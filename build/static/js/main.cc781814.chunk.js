(window.webpackJsonp=window.webpackJsonp||[]).push([[0],Array(18).concat([function(e,t,n){"use strict";(function(e){n.d(t,"b",function(){return C}),n.d(t,"a",function(){return P}),n.d(t,"c",function(){return R});var r,i=n(1),a=n.n(i),o=n(3),s=n(5),c=n(6),u=n(4),l=n(7),h=n(10),d=n(8),f=n(13),p=n(37),v=n(41),m=n(51),y=n(58),b=n(27),g=n(59),w=n(22),k=(n(54),n(61),n(78),n(80),n(30)),x=n(38),E=n(49),O=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},j=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},C=new RegExp("Android|webOS|iPhone|iPad|BlackBerry|Windows Phone|Opera Mini|IEMobile|Mobile","i").test(navigator.userAgent)?{minHeight:"3em"}:void 0,S=(n(62),[]),N=1,P=function(t){function n(e){var t;return Object(o.a)(this,n),(t=Object(c.a)(this,Object(u.a)(n).call(this,e))).waitCount=0,t.isHistoryBack=!1,t.clearError=function(){t.setState({fetchError:void 0})},t.back=t.back.bind(Object(h.a)(Object(h.a)(t))),t.navBack=t.navBack.bind(Object(h.a)(Object(h.a)(t))),t.stack=[],t.state={stack:t.stack,wait:0,fetchError:void 0},t}return Object(l.a)(n,t),Object(s.a)(n,[{key:"componentWillMount",value:function(){return j(this,void 0,void 0,a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:window.addEventListener("popstate",this.navBack);case 1:case"end":return e.stop()}},e,this)}))}},{key:"componentDidMount",value:function(){return j(this,void 0,void 0,a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return R.set(this),e.next=3,R.start();case 3:case"end":return e.stop()}},e,this)}))}},{key:"startWait",value:function(){var t=this;0===this.waitCount&&(this.setState({wait:1}),this.waitTimeHandler=e.setTimeout(function(){t.waitTimeHandler=void 0,t.setState({wait:2})},1e3)),++this.waitCount,this.setState({fetchError:void 0})}},{key:"endWait",value:function(){var e=this;setTimeout(function(){--e.waitCount,0===e.waitCount&&(void 0!==e.waitTimeHandler&&(clearTimeout(e.waitTimeHandler),e.waitTimeHandler=void 0),e.setState({wait:0}))},100)}},{key:"onError",value:function(e){return j(this,void 0,void 0,a.a.mark(function t(){var n;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===(n=e.error)||!0!==n.unauthorized){t.next=5;break}return t.next=4,R.showLogin();case 4:return t.abrupt("return");case 5:this.setState({fetchError:e});case 6:case"end":return t.stop()}},t,this)}))}},{key:"show",value:function(e,t){return this.clear(),this.push(e,t)}},{key:"push",value:function(e,t){this.removeCeased(),this.stack.length>0&&window.history.pushState("forward",null,null);var n=N++;return this.stack.push({key:n,view:e,ceased:!1,disposer:t}),this.refresh(),n}},{key:"replace",value:function(e,t){var n=void 0,r=this.stack;r.length>0&&(n=r.pop());var i=N++;return this.stack.push({key:i,view:e,ceased:!1,disposer:t}),void 0!==n&&this.dispose(n.disposer),this.refresh(),i}},{key:"ceaseTop",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.stack.length-1,n=0;n<e&&!(t<0);n++,t--){this.stack[t].ceased=!0}}},{key:"pop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.stack,n=t.length;if(!(e<=0||n<=1)){n<e&&(e=n);for(var r=0,i=0;i<e&&0!==t.length;i++)this.popAndDispose(),++r;r>=n&&r--,this.refresh(),this.isHistoryBack}}},{key:"popTo",value:function(e){throw new Error("to be designed")}},{key:"removeCeased",value:function(){for(;;){var e=this.stack.length-1;if(e<0)break;if(!1===this.stack[e].ceased)break;var t=this.stack.pop().disposer;this.dispose(t)}this.refresh()}},{key:"popAndDispose",value:function(){this.removeCeased();var e=this.stack.pop();if(void 0!==e){var t=e.disposer;return this.dispose(t),this.removeCeased(),e}}},{key:"dispose",value:function(e){void 0!==e&&(void 0===this.stack.find(function(t){return t.disposer===e})&&e())}},{key:"clear",value:function(){for(this.stack.length;this.stack.length>0;)this.popAndDispose();this.refresh()}},{key:"regConfirmClose",value:function(e){var t=this.stack,n=t.length;0!==n&&(t[n-1].confirmClose=e)}},{key:"navBack",value:function(){R.log("backbutton pressed - nav level: "+this.stack.length),this.isHistoryBack=!0,this.back(!0),this.isHistoryBack=!1}},{key:"back",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return j(this,void 0,void 0,a.a.mark(function t(){var n,r,i;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=this.stack,0!==(r=n.length)){t.next=4;break}return t.abrupt("return");case 4:if(1!==r){t.next=7;break}return self!=window.top&&window.top.postMessage({type:"pop-app"},"*"),t.abrupt("return");case 7:if(i=n[r-1],!0!==e||!i.confirmClose){t.next=16;break}return t.next=11,i.confirmClose();case 11:if(t.t0=t.sent,!0!==t.t0){t.next=14;break}this.pop();case 14:t.next=17;break;case 16:this.pop();case 17:case"end":return t.stop()}},t,this)}))}},{key:"confirmBox",value:function(e){return window.confirm(e)}},{key:"render",value:function(){var e=this.state,t=e.wait,n=e.fetchError,r=this.state.stack,i=r.length-1,a=null,o=null;switch(t){case 1:a=d.createElement("li",{className:"va-wait va-wait1"});break;case 2:a=d.createElement("li",{className:"va-wait va-wait2"},d.createElement("i",{className:"fa fa-spinner fa-spin fa-3x fa-fw"}),d.createElement("span",{className:"sr-only"},"Loading..."))}return n&&(o=d.createElement(y.a,Object.assign({clearError:this.clearError},n))),d.createElement("ul",{className:"va"},r.map(function(e,t){var n=e.key,r=e.view;return d.createElement("li",{key:n,style:t<i?{visibility:"hidden"}:void 0},r)}),a,o)}},{key:"refresh",value:function(){this.setState({stack:this.stack})}},{key:"level",get:function(){return this.stack.length}}]),n}(d.Component),_=function(){function e(){Object(o.a)(this,e),this.local=new g.a,this.user=void 0;var t=x.b.lang,n=x.b.district;this.language=t,this.culture=n}return Object(s.a)(e,[{key:"set",value:function(e){this.nav=e}},{key:"registerReceiveHandler",value:function(e){if(void 0!==this.ws)return this.ws.onWsReceiveAny(e)}},{key:"unregisterReceiveHandler",value:function(e){void 0!==this.ws&&void 0!==e&&this.ws.endWsReceive(e)}},{key:"onReceive",value:function(e){return j(this,void 0,void 0,a.a.mark(function t(){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==this.ws){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.ws.receive(e);case 4:case"end":return t.stop()}},t,this)}))}},{key:"getUnitName",value:function(){return j(this,void 0,void 0,a.a.mark(function e(){var t,n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch("unit.json",{});case 3:return t=e.sent,e.next=6,t.json();case 6:return n=e.sent,e.abrupt("return",n.unit);case 10:return e.prev=10,e.t0=e.catch(0),this.local.unit.clear(),e.abrupt("return");case 14:case"end":return e.stop()}},e,this,[[0,10]])}))}},{key:"loadUnit",value:function(){return j(this,void 0,void 0,a.a.mark(function e(){var t,n,r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(n=this.local.unit.get())){e.next=13;break}if(!0===w.g){e.next=4;break}return e.abrupt("return",n.id);case 4:return e.next=6,this.getUnitName();case 6:if(void 0!==(t=e.sent)){e.next=9;break}return e.abrupt("return");case 9:if(n.name!==t){e.next=11;break}return e.abrupt("return",n.id);case 11:e.next=18;break;case 13:return e.next=15,this.getUnitName();case 15:if(void 0!==(t=e.sent)){e.next=18;break}return e.abrupt("return");case 18:return e.next=20,w.e.unitFromName(t);case 20:return void 0!==(r=e.sent)&&this.local.unit.set({id:r,name:t}),e.abrupt("return",r);case 23:case"end":return e.stop()}},e,this)}))}},{key:"start",value:function(){return j(this,void 0,void 0,a.a.mark(function e(){var t,n,r,i,o,s,c,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return R.clear(),R.push(d.createElement(v.a,{header:!1},d.createElement(E.a,null))),e.next=4,w.f.start();case 4:return t=w.f.url,n=w.f.ws,this.centerHost=t,this.wsHost=n,Object(w.n)(t),e.next=10,this.loadUnit();case 10:if(r=e.sent,w.j.unit=r,void 0!==(i=this.local.guest.get())){e.next=17;break}return e.next=16,w.e.guest();case 16:i=e.sent;case 17:if(R.setGuest(i),o=document.location.hash,console.log("url=%s hash=%s",document.location.origin,o),this.isInFrame=void 0!==o&&""!==o&&o.startsWith("#tv"),!0!==this.isInFrame){e.next=28;break}if(void 0===(s=Object(b.h)(o))){e.next=28;break}return this.ws=k.d,console.log("this.ws = wsBridge in sub frame"),self!==window.parent&&window.parent.postMessage({type:"sub-frame-started",hash:s.hash},"*"),e.abrupt("return");case 28:if(void 0!==(c=this.local.user.get())){e.next=39;break}if(void 0===(u=this.nav.props.notLogined)){e.next=36;break}return e.next=34,u();case 34:e.next=38;break;case 36:return e.next=38,R.showLogin();case 38:return e.abrupt("return");case 39:return e.next=41,R.logined(c);case 41:case"end":return e.stop()}},e,this)}))}},{key:"showAppView",value:function(){return j(this,void 0,void 0,a.a.mark(function e(){var t;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(t=this.nav.props.onLogined)){e.next=4;break}return R.push(d.createElement("div",null,"NavView has no prop onLogined")),e.abrupt("return");case 4:return R.clear(),e.next=7,t();case 7:console.log("logined: AppView shown");case 8:case"end":return e.stop()}},e,this)}))}},{key:"setGuest",value:function(e){this.local.guest.set(e),m.a.set(0,e.token)}},{key:"logined",value:function(e){return j(this,void 0,void 0,a.a.mark(function t(){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return(this.ws=new w.d(this.wsHost,e.token)).connect(),console.log("logined: %s",JSON.stringify(e)),this.local.user.set(e),m.a.set(e.id,e.token),this.user=new p.a(e),t.next=8,this.showAppView();case 8:case"end":return t.stop()}},t,this)}))}},{key:"showLogin",value:function(e){return j(this,void 0,void 0,a.a.mark(function t(){var r,i;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.e(1).then(n.bind(null,107));case 2:r=t.sent,i=d.createElement(r.default,{withBack:e}),!0!==e&&(this.nav.clear(),this.pop()),this.nav.push(i);case 6:case"end":return t.stop()}},t,this)}))}},{key:"logout",value:function(e){return j(this,void 0,void 0,a.a.mark(function t(){var n;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.local.logoutClear(),this.user=void 0,Object(w.i)(),Object(b.f)(),n=this.local.guest.get(),Object(w.m)(0,n&&n.token),this.ws=void 0,!0!==e){t.next=9;break}return t.abrupt("return");case 9:return t.next=11,R.start();case 11:case"end":return t.stop()}},t,this)}))}},{key:"startWait",value:function(){this.nav.startWait()}},{key:"endWait",value:function(){this.nav.endWait()}},{key:"onError",value:function(e){return j(this,void 0,void 0,a.a.mark(function t(){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.nav.onError(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"show",value:function(e,t){this.nav.show(e,t)}},{key:"push",value:function(e,t){this.nav.push(e,t)}},{key:"replace",value:function(e,t){this.nav.replace(e,t)}},{key:"pop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.nav.pop(e)}},{key:"clear",value:function(){this.nav.clear()}},{key:"navBack",value:function(){this.nav.navBack()}},{key:"ceaseTop",value:function(e){this.nav.ceaseTop(e)}},{key:"removeCeased",value:function(){this.nav.removeCeased()}},{key:"back",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return j(this,void 0,void 0,a.a.mark(function t(){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.nav.back(e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"regConfirmClose",value:function(e){this.nav.regConfirmClose(e)}},{key:"confirmBox",value:function(e){return this.nav.confirmBox(e)}},{key:"navToApp",value:function(e,t,n,r,i){var a=this,o=!0===this.centerHost.includes("http://localhost:")?"sheet_debug":"sheet",s=void 0===i?Object(b.b)(e,t):Object(b.b)(e,t,o,[n,r,i]);console.log("navToApp: %s",JSON.stringify(s)),R.push(d.createElement("article",{className:"app-container"},d.createElement("span",{id:s.hash,onClick:function(){return a.back()},style:C},d.createElement("i",{className:"fa fa-arrow-left"})),d.createElement("iframe",{src:s.url})))}},{key:"navToSite",value:function(e){window.open(e)}},{key:"log",value:function(e){S.push(e)}},{key:"logMark",value:function(){var e=new Date;r=e.getTime(),S.push("log-mark: "+e.toTimeString())}},{key:"logStep",value:function(e){S.push(e+": "+((new Date).getTime()-r))}},{key:"guest",get:function(){var e=this.local.guest;if(void 0===e)return 0;var t=e.get();return void 0===t?0:t.guest}},{key:"level",get:function(){return this.nav.level}},{key:"logs",get:function(){return S}}]),e}();O([f.l],_.prototype,"user",void 0);var R=new _}).call(this,n(31))},,,,function(e,t,n){"use strict";var r=n(30),i=n(43),a=n(1),o=n.n(a),s=n(3),c=n(5),u=n(6),l=n(4),h=n(7),d=n(37),f=n(29),p=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},v=new(function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(c.a)(t,[{key:"guest",value:function(){return p(this,void 0,void 0,o.a.mark(function e(){var t,n;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get("",{});case 2:t=e.sent,e.t0=typeof t,e.next="string"===e.t0?7:"object"===e.t0?8:6;break;case 6:return e.abrupt("return");case 7:return e.abrupt("return",Object(d.b)(t));case 8:return n=Object(d.b)(t.token),e.abrupt("return",n);case 10:case"end":return e.stop()}},e,this)}))}},{key:"unitFromName",value:function(e){return p(this,void 0,void 0,o.a.mark(function t(){var n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get(e);case 2:return n=t.sent,t.abrupt("return",n&&n.unit);case 4:case"end":return t.stop()}},t,this)}))}}]),t}(f.a))("tv/guest/",void 0),m=n(27),y=n(34);n(39);n.d(t,"d",function(){return r.a}),n.d(t,"k",function(){return r.b}),n.d(t,"l",function(){return i.b}),n.d(t,"e",function(){return v}),n.d(t,"i",function(){return f.g}),n.d(t,"c",function(){return f.d}),n.d(t,"b",function(){return f.c}),n.d(t,"n",function(){return f.i}),n.d(t,"m",function(){return f.h}),n.d(t,"a",function(){return f.a}),n.d(t,"j",function(){return m.g}),n.d(t,"h",function(){return m.e}),n.d(t,"g",function(){return y.b}),n.d(t,"f",function(){return y.a})},,,,,function(e,t,n){"use strict";n.d(t,"f",function(){return m}),n.d(t,"g",function(){return b}),n.d(t,"d",function(){return g}),n.d(t,"h",function(){return O}),n.d(t,"b",function(){return j}),n.d(t,"e",function(){return C}),n.d(t,"a",function(){return S}),n.d(t,"c",function(){return P});var r=n(1),i=n.n(r),a=n(3),o=n(5),s=n(23),c=n.n(s),u=n(33),l=n(36),h=n(29),d=n(30),f=n(34),p=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},v={};function m(){for(var e in v)v[e]=void 0}var y={},b=new(function(){function e(){Object(a.a)(this,e)}return Object(o.a)(e,[{key:"unit",get:function(){return this._unit},set:function(e){this._unit=e}}]),e}());function g(){return self!==window.parent}function w(e){var t,n,r=e.data,i=e.source;Object(d.c)(i),t=r.hash,void 0!==(n=document.getElementById(t))&&(n.hidden=!0);var a=c.a.clone(u.g.user);a.type="init-sub-win",i.postMessage(a,"*")}function k(e){return p(this,void 0,void 0,i.a.mark(function t(){return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("initSubWin: set nav.user",e),u.g.user=e,t.next=4,u.g.showAppView();case 4:case"end":return t.stop()}},t,this)}))}function x(e,t){return p(this,void 0,void 0,i.a.mark(function n(){var r,a,o,s;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==(r=y[e])){n.next=3;break}return n.abrupt("return",{name:t,url:void 0,urlDebug:void 0,token:void 0});case 3:return a=r.unit,o=t.split("/"),n.next=7,h.j.uq({unit:a,uqOwner:o[0],uqName:o[1]});case 7:if(void 0!==(s=n.sent)){n.next=11;break}throw console.log("apiTokenApi.api return undefined. api=%s, unit=%s",t,a),"api not found";case 11:return n.abrupt("return",{name:t,url:s.url,urlDebug:s.urlDebug,token:s.token});case 12:case"end":return n.stop()}},n,this)}))}function E(e){return p(this,void 0,void 0,i.a.mark(function t(){var n,r,a,o,s,c;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.apiName,r=e.url,a=e.urlDebug,o=e.token,void 0!==(s=v[n])){t.next=4;break}throw"error app api return";case 4:c=f.a.getUrlOrDebug(r,a),console.log("onAppApiReturn(message:any): url="+r+", debug="+a+", real="+c),s.url=c,s.token=o,s.resolve(s);case 9:case"end":return t.stop()}},t,this)}))}function O(e){var t=e.split("-"),n=t.length;return b.hash=t[0].substr(3),n>0&&(b.unit=Number(t[1])),n>1&&(b.page=t[2]),n>2&&(b.param=t.slice(3)),b}function j(e,t,n,r){for(var i;;){if(i=Object(l.a)(),void 0===y[i]){y[i]={hash:i,unit:t};break}}if(e+="#tv"+i+"-"+t,void 0!==n&&(e+="-"+n,void 0!==r))for(var a=0;a<r.length;a++)e+="-"+r[a];return{url:e,hash:i}}function C(e,t){return p(this,void 0,void 0,i.a.mark(function n(){var r,a,o;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=new h.b("tv/",void 0),a=b.unit,n.next=4,r.uqs(a,e,t);case 4:return o=n.sent,r.checkUqs(a,e,t).then(function(e){!1===e&&u.g.start()}),n.abrupt("return",o);case 7:case"end":return n.stop()}},n,this)}))}function S(e,t,n){return p(this,void 0,void 0,i.a.mark(function r(){var a,o,s,c,u,l=this;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(void 0===(a=v[e])){r.next=3;break}return r.abrupt("return",a);case 3:if(g()){r.next=17;break}return r.next=6,h.j.uq({unit:b.unit,uqOwner:t,uqName:n});case 6:if(void 0!==(a=r.sent)){r.next=10;break}throw"unauthorized call: uqTokenApi center return undefined!","unauthorized call: uqTokenApi center return undefined!";case 10:return void 0===a.token&&(a.token=h.f),s=(o=a).url,c=o.urlDebug,u=f.a.getUrlOrDebug(s,c),console.log("realUrl: %s",u),a.url=u,v[e]=a,r.abrupt("return",a);case 17:return console.log("appApi parent send: %s",b.hash),a={name:e,url:void 0,urlDebug:void 0,token:void 0,resolve:void 0,reject:void 0},v[e]=a,r.abrupt("return",new Promise(function(t,n){a.resolve=function(e){return p(l,void 0,void 0,i.a.mark(function n(){var r;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e;case 2:r=n.sent,console.log("return from parent window: %s",JSON.stringify(r)),a.url=r.url,a.urlDebug=r.urlDebug,a.token=r.token,t(a);case 8:case"end":return n.stop()}},n,this)}))},a.reject=n,(window.opener||window.parent).postMessage({type:"app-api",apiName:e,hash:b.hash},"*")}));case 21:case"end":return r.stop()}},r,this)}))}window.addEventListener("message",function(e){return p(this,void 0,void 0,i.a.mark(function t(){var n,r;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=e.data,t.t0=n.type,t.next="sub-frame-started"===t.t0?4:"ws"===t.t0?6:"init-sub-win"===t.t0?9:"pop-app"===t.t0?12:"center-api"===t.t0?14:"center-api-return"===t.t0?17:"app-api"===t.t0?19:"app-api-return"===t.t0?26:31;break;case 4:return w(e),t.abrupt("break",33);case 6:return t.next=8,u.g.onReceive(n.msg);case 8:return t.abrupt("break",33);case 9:return t.next=11,k(n);case 11:return t.abrupt("break",33);case 12:return u.g.navBack(),t.abrupt("break",33);case 14:return t.next=16,_(e.source,n);case 16:return t.abrupt("break",33);case 17:return R(n),t.abrupt("break",33);case 19:return console.log("receive PostMessage: %s",JSON.stringify(n)),t.next=22,x(n.hash,n.apiName);case 22:return r=t.sent,console.log("onReceiveAppApiMessage: %s",JSON.stringify(r)),e.source.postMessage({type:"app-api-return",apiName:n.apiName,url:r.url,urlDebug:r.urlDebug,token:r.token},"*"),t.abrupt("break",33);case 26:return console.log("app-api-return: %s",JSON.stringify(n)),console.log("await onAppApiReturn(message);"),t.next=30,E(n);case 30:return t.abrupt("break",33);case 31:return this.console.log("message: %s",JSON.stringify(n)),t.abrupt("break",33);case 33:case"end":return t.stop()}},t,this)}))});var N={};function P(e,t,n){return p(this,void 0,void 0,i.a.mark(function r(){var a=this;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("bridgeCenterApi: url=%s, method=%s",e,t),r.next=3,new Promise(function(r,o){return p(a,void 0,void 0,i.a.mark(function a(){var s;return i.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(s=Object(l.a)(),void 0!==N[s]){i.next=5;break}return N[s]={id:s,resolve:r,reject:o},i.abrupt("break",7);case 5:i.next=0;break;case 7:(window.opener||window.parent).postMessage({type:"center-api",callId:s,url:e,method:t,body:n},"*");case 8:case"end":return i.stop()}},a,this)}))});case 3:return r.abrupt("return",r.sent);case 4:case"end":return r.stop()}},r,this)}))}function _(e,t){return p(this,void 0,void 0,i.a.mark(function n(){var r,a,o,s,c;return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.callId,a=t.url,o=t.method,s=t.body,n.next=3,h.e.directCall(a,o,s);case 3:c=n.sent,e.postMessage({type:"center-api-return",callId:r,result:c},"*");case 5:case"end":return n.stop()}},n,this)}))}function R(e){var t=e.callId,n=e.result,r=N[t];void 0!==r&&(N[t]=void 0,r.resolve(n))}},,function(e,t,n){"use strict";var r=n(6),i=n(4),a=n(7),o=n(1),s=n.n(o),c=n(3),u=n(5),l=n(23),h=n.n(l),d=n(39),f=n(18),p=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},v=function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,[{key:"startWait",value:function(){f.c.startWait()}},{key:"endWait",value:function(){f.c.endWait()}},{key:"showError",value:function(e){return p(this,void 0,void 0,s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return f.c.endWait(),t.next=3,f.c.onError(e);case 3:case"end":return t.stop()}},t,this)}))}}]),e}(),m=n(27),y=n(43),b=n(34);n.d(t,"g",function(){return x}),n.d(t,"d",function(){return O}),n.d(t,"c",function(){return S}),n.d(t,"i",function(){return N}),n.d(t,"f",function(){return R}),n.d(t,"h",function(){return q}),n.d(t,"a",function(){return I}),n.d(t,"j",function(){return F}),n.d(t,"e",function(){return V}),n.d(t,"b",function(){return T});var g=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},w={},k={};function x(){w={},k={},j={}}var E=new(function(){function e(){Object(c.a)(this,e)}return Object(u.a)(e,[{key:"loadAccess",value:function(e){return g(this,void 0,void 0,s.a.mark(function t(){var n,r,i,a,o,c,u,l,d,f,p;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=e.uqOwner,r=e.uqName,void 0===this.local&&null!==(i=localStorage.getItem("uqLocalEntities"))&&(this.local=JSON.parse(i)),void 0!==this.local)if(a=this.local,o=a.user,c=a.uqs,o!==A||void 0===c)this.local=void 0;else for(u in c)c[u].isNet=void 0;if(void 0===this.local&&(this.local={user:A,unit:void 0,uqs:{}}),d=n+"/"+r,void 0!==(f=this.local.uqs[d])&&(p=f.value,l=p),void 0!==l){t.next=13;break}return t.next=11,e.__loadAccess();case 11:l=t.sent,this.saveLocal(d,l);case 13:return t.abrupt("return",h.a.cloneDeep(l));case 16:throw t.prev=16,t.t0=t.catch(0),this.local=void 0,localStorage.removeItem("uqLocalEntities"),t.t0;case 21:case"end":return t.stop()}},t,this,[[0,16]])}))}},{key:"saveLocal",value:function(e,t){this.local.uqs[e]={value:t,isNet:!0};var n=JSON.stringify(this.local);localStorage.setItem("uqLocalEntities",n)}},{key:"checkAccess",value:function(e){return g(this,void 0,void 0,s.a.mark(function t(){var n,r,i,a,o,c,u,l;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.uqOwner,r=e.uqName,i=n+"/"+r,void 0!==(a=this.local.uqs[i])){t.next=5;break}return t.abrupt("return",!1);case 5:if(o=a.isNet,c=a.value,!0!==o){t.next=8;break}return t.abrupt("return",!0);case 8:return t.next=10,e.__loadAccess();case 10:return u=t.sent,!1===(l=h.a.isMatch(c,u))&&this.saveLocal(i,u),t.abrupt("return",l);case 14:case"end":return t.stop()}},t,this)}))}}]),e}()),O=function(e){function t(e,n,a,o,s){var u;return Object(c.a)(this,t),u=Object(r.a)(this,Object(i.a)(t).call(this,e,s)),a&&(u.uqOwner=n,u.uqName=a,u.uq=n+"/"+a),u.access=o,u.showWaiting=s,u}return Object(a.a)(t,e),Object(u.a)(t,[{key:"getHttpChannel",value:function(){return g(this,void 0,void 0,s.a.mark(function e(){var t,n,r,i;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!0===this.showWaiting||void 0===this.showWaiting?(t=w,n=new v):t=k,void 0===(r=t[this.uq])){e.next=4;break}return e.abrupt("return",r);case 4:return e.next=6,Object(m.a)(this.uq,this.uqOwner,this.uqName);case 6:return i=e.sent,this.token=i.token,r=new d.a(!1,i.url,i.token,n),e.abrupt("return",t[this.uq]=r);case 10:case"end":return e.stop()}},e,this)}))}},{key:"update",value:function(){return g(this,void 0,void 0,s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get("update");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"__loadAccess",value:function(){return g(this,void 0,void 0,s.a.mark(function e(){var t,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=void 0===this.access?"":this.access.join("|"),e.next=3,this.get("access",{acc:t});case 3:return n=e.sent,e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}))}},{key:"loadAccess",value:function(){return g(this,void 0,void 0,s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.loadAccess(this);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"loadEntities",value:function(){return g(this,void 0,void 0,s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get("entities");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"checkAccess",value:function(){return g(this,void 0,void 0,s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,E.checkAccess(this);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"schema",value:function(e){return g(this,void 0,void 0,s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get("schema/"+e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"schemas",value:function(e){return g(this,void 0,void 0,s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.post("schema",e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"tuidGet",value:function(e,t){return g(this,void 0,void 0,s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.get("tuid/"+e+"/"+t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"tuidGetAll",value:function(e){return g(this,void 0,void 0,s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get("tuid-all/"+e+"/");case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"tuidSave",value:function(e,t){return g(this,void 0,void 0,s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.post("tuid/"+e,t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"tuidSearch",value:function(e,t,n,r,i,a){return g(this,void 0,void 0,s.a.mark(function o(){var c;return s.a.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,this.post("tuids/"+e,{arr:t,owner:n,key:r,pageStart:i,pageSize:a});case 2:return c=o.sent,o.abrupt("return",c);case 4:case"end":return o.stop()}},o,this)}))}},{key:"tuidArrGet",value:function(e,t,n,r){return g(this,void 0,void 0,s.a.mark(function i(){return s.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.get("tuid-arr/"+e+"/"+n+"/"+t+"/"+r);case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}},i,this)}))}},{key:"tuidArrGetAll",value:function(e,t,n){return g(this,void 0,void 0,s.a.mark(function r(){return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.get("tuid-arr-all/"+e+"/"+n+"/"+t+"/");case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}},r,this)}))}},{key:"tuidArrSave",value:function(e,t,n,r){return g(this,void 0,void 0,s.a.mark(function i(){return s.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.post("tuid-arr/"+e+"/"+n+"/"+t+"/",r);case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}},i,this)}))}},{key:"tuidArrPos",value:function(e,t,n,r,i){return g(this,void 0,void 0,s.a.mark(function a(){return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.post("tuid-arr-pos/"+e+"/"+n+"/"+t+"/",{id:r,$order:i});case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}},a,this)}))}},{key:"tuidIds",value:function(e,t,n){return g(this,void 0,void 0,s.a.mark(function r(){var i,a;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,i="tuidids/"+e+"/",i+=void 0!==t?t:"$",r.next=5,this.post(i,n);case 5:return a=r.sent,r.abrupt("return",a);case 9:r.prev=9,r.t0=r.catch(0),console.error(r.t0);case 12:case"end":return r.stop()}},r,this,[[0,9]])}))}},{key:"proxied",value:function(e,t,n){return g(this,void 0,void 0,s.a.mark(function r(){var i,a;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,i="tuid-proxy/"+e+"/"+t+"/"+n,r.next=4,this.get(i);case 4:return a=r.sent,r.abrupt("return",a);case 8:r.prev=8,r.t0=r.catch(0),console.error(r.t0);case 11:case"end":return r.stop()}},r,this,[[0,8]])}))}},{key:"sheetSave",value:function(e,t){return g(this,void 0,void 0,s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.post("sheet/"+e,t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"sheetAction",value:function(e,t){return g(this,void 0,void 0,s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.put("sheet/"+e,t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"stateSheets",value:function(e,t){return g(this,void 0,void 0,s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.post("sheet/"+e+"/states",t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"stateSheetCount",value:function(e){return g(this,void 0,void 0,s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get("sheet/"+e+"/statecount");case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"getSheet",value:function(e,t){return g(this,void 0,void 0,s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.get("sheet/"+e+"/get/"+t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"sheetArchives",value:function(e,t){return g(this,void 0,void 0,s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.post("sheet/"+e+"/archives",t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"sheetArchive",value:function(e,t){return g(this,void 0,void 0,s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.get("sheet/"+e+"/archive/"+t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"action",value:function(e,t){return g(this,void 0,void 0,s.a.mark(function n(){return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.post("action/"+e,t);case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}},n,this)}))}},{key:"page",value:function(e,t,n,r){return g(this,void 0,void 0,s.a.mark(function i(){var a;return s.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:i.t0=typeof r,i.next="undefined"===i.t0?3:5;break;case 3:return a={key:""},i.abrupt("break",7);case 5:return a=h.a.clone(r),i.abrupt("break",7);case 7:return a.$pageStart=t,a.$pageSize=n,i.next=11,this.post("query-page/"+e,a);case 11:return i.abrupt("return",i.sent);case 12:case"end":return i.stop()}},i,this)}))}},{key:"query",value:function(e,t){return g(this,void 0,void 0,s.a.mark(function n(){var r;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.post("query/"+e,t);case 2:return r=n.sent,n.abrupt("return",r);case 4:case"end":return n.stop()}},n,this)}))}},{key:"user",value:function(){return g(this,void 0,void 0,s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.get("user");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}}]),t}(y.a),j={};var C,S=function(e){function t(e){var n;return Object(c.a)(this,t),(n=Object(r.a)(this,Object(i.a)(t).call(this,"tv/",void 0,void 0,void 0,!0))).unitId=e,n}return Object(a.a)(t,e),Object(u.a)(t,[{key:"getHttpChannel",value:function(){return g(this,void 0,void 0,s.a.mark(function e(){var t;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===(t=j[this.unitId])){e.next=3;break}return e.abrupt("return",t);case 3:return e.next=5,this.buildChannel();case 5:return e.abrupt("return",j[this.unitId]=e.sent);case 6:case"end":return e.stop()}},e,this)}))}},{key:"buildChannel",value:function(){return g(this,void 0,void 0,s.a.mark(function e(){var t,n,r,i,a,o,c;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new v,n=new T("tv/",void 0),e.next=4,n.unitxUq(this.unitId);case 4:return r=e.sent,i=r.token,a=r.url,o=r.urlDebug,c=b.a.getUrlOrDebug(a,o),this.token=i,e.abrupt("return",new d.a(!1,c,i,t));case 9:case"end":return e.stop()}},e,this)}))}}]),t}(O);function N(e){console.log("setCenterUrl %s",e),C=e,R=void 0,_=void 0,P=void 0}var P,_,R=void 0,A=0;function q(e,t){R=t,console.log("setCenterToken %s",t),_=void 0,P=void 0}var I=function(e){function t(e,n){return Object(c.a)(this,t),Object(r.a)(this,Object(i.a)(t).call(this,e,n))}return Object(a.a)(t,e),Object(u.a)(t,[{key:"getHttpChannel",value:function(){return g(this,void 0,void 0,s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0===this.showWaiting||void 0===this.showWaiting?void 0!==P?P:P=new d.a(!0,C,R,new v):void 0!==_?_:_=new d.a(!0,C,R));case 1:case"end":return e.stop()}},e,this)}))}}]),t}(y.a),F=new(function(e){function t(){return Object(c.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(a.a)(t,e),Object(u.a)(t,[{key:"uq",value:function(e){return g(this,void 0,void 0,s.a.mark(function t(){var n,r,i,a,o,c,u,l,h,d,f,p,v;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=e.unit,r=e.uqOwner,i=e.uqName,void 0===this.local&&null!==(a=localStorage.getItem("uqTokens"))&&(this.local=JSON.parse(a)),void 0!==this.local&&(o=this.local,c=o.unit,u=o.user,c===n&&u===A||(this.local=void 0)),void 0===this.local&&(this.local={user:A,unit:e.unit,uqs:{}}),l=r+"/"+i,h=(new Date).getTime(),void 0===(d=this.local.uqs[l])){t.next=12;break}if(f=d.tick,p=d.value,!(h-f<864e5)){t.next=12;break}return t.abrupt("return",p);case 12:return t.next=14,this.get("app-uq",e);case 14:return v=t.sent,this.local.uqs[l]={tick:h,value:v},localStorage.setItem("uqTokens",JSON.stringify(this.local)),t.abrupt("return",v);case 20:throw t.prev=20,t.t0=t.catch(0),this.local=void 0,localStorage.removeItem("uqTokens"),t.t0;case 25:case"end":return t.stop()}},t,this,[[0,20]])}))}}]),t}(I))("tv/tie/",void 0),V=new(function(e){function t(){return Object(c.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(a.a)(t,e),Object(u.a)(t,[{key:"directCall",value:function(e,t,n){return this.call(e,t,n)}}]),t}(I))("",void 0),T=function(e){function t(){return Object(c.a)(this,t),Object(r.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(a.a)(t,e),Object(u.a)(t,[{key:"uqs",value:function(e,t,n){return g(this,void 0,void 0,s.a.mark(function r(){var i,a,o,c,u,l,d,f;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(null!==(a=localStorage.getItem("appUqs"))&&(o=JSON.parse(a),c=o.unit,u=o.appOwner,l=o.appName,d=o.value,e===c&&t===u&&n===l&&(i=d)),void 0!==i){r.next=8;break}return r.next=5,this.uqsPure(e,t,n);case 5:i=r.sent,f={unit:e,appOwner:t,appName:n,value:i},localStorage.setItem("appUqs",JSON.stringify(f));case 8:return r.abrupt("return",this.cachedUqs=h.a.cloneDeep(i));case 9:case"end":return r.stop()}},r,this)}))}},{key:"uqsPure",value:function(e,t,n){return g(this,void 0,void 0,s.a.mark(function r(){return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.get("tie/app-uqs",{unit:e,appOwner:t,appName:n});case 2:return r.abrupt("return",r.sent);case 3:case"end":return r.stop()}},r,this)}))}},{key:"checkUqs",value:function(e,t,n){return g(this,void 0,void 0,s.a.mark(function r(){var i;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.uqsPure(e,t,n);case 2:return i=r.sent,r.abrupt("return",h.a.isMatch(this.cachedUqs,i));case 4:case"end":return r.stop()}},r,this)}))}},{key:"unitxUq",value:function(e){return g(this,void 0,void 0,s.a.mark(function t(){return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get("tie/unitx-uq",{unit:e});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}}]),t}(I)},function(e,t,n){"use strict";n.d(t,"c",function(){return f}),n.d(t,"b",function(){return p}),n.d(t,"d",function(){return y}),n.d(t,"a",function(){return b});var r,i=n(6),a=n(4),o=n(7),s=n(1),c=n.n(s),u=n(3),l=n(5),h=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};function d(e){void 0!==r&&r.postMessage({type:"ws",msg:e},"*")}function f(e){r=e}function p(e){window.top.postMessage({type:"ws",msg:e},"*")}var v=function(){function e(){Object(u.a)(this,e),this.handlerSeed=1,this.anyHandlers={},this.msgHandlers={}}return Object(l.a)(e,[{key:"onWsReceiveAny",value:function(e){var t=this.handlerSeed++;return this.anyHandlers[t]=e,t}},{key:"onWsReceive",value:function(e,t){var n=this.handlerSeed++;return this.msgHandlers[n]={type:e,handler:t},n}},{key:"endWsReceive",value:function(e){delete this.anyHandlers[e],delete this.msgHandlers[e]}},{key:"receive",value:function(e){return h(this,void 0,void 0,c.a.mark(function t(){var n,r,i,a,o,s;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=e.$type,t.t0=c.a.keys(this.anyHandlers);case 2:if((t.t1=t.t0()).done){t.next=8;break}return r=t.t1.value,t.next=6,this.anyHandlers[r](e);case 6:t.next=2;break;case 8:t.t2=c.a.keys(this.msgHandlers);case 9:if((t.t3=t.t2()).done){t.next=18;break}if(i=t.t3.value,a=this.msgHandlers[i],o=a.type,s=a.handler,o===n){t.next=14;break}return t.abrupt("continue",9);case 14:return t.next=16,s(e);case 16:t.next=9;break;case 18:case"end":return t.stop()}},t,this)}))}}]),e}(),m=1,y=new(function(e){function t(){var e;return Object(u.a)(this,t),(e=Object(i.a)(this,Object(a.a)(t).apply(this,arguments))).wsBaseId="WsBridge seed "+m++,e}return Object(o.a)(t,e),t}(v)),b=function(e){function t(e,n){var r;return Object(u.a)(this,t),(r=Object(i.a)(this,Object(a.a)(t).call(this))).wsBaseId="WSChannel seed "+m++,r.wsHost=e,r.token=n,r}return Object(o.a)(t,e),Object(l.a)(t,[{key:"connect",value:function(){var e=this;if(void 0===this.ws){var n=this;return new Promise(function(r,i){var a=new WebSocket(e.wsHost,e.token||t.centerToken);console.log("connect webSocket %s",e.wsHost),a.onopen=function(t){console.log("webSocket connected %s",e.wsHost),n.ws=a,r()},a.onerror=function(e){i("webSocket can't open!")},a.onmessage=function(t){return h(e,void 0,void 0,c.a.mark(function e(){return c.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.wsMessage(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))},a.onclose=function(e){n.ws=void 0,console.log("webSocket closed!")}})}}},{key:"close",value:function(){void 0!==this.ws&&(this.ws.close(),this.ws=void 0)}},{key:"wsMessage",value:function(e){return h(this,void 0,void 0,c.a.mark(function t(){var n;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,console.log("websocket message: %s",e.data),d(n=JSON.parse(e.data)),t.next=6,this.receive(n);case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.log("ws msg error: ",t.t0);case 11:case"end":return t.stop()}},t,this,[[0,8]])}))}},{key:"sendWs",value:function(e){var t=this;this.connect().then(function(){t.ws.send(e)})}}],[{key:"setCenterToken",value:function(e){t.centerToken=e}}]),t}(v)},,,function(e,t,n){"use strict";var r=n(18),i=(n(44),n(41)),a=n(8),o=n(3),s=n(5),c=n(6),u=n(4),l=n(7),h=n(15),d=n.n(h),f=(a.Component,a.Component,n(1)),p=n.n(f),v=n(22),m=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},y=function(){function e(t){var n=this;Object(o.a)(this,e),this.isDev=v.g,this.onMessageReceive=function(e){return m(n,void 0,void 0,p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.onMessage(e);case 2:case"end":return t.stop()}},t,this)}))},this.res=t||{},this.x=this.res.x||{}}return Object(s.a)(e,[{key:"dispose",value:function(){r.c.unregisterReceiveHandler(this.receiveHandlerId),this.onDispose()}},{key:"onDispose",value:function(){}},{key:"showVPage",value:function(e,t){return m(this,void 0,void 0,p.a.mark(function n(){return p.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,new e(this).showEntry(t);case 2:case"end":return n.stop()}},n,this)}))}},{key:"renderView",value:function(e,t){return new e(this).render(t)}},{key:"event",value:function(e,t){return m(this,void 0,void 0,p.a.mark(function n(){return p.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.onEvent(e,t);case 2:case"end":return n.stop()}},n,this)}))}},{key:"onEvent",value:function(e,t){return m(this,void 0,void 0,p.a.mark(function e(){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)}))}},{key:"msg",value:function(e){alert(e)}},{key:"errorPage",value:function(e,t){this.openPage(a.createElement(i.a,{header:"App error!"},a.createElement("pre",null,"string"===typeof t?t:t.message)))}},{key:"onMessage",value:function(e){}},{key:"beforeStart",value:function(){return m(this,void 0,void 0,p.a.mark(function e(){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!0);case 1:case"end":return e.stop()}},e,this)}))}},{key:"registerReceiveHandler",value:function(){this.receiveHandlerId=r.c.registerReceiveHandler(this.onMessageReceive)}},{key:"start",value:function(e){return m(this,void 0,void 0,p.a.mark(function t(){return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.disposer=this.dispose.bind(this),this.registerReceiveHandler(),t.next=4,this.beforeStart();case 4:if(!1!==t.sent){t.next=7;break}return t.abrupt("return");case 7:return t.next=9,this.internalStart(e);case 9:case"end":return t.stop()}},t,this)}))}},{key:"call",value:function(e){return m(this,void 0,void 0,p.a.mark(function t(){var n=this;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===this._resolve_$&&(this._resolve_$=[]),t.abrupt("return",new Promise(function(t,r){return m(n,void 0,void 0,p.a.mark(function n(){return p.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this._resolve_$.push(t),n.next=3,this.start(e);case 3:case"end":return n.stop()}},n,this)}))}));case 2:case"end":return t.stop()}},t,this)}))}},{key:"vCall",value:function(e,t){return m(this,void 0,void 0,p.a.mark(function n(){var r=this;return p.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return void 0===this._resolve_$&&(this._resolve_$=[]),n.abrupt("return",new Promise(function(n,i){return m(r,void 0,void 0,p.a.mark(function r(){return p.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return this._resolve_$.push(n),r.next=3,new e(this).showEntry(t);case 3:case"end":return r.stop()}},r,this)}))}));case 2:case"end":return n.stop()}},n,this)}))}},{key:"returnCall",value:function(e){if(void 0!==this._resolve_$){var t=this._resolve_$.pop();void 0!==t?t(e):alert("the Coordinator call already returned, or not called")}}},{key:"openPage",value:function(e){r.c.push(e,this.disposer),this.disposer=void 0}},{key:"replacePage",value:function(e){r.c.replace(e,this.disposer),this.disposer=void 0}},{key:"backPage",value:function(){r.c.back()}},{key:"closePage",value:function(e){r.c.pop(e)}},{key:"ceasePage",value:function(e){r.c.ceaseTop(e)}},{key:"removeCeased",value:function(){r.c.removeCeased()}},{key:"regConfirmClose",value:function(e){r.c.regConfirmClose(e)}},{key:"user",get:function(){return r.c.user}},{key:"isLogined",get:function(){var e=r.c.user;return void 0!==e&&e.id>0}},{key:"isCalling",get:function(){return void 0!==this._resolve_$}}]),e}(),b=function(){function e(t){Object(o.a)(this,e),this.controller=t,this.res=t.res,this.x=t.x}return Object(s.a)(e,[{key:"renderVm",value:function(e,t){return new e(this.controller).render(t)}},{key:"showVPage",value:function(e,t){return m(this,void 0,void 0,p.a.mark(function n(){return p.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,new e(this.controller).showEntry(t);case 2:case"end":return n.stop()}},n,this)}))}},{key:"event",value:function(e,t){return m(this,void 0,void 0,p.a.mark(function n(){return p.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.controller.event(e,t);case 2:case"end":return n.stop()}},n,this)}))}},{key:"returnCall",value:function(e){this.controller.returnCall(e)}},{key:"openPage",value:function(e,t){this.controller.openPage(a.createElement(e,t))}},{key:"replacePage",value:function(e,t){this.controller.replacePage(a.createElement(e,t))}},{key:"openPageElement",value:function(e){this.controller.openPage(e)}},{key:"replacePageElement",value:function(e){this.controller.replacePage(e)}},{key:"backPage",value:function(){this.controller.backPage()}},{key:"closePage",value:function(e){this.controller.closePage(e)}},{key:"ceasePage",value:function(e){this.controller.ceasePage(e)}},{key:"removeCeased",value:function(){this.controller.removeCeased()}},{key:"regConfirmClose",value:function(e){this.controller.regConfirmClose(e)}},{key:"isDev",get:function(){return v.g}}]),e}(),g=function(e){function t(e){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,e))}return Object(l.a)(t,e),Object(s.a)(t,[{key:"render",value:function(e){return null}}]),t}(b),w=n(10),k=n(13),x=n(28),E=n(21),O=n(19),j=n(23),C=n.n(j),S=function e(){Object(o.a)(this,e)},N=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this))).func=e,n}return Object(l.a)(t,e),Object(s.a)(t,[{key:"check",value:function(e,t){var n=this.func(t);if(void 0!==n)switch(typeof n){case"undefined":return;case"string":return void e.push(n);default:return void e.push.apply(e,Object(E.a)(n))}}}]),t}(S),P=function(e){function t(e){var n;return Object(o.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this))).res=e,n}return Object(l.a)(t,e),t}(S),_=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(s.a)(t,[{key:"check",value:function(e,t){switch(typeof t){default:case"boolean":return;case"object":if(null!==t)return;break;case"string":if(t.trim().length>0)return;break;case"number":if(NaN!==t)return;break;case"undefined":}e.push(this.res.required)}}]),t}(P),R=function(e){function t(e,n,r){var i;return Object(o.a)(this,t),(i=Object(c.a)(this,Object(u.a)(t).call(this,e))).minMsg=C.a.template(e.min),i.maxMsg=C.a.template(e.max),i.min=n,i.max=r,i}return Object(l.a)(t,e),Object(s.a)(t,[{key:"check",value:function(e,t){if(void 0!==t&&null!==t){var n=Number(t);NaN===n?e.push(this.res.number):this.checkMore(e,n)}}},{key:"checkMore",value:function(e,t){void 0!==this.min&&Number(t)<this.min&&e.push(this.minMsg({min:this.min})),void 0!==this.max&&Number(t)>this.max&&e.push(this.maxMsg({max:this.max}))}}]),t}(P),A=function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(s.a)(t,[{key:"checkMore",value:function(e,n){Object(O.a)(Object(u.a)(t.prototype),"checkMore",this).call(this,e,n),!1===Number.isInteger(n)&&e.push(this.res.integer)}}]),t}(R),q=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},I=function(){function e(t,n,r,i){var a=this;Object(o.a)(this,e),this.errors=[],this.contextErrors=[],this.onInputChange=function(e){a.changeValue(e.target.value,!0)},this.context=t;var s=n.name;if(this.name=s,this.itemSchema=n,this.fieldProps=r,this.children=i,this.ui=t.getUiItem(s),void 0===this.ui)this.readOnly=!1,this.disabled=!1,this.visible=!0;else{var c=this.ui,u=c.readOnly,l=c.disabled,h=c.visible;this.readOnly=!0===u,this.disabled=!0===l,this.visible=!(!1===h)}this.value=this.defaultValue=t.getValue(s),this.init()}return Object(s.a)(e,[{key:"init",value:function(){if(this.rules=[],!0===this.itemSchema.required&&this.rules.push(new _(this.context.form.res)),this.buildRules(),void 0!==this.ui){var e=this.ui.rules;if(void 0!==e)if(!1!==Array.isArray(e)){var t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.rules.push(new N(o))}}catch(s){n=!0,r=s}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}else this.rules.push(new N(e))}}},{key:"buildRules",value:function(){}},{key:"checkRules",value:function(){var e,t=[],n=!0,r=!1,i=void 0;try{for(var a,o=this.rules[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){a.value.check(t,this.value)}}catch(s){r=!0,i=s}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}0===t.length?this.context.removeErrorWidget(this):(this.context.addErrorWidget(this),(e=this.errors).push.apply(e,t))}},{key:"setError",value:function(e){var t;void 0!==e&&("string"===typeof e?this.errors.push(e):(t=this.errors).push.apply(t,Object(E.a)(e)))}},{key:"setContextError",value:function(e){var t;void 0!==e&&("string"===typeof e?this.contextErrors.push(e):(t=this.contextErrors).push.apply(t,Object(E.a)(e)))}},{key:"clearError",value:function(){this.errors.splice(0)}},{key:"clearContextError",value:function(){this.contextErrors.splice(0)}},{key:"parse",value:function(e){return e}},{key:"setElementValue",value:function(e){}},{key:"setDataValue",value:function(e){!0!==this.isChanging&&(this.context.initData[this.name]=this.value=this.parse(e))}},{key:"setValue",value:function(e){!0!==this.isChanging&&this.changeValue(e,!1)}},{key:"getValue",value:function(){return this.context.getValue(this.name)}},{key:"getReadOnly",value:function(){return this.readOnly}},{key:"getDisabled",value:function(){return this.disabled}},{key:"getVisible",value:function(){return this.visible}},{key:"setReadOnly",value:function(e){this.readOnly=e}},{key:"setDisabled",value:function(e){this.disabled=e}},{key:"setVisible",value:function(e){this.visible=e}},{key:"changeValue",value:function(e,t){var n,r,i=this.value;void 0!==this.ui&&(n=this.ui.onChanging,r=this.ui.onChanged);var a=!0;void 0!==n&&(this.isChanging=!0,a=n(this.context,this.value,i),this.isChanging=!1),!0===a&&(this.setDataValue(e),!0!==t&&this.setElementValue(e),void 0!==r&&(this.isChanging=!0,r(this.context,this.value,i),this.isChanging=!1))}},{key:"renderContainer",value:function(){if(!1===this.visible)return null;var e,t=this.context,n=t.form;if(!0===t.inNode)return this.render();if(void 0===this.ui)e=this.name;else{var r=this.ui.label;null===r&&(e=null),e=r||this.name}return!0===this.itemSchema.required&&!1!==n.props.requiredFlag&&null!==e&&(e=a.createElement(a.Fragment,null,e,"\xa0",a.createElement("span",{className:"text-danger"},"*"))),n.FieldContainer(e,this.render())}},{key:"renderTemplet",value:function(){if(void 0!==this.children)return a.createElement(a.Fragment,null,this.children);if(void 0!==this.ui){var e=this.ui.Templet;return"function"===typeof e?e(this.value):e}}},{key:"renderErrors",value:function(){var e=[].concat(Object(E.a)(this.errors),Object(E.a)(this.contextErrors));if(0===e.length)return null;var t=!0===this.context.inNode?"span":"div";return e.map(function(e){return a.createElement(t,{key:e,className:"text-danger d-inline-block my-2 ml-3"},a.createElement(a.Fragment,null,a.createElement("i",{className:"fa fa-exclamation-circle"})," \xa0",e))})}},{key:"hasError",get:function(){return this.errors.length+this.contextErrors.length>0}},{key:"isOk",get:function(){return 0===this.errors.length}},{key:"className",get:function(){var e;return!1===this.context.inNode&&(e="form-control"),d()(e,this.context.form.FieldClass,this.ui&&this.ui.className)}}]),e}();q([k.l],I.prototype,"errors",void 0),q([k.l],I.prototype,"contextErrors",void 0),q([k.e],I.prototype,"hasError",null),q([k.l],I.prototype,"visible",void 0),q([k.e],I.prototype,"isOk",null);var F=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="text",e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"setElementValue",value:function(e){null!==this.input&&(this.input.value=e)}},{key:"onBlur",value:function(e){this.onInputChange(e),this.checkRules(),this.context.checkContextRules()}},{key:"onFocus",value:function(e){this.clearError(),this.context.removeErrorWidget(this),this.context.removeErrors()}},{key:"onChange",value:function(e){}},{key:"setReadOnly",value:function(e){null!==this.input&&(this.input.readOnly=this.readOnly=e)}},{key:"setDisabled",value:function(e){null!==this.input&&(this.input.disabled=this.disabled=e)}},{key:"render",value:function(){var e=this,t=this.renderTemplet();if(void 0!==t)return t;var n={};return!0===this.hasError?n["is-invalid"]=!0:n["required-item"]=!0===this.itemSchema.required,a.createElement(a.Fragment,null,a.createElement("input",{ref:function(t){return e.input=t},className:d()(this.className,n),type:this.inputType,defaultValue:this.value,onChange:function(t){return e.onChange(t)},placeholder:this.placeholder,readOnly:this.readOnly,disabled:this.disabled,onKeyDown:this.onKeyDown,onFocus:function(t){return e.onFocus(t)},onBlur:function(t){return e.onBlur(t)},maxLength:this.itemSchema.maxLength}),this.renderErrors())}},{key:"placeholder",get:function(){return this.ui&&this.ui.placeholder||this.name}}]),t}(I),V=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).onInputChange=function(t){e.setValue(t.currentTarget.value)},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"setElementValue",value:function(e){this.input.value=e}},{key:"setReadOnly",value:function(e){this.input.readOnly=this.readOnly=e}},{key:"setDisabled",value:function(e){this.input.disabled=this.disabled=e}},{key:"render",value:function(){var e=this;return a.createElement("textarea",{ref:function(t){return e.input=t},rows:this.ui&&this.ui.rows,maxLength:this.itemSchema.maxLength,defaultValue:this.defaultValue,onChange:this.onInputChange})}}]),t}(I),T=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="password",e}return Object(l.a)(t,e),t}(F),U=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="url",e}return Object(l.a)(t,e),t}(F),D=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="email",e}return Object(l.a)(t,e),t}(F),L=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="number",e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"buildRules",value:function(){Object(O.a)(Object(u.a)(t.prototype),"buildRules",this).call(this);var e=this.context.form.res,n=this.itemSchema,r=n.min,i=n.max;this.rules.push("integer"===this.itemSchema.type?new R(e,r,i):new A(e,r,i))}},{key:"parse",value:function(e){if(void 0!==e&&null!==e)return Number(e)}}]),t}(F),M=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="number",e.onKeyDown=function(t){var n=t.keyCode;event.returnValue=e.isValidKey(n)},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"isValidKey",value:function(e){return 46===e||8===e||37===e||39===e||e>=48&&e<=57||e>=96&&e<=105||109===e||189===e}}]),t}(L),B=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="date",e}return Object(l.a)(t,e),t}(F),H=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="datetime",e}return Object(l.a)(t,e),t}(F),$=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="time",e}return Object(l.a)(t,e),t}(F),z=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="month",e}return Object(l.a)(t,e),t}(F),W=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).onInputChange=function(t){e.setDataValue(!0===t.target.checked?e.trueValue:e.falseValue)},e.onClick=function(){e.context.removeErrors()},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"init",value:function(){if(Object(O.a)(Object(u.a)(t.prototype),"init",this).call(this),void 0!==this.ui){var e=this.ui,n=e.trueValue,r=e.falseValue;this.trueValue=void 0===n||n,this.falseValue=void 0!==r&&r}else this.trueValue=!0,this.falseValue=!1}},{key:"setElementValue",value:function(e){this.input.checked=e===this.trueValue}},{key:"setReadOnly",value:function(e){this.input.readOnly=this.readOnly=e}},{key:"setDisabled",value:function(e){this.input.disabled=this.disabled=e}},{key:"render",value:function(){var e=this,t=d()(this.className,"form-check-inline"),n=a.createElement("input",{ref:function(t){return e.input=t},className:"align-self-center",type:"checkbox",defaultChecked:this.defaultValue,onChange:this.onInputChange,onClick:this.onClick});return this.context.inNode?a.createElement("label",{className:t},n," ",this.ui&&this.ui.label||this.name):a.createElement("div",{className:t},n)}}]),t}(I),Q=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},K=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).onInputChange=function(t){e.setDataValue(t.target.value)},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"setElementValue",value:function(e){this.select.value=e}},{key:"setReadOnly",value:function(e){this.select.disabled=this.readOnly=!e}},{key:"setDisabled",value:function(e){this.select.disabled=this.disabled=e}},{key:"render",value:function(){var e=this;if(!0===this.readOnly){var t=this.ui.list.find(function(t){return t.value===e.value}),n=void 0===t?"(???)":t.title;return a.createElement("span",{className:"form-control w-min-6c"},n)}return a.createElement("select",{ref:function(t){return e.select=t},className:d()(this.className,"form-control"),defaultValue:this.defaultValue,onChange:this.onInputChange},this.ui.list.map(function(e,t){var n=e.title,r=e.value;return a.createElement("option",{className:void 0,key:t,value:r},n||r)}))}}]),t}(I);Q([k.l],K.prototype,"readOnly",void 0);var J=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputs={},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"setElementValue",value:function(e){for(var t in this.inputs){var n=this.inputs[t];n.checked=e===n.value}}},{key:"setReadOnly",value:function(e){for(var t in this.readOnly=e,this.inputs)this.inputs[t].readOnly=e}},{key:"setDisabled",value:function(e){for(var t in this.disabled=e,this.inputs)this.inputs[t].disabled=e}},{key:"render",value:function(){var e,t=this,n=this.ui,r=n.defaultValue,i=n.list,o=this.context,s=o.isRow;o.inNode;!0===s&&(e=this.context.rowKey);var c=d()(this.className,"form-radio-inline");return a.createElement("span",{className:c},i.map(function(n,i){var o=n.value,s=n.title,c=t.name;return void 0!==e&&(c+="-"+e),a.createElement("label",{key:i,className:"form-radio-inline"},a.createElement("input",{ref:function(e){return t.inputs[i]=e},type:"radio",name:c,value:o,defaultChecked:(t.defaultValue||r)===o}),s||o)}))}}]),t}(I),G=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).inputType="range",e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"setReadOnly",value:function(e){this.input.readOnly=this.readOnly=e}},{key:"setDisabled",value:function(e){this.input.disabled=this.disabled=e}},{key:"render",value:function(){var e=this,t=this.ui,n=t.min,r=t.max,i=t.step;return a.createElement(a.Fragment,null,a.createElement("input",{ref:function(t){return e.input=t},className:d()(this.className,"form-control","w-min-6c"),type:this.inputType,defaultValue:this.defaultValue,onChange:this.onInputChange,max:r,min:n,step:i}))}}]),t}(I),Y=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},X=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Z=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).onClick=function(){return X(Object(w.a)(Object(w.a)(e)),void 0,void 0,p.a.mark(function e(){var t,n;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==(t=this.ui&&this.ui.pickId)){e.next=4;break}return alert("no pickId defined!"),e.abrupt("return");case 4:return e.next=6,t(this.context,this.name,this.value);case 6:n=e.sent,this.setDataValue(n),this.clearError(),this.clearContextError(),this.checkRules();case 11:case"end":return e.stop()}},e,this)}))},e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"setReadOnly",value:function(e){this.readOnly=e}},{key:"setDisabled",value:function(e){this.disabled=e}},{key:"render",value:function(){var e,t;void 0!==this.ui&&(e=this.ui.placeholder,t=this.ui.Templet);var n,r={"form-control":!0,"required-item":!0===this.itemSchema.required,"cursor-pointer":!0,"is-invalid":this.hasError};return void 0===this.value||null===this.value?(n=e||"placeholder",r["text-muted"]=!0):n=void 0===t?a.createElement(a.Fragment,null,this.value):"function"===typeof t?t(this.value):t,a.createElement(a.Fragment,null,a.createElement("div",{className:d()(r),onClick:this.onClick},n),this.renderErrors())}}]),t}(I);Y([k.l],Z.prototype,"value",void 0);var ee=function(e,t,n){return a.createElement("span",{className:"text-danger"},"!!data type ",e," only support ",(n||[]).join(", "),", can't use ui ",t,"!!")},te=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},ne=function(e){function t(){var e;return Object(o.a)(this,t),(e=Object(c.a)(this,Object(u.a)(t).apply(this,arguments))).onClick=function(){return te(Object(w.a)(Object(w.a)(e)),void 0,void 0,p.a.mark(function e(){var t,n,r,i;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.clearError(),this.clearContextError(),t=this.itemSchema,n=t.name,"submit"!==t.type){e.next=7;break}if(this.context.checkRules(),!0!==this.context.hasError){e.next=7;break}return e.abrupt("return");case 7:if(void 0!==(r=this.context.form.props.onButtonClick)){e.next=11;break}return alert("button ".concat(n," clicked. you should define form onButtonClick")),e.abrupt("return");case 11:return e.next=13,r(n,this.context);case 13:if(void 0!==(i=e.sent)){e.next=16;break}return e.abrupt("return");case 16:this.context.setError(n,i);case 17:case"end":return e.stop()}},e,this)}))},e.observerRender=Object(x.a)(function(){var t,n,r,i=e.itemSchema,o=i.name,s=i.type;if(void 0!==e.ui){var c=e.ui.widget;if("button"!==c)return ee(s,c,["button"]);t=e.ui.Templet,n=e.ui.className,r=e.ui.label}var u,l=e.context,h=l.form,d=l.hasError,f=e.context,p="submit"===s&&d;u=void 0!==e.children?e.children:"function"===typeof t?t():void 0!==t?t:r;var v=a.createElement("button",{className:n,type:"button",disabled:p,onClick:e.onClick},u||o);return!0===f.inNode?a.createElement(a.Fragment,null,v,e.renderErrors()):a.createElement("div",{className:h.ButtonClass},a.createElement("div",null,e.renderErrors()),v)}),e}return Object(l.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return a.createElement(this.observerRender,null)}},{key:"renderContainer",value:function(){if(!1===this.visible)return null;var e=this.context,t=e.form;return!0===e.inNode?this.render():t.FieldContainer(null,this.render())}}]),t}(I),re=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},ie=function(){function e(t,n,r,i,s){var c=this;if(Object(o.a)(this,e),this.widgets={},this.errors=[],this.errorWidgets=[],this.renderErrors=Object(x.a)(function(){var e=c.errors;return 0===e.length?null:a.createElement(a.Fragment,null,e.map(function(e){return a.createElement("span",{key:e,className:"text-danger inline-block my-1 ml-3"},a.createElement("i",{className:"fa fa-exclamation-circle"})," \xa0",e)}))}),this.form=t,this.uiSchema=n,this.initData=r,this.inNode=i,this.isRow=s,void 0!==n){var u,l=n.rules;if(void 0!==l)this.rules=[],!1===Array.isArray(l)?this.rules.push(l):(u=this.rules).push.apply(u,Object(E.a)(l))}}return Object(s.a)(e,[{key:"getArrRowContexts",value:function(e){void 0===this.subContexts&&(this.subContexts={});var t=this.subContexts[name];return void 0===t&&(this.subContexts[name]=t={}),t}},{key:"getValue",value:function(e){return this.initData[e]}},{key:"setValue",value:function(e,t){this.initData[e]=t;var n=this.widgets[e];void 0!==n&&n.setValue(t)}},{key:"getDisabled",value:function(e){var t=this.widgets[e];if(void 0!==t)return t.getDisabled()}},{key:"setDisabled",value:function(e,t){var n=this.widgets[e];void 0!==n&&n.setDisabled(t)}},{key:"getReadOnly",value:function(e){var t=this.widgets[e];void 0!==t&&t.getReadOnly()}},{key:"setReadOnly",value:function(e,t){var n=this.widgets[e];void 0!==n&&n.setReadOnly(t)}},{key:"getVisible",value:function(e){var t=this.widgets[e];void 0!==t&&t.getVisible()}},{key:"setVisible",value:function(e,t){var n=this.widgets[e];void 0!==n&&n.setVisible(t)}},{key:"checkFieldRules",value:function(){for(var e in this.widgets)this.widgets[e].checkRules();if(void 0!==this.subContexts)for(var t in this.subContexts){var n=this.subContexts[t];for(var r in n)n[r].checkFieldRules()}}},{key:"checkContextRules",value:function(){if(void 0!==this.rules){this.clearContextErrors();var e=!0,t=!1,n=void 0;try{for(var r,i=this.rules[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var a,o=(0,r.value)(this);if(void 0!==o)if(!0===Array.isArray(o))(a=this.errors).push.apply(a,Object(E.a)(o));else if("string"===typeof o)this.errors.push(o);else for(var s in o)this.setError(s,o[s])}}catch(d){t=!0,n=d}finally{try{e||null==i.return||i.return()}finally{if(t)throw n}}if(void 0!==this.subContexts)for(var c in this.subContexts){var u=this.subContexts[c];for(var l in u){var h=u[l];h.removeErrors(),h.checkContextRules()}}}}},{key:"setError",value:function(e,t){var n=this.widgets[e];void 0!==n&&(n.setContextError(t),this.addErrorWidget(n))}},{key:"clearContextErrors",value:function(){for(var e in this.widgets)this.widgets[e].clearContextError()}},{key:"checkRules",value:function(){this.checkFieldRules(),this.checkContextRules()}},{key:"addErrorWidget",value:function(e){this.errorWidgets.findIndex(function(t){return t===e})<0&&this.errorWidgets.push(e)}},{key:"removeErrorWidget",value:function(e){var t=this.errorWidgets.findIndex(function(t){return t===e});t>=0&&this.errorWidgets.splice(t,1)}},{key:"checkHasError",value:function(){if(!0===this.errorWidgets.length+this.errors.length>0)return!0;if(void 0===this.subContexts)return!1;for(var e in this.subContexts){var t=this.subContexts[e];for(var n in t)if(!0===t[n].hasError)return!0}return!1}},{key:"removeErrors",value:function(){for(var e in this.errors.splice(0),this.errorWidgets.splice(0),this.widgets){var t=this.widgets[e];void 0!==t&&t.clearContextError()}}},{key:"arrName",get:function(){}},{key:"hasError",get:function(){return this.checkHasError()}}]),e}();re([k.l],ie.prototype,"errors",void 0),re([k.l],ie.prototype,"errorWidgets",void 0),re([k.e],ie.prototype,"hasError",null);var ae=1,oe=function(e){function t(e,n,r,i){var a,s;Object(o.a)(this,t);var l=e.uiSchema;if(void 0!==l){var h=l.items;void 0!==h&&(s=h[n.name])}return(a=Object(c.a)(this,Object(u.a)(t).call(this,e.form,s,r,i,!0))).parentContext=e,a.arrSchema=n,a.rowKey=ae++,a.data=r,a}return Object(l.a)(t,e),Object(s.a)(t,[{key:"getItemSchema",value:function(e){return this.arrSchema.itemSchemas[e]}},{key:"getUiItem",value:function(e){if(void 0!==this.uiSchema){var t=this.uiSchema.items;if(void 0!==t)return t[e]}}},{key:"removeErrors",value:function(){Object(O.a)(Object(u.a)(t.prototype),"removeErrors",this).call(this),this.parentContext.removeErrors()}},{key:"arrName",get:function(){return this.arrSchema.name}},{key:"parentData",get:function(){return this.parentContext.data}}]),t}(ie),se=function(e){function t(e,n){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).call(this,e,e.uiSchema,e.data,n,!1))}return Object(l.a)(t,e),Object(s.a)(t,[{key:"getItemSchema",value:function(e){return this.form.itemSchemas[e]}},{key:"getUiItem",value:function(e){var t=this.form.uiSchema;if(void 0!==t){var n=t.items;if(void 0!==n)return n[e]}}},{key:"data",get:function(){return this.form.data}}]),t}(ie),ce=a.createContext({}),ue=Object(x.a)(function(e){var t,n,r,i,o=e.parentContext,s=e.arrSchema,c=e.children,u=s.name,l=s.arr,h=o.initData[u],f=o.form,p=o.getArrRowContexts(u),v=o.getUiItem(u),m=u,y=f.ArrContainer,b=f.RowContainer,g=f.RowSeperator,w=f.uiSchema;if(void 0!==w){var k=w.selectable,E=w.deletable,O=w.restorable;!0!==n&&(n=k),!0!==r&&(r=E),!0!==i&&(i=O)}if(void 0!==v){var j=v.widget,C=v.label,S=v.selectable,N=v.deletable,P=v.restorable,_=v.ArrContainer,R=v.RowContainer,A=v.RowSeperator;if(void 0!==S&&(n=S),void 0!==N&&(r=N),void 0!==P&&(i=P),void 0!==_&&(y=_),void 0!==R&&(b=R),void 0!==A&&(g=A),t=v.Templet,"arr"!==j)return ee(s.type,j,["arr"]);m=C||m}var q=!0;return y(m,a.createElement(a.Fragment,null,h.map(function(e,u){var f,v,m=void 0;if(!1===q?m=g:q=!1,void 0!==c)f=new oe(o,s,e,!0),v=a.createElement(a.Fragment,null,c);else{var y=typeof t;"function"===y?(f=new oe(o,s,e,!0),v=a.createElement(Object(x.a)(t),e)):"object"===y?(f=new oe(o,s,e,!0),v=t):(f=new oe(o,s,e,!1),v=a.createElement(a.Fragment,null,l.map(function(e,t){return a.createElement(a.Fragment,{key:e.name},he(f,e,void 0))})))}var w,k,E=f.rowKey;if(p[E]=f,!0===n){w=a.createElement("div",{className:"form-row-checkbox"},a.createElement("input",{type:"checkbox",onClick:function(t){var n=t.target.checked;e.$isSelected=n;var r=e.$source;void 0!==r&&(r.$isSelected=n),f.removeErrors()},defaultChecked:e.$isSelected}))}var O=!(void 0===e.$isDeleted||!1===e.$isDeleted);if(!0===r){var j=O?"fa-undo":"fa-trash";k=a.createElement("div",{className:"form-row-edit text-info",onClick:function(){if(!0===i){e.$isDeleted=!O;var t=e.$source;void 0!==t&&(t.$isDeleted=!O)}else{var n=h.indexOf(e);n>=0&&h.splice(n,1)}f.removeErrors()}},a.createElement("i",{className:d()("fa",j,"fa-fw")}))}var C=!0===n||!0===r?function(t){return a.createElement("fieldset",{disabled:O},a.createElement("div",{className:d()("d-flex",{deleted:O,"row-selected":e.$isSelected})},w,a.createElement("div",{className:"flex-grow-1"},t),k))}:function(e){return e};return a.createElement(ce.Provider,{key:E,value:f},m,b(C(a.createElement(a.Fragment,null,a.createElement(f.renderErrors,null),v))))})))}),le={id:{dataTypes:["id"],widget:Z},text:{dataTypes:["integer","number","string"],widget:F},textarea:{dataTypes:["string"],widget:V},password:{dataTypes:["string"],widget:T},date:{dataTypes:["date"],widget:B},datetime:{dataTypes:["date"],widget:H},time:{dataTypes:["date"],widget:$},month:{dataTypes:["date"],widget:z},select:{dataTypes:["integer","number","string","date","boolean"],widget:K},url:{dataTypes:["string"],widget:U},email:{dataTypes:["string"],widget:D},number:{dataTypes:["integer","number"],widget:L},updown:{dataTypes:["integer","number"],widget:M},color:{},checkbox:{dataTypes:["boolean","integer","number"],widget:W},checkboxes:{},radio:{dataTypes:["integer","number","string","date","boolean"],widget:J},range:{dataTypes:["integer"],widget:G},button:{dataTypes:["button","submit"],widget:ne}};function he(e,t,n,r){if(void 0===e)return null;if(void 0!==t){var i,o=t.name,s=t.type;switch(s){case"arr":var c=e.getItemSchema(o);return a.createElement(ue,{parentContext:e,arrSchema:c,children:n})}var u=e.getUiItem(o);if(void 0===u)i=v(s);else{var l=u.widget;switch(l){default:if(void 0!==l)i=le[l].widget;void 0===i&&(i=v(s));break;case"custom":i=u.WidgetClass;break;case"group":return a.createElement("span",null,"impletment group")}}var h=e.isRow,d=e.widgets,f=new i(e,t,r,n);if(d[o]=f,!1===h){var p=Object(x.a)(function(){return f.renderContainer()});return a.createElement(p,null)}return f.renderContainer()}function v(e){switch(e){default:return F;case"id":return Z;case"integer":return M;case"number":return L;case"string":return F;case"date":return B;case"boolean":return W;case"button":case"submit":return ne}}}n(54);var de={_:{required:"required",number:"not valid number",integer:"not valid integer",min:"min value is ${min}",max:"max value is ${max}"},zh:{_:{required:"\u5fc5\u987b\u586b",number:"\u9700\u8981\u6570\u5b57",integer:"\u9700\u8981\u6574\u6570",min:"\u4e0d\u80fd\u5c0f\u4e8e${min}",max:"\u4e0d\u80fd\u5927\u4e8e${max}"}}},fe=n(38),pe=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},ve=function(e){function t(e){var n;Object(o.a)(this,t),(n=Object(c.a)(this,Object(u.a)(t).call(this,e))).calcSelectOrDelete=function(){if(void 0!==n.formData){var e=!0,t=!1,r=void 0;try{for(var i,a=n.schema[Symbol.iterator]();!(e=(i=a.next()).done);e=!0){var o=i.value;n.arrItemOperated(o)}}catch(s){t=!0,r=s}finally{try{e||null==a.return||a.return()}finally{if(t)throw r}}}},n.DefaultContainer=function(e){return a.createElement("form",{className:d()(n.props.className)},e)},n.DefaultFieldContainer=function(e,t){var r=n.props.fieldLabelSize;if(r>0){var i;null===e?r=0:i=a.createElement("label",{className:d()("col-sm-"+r,"col-form-label")},e);var o="col-sm-"+(12-r);return a.createElement("div",{className:"form-group row"},i,a.createElement("div",{className:o},t))}return a.createElement("div",{className:"form-group"},null===e?null:a.createElement("label",{className:"col-form-label"},e),t)},n.DefaultFieldClass=void 0,n.DefaultButtonClass="text-center py-2",n.DefaultRes=Object(fe.a)(de),n.ArrContainer=function(e,t){return a.createElement("div",null,a.createElement("div",{className:d()("small text-muted text-center bg-light py-1 px-3 mt-4 mb-1")},e),t)},n.RowContainer=function(e){var t=d()({"py-3":!0});return a.createElement("div",{className:t},e)},n.RowSeperator=a.createElement("div",{className:"border border-gray border-top"});var r=e.schema,i=e.uiSchema,s=e.formData,l=e.Container,h=e.FieldContainer,f=e.FieldClass,p=e.ButtonClass,v=e.res;n.Container=l||n.DefaultContainer,n.FieldContainer=h||n.DefaultFieldContainer,n.FieldClass=void 0!==f&&""!==f&&null!==f?f:n.DefaultFieldClass,n.res=v||n.DefaultRes,n.ButtonClass=p||n.DefaultButtonClass,n.schema=r,n.itemSchemas={};var m=!0,y=!1,b=void 0;try{for(var g,x=n.schema[Symbol.iterator]();!(m=(g=x.next()).done);m=!0){var E=g.value;n.itemSchemas[E.name]=E}}catch(C){y=!0,b=C}finally{try{m||null==x.return||x.return()}finally{if(y)throw b}}n.uiSchema=i,n.formData=s,n.disposer=Object(k.d)(n.calcSelectOrDelete),n.data={},n.initData(s);void 0!==n.props.children||n.uiSchema&&n.uiSchema.Templet;var O,j=n.props.children;void 0!==j?(n.content=a.createElement(a.Fragment,null,j),n.formContext=new se(Object(w.a)(Object(w.a)(n)),!0)):(void 0!==n.uiSchema&&(O=n.uiSchema.Templet),void 0!==O?(n.content="function"===typeof O?O(n.data):O,n.formContext=new se(Object(w.a)(Object(w.a)(n)),!0)):(n.formContext=new se(Object(w.a)(Object(w.a)(n)),!1),n.content=a.createElement(a.Fragment,null,n.schema.map(function(e,t){return a.createElement(a.Fragment,{key:t},he(n.formContext,e,j))}))));return n}return Object(l.a)(t,e),Object(s.a)(t,[{key:"initData",value:function(e){void 0===e&&(e={});var t=!0,n=!1,r=void 0;try{for(var i,a=this.schema[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.initDataItem(o,this.data,e)}}catch(s){n=!0,r=s}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"initDataItem",value:function(e,t,n){var r=e.name,i=e.type;if("button"!==i)if("arr"!==i)t[r]=n[r];else{var a=e,o=a.arr;if(void 0===o)return;var s=a.itemSchemas={},c=!0,u=!1,l=void 0;try{for(var h,d=o[Symbol.iterator]();!(c=(h=d.next()).done);c=!0){var f=h.value;s[f.name]=f}}catch(_){u=!0,l=_}finally{try{c||null==d.return||d.return()}finally{if(u)throw l}}var p=n[r];void 0===p?p=[]:!1===Array.isArray(p)&&(p=[p]);var v=[],m=!0,y=!1,b=void 0;try{for(var g,w=p[Symbol.iterator]();!(m=(g=w.next()).done);m=!0){var x=g.value,E={$source:x,$isSelected:x.$isSelected,$isDeleted:x.$isDeleted},O=!0,j=!1,C=void 0;try{for(var S,N=o[Symbol.iterator]();!(O=(S=N.next()).done);O=!0){var P=S.value;this.initDataItem(P,E,x)}}catch(_){j=!0,C=_}finally{try{O||null==N.return||N.return()}finally{if(j)throw C}}v.push(E)}}catch(_){y=!0,b=_}finally{try{m||null==w.return||w.return()}finally{if(y)throw b}}t[r]=Object(k.l)(v)}}},{key:"arrItemOperated",value:function(e){var t=e.name;if("arr"===e.type){var n=this.data[t],r=e.arr,i=!0,a=!1,o=void 0;try{for(var s,c=n[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value,l=u.$source;if(void 0!==l){var h=l.$isSelected,d=l.$isDeleted;u.$isSelected=h,u.$isDeleted=d;var f=!0,p=!1,v=void 0;try{for(var m,y=r[Symbol.iterator]();!(f=(m=y.next()).done);f=!0){var b=m.value;this.arrItemOperated(b)}}catch(g){p=!0,v=g}finally{try{f||null==y.return||y.return()}finally{if(p)throw v}}}}}catch(g){a=!0,o=g}finally{try{i||null==c.return||c.return()}finally{if(a)throw o}}}}},{key:"componentDidMount",value:function(){var e=this.props.beforeShow;void 0!==e&&e(this.formContext)}},{key:"componentWillUnmount",value:function(){this.disposer()}},{key:"render",value:function(){return a.createElement(ce.Provider,{value:this.formContext},a.createElement(this.formContext.renderErrors,null),this.Container(this.content))}}]),t}(a.Component);pe([k.l],ve.prototype,"data",void 0),(function(e){function t(){return Object(o.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this.props,t=e.name,n=e.children,r=this.context;if(void 0===r)return a.createElement("span",{className:"text-danger"},"!only in Form!");var i=r.getItemSchema(t),o=he(r,i,n,this.props);return void 0===o?a.createElement("span",{className:"text-danger"},"!!",t," is not defined!!"):o}}]),t}(a.Component)).contextType=ce;var me=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},ye=function(){function e(){Object(o.a)(this,e)}return Object(s.a)(e,[{key:"content",get:function(){return!0!==this.selected?this._content:void 0!==this._content?this._content:this._content=this.contentBuilder()}}]),e}();me([k.l],ye.prototype,"selected",void 0);var be=function(e){function t(e){var n,r;Object(o.a)(this,t),(r=Object(c.a)(this,Object(u.a)(t).call(this,e))).tabs=[],r.tabClick=function(e){r.selectedTab.selected=!1,e.selected=!0,r.selectedTab=e};var i=r.props,a=i.size,s=i.tabs,l=i.tabBack,h=i.contentBack,d=i.sep,f=i.selected;switch(a){default:case"md":r.size="3.2rem";break;case"sm":r.size="4rem";break;case"lg":r.size="2.5rem"}return(n=r.tabs).push.apply(n,Object(E.a)(s.map(function(e){var t=new ye;return t.name=e.name,t.selected=!1,t.caption=e.caption,t.contentBuilder=e.content,t.notify=e.notify,t}))),r.tabBack=l||"bg-light",r.contentBack=h,r.sep=d||"border-top border-gray",void 0!==f&&(r.selectedTab=r.tabs.find(function(e){return e.name===f})),void 0===r.selectedTab&&(r.selectedTab=r.tabs[0]),r.selectedTab.selected=!0,r}return Object(l.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return a.createElement("div",{className:"tab"},a.createElement("div",{className:this.contentBack,style:{height:"calc(100% - "+this.size+")"}},this.tabs.map(function(e,t){var n={display:!0===e.selected?void 0:"none"};return a.createElement("div",{key:t,style:n},e.content)})),a.createElement("div",{className:d()(this.tabBack,this.sep),style:{height:this.size}},this.tabs.map(function(t,n){var r,i=t.selected,o=t.caption,s=t.notify;if(void 0!==s){var c=s.get();void 0!==c&&(c>0?r=a.createElement("u",null,c>99?"99+":c):c<0&&(r=a.createElement("u",{className:"dot"})))}return a.createElement("div",{key:n,className:"",onClick:function(){return e.tabClick(t)}},a.createElement("div",{className:"align-self-center"},r,o(i)))})))}}]),t}(a.Component);me([k.l],be.prototype,"selectedTab",void 0),me([k.l],be.prototype,"tabs",void 0),be=me([x.a],be);n(49);n.d(t,"c",function(){return r.a}),n.d(t,"g",function(){return r.c}),n.d(t,"d",function(){return i.a}),n.d(t,"a",function(){return y}),n.d(t,"f",function(){return b}),n.d(t,"e",function(){return g}),n.d(t,"b",function(){return ve}),n.d(t,"h",function(){return fe.a})},function(e,t,n){"use strict";n.d(t,"b",function(){return c}),n.d(t,"a",function(){return d});var r=n(1),i=n.n(r),a=n(3),o=n(5),s=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},c=!1,u={centerhost:{value:Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56",REACT_APP_ICON:"http://101.200.46.56/imgs/Bear-icon.png",REACT_APP_ITEM_ICON:"http://101.200.46.56/imgs/Bear-icon.png"}).REACT_APP_CENTER_DEBUG_HOST||"localhost:3000",local:!1},uqhost:{value:Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56",REACT_APP_ICON:"http://101.200.46.56/imgs/Bear-icon.png",REACT_APP_ITEM_ICON:"http://101.200.46.56/imgs/Bear-icon.png"}).REACT_APP_UQ_DEBUG_HOST||"localhost:3015",local:!1},unitxhost:{value:Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56",REACT_APP_ICON:"http://101.200.46.56/imgs/Bear-icon.png",REACT_APP_ITEM_ICON:"http://101.200.46.56/imgs/Bear-icon.png"}).REACT_APP_UQ_DEBUG_HOST||"localhost:3015",local:!1},"uq-build":{value:Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56",REACT_APP_ICON:"http://101.200.46.56/imgs/Bear-icon.png",REACT_APP_ITEM_ICON:"http://101.200.46.56/imgs/Bear-icon.png"}).REACT_APP_UQ_DEBUG_BUILDER_HOST||"localhost:3009",local:!1}};function l(e){return"http://".concat(e,"/")}function h(e){return"ws://".concat(e,"/tv/")}var d=new(function(){function e(){Object(a.a)(this,e)}return Object(o.a)(e,[{key:"start",value:function(){return s(this,void 0,void 0,i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==c){e.next=3;break}return e.next=3,this.tryLocal();case 3:t=this.getCenterHost(),this.url=l(t),this.ws=h(t);case 6:case"end":return e.stop()}},e,this)}))}},{key:"debugHostUrl",value:function(e){return"http://".concat(e,"/hello")}},{key:"tryLocal",value:function(){return s(this,void 0,void 0,i.a.mark(function e(){var t,n,r,a,o,s,c,l;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(n in t=[],u)r=u[n].value,a=this.debugHostUrl(r),o={method:"GET",mode:"no-cors",headers:{"Content-Type":"text/plain"}},t.push(v(a,o));return e.next=4,Promise.all(t);case 4:for(l in s=e.sent,c=0,u)u[l].local=s[c],++c;case 7:case"end":return e.stop()}},e,this)}))}},{key:"getCenterHost",value:function(){var e=u.centerhost,t=e.value,n=e.local;return!0===document.location.hash.includes("sheet_debug")?t:!0===c&&!0===n?t:"101.200.46.56"}},{key:"getUrlOrDebug",value:function(e,t){if(!0!==c)return e;if(!t)return e;for(var n in u){var r=u[n],i=r.value,a=r.local,o="://".concat(n,"/");if(t.indexOf(o)>0){if(!1===a)break;return t=t.replace(o,"://".concat(i,"/"))}}return e}}]),e}()),f=100;function p(e,t){return new Promise(function(n,r){fetch(e,t).then(function(e){e.text().then(n).catch(r)}).catch(r);var i=new Error("Connection timed out");setTimeout(r,f,i)})}function v(e,t){return s(this,void 0,void 0,i.a.mark(function n(){return i.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,p(e,t);case 3:return n.abrupt("return",!0);case 6:return n.prev=6,n.t0=n.catch(0),n.abrupt("return",!1);case 9:case"end":return n.stop()}},n,this,[[0,6]])}))}},,function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",i=8;function a(){for(var e=r.length,t="",n=0;n<i;n++)t+=r.charAt(Math.floor(Math.random()*e));return t}},function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"c",function(){return c}),n.d(t,"b",function(){return u});var r=n(3),i=n(5),a=n(50),o=n.n(a),s=function(){function e(t){Object(r.a)(this,e),this.user=t}return Object(i.a)(e,[{key:"id",get:function(){return this.user.id}},{key:"name",get:function(){return this.user.name}},{key:"nick",get:function(){return this.user.nick}},{key:"icon",get:function(){return this.user.icon||"http://101.200.46.56/imgs/Bear-icon.png"}},{key:"guest",get:function(){return this.user.guest}},{key:"token",get:function(){return this.user.token}}]),e}();function c(e){var t=o()(e);return{id:t.id,name:t.name,guest:t.guest,token:e}}function u(e){return{id:0,guest:o()(e).guest,token:e}}},function(e,t,n){"use strict";n.d(t,"b",function(){return a}),n.d(t,"a",function(){return o});var r=n(23),i=n.n(r),a={lang:void 0,district:void 0};function o(e){var t=a.lang,n=a.district,r={};if(void 0===e)return r;i.a.merge(r,e._);var o=e[t];if(void 0===o)return r;i.a.merge(r,o._);var s=o[n];if(void 0===s)return r;i.a.merge(r,s);var c=r.entity;if(void 0!==c)for(var u in c)c[u.toLowerCase()]=c[u];return r}!function(){var e,t,n=navigator.languages&&navigator.languages[0]||navigator.language;if(n){var r=n.split("-");e=r[0],r.length>1&&(t=r[1])}else e="zh",t="CN";!function(e,t){a.lang=e,a.district=t}(e,t)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var r=n(3),i=n(5),a=n(1),o=n.n(a),s=n(27),c=n(18),u=n(34),l=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};var h=function(){function e(t,n,i,a){var s=this;Object(r.a)(this,e),this.startWait=function(){void 0!==s.ui&&s.ui.startWait()},this.endWait=function(e,t){void 0!==s.ui&&s.ui.endWait(),void 0!==t&&t("\u8bbf\u95eewebapi\u8d85\u65f6 "+e)},this.showError=function(e){return l(s,void 0,void 0,o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===this.ui){t.next=3;break}return t.next=3,this.ui.showError(e);case 3:case"end":return t.stop()}},t,this)}))},this.isCenter=t,this.hostUrl=n,this.apiToken=i,this.ui=a,this.timeout=!0===u.b?5e5:5e3}return Object(i.a)(e,[{key:"used",value:function(){this.post("",{})}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return l(this,void 0,void 0,o.a.mark(function n(){var r,i,a,s,c;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t){n.next=15;break}if(!((r=Object.keys(t)).length>0)){n.next=15;break}i="?",a=0;case 5:if(!(a<r.length)){n.next=15;break}if(s=r[a],void 0!==t[s]){n.next=10;break}return n.abrupt("continue",12);case 10:e+=i+s+"="+t[s],i="&";case 12:a++,n.next=5;break;case 15:return(c=this.buildOptions()).method="GET",n.next=19,this.innerFetch(e,c);case 19:return n.abrupt("return",n.sent);case 20:case"end":return n.stop()}},n,this)}))}},{key:"post",value:function(e,t){return l(this,void 0,void 0,o.a.mark(function n(){var r;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return(r=this.buildOptions()).method="POST",r.body=JSON.stringify(t),n.next=5,this.innerFetch(e,r);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}},n,this)}))}},{key:"put",value:function(e,t){return l(this,void 0,void 0,o.a.mark(function n(){var r;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return(r=this.buildOptions()).method="PUT",r.body=JSON.stringify(t),n.next=5,this.innerFetch(e,r);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}},n,this)}))}},{key:"delete",value:function(e,t){return l(this,void 0,void 0,o.a.mark(function n(){var r;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return(r=this.buildOptions()).method="DELETE",r.body=JSON.stringify(t),n.next=5,this.innerFetch(e,r);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}},n,this)}))}},{key:"fetch",value:function(e){function t(t,n,r,i){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e,t,n,r){return l(this,void 0,void 0,o.a.mark(function i(){var a,s,u,h,d,f,p,v=this;return o.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return u=function(e){return{channel:a,url:s,options:t,resolve:n,reject:r,error:e}},a=this,this.startWait(),s=e,i.prev=4,console.log("%s %s",t.method,s),h=setTimeout(function(){return a.endWait(e,r)},this.timeout),i.next=9,fetch(encodeURI(s),t);case 9:if(!1!==(d=i.sent).ok){i.next=15;break}throw clearTimeout(h),a.endWait(),console.log("call error %s",d.statusText),d.statusText;case 15:if(!((f=d.headers.get("content-type"))&&f.indexOf("json")>=0)){i.next=20;break}return i.abrupt("return",d.json().then(function(e){return l(v,void 0,void 0,o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(clearTimeout(h),a.endWait(),!0!==e.ok){t.next=4;break}return t.abrupt("return",n(e.res));case 4:if(void 0!==e.error){t.next=9;break}return t.next=7,a.showError(u("not valid tonva json"));case 7:t.next=12;break;case 9:return t.next=11,a.showError(u(e.error));case 11:r(e.error);case 12:case"end":return t.stop()}},t,this)}))}).catch(function(e){return l(v,void 0,void 0,o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.showError(u(e.message));case 2:case"end":return t.stop()}},t,this)}))}));case 20:return i.next=22,d.text();case 22:p=i.sent,clearTimeout(h),a.endWait(),n(p);case 26:i.next=36;break;case 28:if(i.prev=28,i.t0=i.catch(4),"string"!==typeof i.t0){i.next=34;break}if(!0!==i.t0.toLowerCase().startsWith("unauthorized")){i.next=34;break}return c.c.logout(),i.abrupt("return");case 34:return i.next=36,this.showError(u(i.t0.message));case 36:case 37:case"end":return i.stop()}},i,this,[[4,28]])}))})},{key:"innerFetch",value:function(e,t){return l(this,void 0,void 0,o.a.mark(function n(){var r,i=this;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(r=this.hostUrl+e,!0!==this.isCenter||void 0!==this.apiToken||!Object(s.d)()){n.next=5;break}return n.next=4,Object(s.c)(r,t.method,t.body);case 4:return n.abrupt("return",n.sent);case 5:return n.next=7,new Promise(function(e,n){return l(i,void 0,void 0,o.a.mark(function i(){return o.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.fetch(r,t,e,n);case 2:case"end":return i.stop()}},i,this)}))});case 7:return n.abrupt("return",n.sent);case 8:case"end":return n.stop()}},n,this)}))}},{key:"callFetch",value:function(e,t,n){return l(this,void 0,void 0,o.a.mark(function r(){var i,a=this;return o.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return(i=this.buildOptions()).method=t,i.body=n,r.next=5,new Promise(function(t,n){return l(a,void 0,void 0,o.a.mark(function r(){return o.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.fetch(e,i,t,n);case 2:case"end":return r.stop()}},r,this)}))});case 5:return r.abrupt("return",r.sent);case 6:case"end":return r.stop()}},r,this)}))}},{key:"buildOptions",value:function(){var e=c.c.language,t=c.c.culture,n=new Headers;n.append("Content-Type","application/json;charset=UTF-8");var r=e;return t&&(r+="-"+t),n.append("Accept-Language",r),this.apiToken&&n.append("Authorization",this.apiToken),{headers:n}}}]),e}()},,function(e,t,n){"use strict";n.d(t,"a",function(){return x});var r=n(1),i=n.n(r),a=n(3),o=n(5),s=n(6),c=n(4),u=n(7),l=n(10),h=n(8),d=n(28),f=n(15),p=n.n(f),v=n(23),m=n.n(v),y=n(44),b=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},g=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},w=100,k=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(s.a)(this,Object(c.a)(t).apply(this,arguments))).bottomTime=0,e.topTime=0,e.onScroll=function(t){return g(Object(l.a)(Object(l.a)(e)),void 0,void 0,i.a.mark(function e(){var n,r,a,o,s,c,u;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=this.props,r=n.onScroll,a=n.onScrollTop,o=n.onScrollBottom,r&&this.props.onScroll(t),(s=t.target).scrollTop<30&&void 0!==a&&(c=(new Date).getTime())-this.topTime>w&&(this.topTime=c,a()),s.scrollTop+s.offsetHeight>s.scrollHeight-30&&void 0!==o&&(u=(new Date).getTime())-this.bottomTime>w&&(this.bottomTime=u,o());case 5:case"end":return e.stop()}},e,this)}))},e}return Object(u.a)(t,e),Object(o.a)(t,[{key:"eachChild",value:function(e,t){var n=this,r=e.props;if(void 0!==r){var i=r.children;void 0!==i&&h.Children.forEach(i,function(e,r){var i=e._$scroll;i&&i(t),console.log(e.toString()),n.eachChild(e,t)})}}},{key:"render",value:function(){return h.createElement("main",{className:this.props.className,onScroll:this.onScroll},this.props.children)}}]),t}(h.Component),x=function(e){function t(e){var n;Object(a.a)(this,t),n=Object(s.a)(this,Object(c.a)(t).call(this,e));var r,i=e.tabs;if(void 0===i||0===i.length)return Object(s.a)(n);n.tabs=i;var o=[],u=!0,l=!1,h=void 0;try{for(var d,f=i[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var p=d.value,v=m.a.clone(p);void 0===r&&!0===v.isSelected?r=v:v.isSelected=!1,v.isMounted=!1,o.push(v)}}catch(y){l=!0,h=y}finally{try{u||null==f.return||f.return()}finally{if(l)throw h}}return n.state={cur:r,tabs:o},n}return Object(u.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){return g(this,void 0,void 0,i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.tabs){e.next=2;break}return e.abrupt("return");case 2:if(void 0!==(t=this.state.tabs[0])){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,this.onTabClick(t);case 7:case"end":return e.stop()}},e,this)}))}},{key:"onTabClick",value:function(e){return g(this,void 0,void 0,i.a.mark(function t(){var n,r,a,o,s,c,u,l,h;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!0!==e.isSelected){t.next=2;break}return t.abrupt("return");case 2:for(r=this.state.tabs,a=!0,o=!1,s=void 0,t.prev=6,c=r[Symbol.iterator]();!(a=(u=c.next()).done);a=!0)(l=u.value)===e?(l.isSelected=!0,n=l):l.isSelected=!1;t.next=14;break;case 10:t.prev=10,t.t0=t.catch(6),o=!0,s=t.t0;case 14:t.prev=14,t.prev=15,a||null==c.return||c.return();case 17:if(t.prev=17,!o){t.next=20;break}throw s;case 20:return t.finish(17);case 21:return t.finish(14);case 22:if(!0===n.isMounted){t.next=27;break}if(void 0===(h=n.load)){t.next=27;break}return t.next=27,h();case 27:this.setState({cur:n,tabs:r});case 28:case"end":return t.stop()}},t,this,[[6,10,14,22],[15,,17,21]])}))}},{key:"onTouchStart",value:function(e){}},{key:"renderTabs",value:function(e){var t,n=this,r=this.props,i=r.header,a=r.back,o=r.right,s=r.keepHeader,c=this.state.cur,u=h.createElement("div",null,this.state.tabs.map(function(e,t){var r,i,a,o=e.icon,s=e.isSelected,c=e.title,u=e.redDot;if(void 0!==o&&(r=h.createElement("img",{src:o})),void 0!==u){var l=u.get();l<0?(a=p()("red-dot"),i=h.createElement("u",null)):l>0&&(a=p()("red-dot","num"),i=h.createElement("u",null,l))}return h.createElement("div",{key:t,className:p()("va-tab",{cur:s}),onClick:function(){return n.onTabClick(e)}},r,h.createElement("div",{className:a},c,i))}));return!1!==i&&(t=h.createElement(y.a,{back:a,center:!0===s?i:c&&(c.header||c.title),right:o})),h.createElement("article",{className:"page-container"},t,h.createElement("section",null,this.state.tabs.map(function(e,t){var n=e.isSelected,r=e.isMounted,i=e.content;if(!0===n||!0===r)return e.isMounted=!0,h.createElement(k,{key:t,className:p()({invisible:!1===n}),onScroll:e.onScroll,onScrollTop:e.onScrollTop,onScrollBottom:e.onScrollBottom},"function"===typeof i?i():i)})),u,e)}},{key:"renderSingle",value:function(e){var t,n=this.props,r=n.back,i=n.header,a=n.right,o=n.onScroll,s=n.onScrollTop,c=n.onScrollBottom,u=n.children;return!1!==i&&(t=h.createElement(y.a,{back:r,center:i,right:a,logout:this.props.logout})),h.createElement("article",{className:"page-container",onTouchStart:this.onTouchStart},t,h.createElement("section",null,h.createElement(k,{onScroll:o,onScrollTop:s,onScrollBottom:c},u)),e)}},{key:"render",value:function(){var e,t=this.props.footer;return void 0!==t&&(e=h.createElement("footer",null,t)),void 0!==this.tabs?this.renderTabs(e):this.renderSingle(e)}}]),t}(h.Component);x=b([d.a],x)},,function(e,t,n){"use strict";n.d(t,"b",function(){return c}),n.d(t,"a",function(){return u});var r=n(3),i=n(5),a=n(1),o=n.n(a),s=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};function c(e,t,n,r,i){return s(this,void 0,void 0,o.a.mark(function a(){return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.fetch(t,n,r,i);case 2:case"end":return a.stop()}},a,this)}))}var u=function(){function e(t,n){Object(r.a)(this,e),this.path=t||"",this.showWaiting=n}return Object(i.a)(e,[{key:"call",value:function(e,t,n){return s(this,void 0,void 0,o.a.mark(function r(){var i;return o.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.getHttpChannel();case 2:return i=r.sent,r.next=5,i.callFetch(e,t,n);case 5:return r.abrupt("return",r.sent);case 6:case"end":return r.stop()}},r,this)}))}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return s(this,void 0,void 0,o.a.mark(function n(){var r;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getHttpChannel();case 2:return r=n.sent,n.next=5,r.get(this.path+e,t);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}},n,this)}))}},{key:"post",value:function(e,t){return s(this,void 0,void 0,o.a.mark(function n(){var r;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getHttpChannel();case 2:return r=n.sent,n.next=5,r.post(this.path+e,t);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}},n,this)}))}},{key:"put",value:function(e,t){return s(this,void 0,void 0,o.a.mark(function n(){var r;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getHttpChannel();case 2:return r=n.sent,n.next=5,r.put(this.path+e,t);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}},n,this)}))}},{key:"delete",value:function(e,t){return s(this,void 0,void 0,o.a.mark(function n(){var r;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.getHttpChannel();case 2:return r=n.sent,n.next=5,r.delete(this.path+e,t);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}},n,this)}))}}]),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r=n(1),i=n.n(r),a=n(3),o=n(5),s=n(6),c=n(4),u=n(7),l=n(10),h=n(8),d=n(18),f=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},p=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(s.a)(this,Object(c.a)(t).call(this,e))).logoutClick=function(){if(!1!==confirm("Really want to logout?")){var e=n.props.logout;"function"===typeof e&&e(),d.c.logout()}},n.navChange=n.navChange.bind(Object(l.a)(Object(l.a)(n))),n.state={hasBack:!1},n}return Object(u.a)(t,e),Object(o.a)(t,[{key:"navChange",value:function(){this.setState({hasBack:d.c.level>1})}},{key:"componentWillMount",value:function(){this.navChange()}},{key:"componentWillUnmount",value:function(){}},{key:"back",value:function(){return f(this,void 0,void 0,i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.c.back();case 2:case"end":return e.stop()}},e,this)}))}},{key:"openWindow",value:function(){window.open(document.location.href)}},{key:"render",value:function(){var e,t,n,r,i=this.state.hasBack||self!=top,a=this.props,o=a.right,s=a.center,c=a.logout;if(void 0!==c&&self===top&&("boolean"===typeof c&&!0===c||"function"===typeof c)){var u=d.c.user,l=u.nick,f=u.name;n=h.createElement("div",{className:"d-flex align-items-center"},h.createElement("small",{className:"text-light"},l||f),h.createElement("a",{className:"dropdown-toggle btn btn-secondary btn-sm ml-2",role:"button",onClick:this.logoutClick},h.createElement("i",{className:"fa fa-sign-out"})))}if(i)switch(this.props.back){case"none":e=void 0;break;default:case"back":e=h.createElement("nav",{onClick:this.back},h.createElement("i",{className:"fa fa-arrow-left"}));break;case"close":e=h.createElement("nav",{onClick:this.back},h.createElement("i",{className:"fa fa-close"}))}return self!=top&&(console.log(document.location.href),t=h.createElement("header",{onClick:this.openWindow})),(o||n)&&(r=h.createElement("aside",null,o," ",n)),h.createElement("header",{style:d.b},t,e,h.createElement("div",null,s),r)}}]),t}(h.Component)},,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return i});var r=n(8);function i(){return r.createElement("div",{style:{height:"100%"},className:"d-flex flex-fill align-items-center justify-content-center"},r.createElement("div",{className:"d-flex align-items-center justify-content-center slide text-info",style:{width:"5em",height:"2em"}},"\u52a0\u8f7d\u4e2d..."))}},,function(e,t,n){"use strict";n.d(t,"a",function(){return a});var r=n(29),i=n(30),a={set:function(e,t){Object(r.h)(e,t),i.a.setCenterToken(t)},clear:function(){Object(r.h)(0,void 0),i.a.setCenterToken(void 0)}}},,,,,,function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var r=n(1),i=n.n(r),a=n(3),o=n(5),s=n(6),c=n(4),u=n(7),l=n(10),h=n(8),d=n(22),f=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},p=function(e){function t(){var e;return Object(a.a)(this,t),(e=Object(s.a)(this,Object(c.a)(t).apply(this,arguments))).reApi=function(){return f(Object(l.a)(Object(l.a)(e)),void 0,void 0,i.a.mark(function e(){var t,n,r,a,o,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.props.clearError(),t=this.props,n=t.channel,r=t.url,a=t.options,o=t.resolve,s=t.reject,e.next=4,Object(d.l)(n,r,a,o,s);case 4:case"end":return e.stop()}},e,this)}))},e.close=function(){return f(Object(l.a)(Object(l.a)(e)),void 0,void 0,i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.props.clearError();case 1:case"end":return e.stop()}},e,this)}))},e}return Object(u.a)(t,e),Object(o.a)(t,[{key:"render",value:function(){var e,t=this.props,n=t.error,r=t.url;if("object"===typeof n){var i=[];for(var a in n)i.push(h.createElement("li",{key:a},h.createElement("label",null,a),h.createElement("div",null,n[a])));e=h.createElement("ul",null,i)}else e=h.createElement("div",null,n);return h.createElement("li",null,h.createElement("article",{className:"page-container"},h.createElement("section",null,h.createElement("div",{className:"va-error"},h.createElement("div",null,"\u7f51\u7edc\u51fa\u73b0\u95ee\u9898"),h.createElement("div",null,"\u70b9\u51fb\u91cd\u65b0\u8bbf\u95ee"),h.createElement("div",null,"url: ",r),e,h.createElement("div",{className:"p-3"},h.createElement("button",{type:"button",onClick:this.reApi},"\u91cd\u65b0API"),h.createElement("button",{type:"button",onClick:this.close},"\u5173\u95ed"))))))}}]),t}(h.Component)},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var r=n(3),i=n(5),a=function(){function e(t){Object(r.a)(this,e),this.name=t}return Object(i.a)(e,[{key:"get",value:function(){if(void 0!==this.value)return this.value;var e=localStorage.getItem(this.name);return this.value=null===e?void 0:JSON.parse(e)}},{key:"set",value:function(e){e?(this.value=e,localStorage.setItem(this.name,JSON.stringify(e))):this.clear()}},{key:"clear",value:function(){this.value=void 0,localStorage.removeItem(this.name)}}]),e}(),o=function(){function e(){Object(r.a)(this,e),this.user=new a("user"),this.guest=new a("guest"),this.unit=new a("unit"),this.homeTabCur=new a("homeTabCur")}return Object(i.a)(e,[{key:"logoutClear",value:function(){[this.user,this.homeTabCur].map(function(e){return e.clear()})}}]),e}()},,function(e,t,n){},function(e,t,n){e.exports=n.p+"static/media/logo.ee7cd8ed.svg"},function(e,t,n){e.exports=n(106)},,,,,,,,,,,,,,,function(e,t,n){},,function(e,t,n){},,,,,,function(e,t,n){},,function(e,t,n){},,function(e,t,n){},,function(e,t,n){},,,,,,,,function(e,t,n){},,,,function(e,t,n){},,function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),a=n(40),o="00000000000000";n(37);var s=n(22),c=n(33),u=n(36),l=n(21),h=n(1),d=n.n(h),f=n(3),p=n(5),v=n(13),m=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},y=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},b=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Object(f.a)(this,e),this.isFirst=!0,this.loading=!1,this.beforeLoad=!0,this.loaded=!1,this.allLoaded=!1,this.firstSize=100,this.pageStart=void 0,this.pageSize=30,this.appendPosition="tail",this._items=v.l.array([],{deep:t})}return Object(p.a)(e,[{key:"scrollToTop",value:function(){this.topDiv="$$"+Object(u.a)()}},{key:"scrollToBottom",value:function(){this.bottomDiv="$$"+Object(u.a)()}},{key:"reset",value:function(){this.isFirst=!0,this.beforeLoad=!0,this.loaded=!1,this.param=void 0,this.allLoaded=!1,this._items.clear(),this.setPageStart(void 0)}},{key:"append",value:function(e){"tail"===this.appendPosition?this._items.unshift(e):this._items.push(e)}},{key:"first",value:function(e){return y(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.reset(),this.beforeLoad=!1,this.param=e,t.next=5,this.more();case 5:case"end":return t.stop()}},t,this)}))}},{key:"more",value:function(){return y(this,void 0,void 0,d.a.mark(function e(){var t,n,r,i,a;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==this.allLoaded){e.next=2;break}return e.abrupt("return");case 2:if(!0!==this.loading){e.next=4;break}return e.abrupt("return");case 4:return this.loading=!0,r=this.pageSize+1,!0===this.isFirst&&this.firstSize>this.pageSize&&(r=this.firstSize+1),e.next=9,this.load(this.param,this.pageStart,r);case 9:if(i=e.sent,this.loading=!1,this.loaded=!0,a=i.length,!0===this.isFirst&&a>this.firstSize||!1===this.isFirst&&a>this.pageSize?(this.allLoaded=!1,--a,i.splice(a,1)):this.allLoaded=!0,0!==a){e.next=17;break}return this._items.clear(),e.abrupt("return");case 17:this.setPageStart(i[a-1]),"tail"===this.appendPosition?(t=this._items).push.apply(t,Object(l.a)(i)):(n=this._items).unshift.apply(n,Object(l.a)(i.reverse())),this.isFirst=!1;case 20:case"end":return e.stop()}},e,this)}))}},{key:"items",get:function(){return!0===this.beforeLoad?null:!1!==this.loaded?this._items:void 0}}]),e}();m([v.l],b.prototype,"loading",void 0),m([v.l],b.prototype,"beforeLoad",void 0),m([v.l],b.prototype,"loaded",void 0),m([v.l],b.prototype,"allLoaded",void 0),m([v.e],b.prototype,"items",null),m([v.l],b.prototype,"topDiv",void 0),m([v.l],b.prototype,"bottomDiv",void 0);var g=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},w=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},k=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;Object(f.a)(this,e),this.arr=[],this.dict=new Map,this.maxCount=t}return Object(p.a)(e,[{key:"loadIds",value:function(e){var t=[],n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;if(null!==s){var c=this.dict.get(s);void 0===c&&(t.push(s),c={id:s},this.dict.set(s,c))}}}catch(u){r=!0,i=u}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}this.loadId(t)}},{key:"get",value:function(e){if(void 0===e||null===e)return null;var t=this.dict.get(e);return void 0===t&&(this.dict.set(e,{id:e}),this.loadId([e]),t=this.dict.get(e)),t}},{key:"setItem",value:function(e,t){void 0===t?(this.dict.set(e,null),this.arr.push({id:e})):(this.dict.set(e,t),this.arr.push(t)),this.arr.length>this.maxCount&&(t=this.arr.shift(),this.dict.delete(t.id))}},{key:"loadId",value:function(e){return w(this,void 0,void 0,d.a.mark(function t(){var n,r,i,a,o,s,c,u,l,h,f,p,v,m,y=this;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._loadIds(e);case 2:if(void 0!==(n=t.sent)){t.next=36;break}r=!0,i=!1,a=void 0,t.prev=7,o=e[Symbol.iterator]();case 9:if(r=(s=o.next()).done){t.next=20;break}if(null!==(c=s.value)){t.next=13;break}return t.abrupt("continue",17);case 13:return t.next=15,this._loadId(c);case 15:u=t.sent,this.setItem(c,u);case 17:r=!0,t.next=9;break;case 20:t.next=26;break;case 22:t.prev=22,t.t0=t.catch(7),i=!0,a=t.t0;case 26:t.prev=26,t.prev=27,r||null==o.return||o.return();case 29:if(t.prev=29,!i){t.next=32;break}throw a;case 32:return t.finish(29);case 33:return t.finish(26);case 34:t.next=56;break;case 36:for(l=!0,h=!1,f=void 0,t.prev=39,p=function(){var e=m.value,t=n.find(function(t){return t.id===e});y.setItem(e,t)},v=e[Symbol.iterator]();!(l=(m=v.next()).done);l=!0)p();t.next=48;break;case 44:t.prev=44,t.t1=t.catch(39),h=!0,f=t.t1;case 48:t.prev=48,t.prev=49,l||null==v.return||v.return();case 51:if(t.prev=51,!h){t.next=54;break}throw f;case 54:return t.finish(51);case 55:return t.finish(48);case 56:case"end":return t.stop()}},t,this,[[7,22,26,34],[27,,29,33],[39,44,48,56],[49,,51,55]])}))}}]),e}();g([v.l],k.prototype,"dict",void 0);var x,E=n(12),O=n(9),j=n(16),C=(x=function(e,t){return(x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}x(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),S=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},N=function(){function e(e){this.formView=e}return e.prototype.render=function(){return O.createElement("div",{className:"col-sm-10"},this.renderControl())},Object.defineProperty(e.prototype,"hasError",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filled",{get:function(){return!1},enumerable:!0,configurable:!0}),e.prototype.clear=function(){},e.prototype.clearErrors=function(){},e.prototype.readValues=function(e){},e.prototype.setError=function(e,t){},e.prototype.setInitValues=function(e){},e.prototype.isOk=function(){return this.validate(),!this.hasError},e.prototype.validate=function(){},S([j.d],e.prototype,"hasError",null),S([j.d],e.prototype,"filled",null),e}(),P=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.field=n,i.face=r,i.init(),i.setProps(),i}return C(t,e),t.prototype.ref=function(e){this.element=e},t.prototype.init=function(){var e;this.rules=[];var t=this.field.rules;void 0!==t&&(!0===Array.isArray(t)?(e=this.rules).push.apply(e,t):this.rules.push(t))},t.prototype.setProps=function(){return this.props={ref:this.ref.bind(this),name:this.field.name}},Object.defineProperty(t.prototype,"hasError",{get:function(){return void 0!==this.error},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filled",{get:function(){return void 0!==this.value&&this.value!==this.field.defaultValue},enumerable:!0,configurable:!0}),t.prototype.clearValue=function(){this.value=void 0},t.prototype.clear=function(){this.clearErrors(),this.clearValue()},t.prototype.clearErrors=function(){this.isOK=void 0,this.error=void 0},t.prototype.readValues=function(e){e[this.field.name]=this.value},t.prototype.setError=function(e,t){},t.prototype.setInitValues=function(e){},t.prototype.getValueFromElement=function(){return this.value},t.prototype.validate=function(){try{var e=this.getValueFromElement();if(this.rules.length>0){for(var t=void 0,n=0,r=this.rules;n<r.length;n++){var i=r[n];console.log("validate: %s",e);var a=i(e);if(console.log("validate: %s err: %s",e,a),!0===a)this.error=void 0,t=!0;else if(void 0!==a)return this.error=a,void(this.isOK=!1)}this.isOK=t}this.value=e}catch(o){this.error=o.message}},t.prototype.render=function(){var e;if(void 0!==this.face){var t=this.face.notes;void 0!==t&&(e=O.createElement("small",{className:"text-muted"},t))}return O.createElement("div",{className:"col-sm-10"},this.renderControl(),e)},S([j.k],t.prototype,"isOK",void 0),S([j.k],t.prototype,"error",void 0),S([j.k],t.prototype,"value",void 0),S([j.d],t.prototype,"hasError",null),S([j.d],t.prototype,"filled",null),t}(N),_=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),R=function(e){function t(t){var n=e.call(this,t)||this;return n.otherClick=n.otherClick.bind(n),n}return _(t,e),t.prototype.otherClick=function(){var e=this.formView.props.onOther;void 0!==e&&e(this.formView.readValues())},t.prototype.renderControl=function(){console.log("buttons.renderControl");var e=this.formView.nothing,t=this.formView.hasError,n=this.formView.props;console.log("buttons.renderControl nothing:%s hasError:%s",e,t);var r,i=n.submitButton,a=n.otherButton;n.onOther;return void 0!==a&&(r=O.createElement("button",{className:"btn btn-outline-info ml-auto",onClick:this.otherClick},a)),O.createElement("div",{className:"d-flex justify-content-start"},O.createElement("button",{className:"btn btn-primary",type:"submit",disabled:e||t},i||"\u63d0\u4ea4"),r)},t}(N),A=n(26),q=n(14),I=n.n(q),F=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),V=function(){return(V=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},T=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return F(t,e),t.prototype.init=function(){e.prototype.init.call(this),!0===this.field.required&&this.rules.push(function(e){return null!==e&&void 0!==e&&0!==e.trim().length||"\u5fc5\u987b\u586b\u5165\u8981\u6c42\u5185\u5bb9"})},t.prototype.getValueFromElement=function(){return this.parseValue(this.element.value)},t.prototype.setProps=function(){e.prototype.setProps.call(this),A.assign(this.props,{onBlur:this.onBlur.bind(this),onFocus:this.onFocus.bind(this),onChange:this.onChange.bind(this)});var t=this.face;return void 0!==t&&A.assign(this.props,{placeholder:t.placeholder}),this.props},t.prototype.parseValue=function(e){return e},t.prototype.onBlur=function(){this.validate()},t.prototype.onChange=function(){console.log("onChange"),this.validate()},t.prototype.onFocus=function(){this.clearErrors()},t.prototype.className=function(){return q({"form-control":!0,"has-success":!0===this.isOK,"is-invalid":void 0!==this.error,"is-valid":void 0===this.error&&!0===this.isOK})},t.prototype.renderInput=function(){return O.createElement("input",V({className:this.className()},this.props))},t.prototype.ref=function(t){e.prototype.ref.call(this,t),t&&(t.value=void 0===this.value?"":this.value)},t.prototype.renderError=function(){return void 0===this.error?null:O.createElement("div",{className:"invalid-feedback"},this.error)},t.prototype.clearValue=function(){e.prototype.clearValue.call(this),this.element.value=""},t.prototype.setError=function(e,t){this.field.name===e&&(this.error=t)},t.prototype.setInitValues=function(e){var t=e[this.field.name];void 0!==t&&(this.value=t)},t.prototype.renderControl=function(){return O.createElement(O.Fragment,null,this.renderInput(),this.renderError())},t}(P),U=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),D=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return U(t,e),t.prototype.setProps=function(){var t=e.prototype.setProps.call(this);return A.assign(t,{type:"text",maxLength:this.field.maxLength}),t},t.prototype.parseValue=function(e){if(void 0!==e&&0!==e.trim().length)return e},t}(T),L=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return U(t,e),t.prototype.setProps=function(){var t=e.prototype.setProps.call(this);return A.assign(t,{type:"password",maxLength:this.field.maxLength}),t},t}(D),M=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),B=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return M(t,e),t.prototype.init=function(){e.prototype.init.call(this),this.extraChars=[];var t=this.field,n=t.min,r=t.max;switch(void 0!==n?(this.rules.push(function(e){if(void 0!==e)return!(e<n)||"\u6700\u5c0f\u503c\u4e3a"+n}),n<0&&this.extraChars.push(45)):this.extraChars.push(45),void 0!==r&&this.rules.push(function(e){if(void 0!==e)return!(e>r)||"\u6700\u5927\u503c\u4e3a"+r}),this.field.type){case"dec":case"number":this.extraChars.push(46)}},t.prototype.parseValue=function(e){if(void 0!==e&&0!==e.trim().length){var t=Number.parseFloat(e);if(isNaN(t))throw new Error("\u65e0\u6548\u7684\u6570\u5b57");return t}},t.prototype.setProps=function(){e.prototype.setProps.call(this),A.assign(this.props,{type:"number",step:this.field.step,onKeyPress:this.onKeyPress.bind(this)})},t.prototype.onKeyPress=function(e){var t=e.charCode;if(!(8===t||0===t||13===t||t>=48&&t<=57))if(void 0!==this.extraChars&&this.extraChars.indexOf(t)>=0)switch(t){case 46:this.onKeyDot();break;case 45:this.onKeyNeg(),e.preventDefault()}else e.preventDefault()},t.prototype.onKeyDot=function(){var e=this.element.value;e.indexOf(".")>=0&&(this.element.value=e.replace(".",""))},t.prototype.onKeyNeg=function(){var e=this.element.value,t=e.indexOf("-");e=t>=0?e.replace("-",""):"-"+e,this.element.value=e},t}(T),H=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),$=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return H(t,e),t.prototype.init=function(){e.prototype.init.call(this);var t=this.field,n=t.trueValue,r=t.falseValue;void 0===n&&(this.trueValue=1),void 0===r&&(this.falseValue=0)},t.prototype.setProps=function(){e.prototype.setProps.call(this),A.assign(this.props,{onChange:this.onChange.bind(this)})},t.prototype.clearValue=function(){this.element.checked=this.field.defaultValue===this.trueValue,this.value=this.getValueFromElement()},t.prototype.setInitValues=function(e){var t=e[this.field.name];void 0===t&&(t=this.field.defaultValue)},t.prototype.getValueFromElement=function(){return this.element.checked?this.trueValue:this.falseValue},t.prototype.onChange=function(){this.value=this.getValueFromElement()},t.prototype.renderControl=function(){return O.createElement("div",{className:"form-control-static"},O.createElement("label",{className:"form-control"},O.createElement("label",{className:"custom-control custom-checkbox mb-0"},O.createElement("input",{type:"checkbox",name:this.field.name,ref:this.props.ref,onChange:this.props.onChange,className:"custom-control-input"}),O.createElement("span",{className:"custom-control-indicator"}),O.createElement("span",{className:"custom-control-description"},this.face.label))))},t}(P),z=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),W=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return z(t,e),t.prototype.renderControl=function(){var e=this;return O.createElement("div",{className:"form-control-static"},O.createElement("div",{className:"form-control"},this.face.list.map(function(t,n){var r;return"object"!==typeof t?r=t:(r=t.text,t.value),O.createElement("label",{key:n,className:"custom-control custom-radio w-25"},O.createElement("input",{type:"radio",name:e.field.name,className:"custom-control-input"}),O.createElement("span",{className:"custom-control-indicator"}),O.createElement("span",{className:"custom-control-description"},r))})))},t}(P),Q=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),K=function(){return(K=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},J=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Q(t,e),t.prototype.setProps=function(){var t=e.prototype.setProps.call(this),n=this.field.maxLength,r=this.face.rows;return A.assign(t,{maxLength:n,rows:r}),t},t.prototype.renderInput=function(){var e=this;return O.createElement("textarea",K({ref:function(t){e.el=t,void 0!==t&&(t.value="")},className:this.className()},this.props))},t}(T),G=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Y=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.ref=i.ref.bind(i),i}return G(t,e),t.prototype.getValueFromElement=function(){var e=this.element,t=(e.selectedIndex,e.selectedOptions[0].value);switch(this.field.type){case"number":t=Number(t);break;case"date":t=new Date(t);break;case"bool":"string"===typeof t&&(t="true"===t.toLowerCase())}return t},t.prototype.renderControl=function(){var e=this.face.list,t=[];return void 0===this.face.default&&t.push(O.createElement("option",{key:-1,value:void 0},"\u8bf7\u9009\u62e9")),t.push.apply(t,e.map(function(e,t){var n,r;return"object"!==typeof e?n=r=e:(n=e.text,r=e.value),O.createElement("option",{key:t,value:r},n)})),O.createElement("div",{className:"form-control-static"},O.createElement("select",{name:this.field.name,className:"form-control",ref:this.ref},t))},t}(P),X=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Z=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return X(t,e),t.prototype.renderControl=function(){return O.createElement("div",{className:"form-control-plaintext"},O.createElement("div",{className:"alert alert-primary",role:"alert"},"don't know how to create control",O.createElement("br",null),"field: ",JSON.stringify(this.field)," must be object ",O.createElement("br",null),"face: ",JSON.stringify(this.face)," must be object ",O.createElement("br",null)))},t}(P),ee=function(e){function t(t,n){var r=e.call(this,t)||this;return r.element=n,r}return X(t,e),t.prototype.renderControl=function(){return O.createElement("div",{className:"form-control-plaintext"},this.element)},t}(N),te=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ne=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},re=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},ie=function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(s){a=[6,s],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},ae=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(){return re(t,void 0,void 0,function(){var e,t,n,r,i,a,o;return ie(this,function(s){switch(s.label){case 0:return e=this.face,t=e.pick,n=e.fromPicked,[4,t(this.face,this.formView.props,this.formView.readValues())];case 1:return void 0===(r=s.sent())?(this.value=void 0,[2]):void 0===n?(this.value=r.id,[2]):(i=n(r),a=i.id,o=i.caption,this.value=a,this.caption=o,[2])}})})},t.onPicked=function(e){t.value=e.id},t}return te(t,e),t.prototype.setInitValues=function(e){var t=e[this.field.name];this.value=t},t.prototype.controlContent=function(){var e=this.face,t=e.itemFromId,n=e.fromPicked,r=e.initCaption;if(void 0===this.value)return r||"\u8bf7\u9009\u62e9Id";if(void 0!==this.caption)return this.caption;if(void 0!==t&&void 0!==n){var i=t(this.value);if(i){var a=n(i);if(void 0!==a)return a.caption}}return String(this.value)},t.prototype.renderControl=function(){var e=this.face,t=e.tuid,n=e.input;return void 0===n?O.createElement("div",{className:"form-control-plaintext px-2 border text-primary rounded cursor-pointer",onClick:this.onClick},this.controlContent()):O.createElement("div",{className:"form-control-static "},O.createElement(n.component,{id:this.value,ui:t}))},ne([j.k],t.prototype,"caption",void 0),t}(P),oe=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),se=function(){return(se=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ce=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},ue=function(e){function t(t,n,r){var i=e.call(this,t,n,r)||this;return i.onIdChanged=i.onIdChanged.bind(i),i}return oe(t,e),t.prototype.onIdChanged=function(e){this.value=e.id},t.prototype.setInitValues=function(e){var t=e[this.field.name];this.value=t},t.prototype.buildContent=function(){var e=this;return O.createElement(this.face.input.component,se({},this.face,{id:this.value,onFormValues:function(){return e.formView.readValues()},onIdChanged:this.onIdChanged}))},t.prototype.renderControl=function(){return O.createElement("div",{className:"form-control-static "},this.buildContent())},ce([j.k],t.prototype,"caption",void 0),t}(P),le=n(24),he=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),de=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},fe=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},pe=function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(s){a=[6,s],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},ve=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(){return fe(t,void 0,void 0,function(){var e,t,n,r,i,a,o;return pe(this,function(s){switch(s.label){case 0:return e=this.face,t=e.pick,n=e.fromPicked,[4,t(this.face,this.formView.props,this.formView.readValues())];case 1:return void 0===(r=s.sent())?(this.value=void 0,[2]):(i=n(r),a=i.id,o=i.caption,this.value=a,this.caption=o,[2])}})})},t.view=Object(le.a)(function(){var e,n=t.face.content;return e=void 0===t.value||null===t.value?"\u8bf7\u9009\u62e9":O.createElement(n,{id:t.value}),O.createElement("div",{className:"form-control-plaintext px-2 border text-primary rounded cursor-pointer bg-light",onClick:t.onClick},e)}),t}return he(t,e),t.prototype.setInitValues=function(e){var t=e[this.field.name];this.value=t},t.prototype.renderControl=function(){return O.createElement(this.view,null)},de([j.k],t.prototype,"caption",void 0),t}(P),me=function(e,t){t.label;return void 0!==t.group?function(e,t,n){return new Z(e,n,void 0)}(e,0,t):void 0!==t.field?function(e,t,n){var r=n.field,i=n.face;switch(typeof r){case"string":r={name:r,type:"string"};break;case"object":break;default:return new Z(e,r,i)}var a=r.type||"string";if(void 0===i){if(void 0===(i=be[a]))return new Z(e,r,i)}else if(void 0===i.type){var o=be[a];i.type=void 0===o?"string":o.type}return new(ye[i.type||a]||Z)(e,r,i)}(e,0,t):new ee(e,t.help)},ye={string:D,password:L,number:B,checkbox:$,radiobox:W,select:Y,"pick-id":ae,"pick-tuid":ue,textarea:J,pick:ve},be={string:{type:"string"},number:{type:"number"},int:{type:"number"},dec:{type:"number"},bool:{type:"checkbox"}};var ge=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),we=function(){function e(e,t){if(this.form=e,this.row=t,void 0===t.type){var n=t.createControl;void 0===n&&(n=e.createControl),void 0===n&&(n=me),this.control=n(e,t)}}return e.prototype.isOk=function(){return void 0===this.control||this.control.isOk()},e.prototype.contains=function(e){var t=this.row.field;if(void 0!==t)return e===t.name;var n=this.row.group;return void 0!==n&&void 0!==n.find(function(t){return t.field.name===e})},Object.defineProperty(e.prototype,"hasError",{get:function(){return this.control.hasError},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"filled",{get:function(){return this.control.filled},enumerable:!0,configurable:!0}),e.prototype.clear=function(){void 0!==this.control&&this.control.clear()},e.prototype.clearErrors=function(){void 0!==this.control&&this.control.clearErrors()},e.prototype.readValues=function(e){void 0!==this.control&&this.control.readValues(e)},e.prototype.setError=function(e,t){void 0!==this.control&&this.control.setError(e,t)},e.prototype.setInitValues=function(e){void 0!==this.control&&this.control.setInitValues(e)},e}(),ke=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ge(t,e),t.prototype.render=function(e){return O.createElement("div",{key:e,className:"form-group"},this.row)},Object.defineProperty(t.prototype,"hasError",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filled",{get:function(){return!1},enumerable:!0,configurable:!0}),t}(we),xe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ge(t,e),t.prototype.render=function(e){return O.createElement("div",{key:e,className:"form-group row"},O.createElement("label",{className:"col-sm-2 col-form-label"},this.row.label),this.control.render())},t}(we);function Ee(e,t){return new xe(e,t)}function Oe(e,t){return new ke(e,t)}var je="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",Ce=8;function Se(){for(var e=je.length,t="",n=0;n<Ce;n++)t+=je.charAt(Math.floor(Math.random()*e));return t}var Ne=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Pe=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},_e=function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(s){a=[6,s],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},Re=function(){function e(e){this.rows=[],this.uid=Se(),this.props=e,this.buildRows(e),this.createControl=e.createControl,this.onSubmit=this.onSubmit.bind(this)}return Object.defineProperty(e.prototype,"hasError",{get:function(){var e=this.rows.map(function(e,t){return t+": "+e.hasError+"\n"});return console.log(e),this.rows.some(function(e){return e.hasError})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nothing",{get:function(){return this.rows.every(function(e){return!e.filled})},enumerable:!0,configurable:!0}),e.prototype.readValues=function(){for(var e={},t=0,n=this.rows;t<n.length;t++){n[t].readValues(e)}return e},e.prototype.clear=function(){for(var e=0,t=this.rows;e<t.length;e++){t[e].clear()}},e.prototype.clearErrors=function(){for(var e=0,t=this.rows;e<t.length;e++){t[e].clearErrors()}},e.prototype.setError=function(e,t){for(var n=0,r=this.rows;n<r.length;n++){r[n].setError(e,t)}},e.prototype.setInitValues=function(e){if(void 0!==e)for(var t=0,n=this.rows;t<n.length;t++){n[t].setInitValues(e)}},e.prototype.buildRows=function(e){var t=e.formRows,n=e.createRow;if(void 0!==t){for(var r=0,i=t;r<i.length;r++){var a=i[r];this.rows.push(this.buildRow(a,n))}!0!==this.props.readOnly&&(this.buttonsRow=this.buildRow({createControl:this.createButtons.bind(this)},void 0))}else this.rows.push(Oe(this,O.createElement("div",{className:"text-warning"},"TonvaForm need formRows defined")))},e.prototype.buildRow=function(e,t){var n;return void 0!==e.type?n=Oe:void 0===(n=e.createRow)&&void 0===(n=t)&&(n=Ee),n(this,e)},e.prototype.createButtons=function(e,t){return new R(e)},e.prototype.isOk=function(){for(var e=!0,t=0,n=this.rows;t<n.length;t++){n[t].isOk()||(e=!1)}return e},e.prototype.render=function(){var e=this;return O.createElement("form",{onSubmit:this.onSubmit},this.rows.map(function(t,n){return t.render(e.uid+n)}),this.buttons())},e.prototype.buttons=function(){if(void 0!==this.buttonsRow)return this.buttonsRow.render(this.uid+this.rows.length)},e.prototype.onSubmit=function(e){return Pe(this,void 0,void 0,function(){var t;return _e(this,function(n){switch(n.label){case 0:return e.preventDefault(),this.isOk()?(t=this.readValues(),[4,this.props.onSubmit(t)]):[2];case 1:return n.sent(),[2]}})})},Ne([j.d],e.prototype,"hasError",null),Ne([j.d],e.prototype,"nothing",null),e}(),Ae=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),qe=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o};var Ie=function(e){function t(t){var n=e.call(this,t)||this;return n.formView=new Re(n.props),n}return Ae(t,e),t.prototype.componentWillMount=function(){this.formView.setInitValues(this.props.initValues)},t.prototype.debug=function(){},t.prototype.render=function(){var e=this.props,t=e.className,n=e.children;e.initValues;return O.createElement("div",{className:t},void 0===n?this.formView.render():O.createElement("form",{onSubmit:this.formView.onSubmit},n))},t=qe([le.a],t)}(O.Component),Fe=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Ve=function(){function e(e){this.list=e}return Object.defineProperty(e.prototype,"isPaged",{get:function(){var e=this.list.props.items;return null!==e&&void 0!==e&&!1===Array.isArray(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"items",{get:function(){var e=this.list.props.items;return null===e?null:void 0!==e?!0===Array.isArray(e)?e:e.items:void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"loading",{get:function(){var e=this.list.props.items;if(null===e)return!1;if(void 0===e)return!0;var t=e;return void 0!==t.items&&t.loading},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectedItems",{get:function(){},enumerable:!0,configurable:!0}),e.prototype.updateProps=function(e){},e.prototype.renderContent=function(e,t){var n=this.list.props.item.render;return void 0===n?O.createElement("div",{className:"px-3 py-2"},JSON.stringify(e)):n(e,t)},Fe([j.d],e.prototype,"loading",null),e}(),Te=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Te(t,e),t.prototype.render=function(e,t){var n=this.list.props.item,r=n.className,i=n.key,a=n.onClick;return O.createElement("li",{key:void 0===i?t:i(e),className:q("va-row-clickable",r),onClick:function(){return a(e)}},this.renderContent(e,t))},t}(Ve),De=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Le=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return De(t,e),t.prototype.render=function(e,t){var n=this.list.props.item,r=n.className,i=n.key;n.render;if("string"===typeof e){var a=q("va-list-gap","px-3","pt-1");return O.createElement("li",{key:Se(),className:a},e)}return O.createElement("li",{key:void 0===i?t:i(e),className:q(r)},this.renderContent(e,t))},t}(Ve),Me=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Be=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},He=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Me(t,e),t.prototype.buildItems=function(){console.log("buildItems in selectable.tsx");var e,t=this.list.props,n=t.items,r=t.selectedItems,i=t.compare;return void 0===n?this._items=void 0:null===n?this._items=null:(e=!0===Array.isArray(n)?n:n.items,this._selectedItems=r,this._items=void 0===r?e.map(function(e){return{selected:!1,item:e,labelId:Se()}}):void 0===i?e.map(function(e){return{selected:void 0!==r.find(function(t){return t===e}),item:e,labelId:Se()}}):e.map(function(e){return{selected:void 0!==r.find(function(t){return i(e,t)}),item:e,labelId:Se()}}))},Object.defineProperty(t.prototype,"items",{get:function(){return this.buildItems(),this._items},enumerable:!0,configurable:!0}),t.prototype.updateProps=function(e){e.selectedItems!==this._selectedItems&&this.buildItems()},t.prototype.onSelect=function(e,t){e.selected=t;var n=this._items.some(function(e){return e.selected});this.list.props.item.onSelect(e.item,t,n)},Object.defineProperty(t.prototype,"selectedItems",{get:function(){return this._items.filter(function(e){return!0===e.selected}).map(function(e){return e.item})},enumerable:!0,configurable:!0}),t.prototype.render=function(e,t){var n=this,r=this.list.props.item,i=r.className,a=r.key,o=(r.render,r.onSelect,e.labelId),s=e.selected;return O.createElement("li",{key:void 0===a?t:a(e),className:q(i)},O.createElement("div",{className:"d-flex align-items-center px-3"},O.createElement("input",{ref:function(e){e&&(n.input=e,e.checked=s)},className:"",type:"checkbox",value:"",id:o,defaultChecked:s,onChange:function(t){n.onSelect(e,t.target.checked)}}),O.createElement("label",{className:"",style:{flex:1,marginBottom:0},htmlFor:o},this.renderContent(e.item,t))))},Be([j.d],t.prototype,"items",null),t}(Ve),$e=(n(86),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),ze=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},We=function(e){function t(t){var n=e.call(this,t)||this;n._$scroll=function(e){console.log("############### items scroll to "+e)};var r=n.props.item,i=r.onClick,a=r.onSelect;return n.listBase=void 0!==a?new He(n):void 0!==i?new Ue(n):new Le(n),n}return $e(t,e),t.prototype.componentWillUpdate=function(e,t,n){this.listBase.updateProps(e)},Object.defineProperty(t.prototype,"selectedItems",{get:function(){return this.listBase.selectedItems},enumerable:!0,configurable:!0}),t.prototype.render=function(){var e=this,t=this.props,n=t.className,r=t.header,i=t.footer,a=t.before,o=t.loading,s=t.none;t.item,t.selectedItems;void 0===a&&(a="before"),void 0===o&&(o="loading"),void 0===s&&(s="none");var c,u=this.listBase,l=(u.isPaged,u.items);u.loading;function h(e,t){if(e)switch(typeof e){default:case"string":return O.createElement("li",{className:"va-list-"+t},e);case"function":return O.createElement("li",{className:"va-list-"+t},e());case"object":return O.createElement("li",null,e)}}return c=null===l?h(a,"before"):void 0===l?h(o,"loading"):0===l.length?h(s,"none"):l.map(function(t,n){return e.listBase.render(t,n)}),O.createElement("ul",{className:I()("va-list",n)},h(r,"header"),c,h(i,"footer"))},t=ze([le.a],t)}(O.Component),Qe=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ke=function(e){function t(t){var n=e.call(this,t)||this;return n.handleDocumentClick=function(e){!1!==n.state.dropdownOpen&&(n.button&&n.button.contains(e.target)||n.menu&&n.toggle())},n.toggle=function(){n.setState({dropdownOpen:!n.state.dropdownOpen})},n.state={dropdownOpen:!1},n}return Qe(t,e),t.prototype.componentWillMount=function(){document.addEventListener("click",this.handleDocumentClick),document.addEventListener("touchstart",this.handleDocumentClick)},t.prototype.componentWillUnmount=function(){document.removeEventListener("click",this.handleDocumentClick),document.removeEventListener("touchstart",this.handleDocumentClick)},t.prototype.render=function(){var e=this,t=this.props,n=t.icon,r=t.actions,i=t.isRight;void 0===i&&(i=!0);var a=r.some(function(e){return void 0!==e.icon}),o=this.state.dropdownOpen;return O.createElement("div",{className:"dropdown"},O.createElement("button",{ref:function(t){return e.button=t},className:"cursor-pointer dropdown-toggle btn btn-sm","data-toggle":"dropdown","aria-expanded":o,onClick:this.toggle},O.createElement("i",{className:I()("fa","fa-"+(n||"ellipsis-v"))})),O.createElement("div",{ref:function(t){return e.menu=t},className:I()({"dropdown-menu":!0,"dropdown-menu-right":i,show:o})},r.map(function(e,t){var n,r=e.icon,i=e.caption,o=e.action;return void 0===r&&void 0===i?O.createElement("div",{className:"dropdown-divider"}):(!0===a&&(void 0!==r&&(r="fa-"+r),n=O.createElement(O.Fragment,null,O.createElement("i",{className:I()("fa",r,"fa-fw"),"aria-hidden":!0}),"\xa0 ")),void 0===o?O.createElement("h6",{className:"dropdown-header"},n," ",i):O.createElement("a",{className:"dropdown-item",key:t,href:"#",onClick:function(e){e.preventDefault(),o()}},n," ",i))})))},t}(O.Component),Je=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ge=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Je(t,e),t.prototype.render=function(){var e=this.props.date;if(!e)return null;var t="string"===typeof e?new Date(Date.parse(e)):e,n=new Date,r=n.getTime()-t.getTime(),i=n.getDate(),a=t.getDate(),o=t.getHours(),s=t.getMinutes(),c=t.getMonth()+1,u=o+(s<10?":0":":")+s;return r<-864e5?t.getFullYear()+"\u5e74"+c+"\u6708"+a+"\u65e5 "+u:r<864e5?a!==i?(r<0?"\u660e\u5929 ":"\u6628\u5929 ")+u:u:r<31536e6?c+"\u6708"+a+"\u65e5 ":t.getFullYear()+"\u5e74"+c+"\u6708"+a+"\u65e5"},t}(O.Component),Ye=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Xe=function(){function e(){}return e.prototype.setValues=function(e){},e}(),Ze=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ye(t,e),t.prototype.render=function(e){return O.createElement("div",{key:"_b_"+e,className:""},O.createElement("div",{className:"col-sm-12"},O.createElement("div",{style:{borderTop:"1px solid #f0f0f0"}})))},t}(Xe),et=function(e){function t(t){var n=e.call(this)||this;return n.param=t,n}return Ye(t,e),t.prototype.render=function(e){var t;switch(this.param){default:t="py-2";break;case"=":t="py-1";break;case"-":t="pb-1"}var n=q(t);return O.createElement("div",{key:"_g_"+e,className:n,style:{backgroundColor:"#f0f0f0"}})},t}(Xe),tt=function(e){function t(t,n){var r=e.call(this)||this;return r.gridProps=t,r.prop=n,r}return Ye(t,e),t.prototype.render=function(e){var t=this.prop,n=t.onClick,r=t.bk,i=q({"cursor-pointer":void 0!==n,"bg-white":void 0===r,row:!0});return O.createElement("div",{key:e,className:i,onClick:n},this.renderLabel(),this.renderProp())},t.prototype.renderLabel=function(){var e=this.prop.label;return void 0===e?null:O.createElement("label",{className:"col-sm-2 col-form-label"},e)},t.prototype.renderProp=function(){var e,t,n=this.prop,r=n.label,i=n.full;switch(this.gridProps.alignValue){case"left":e="justify-content-start";break;case"center":e="justify-content-center";break;case"right":e="justify-content-end"}switch(this.prop.vAlign){case"top":t="align-items-start";break;default:case"center":t="align-items-center";break;case"bottom":t="align-items-end";break;case"stretch":t="align-items-stretch"}var a=q(e,t,!0!==i?void 0===r?"col-sm-12":"col-sm-10":"w-100","d-flex");return O.createElement("div",{className:a},this.renderPropBody())},t.prototype.renderPropBody=function(){return O.createElement("div",{className:"form-control-plaintext"},this.renderPropContent())},t.prototype.renderPropContent=function(){return this.content},t}(Xe),nt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ye(t,e),t.prototype.setValues=function(e){this.content=void 0===e?void 0:e[this.prop.name]},t}(tt),rt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ye(t,e),t.prototype.setValues=function(e){this.content=void 0===e?void 0:e[this.prop.name]},t}(tt),it=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ye(t,e),t.prototype.setValues=function(e){if(void 0===e)this.content=void 0;else{var t=this.prop.list;this.content="string"===typeof t?e[t]:void 0}},t.prototype.renderPropBody=function(){var e=this.prop,t=e.list,n=e.row,r="string"===typeof t?this.content:t;return void 0===r?O.createElement("div",null):O.createElement("div",{className:"w-100"},r.map(function(e,t){return O.createElement(O.Fragment,{key:t},0===t?null:O.createElement("div",{style:{width:"100%",borderBottom:"1px solid #f0f0f0"}}),O.createElement(n,e))}))},t}(tt),at=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ye(t,e),t.prototype.renderPropBody=function(){return this.prop.component},t}(tt),ot=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Ye(t,e),t.prototype.render=function(e){return O.createElement("div",{className:"bg-white"},O.createElement("label",{className:"col-sm-2 col-form-label"},"AAABBBCCC"),O.createElement("div",{className:"col-sm-10"},O.createElement("div",{className:"form-control-plaintext"},"dsfasfa sdf asdf a")))}}(Xe),function(){function e(e,t){this.gridProps=e,this.props=t,this.buildRows()}return e.prototype.buildRows=function(){this.rows=[];for(var e=!0,t=0,n=this.props;t<n.length;t++){var r=n[t];if("string"===typeof r)this.rows.push(new et(r)),e=!0;else{e||this.rows.push(new Ze);var i=void 0;switch(r.type){default:continue;case"string":i=new nt(this.gridProps,r);break;case"number":i=new rt(this.gridProps,r);break;case"list":i=new it(this.gridProps,r);break;case"component":i=new at(this.gridProps,r)}this.rows.push(i),e=!1}}},e.prototype.setValues=function(e){for(var t=0,n=this.rows;t<n.length;t++){n[t].setValues(e)}},e.prototype.render=function(){return this.rows.map(function(e,t){return e.render(String(t))})},e}()),st=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ct=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},ut=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return st(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=e.rows,r=e.values,i=new ot(this.props,n);i.setValues(r);var a=q("container-fluid",t);return O.createElement("div",{className:a},i.render())},t=ct([le.a],t)}(O.Component),lt=(n(88),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),ht=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},dt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return lt(t,e),t.prototype.render=function(){var e,t=this.props,n=t.className,r=t.badge,i=t.size,a=t.color,o=t.badgeAlign,s=t.badgeVertical,c=t.children,u=q(n,"va-badge",i&&"va-badge-"+i,"va-badge-"+(a||"secondary"),o&&"va-badg-"+o,s&&"va-badg-"+s);return r&&(e=O.createElement("b",null,r)),O.createElement("div",{className:u},c,e)},t=ht([le.a],t)}(O.Component),ft=(n(90),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),pt=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},vt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return ft(t,e),t.prototype.render=function(){var e,t,n,r=this.props,i=r.className,a=r.left,o=r.children,s=r.right,c=r.onClick;return void 0!==a&&(e=O.createElement("header",null,a)),void 0!==s&&(t=O.createElement("footer",null,s)),void 0!==c&&(n="cursor-pointer"),O.createElement("div",{className:q("va-lmr",i,n),onClick:c},e,O.createElement("div",null,o),t)},t=pt([le.a],t)}(O.Component),mt=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),yt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return mt(t,e),t.prototype.render=function(){var e=this.props,t=e.name,n=e.className,r=e.size,i=e.spin,a=e.fixWidth,o=e.border,s=e.pull,c=e.pulse,u=e.rotate,l=e.flip,h=e.inverse,d=q(n,"fa",t&&"fa-"+t,r&&"fa-"+r,a&&"fa-fw",o&&"fa-border",s&&"fa-pull-"+s,i&&"fa-spin",c&&"fa-pulse",u&&"fa-rotate-"+u,l&&"fa-flip-"+l,h&&"fa-inverse");return O.createElement("i",{className:d})},t}(O.Component),bt=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}mt(t,e),t.prototype.render=function(){var e=this.props,t=e.className,n=e.size,r=e.children,i=q("fa-stack",t,n&&"fa-"+n);return O.createElement("span",{className:i},r)}}(O.Component),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),gt=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}bt(t,e),t.prototype.render=function(){var e=this.props,t=e.icon,n=e.iconClass,r=e.text,i=e.textClass;return O.createElement("div",{className:"py-2"},O.createElement(yt,{className:n,name:t,fixWidth:!0}),O.createElement("span",{className:i},r))}}(O.Component),function(e){return O.createElement("small",{className:q("text-muted",e.className),style:e.style},e.children)}),wt=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),kt={width:"4rem",height:"4rem"},xt=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return wt(t,e),t.prototype.render=function(){var e,t=this.props,n=t.icon,r=t.main,i=t.discription,a=t.px,o=t.py;e="string"===typeof i?O.createElement("div",null,i):i;var s=n;"string"===typeof n&&(s=O.createElement("img",{className:"d-flex mr-3",src:n,alt:"img",style:kt}));var c=q("media",void 0===a?"px-0":"px-"+a,void 0===o?"py-2":"py-"+o);return O.createElement("div",{className:c},s,O.createElement("div",{className:"media-body"},O.createElement("h5",{className:"mt-0"},r),e))},t}(O.Component),Et=(n(92),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),Ot=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},jt=function(e){function t(t){var n=e.call(this,t)||this;return n.state={pressed:!1},n}return Et(t,e),t.prototype.render=function(){var e,t,n,r,i,a,o=this.props,s=(o.date,o.main),c=o.vice,u=o.middle,l=o.midSize,h=o.icon,d=o.unread,f=o.right,p=o.onClick;if(void 0!==d){var v=void 0;(v="number"===typeof d?d:d.get())>0?n=O.createElement("b",null,v):v<0&&(n=O.createElement("b",{className:"dot"}))}switch(typeof h){case"object":e=O.createElement("header",null,h,n),t=!1;break;case"string":e=O.createElement("header",{className:"icon"},O.createElement("img",{src:h}),n),t=!0}if(void 0!==u)switch(typeof u){case"string":r=O.createElement("div",{style:{flex:l}},u);break;default:r=u}void 0!==f&&(i="string"===typeof f?O.createElement("footer",null,O.createElement("small",{className:"text-muted"},f)):O.createElement("footer",null,f)),void 0!==c&&(a=O.createElement("span",null,c));var m=q("va-row",{icon:t,pressed:this.state.pressed},{"va-action":void 0!==p});return O.createElement("li",{className:m,onClick:p},e,O.createElement("div",null,O.createElement("div",null,s),a),r,i)},t=Ot([le.a],t)}(O.Component),Ct=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),St=function(){return(St=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Nt=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Pt=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}Ct(t,e),t.prototype.render=function(){var e,t,n=this,r=this.props,i=r.header,a=r.items,o=r.beforeLoad,s=r.none,c=r.renderRow,u=r.className,l=r.footer,h=r.itemClick,d=r.converter,f=q(u,"va-list");return e=void 0===a?null===o?null:O.createElement("li",{className:"empty"},o||"..."):0===a.length?O.createElement("li",{className:"empty"},s||"[none]"):void 0!==c?a.map(function(e,t){return c(e,t,n.props.ex)}):a.map(function(e,t){var n,r=e.onClick;if(void 0===r&&void 0!==h&&(r=function(){return h(e)}),void 0!==d){if(void 0===(n=d(e)))return null}else n=St({},e);return void 0===n.key&&(n.key=n.main),O.createElement(jt,St({onClick:r},n))}),void 0!==i&&(t="string"===typeof i?O.createElement("div",{className:"va-list-header"},i):i),O.createElement("div",{className:f},t,O.createElement("ul",null,e),l)},t=Nt([le.a],t)}(O.Component),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),_t=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Rt=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},At=function(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(s){a=[6,s],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},qt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.key=null,t.onChange=function(e){t.key=e.target.value,void 0!==t.key&&(t.key=t.key.trim()),t.disabled=!t.key},t.onSubmit=function(e){return Rt(t,void 0,void 0,function(){return At(this,function(t){switch(t.label){case 0:return e.preventDefault(),null===this.key&&(this.key=this.props.initKey||""),this.key?(this.input&&(this.input.disabled=!0),[4,this.props.onSearch(this.key)]):[2];case 1:return t.sent(),this.input&&(this.input.disabled=!1),[2]}})})},t}return Pt(t,e),t.prototype.render=function(){var e,t,n=this.props,r=n.className,i=n.inputClassName,a=n.label,o=n.placeholder,s=n.buttonText,c=n.maxLength;switch(n.size){default:case"sm":e="input-group-sm";break;case"md":e="input-group-md";break;case"lg":e="input-group-lg"}return void 0!==a&&(t=O.createElement("label",{className:"input-group-addon"},a)),O.createElement("form",{className:r,onSubmit:this.onSubmit},O.createElement("div",{className:I()("input-group",e)},t,O.createElement("input",{onChange:this.onChange,type:"text",name:"key",className:I()("form-control",i||"border-primary"),placeholder:o,defaultValue:this.props.initKey,maxLength:c}),O.createElement("div",{className:"input-group-append"},O.createElement("button",{className:"btn btn-primary",type:"submit",disabled:this.disabled},O.createElement("i",{className:"fa fa-search"}),O.createElement("i",{className:"fa"}),s))))},_t([j.k],t.prototype,"disabled",void 0),t}(O.Component),It=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ft=function(){return(Ft=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},Vt=function(e){function t(t){var n=e.call(this,t)||this;return n.values={},n.stepViews=[],n.state={topView:void 0,stepViews:[]},n.onPrev=n.onPrev.bind(n),n.onNext=n.onNext.bind(n),n}return It(t,e),t.prototype.setStep=function(e){var t=this.props.steps[e];if(void 0!==t){var n,r;void 0!==this.topView&&this.stepViews.push(this.topView),this.stepViews.length>0&&(n=O.createElement(Tt,{prefix:"undo",text:"\u4e0a\u4e00\u6b65"}),r=this.onPrev);var i=this.props,a=(i.header,i.footer,void 0===t.next?{prefix:"cloud-upload",text:this.props.submitButton||"\u63d0\u4ea4"}:{suffix:"arrow-right",text:"\u4e0b\u4e00\u6b65"}),o={formRows:t.formRows,submitButton:O.createElement(Tt,Ft({},a)),onSubmit:this.onNext,otherButton:n,onOther:r};this.stepViews.length;this.topView={stepName:e,step:t,props:o},this.setState({topView:this.topView,stepViews:this.stepViews})}},t.prototype.componentWillMount=function(){this.setStep(this.props.first)},t.prototype.onPrev=function(e){A.assign(this.values,e),this.topView=this.stepViews.pop(),this.setState({topView:this.topView,stepViews:this.stepViews})},t.prototype.onNext=function(e){A.assign(this.values,e);var t,n=this.topView.step.next;if(void 0===n)return this.props.onSubmit(this.values);t="string"===typeof n?n:n(this.values),this.setStep(t)},t.prototype.render=function(){var e=this.props,t=e.className,n=e.header,r=e.footer,i=this.state,a=i.topView,o=i.stepViews,s=a.stepName,c=a.step,u=o.length+1;return O.createElement("div",{className:t},O.createElement("div",null,n&&n(c,u),O.createElement(Ie,Ft({key:s,initValues:this.values},a.props)),r&&r(c,u)))},t}(O.Component),Tt=function(e){var t,n,r=e.prefix,i=(e.text,e.suffix);return void 0!==r&&(t=O.createElement("i",{className:q("fa","fa-"+r)})),void 0!==i&&(n=O.createElement("i",{className:q("fa","fa-"+i)})),O.createElement(O.Fragment,null,t," ",e.text," ",n)};class Ut extends r.Component{render(){let{date_init:e,date_update:t}=this.props;return r.createElement("small",{className:"text-muted"},"\u4e0a\u6b21\u4fee\u6539: ",r.createElement(Ge,{date:t}),r.createElement("i",{className:"fa fa-fw"}),"\u521b\u5efa: ",r.createElement(Ge,{date:e}))}}const Dt="http://101.200.46.56/imgs/Bear-icon.png",Lt="http://101.200.46.56/imgs/Bear-icon.png";var Mt=n(11),Bt=n(25),Ht=n.n(Bt),$t=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};const zt=new class extends s.a{stickies(){return $t(this,void 0,void 0,function*(){return yield this.get("sticky/list",{start:0,pageSize:30})})}ties(){return $t(this,void 0,void 0,function*(){return yield this.get("tie/list",{start:0,pageSize:30})})}apps(e){return $t(this,void 0,void 0,function*(){return yield this.get("tie/apps",{unit:e})})}appApi(e,t,n){return $t(this,void 0,void 0,function*(){return yield this.get("tie/app-api",{unit:e,app:t,apiName:n})})}userId(e){return $t(this,void 0,void 0,function*(){return yield this.get("tie/user-id",{name:e})})}userAdminUnits(){return $t(this,void 0,void 0,function*(){return yield this.get("tie/user-admin-units",{})})}sendMessage(e,t,n){return $t(this,void 0,void 0,function*(){let{unit:r}=s.j;return yield this.post("tie/send-message",{type:t,fromUnit:r,fromApp:0,toUser:e,content:n})})}unit(e){return $t(this,void 0,void 0,function*(){return yield this.get("unit/",{unit:e})})}unitMemberCount(e){return $t(this,void 0,void 0,function*(){return yield this.get("unit/member-count",{unit:e})})}unitAdmins(e){return $t(this,void 0,void 0,function*(){return yield this.get("unit/admins",{unit:e})})}unitSetAdmin(e,t,n,r){return $t(this,void 0,void 0,function*(){return yield this.post("unit/set-admin",{fellow:e,unit:t,isOwner:n,isAdmin:r})})}unitAddAdmin(e,t,n,r){return $t(this,void 0,void 0,function*(){return yield this.post("unit/add-admin",{user:e,unit:t,isOwner:n,isAdmin:r})})}unitApps(e){return $t(this,void 0,void 0,function*(){return yield this.get("unit/apps",{unit:e})})}unitAddApp(e,t){return $t(this,void 0,void 0,function*(){return yield this.post("unit/add-app",{unit:e,app:t})})}unitDeleteApp(e,t,n){return $t(this,void 0,void 0,function*(){yield this.post("unit/delete-app",{unit:e,app:t,deleted:n})})}unitChangeProp(e,t,n){return $t(this,void 0,void 0,function*(){yield this.post("unit/change-prop",{unit:e,prop:t,value:n})})}searchApp(e,t,n,r){return $t(this,void 0,void 0,function*(){return yield this.get("unit/search-app",{unit:e,key:t,pageStart:n,pageSize:r})})}unitRoles(e){return $t(this,void 0,void 0,function*(){return yield this.get("unit/roles",{unit:e})})}unitAddRole(e,t,n){return $t(this,void 0,void 0,function*(){return yield this.post("unit/add-role",{unit:e,name:t,discription:n})})}unitRoleChangeProp(e,t,n,r){return $t(this,void 0,void 0,function*(){yield this.post("unit/change-role-prop",{unit:e,role:t,prop:n,value:r})})}unitRoleApps(e,t){return $t(this,void 0,void 0,function*(){return yield this.get("unit/role-apps",{unit:e,role:t})})}unitRoleSetApps(e,t,n){return $t(this,void 0,void 0,function*(){yield this.post("unit/role-set-apps",{unit:e,role:t,apps:n})})}unitMembers(e,t,n,r,i){return $t(this,void 0,void 0,function*(){return yield this.get("unit/members",{unit:e,role:t,key:n,pageStart:r,pageSize:i})})}unitAssignMember(e,t,n){return $t(this,void 0,void 0,function*(){yield this.post("unit/assign-member",{unit:e,member:t,assigned:n})})}unitMemberRoles(e,t){return $t(this,void 0,void 0,function*(){return yield this.get("unit/member-roles",{unit:e,member:t})})}unitSetMemberRoles(e,t,n){return $t(this,void 0,void 0,function*(){yield this.post("unit/member-set-roles",{unit:e,member:t,roles:n})})}}("tv/",void 0);var Wt=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};const Qt=new class extends s.a{uqBuilderUrl(){return Wt(this,void 0,void 0,function*(){return yield this.get("uq-builder-url",void 0)})}counts(e){return Wt(this,void 0,void 0,function*(){return yield this.get("counts",{unit:e})})}app(e){return Wt(this,void 0,void 0,function*(){return yield this.get("app",{id:e})})}uq(e){return Wt(this,void 0,void 0,function*(){return yield this.get("uq",{id:e})})}server(e){return Wt(this,void 0,void 0,function*(){return yield this.get("server",{id:e})})}uqdb(e){return Wt(this,void 0,void 0,function*(){return yield this.get("uqdb",{id:e})})}apps(e,t=30){return Wt(this,void 0,void 0,function*(){return yield this.get("apps",{unit:e,pageSize:t})})}uqs(e,t=30){return Wt(this,void 0,void 0,function*(){return yield this.get("uqs",{unit:e,pageSize:t})})}buses(e,t=30){return Wt(this,void 0,void 0,function*(){return yield this.get("buses",{unit:e,pageSize:t})})}servers(e,t=30){return Wt(this,void 0,void 0,function*(){return yield this.get("servers",{unit:e,pageSize:t})})}uqdbs(e,t=30){return Wt(this,void 0,void 0,function*(){return yield this.get("uqdbs",{unit:e,pageSize:t})})}services(e,t=30){return Wt(this,void 0,void 0,function*(){return yield this.get("services",{unit:e,pageSize:t})})}saveApp(e){return Wt(this,void 0,void 0,function*(){return yield this.post("app-save",e)})}saveUq(e){return Wt(this,void 0,void 0,function*(){return yield this.post("uq-save",e)})}saveBus(e){return Wt(this,void 0,void 0,function*(){return yield this.post("bus-save",e)})}saveServer(e){return Wt(this,void 0,void 0,function*(){return yield this.post("server-save",e)})}saveUqdb(e){return Wt(this,void 0,void 0,function*(){return yield this.post("uqdb-save",e)})}saveService(e){return Wt(this,void 0,void 0,function*(){return yield this.post("service-save",e)})}delApp(e,t){return Wt(this,void 0,void 0,function*(){return yield this.post("app-del",{unit:e,id:t})})}delUq(e,t){return Wt(this,void 0,void 0,function*(){return yield this.post("uq-del",{unit:e,id:t})})}delBus(e,t){return Wt(this,void 0,void 0,function*(){return yield this.post("bus-del",{unit:e,id:t})})}delServer(e,t){return Wt(this,void 0,void 0,function*(){return yield this.post("server-del",{unit:e,id:t})})}delUqdb(e,t){return Wt(this,void 0,void 0,function*(){return yield this.post("uqdb-del",{unit:e,id:t})})}delService(e,t){return Wt(this,void 0,void 0,function*(){return yield this.post("service-del",{unit:e,id:t})})}loadAppUqs(e){return Wt(this,void 0,void 0,function*(){return yield this.get("app-uqs",{app:e})})}appBindUq(e,t,n){return Wt(this,void 0,void 0,function*(){let r;void 0!==n&&(r=n.map(e=>String(e.id)+"|"+e.access.join(",")).join(";")),yield this.post("app-bind-uq",{unit:e,app:t,uqs:r})})}searchUq(e,t,n,r){return Wt(this,void 0,void 0,function*(){return yield this.get("uq-search",{unit:e,key:t,pageStart:n,pageSize:r})})}getMyUqs(e){return Wt(this,void 0,void 0,function*(){return yield this.get("my-uqs",{unit:e})})}searchApp(e,t,n,r){return Wt(this,void 0,void 0,function*(){return yield this.get("app-search",{unit:e,key:t,pageStart:n,pageSize:r})})}searchServer(e,t,n,r){return Wt(this,void 0,void 0,function*(){return yield this.get("server-search",{unit:e,key:t,pageStart:n,pageSize:r})})}searchUqdb(e,t,n,r){return Wt(this,void 0,void 0,function*(){return yield this.get("uqdb-search",{unit:e,key:t,pageStart:n,pageSize:r})})}loadUqServices(e,t){return Wt(this,void 0,void 0,function*(){return yield this.get("uq-services",{unit:e,uq:t})})}changeServiceProp(e,t,n,r){return Wt(this,void 0,void 0,function*(){return yield this.post("service-change-prop",{unit:e,service:t,prop:n,value:r})})}uqGetEntities(e,t){return Wt(this,void 0,void 0,function*(){return yield this.get("uq-get-entities",{unit:e,uq:t})})}}("tv/dev/",void 0);var Kt=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Jt=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class Gt{constructor(e){this.cur=void 0,this.owners=void 0,this.admins=void 0,this.fellows=void 0,this.store=e}load(){return Jt(this,void 0,void 0,function*(){let e=this.store.unit;if(void 0===e)return;if(void 0===e.id)return;if(void 0!==this.admins)return;let t=yield zt.unitAdmins(e.id),n=[],r=[],i=[];t.forEach(e=>{let{isOwner:t,isAdmin:a}=e;0===t&&0===a?i.push(e):(1===t&&n.push(e),1===a&&r.push(e))}),this.owners=n,this.admins=r,this.fellows=i})}removeCur(e){let t=e.findIndex(e=>e.id===this.cur.id);t>=0&&e.splice(t,1)}unitSetAdmin(e,t){return Jt(this,void 0,void 0,function*(){let n=this.cur;n.isOwner=e,n.isAdmin=t;let r=n.id,i=this.store.unit.id;yield zt.unitSetAdmin(r,i,e,t),this.removeCur(this.owners),this.removeCur(this.admins),this.removeCur(this.fellows),0===e&&0===t?this.fellows.unshift(n):(1===e&&this.owners.unshift(n),1===t&&this.admins.unshift(n))})}addNew(e,t,n){return Jt(this,void 0,void 0,function*(){let r=yield zt.unitAddAdmin(e,this.store.unit.id,t,n);if(void 0!==r){let e=this.cur=r;this.removeCur(this.owners),this.removeCur(this.admins),this.removeCur(this.fellows),0===t&&0===n?this.fellows.unshift(e):(1===t&&this.owners.unshift(e),1===n&&this.admins.unshift(e))}return r})}}Kt([Mt.j],Gt.prototype,"cur",void 0),Kt([Mt.j],Gt.prototype,"owners",void 0),Kt([Mt.j],Gt.prototype,"admins",void 0),Kt([Mt.j],Gt.prototype,"fellows",void 0);var Yt=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Xt=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class Zt{constructor(e,t){this.items=void 0,this.cur=void 0,this.store=e,this.dev=t}load(){return Xt(this,void 0,void 0,function*(){let e=yield this._load();this.items=e})}saveCur(e){return Xt(this,void 0,void 0,function*(){let t={};void 0!==this.cur?Ht.a.assign(t,this.cur,e):Ht.a.assign(t,e),t.unit=e.unit=this.store.unit.id;let n=yield this._save(t);if(void 0===this.cur){if(0===n)return!1;t.id=n,void 0!==this.items&&this.items.unshift(t),this._inc(),this.cur=Object(Mt.j)(t)}else Ht.a.assign(this.cur,t);return!0})}save(e){return Xt(this,void 0,void 0,function*(){let t={};Ht.a.assign(t,e),t.unit=e.unit=this.store.unit.id;let n=yield this._save(t);if(0!==n)return t.id=n,t})}del(){return Xt(this,void 0,void 0,function*(){let e=this.cur;if(void 0===e)return;let t=e.id;if(yield this._del(e),void 0===this.items)return;let n=this.items.findIndex(e=>e.id===t);n>=0&&(this.items.splice(n,1),this._dec())})}}Yt([Mt.j],Zt.prototype,"items",void 0),Yt([Mt.j],Zt.prototype,"cur",void 0);class en extends Zt{constructor(){super(...arguments),this.uqs=void 0,this.searchedUqs=void 0}_load(){return Xt(this,void 0,void 0,function*(){return yield Qt.apps(this.store.unit.id)})}_save(e){return Xt(this,void 0,void 0,function*(){return yield Qt.saveApp(e)})}_del(e){return Xt(this,void 0,void 0,function*(){yield Qt.delApp(this.store.unit.id,e.id)})}_inc(){this.dev.counts.app++}_dec(){this.dev.counts.app--}loadCurUqs(){return Xt(this,void 0,void 0,function*(){let e=yield Qt.loadAppUqs(this.cur.id);this.uqs=e})}searchUq(e){return Xt(this,void 0,void 0,function*(){this.searchedUqs=yield Qt.searchUq(this.store.unit.id,e,0,on)})}appBindUq(e,t){return Xt(this,void 0,void 0,function*(){let n=this.uqs.map(e=>{let{id:t,access:n}=e;return{id:t,access:[n]}});for(let r of e){let e=n.findIndex(e=>e.id===r.id);!0===t?e<0&&n.unshift(r):n.splice(e,1)}yield Qt.appBindUq(this.store.unit.id,this.cur.id,n);for(let r of e){let e=this.uqs.findIndex(e=>e.id===r.id);if(e>=0&&this.uqs.splice(e,1),!0===t&&void 0!==this.searchedUqs){let e=this.searchedUqs.find(e=>e.id===r.id);void 0!==e&&this.uqs.unshift(e)}}})}}Yt([Mt.j],en.prototype,"uqs",void 0),Yt([Mt.j],en.prototype,"searchedUqs",void 0);class tn extends Zt{_load(){return Xt(this,void 0,void 0,function*(){return yield Qt.uqs(this.store.unit.id)})}_save(e){return Xt(this,void 0,void 0,function*(){return yield Qt.saveUq(e)})}_del(e){return Xt(this,void 0,void 0,function*(){yield Qt.delUq(this.store.unit.id,e.id)})}_inc(){this.dev.counts.uq++}_dec(){this.dev.counts.uq--}}class nn extends Zt{_load(){return Xt(this,void 0,void 0,function*(){return yield Qt.buses(this.store.unit.id)})}_save(e){return Xt(this,void 0,void 0,function*(){return yield Qt.saveBus(e)})}_del(e){return Xt(this,void 0,void 0,function*(){yield Qt.delBus(this.store.unit.id,e.id)})}_inc(){this.dev.counts.bus++}_dec(){this.dev.counts.bus--}}class rn extends Zt{_load(){return Xt(this,void 0,void 0,function*(){return yield Qt.servers(this.store.unit.id)})}_save(e){return Xt(this,void 0,void 0,function*(){return yield Qt.saveServer(e)})}_del(e){return Xt(this,void 0,void 0,function*(){yield Qt.delServer(this.store.unit.id,e.id)})}_inc(){this.dev.counts.server++}_dec(){this.dev.counts.server--}}class an extends Zt{_load(){return Xt(this,void 0,void 0,function*(){return yield Qt.services(this.store.unit.id)})}_save(e){return Xt(this,void 0,void 0,function*(){return yield Qt.saveService(e)})}_del(e){return Xt(this,void 0,void 0,function*(){yield Qt.delService(this.store.unit.id,e.id)})}_inc(){this.dev.counts.service++}_dec(){this.dev.counts.service--}changeProp(e,t){return Xt(this,void 0,void 0,function*(){let n=yield Qt.changeServiceProp(this.store.unit.id,this.cur.id,e,t);switch(e){case"url":this.cur.url=t;break;case"server":this.cur.server=t;break;case"db":this.cur.db=t;break;case"db_type":this.cur.db_type=t;break;case"connection":this.cur.connection=t}return n})}loadUqServices(e){return Xt(this,void 0,void 0,function*(){let t=yield Qt.loadUqServices(this.store.unit.id,e);this.items=t[0]})}}const on=50;class sn{constructor(e,t,n){this.items=void 0,this.allLoaded=!1,this.pageStart=0,this.store=e,this.dev=t,this.search=n}first(e){return Xt(this,void 0,void 0,function*(){this.key=e,this.items=void 0,this.allLoaded=!1,this.pageStart=0,yield this.more()})}more(){return Xt(this,void 0,void 0,function*(){if(!0===this.allLoaded)return;let e=yield this.search(this.store.unit.id,this.key,this.pageStart,on),t=e.length;t>on?(this.allLoaded=!1,--t,e.splice(t,1)):this.allLoaded=!0,t>0?(this.pageStart=e[t-1].id,void 0===this.items?this.items=e:this.items.push(...e)):this.items=[]})}}Yt([Mt.j],sn.prototype,"items",void 0);class cn{constructor(e){this.counts=void 0,this.apps=void 0,this.uqs=void 0,this.buses=void 0,this.servers=void 0,this.services=void 0,this.searchApp=void 0,this.searchUq=void 0,this.searchServer=void 0,this.searchUqdb=void 0,this.store=e,this.apps=new en(e,this),this.uqs=new tn(e,this),this.buses=new nn(e,this),this.servers=new rn(e,this),this.services=new an(e,this),this.searchApp=new sn(e,this,Qt.searchApp.bind(Qt)),this.searchUq=new sn(e,this,Qt.searchUq.bind(Qt)),this.searchServer=new sn(e,this,Qt.searchServer.bind(Qt))}loadCounts(){return Xt(this,void 0,void 0,function*(){let{unit:e}=this.store;this.counts=yield Qt.counts(e.id)})}}Yt([Mt.j],cn.prototype,"counts",void 0);var un=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class ln extends k{_loadIds(e){return un(this,void 0,void 0,function*(){})}_loadId(e){return un(this,void 0,void 0,function*(){return yield zt.unit(e)})}}class hn extends k{_loadIds(e){return un(this,void 0,void 0,function*(){})}_loadId(e){return un(this,void 0,void 0,function*(){return yield Qt.uq(e)})}}class dn extends k{_loadIds(e){return un(this,void 0,void 0,function*(){})}_loadId(e){return un(this,void 0,void 0,function*(){return yield Qt.app(e)})}}class fn extends k{_loadIds(e){return un(this,void 0,void 0,function*(){})}_loadId(e){return un(this,void 0,void 0,function*(){return yield Qt.server(e)})}}var pn=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},vn=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class mn{get unitId(){return s.j.unit}init(){this.unit=void 0,this.admins=new Gt(this),this.dev=new cn(this),this.cacheUnits=new ln,this.cacheUqs=new hn,this.cacheApps=new dn,this.cacheServers=new fn}logout(){s.j.hash=void 0,s.j.unit=void 0,this.init(),this.memberCount=void 0,this.apps=void 0,this.role=void 0,this.roles=void 0,this.roleApps=void 0,this.roleMember=void 0,this.roleMembers=void 0,this.memberRoles=void 0}setRole(e){this.role!==e&&(this.role=e,this.roleApps=void 0,this.roleMember=void 0,this.roleMembers=void 0,this.memberRoles=void 0)}setRoleUser(e){this.roleMember!==e&&(this.roleMember=e,this.memberRoles=void 0)}unitChangeProp(e,t){return vn(this,void 0,void 0,function*(){yield zt.unitChangeProp(this.unit.id,e,t),this.unit[e]=t})}loadApps(){return vn(this,void 0,void 0,function*(){void 0===this.apps&&(this.apps=yield zt.unitApps(this.unitId))})}loadUnit(){return vn(this,void 0,void 0,function*(){if(void 0===this.unitId)return;console.log("loadUnit()");let e=yield zt.unit(this.unitId);this.unit=e,console.log("loadUnit unit=%s",JSON.stringify(e)),this.memberCount=yield zt.unitMemberCount(this.unitId);let t=yield Qt.uqBuilderUrl(),{url:n,urlDebug:r}=t;this.uqServer=s.f.getUrlOrDebug(n,r),console.log("uq-build: %s",JSON.stringify(this.uqServer))})}stopUnitApp(e){return vn(this,void 0,void 0,function*(){yield zt.unitDeleteApp(this.unit.id,e,1),this.apps.find(t=>t.id===e).inUnit=0})}restoreUnitApp(e){return vn(this,void 0,void 0,function*(){let t=yield zt.unitAddApp(this.unit.id,e);return t<=0?t:(this.apps.find(t=>t.id===e).inUnit=1,1)})}addUnitApp(e){return vn(this,void 0,void 0,function*(){let t=yield zt.unitAddApp(this.unit.id,e.id);return t<=0?t:(this.apps.push(e),1)})}loadRoles(){return vn(this,void 0,void 0,function*(){if(void 0!==this.roles)return;let e=yield zt.unitRoles(this.unit.id);e.forEach(e=>{switch(e.id){case 1:e.name="\u8bbf\u5ba2",e.discription="\u53ef\u4ee5\u83b7\u53d6\u5f00\u653e\u4fe1\u606f";break;case 2:e.name="\u666e\u901a",e.discription="\u80fd\u8bbf\u95ee\u6700\u57fa\u672c\u7684\u529f\u80fd"}}),this.roles=e})}unitAddRole(e,t){return vn(this,void 0,void 0,function*(){let n=yield zt.unitAddRole(this.unit.id,e,t);return n>0&&this.roles.push({id:n,name:e,discription:t,count:void 0}),n})}roleChangeProp(e,t){return vn(this,void 0,void 0,function*(){yield zt.unitRoleChangeProp(this.unit.id,this.role.id,e,t),this.role[e]=t})}loadRoleApps(){return vn(this,void 0,void 0,function*(){let e=yield zt.unitRoleApps(this.unit.id,this.role.id);this.roleApps=e.map(e=>this.apps.find(t=>t.id===e.id))})}setRoleApps(e){return vn(this,void 0,void 0,function*(){yield zt.unitRoleSetApps(this.unit.id,this.role.id,e.map(e=>e.id)),this.roleApps=e})}loadMembers(){return vn(this,void 0,void 0,function*(){let e=yield zt.unitMembers(this.unit.id,void 0===this.role?0:this.role.id,void 0,0,100);this.roleMembers=e})}unitAssignMember(e){return vn(this,void 0,void 0,function*(){yield zt.unitAssignMember(this.unit.id,this.roleMember.id,e),this.roleMember.assigned=e})}loadMemberRoles(){return vn(this,void 0,void 0,function*(){let e=(yield zt.unitMemberRoles(this.unit.id,this.roleMember.id)).map(e=>{let t=e.id,n=this.roles.find(e=>e.id===t);return Ht.a.clone(n)});this.memberRoles=e})}setMemberRoles(e){return vn(this,void 0,void 0,function*(){yield zt.unitSetMemberRoles(this.unit.id,this.roleMember.id,e.map(e=>e.id)),this.roles.forEach(t=>{let n=t.id,r=this.memberRoles.find(e=>e.id===n),i=e.find(e=>e.id===n);if(void 0===r)void 0!==i&&t.count++;else{if(void 0!==i)return;t.count--}}),this.memberRoles=e})}}pn([Mt.j],mn.prototype,"unit",void 0),pn([Mt.j],mn.prototype,"memberCount",void 0),pn([Mt.j],mn.prototype,"apps",void 0),pn([Mt.j],mn.prototype,"role",void 0),pn([Mt.j],mn.prototype,"roles",void 0),pn([Mt.j],mn.prototype,"roleApps",void 0),pn([Mt.j],mn.prototype,"roleMember",void 0),pn([Mt.j],mn.prototype,"roleMembers",void 0),pn([Mt.j],mn.prototype,"memberRoles",void 0);const yn=new mn;var bn=n(35),gn=n.n(bn);function wn(e,t,n,i){let a,o;return!0===e?(a="a",o={className:bn(t,"cursor-pointer"),onClick:n,href:"#"}):(a="span",o={className:t}),r.createElement(a,o,i)}var kn=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o};let xn=class extends r.Component{constructor(){super(...arguments),this.onClick=(e=>(e.preventDefault(),c.g.push(r.createElement(On,{id:this.props.id})),!1))}render(){let{id:e,isLink:t,className:n}=this.props;if(void 0===e)return null;let i,a=yn.cacheUnits.get(e),{name:o,nick:s,discription:c}=a,u=c&&"- "+c;return i=s?r.createElement(r.Fragment,null,s," \xa0 ",r.createElement("small",{className:"text-muted"},o," ",u)):o?r.createElement(r.Fragment,null,o," \xa0 ",r.createElement("small",{className:"text-muted"},u)):e,wn(t,n,this.onClick,i)}};xn=kn([E.a],xn);let En=class extends r.Component{render(){let{id:e,isLink:t,className:n}=this.props;if(void 0===e)return null;let i=yn.cacheUnits.get(e),{name:a}=i;return r.createElement(r.Fragment,null,a)}};En=kn([E.a],En);class On extends r.Component{constructor(e){super(e)}render(){let e=yn.cacheUnits.get(this.props.id),{name:t,nick:n,icon:i,discription:a}=e;return this.rows=["",{type:"component",component:r.createElement(xt,{icon:i||Dt,main:t,discription:a})},""],r.createElement(c.d,{header:"\u5c0f\u53f7 - \u8be6\u7ec6\u8d44\u6599"},r.createElement(ut,{rows:this.rows,values:this.props}))}}var jn=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o};let Cn=class extends r.Component{constructor(){super(...arguments),this.onClick=(e=>(e.preventDefault(),c.g.push(r.createElement(Sn,{id:this.props.id})),!1))}render(){let e,{id:t,className:n,isLink:i}=this.props,a=yn.cacheUqs.get(t);if(null===a)e=t;else{let{name:n,discription:i}=a,o=i&&"- "+i;e=void 0!==n?r.createElement(r.Fragment,null,n," \xa0 ",r.createElement("small",{className:"text-muted"},o)):t}return wn(i,n,this.onClick,e)}};Cn=jn([E.a],Cn);let Sn=class extends r.Component{constructor(e){super(e)}render(){let e=yn.cacheUqs.get(this.props.id),{name:t,discription:n,unit:i,date_init:a,date_update:o}=e,s=r.createElement("div",null,r.createElement("div",null,n),r.createElement(Ut,{date_update:o,date_init:a}));return this.rows=["",{type:"component",component:r.createElement(xt,{icon:Dt,main:t,discription:s})},"",{type:"component",label:"\u6240\u6709\u8005",component:r.createElement("div",{className:"py-2"},r.createElement(xn,{id:i,isLink:!0}))}],r.createElement(c.d,{header:"UQ - \u8be6\u7ec6\u8d44\u6599"},r.createElement(ut,{rows:this.rows,values:this.props}))}};Sn=jn([E.a],Sn);var Nn=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Pn=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};let _n=class extends r.Component{constructor(){super(...arguments),this.onClick=(e=>(e.preventDefault(),c.g.push(r.createElement(Rn,{id:this.props.id})),!1))}render(){let e,{id:t,isLink:n,className:i}=this.props,a=yn.cacheApps.get(t);if(null===a)e=t;else{let{name:n,icon:i,discription:o}=a,s=(a.public,o&&"- "+o);e=void 0!==n?r.createElement(r.Fragment,null,n," \xa0 ",r.createElement("small",{className:"text-muted"},s)):t}return wn(n,i,this.onClick,e)}};_n=Nn([E.a],_n);let Rn=class extends r.Component{constructor(e){super(e),this.apis={label:"\u5173\u8054API",type:"list",list:void 0,row:An}}componentDidMount(){return Pn(this,void 0,void 0,function*(){this.apis.list=yield Qt.loadAppUqs(this.props.id)})}render(){let e=yn.cacheApps.get(this.props.id),{unit:t,name:n,discription:i,icon:a,date_init:o,date_update:s}=e,u=r.createElement("div",null,r.createElement("div",null,i),r.createElement(Ut,{date_update:s,date_init:o}));return this.rows=["",{type:"component",component:r.createElement(xt,{icon:a||Dt,main:n,discription:u})},"",{type:"component",label:"\u6240\u6709\u8005",component:r.createElement("div",{className:"py-2"},r.createElement(xn,{id:t,isLink:!0}))},this.apis],r.createElement(c.d,{header:"APP - \u8be6\u7ec6\u8d44\u6599"},r.createElement(ut,{rows:this.rows,values:this.props}))}};Nn([Mt.j],Rn.prototype,"apis",void 0),Rn=Nn([E.a],Rn);class An extends r.Component{render(){let e,{name:t,discription:n}=this.props;return n&&(e=r.createElement("div",{className:"small text-muted"},n)),r.createElement("div",{className:"form-control-plaintext"},r.createElement("div",null,t),e)}}let qn=class extends r.Component{constructor(){super(...arguments),this.onClick=(e=>(e.preventDefault(),c.g.push(r.createElement(In,{id:this.props.id})),!1))}render(){let e,{id:t,isLink:n,className:i}=this.props,a=yn.cacheServers.get(t);if(null===a)e=t;else{let{cloud:n,ip:i,discription:o}=a;e=void 0!==o?r.createElement(r.Fragment,null,o," \xa0 ",r.createElement("small",{className:"text-muted"},i)):t}return wn(n,i,this.onClick,e)}};qn=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}([E.a],qn);class In extends r.Component{constructor(e){super(e)}render(){let e=yn.cacheServers.get(this.props.id),{discription:t,cloud:n,ip:i,unit:a,date_init:o,date_update:s}=e;r.createElement("div",null,r.createElement("div",null,t),r.createElement(Ut,{date_update:s,date_init:o}));return this.rows=["",{type:"component",component:r.createElement(xt,{icon:Dt,main:t,discription:i})},"",{type:"component",label:"\u6240\u6709\u8005",component:r.createElement("div",{className:"py-2"},r.createElement(xn,{id:a,isLink:!0}))},{type:"string",label:"\u4e91\u670d\u52a1",name:"cloud"}],r.createElement(c.d,{header:"\u670d\u52a1\u5668 - \u8be6\u7ec6\u8d44\u6599"},r.createElement(ut,{rows:this.rows,values:this.props}))}}var Fn=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class Vn extends r.Component{constructor(e){super(e),this.onChange=(e=>{let t=this.props.value,n=t&&t.trim();this.value=e.currentTarget.value.trim(),this.setState({disabled:n===this.value})}),this.onSubmit=(()=>Fn(this,void 0,void 0,function*(){let e=this.props.value,t=e&&e.trim(),n=this.value,r=this.props.onChanged;if(void 0!==r){let e=yield r(n,t);if("string"===typeof e)return void this.setState({error:e});c.g.pop()}})),this.state={disabled:!0}}renderControl(){return r.createElement("input",{className:"form-control w-100",type:"text",defaultValue:this.props.value,onChange:this.onChange})}render(){let e,{title:t,onChanged:n,buttonText:i,info:a,value:o}=this.props,{disabled:s,error:u}=this.state,l=r.createElement("button",{className:"btn btn-success btn-sm",disabled:s,onClick:this.onSubmit},i||"\u4fdd\u5b58");return void 0!==u&&(e=r.createElement("div",{className:"text-danger"},u)),r.createElement(c.d,{header:t,right:l},r.createElement("div",{className:"my-4 mx-3"},this.renderControl(),e,r.createElement("small",{className:"d-block mt-2 text-muted"},a)))}}class Tn extends Vn{constructor(){super(...arguments),this.onTextAreaChange=(e=>{let t=this.props.value,n=t&&t.trim();this.value=e.currentTarget.value.trim(),this.setState({disabled:n===this.value})})}renderControl(){return r.createElement("textarea",{className:"form-control w-100",rows:8,defaultValue:this.props.value,onChange:this.onTextAreaChange})}}var Un=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};let Dn=class extends r.Component{constructor(){super(...arguments),this.schema=[{name:"user",type:"string",required:!0},{name:"submit",type:"submit"}],this.uiSchema={items:{user:{widget:"text",maxLength:100,placeholder:"\u7528\u6237\u540d",label:"\u9080\u8bf7\u6210\u5458"},submit:{widget:"button",label:"\u9080\u8bf7"}}},this.onSendInvitation=((e,t)=>Un(this,void 0,void 0,function*(){let{isOwner:e,isAdmin:n}=this.props,r=t.form.data.user;if(void 0===(yield yn.admins.addNew(r,e?1:0,n?1:0)))return r+"\u6ca1\u6709\u5173\u6ce8\u5c0f\u53f7";c.g.pop()}))}render(){let{isOwner:e,isAdmin:t}=this.props,n=e?"\u9ad8\u7ba1":"\u7ba1\u7406\u5458";return r.createElement(c.d,{header:"\u65b0\u589e"+n},r.createElement("div",{className:"container"},r.createElement("div",{className:"my-4 text-info"},"\u53ea\u6709\u5173\u6ce8\u672c\u5c0f\u53f7\u7684\u7528\u6237\uff0c\u624d\u80fd\u6210\u4e3a",n),r.createElement(c.b,{schema:this.schema,uiSchema:this.uiSchema,onButtonClick:this.onSendInvitation})))}};var Ln=Dn=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}([E.a],Dn),Mn=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};let Bn=class extends r.Component{onSubmit(e,t){return Mn(this,void 0,void 0,function*(){let{isOwner:e,isAdmin:n}=t.form.data;yield yn.admins.unitSetAdmin(e,n),c.g.pop()})}componentWillMount(){let{unit:e}=yn,{isRoot:t,isOwner:n,isAdmin:r}=e,i=(yn.admins.cur,{name:"isAdmin",type:"boolean"}),a={name:"submit",type:"submit"};1===t?this.schema=[{name:"isOwner",type:"boolean"},i,a]:1===n&&(this.schema=[i,a]),this.uiSchema={items:{isOwner:{widget:"checkbox",label:"\u9ad8\u7ba1",trueValue:1,falseValue:0},isAdmin:{widget:"checkbox",label:"\u7ba1\u7406\u5458",trueValue:1,falseValue:0},submit:{widget:"button",label:"\u63d0\u4ea4"}}}}render(){return r.createElement(c.d,{header:"\u6743\u9650"},r.createElement($n,Object.assign({},yn.admins.cur)),r.createElement(c.b,{schema:this.schema,uiSchema:this.uiSchema,onButtonClick:this.onSubmit}))}};var Hn=Bn=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}([E.a],Bn);const $n=e=>{let{name:t,nick:n,icon:i}=e;return r.createElement("div",{className:"container"},r.createElement("div",{className:"row my-4"},r.createElement("div",{className:"col-xs-2 d-flex justify-content-end align-items-start"},r.createElement("img",{className:"w-75",src:i||Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56",REACT_APP_ICON:"http://101.200.46.56/imgs/Bear-icon.png",REACT_APP_ITEM_ICON:"http://101.200.46.56/imgs/Bear-icon.png"}).REACT_APP_DEFAULT_ICON})),r.createElement("div",{className:"col-xs-auto"},r.createElement("h4",{className:"text-dark"},t),r.createElement("h6",null,r.createElement("small",{className:"text-secondary"},n)),r.createElement("div",{className:"text-info"},"\u8bbe\u7f6e\u6210\u5458\u6743\u9650"))),r.createElement("hr",{className:"mb-4"}))};var zn=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};let Wn=class extends r.Component{constructor(){super(...arguments),this.row=(({icon:e,name:t,nick:n})=>{let i;return i=void 0===n?r.createElement("b",null,t):r.createElement(r.Fragment,null,r.createElement("b",null,n)," \xa0 ",r.createElement("small",{className:"text-muted"},t)),r.createElement(vt,{className:"py-2 px-3 align-items-stretch",left:r.createElement(dt,{size:"sm"},r.createElement("img",{src:e||Lt}))},r.createElement("div",{className:"px-3"},i))}),this.onNewOwner=(e=>{this.newAdmin(e,!0,!1)}),this.onNewAdmin=(e=>{this.newAdmin(e,!1,!0)})}componentDidMount(){return zn(this,void 0,void 0,function*(){yield yn.admins.load()})}onNewFellow(){}onItemClick(e){yn.admins.cur=e,c.g.push(r.createElement(Hn,null))}newAdmin(e,t,n){e.preventDefault(),c.g.push(r.createElement(Ln,{isOwner:t,isAdmin:n}))}render(){let{unit:e}=yn;if(void 0===e)return;let t,n,{owners:i,admins:a,fellows:o}=yn.admins,s=r.createElement("button",{className:"btn btn-success btn-sm",onClick:this.onNewFellow},"\u65b0\u589e\u6210\u5458"),u=!1,l=!1;if(1===e.isRoot&&(u=!0,l=!0),1===e.isOwner&&(l=!0),!0===u){let e=r.createElement(vt,{className:"px-3 small",left:"\u9ad8\u7ba1",right:r.createElement("a",{className:"small",href:"#",onClick:this.onNewOwner},"\u65b0\u589e")});t=r.createElement(We,{className:"my-4",header:e,items:i,none:"[\u65e0]",item:{onClick:this.onItemClick,render:this.row}})}if(!0===l){let e=r.createElement(vt,{className:"px-3 small",left:"\u7ba1\u7406\u5458",right:r.createElement("a",{className:"small",href:"#",onClick:this.onNewAdmin},"\u65b0\u589e")});n=r.createElement(We,{className:"my-4",header:e,items:a,none:"[\u65e0]",item:{onClick:this.onItemClick,render:this.row}})}return r.createElement(c.d,{header:"\u7ba1\u7406\u5458",right:s},t,n,r.createElement("div",{className:"card mx-1 my-4"},r.createElement("div",{className:"card-title"},"\u8bf4\u660e"),r.createElement("div",{className:"card-body"},r.createElement("ul",{style:{paddingLeft:"1em"}},r.createElement("li",null,r.createElement("div",{className:"card-text"},"\u7ba1\u7406\u7ec4\u5305\u62ec\u4e3b\u4eba\u3001\u9ad8\u7ba1\u3001\u7ba1\u7406\u5458")),r.createElement("li",null,r.createElement("div",{className:"card-text"},"\u5c0f\u53f7\u4e3b\u4eba\u53ef\u4ee5\u589e\u51cf\u9ad8\u7ba1")),r.createElement("li",null,r.createElement("div",{className:"card-text"},"\u9ad8\u7ba1\u53ef\u4ee5\u589e\u51cf\u7ba1\u7406\u5458")),r.createElement("li",null,r.createElement("div",{className:"card-text"},"\u7ba1\u7406\u5458\u53ef\u4ee5\u7ba1\u7406\u5c0f\u53f7\uff0c\u7a0b\u5e8f\u7684\u5f00\u53d1\uff0c\u4ee5\u53ca\u7528\u6237"))))))}};var Qn=Wn=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}([E.a],Wn),Kn=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Jn=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};let Gn=class extends r.Component{constructor(){super(...arguments),this.renderUqRow=((e,t)=>{let{name:n,owner:i,unit:a,discription:o}=e;return r.createElement(vt,{className:"py-2",right:r.createElement("small",{className:"text-muted"},o)},i," / ",n)}),this.act=(()=>Jn(this,void 0,void 0,function*(){let{app:e,appActed:t}=this.props,{id:n,unit:r,inUnit:i}=e,a=1;if(0===i){(yield yn.restoreUnitApp(n))<=0&&alert("app \u6216\u8005 uq \u6ca1\u6709\u5b9a\u4e49 service")}else if(1===i)yield yn.stopUnitApp(n),a=0;else{let t=Ht.a.clone(e);t.id=n,t.inUnit=1,(yield yn.addUnitApp(t))<=0&&alert("app \u6216\u8005 uq \u6ca1\u6709\u5b9a\u4e49 service")}void 0!==t&&t(n,a),c.g.pop()}))}componentWillMount(){return Jn(this,void 0,void 0,function*(){this.uqAccesses=yield Qt.loadAppUqs(this.props.app.id)})}render(){let e,t,n,{unit:i,name:a,discription:o,icon:s,inUnit:c,date_init:u,date_update:l}=this.props.app,h=r.createElement("div",null,r.createElement("div",null,o),r.createElement(Ut,{date_update:l,date_init:u}));1===c?(e="ban",t="\u505c\u7528APP",n="btn-danger"):0===c?(e="refresh",t="\u6062\u590dAPP",n="btn-success"):(e="plus",t="\u542f\u7528APP",n="btn-primary");let d=["",{type:"component",component:r.createElement(xt,{icon:s||Dt,main:a,discription:h})},"",{type:"component",label:"\u5f00\u53d1\u53f7",component:r.createElement("div",{className:"py-2"},r.createElement(xn,{id:i,isLink:!0}))},{type:"component",label:"\u5173\u8054UQ",component:r.createElement(We,{className:"w-100",items:this.uqAccesses,item:{render:this.renderUqRow}})},"","",{type:"component",bk:"",component:r.createElement("button",{className:gn()("btn","w-100",n),onClick:this.act},r.createElement(yt,{name:e,size:"lg"})," ",t)}];return r.createElement("div",null,r.createElement(ut,{rows:d,values:this.props}))}};Kn([Mt.j],Gn.prototype,"uqAccesses",void 0),Gn=Kn([E.a],Gn);var Yn=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class Xn extends b{constructor(e){super(),this.unitId=e}load(){return Yn(this,void 0,void 0,function*(){return yield zt.searchApp(this.unitId,this.param,this.pageStart,this.pageSize)})}setPageStart(e){this.pageStart=void 0===e?0:e.id}}let Zn=class extends r.Component{constructor(e){super(e),this.onSearch=(e=>Yn(this,void 0,void 0,function*(){yield this.apps.first(e)})),this.appClick=(e=>{c.g.push(r.createElement(c.d,{header:"App\u8be6\u7ec6\u4fe1\u606f"},r.createElement(Gn,{app:e,appActed:this.appActed})))}),this.appActed=((e,t)=>{let n=this.apps.items,r=n.find(t=>t.id===e);r.inUnit=t,n.replace([r])}),this.apps=new Xn(yn.unit.id)}renderApp(e){let t,{name:n,discription:i,icon:a,inUnit:o}=e;return 1===o?t=r.createElement("small",null,"\u5df2\u542f\u7528"):0===o&&(t=r.createElement("small",null,"\u5df2\u505c\u7528")),r.createElement(vt,{className:"px-3 py-2",left:r.createElement(dt,null,r.createElement("img",{src:a||Dt})),right:t},r.createElement("div",{className:"px-3"},r.createElement("div",null,n),r.createElement("small",{className:"text-muted"},i)))}render(){let e=this.apps.items,t=r.createElement(qt,{onSearch:this.onSearch,className:"w-100 mx-1",placeholder:"\u641c\u7d22App",maxLength:100});return r.createElement(c.d,{header:t},r.createElement(We,{items:e,item:{onClick:this.appClick,render:this.renderApp},before:"\u641c\u7d22App\u540d\u5b57"}))}};Zn=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}([E.a],Zn);var er=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};let tr=class extends r.Component{componentDidMount(){return er(this,void 0,void 0,function*(){yield yn.loadApps()})}itemRender(e,t){let n,{name:i,discription:a,icon:o,inUnit:s}=e;return 0===s&&(n=r.createElement(yt,{className:"text-danger",name:"ban"})),r.createElement(vt,{className:"px-3 py-1",left:r.createElement(dt,null,r.createElement("img",{src:o||Dt})),right:n},r.createElement("div",{className:"px-3"},r.createElement("div",null,i),r.createElement("small",{className:"text-muted"},a)))}appClick(e){c.g.push(r.createElement(c.d,{header:"App\u8be6\u7ec6\u4fe1\u606f"},r.createElement(Gn,{app:e})))}newItem(){c.g.push(r.createElement(Zn,Object.assign({},this.props)))}render(){let e=r.createElement("button",{className:"btn btn-secondary btn-sm",onClick:()=>this.newItem()},r.createElement(yt,{name:"plus"}));return r.createElement(c.d,{header:"\u542f\u505cApp",right:e},r.createElement(We,{items:yn.apps,item:{render:this.itemRender,onClick:this.appClick}}))}};var nr=tr=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}([E.a],tr),rr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class ir extends r.Component{constructor(){super(...arguments),this.formRows=[{label:"\u540d\u79f0",field:{name:"name",type:"string",maxLength:50,required:!0}},{label:"\u63cf\u8ff0",field:{name:"discription",type:"string",maxLength:250},face:{type:"textarea"}}]}onSubmit(e){return rr(this,void 0,void 0,function*(){let{name:t,discription:n}=e;(yield yn.unitAddRole(t,n))<=0?this.form.formView.setError("name","\u89d2\u8272\u540d "+t+" \u5df2\u7ecf\u5b58\u5728"):c.g.pop()})}render(){return r.createElement(c.d,{header:"\u65b0\u5efa\u89d2\u8272"},r.createElement(Ie,{className:"m-3",ref:e=>this.form=e,formRows:this.formRows,onSubmit:this.onSubmit}))}}var ar=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class or extends r.Component{constructor(e){super(e),this.state={apps:void 0}}componentDidMount(){return ar(this,void 0,void 0,function*(){let e=yield zt.unitRoleApps(yn.unit.id,this.props.role.id);this.setState({apps:e})})}renderRoleApp(e,t){return r.createElement(vt,{className:"py-2 px-3 align-items-center",left:e.name,right:r.createElement("small",{className:"text-muted"},e.discription)})}render(){let{role:e}=this.props;return r.createElement(c.d,{header:e.name+" - \u53ef\u7528APP"},r.createElement(We,{items:this.state.apps,item:{render:this.renderRoleApp},none:"\u6ca1\u6709APP"}))}}var sr=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},cr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};let ur=class extends r.Component{constructor(){super(...arguments),this.renderMemberRole=(e=>{let{name:t,discription:n}=e;return r.createElement(vt,{className:"py-2 px-3 align-items-center",left:t,right:r.createElement(gt,null,n)})}),this.setRole=(()=>{c.g.push(r.createElement(lr,null))})}componentDidMount(){return cr(this,void 0,void 0,function*(){yield yn.loadRoles(),yield yn.loadMemberRoles()})}onAssigned(e,t){return cr(this,void 0,void 0,function*(){yield yn.unitAssignMember(e)})}roleClick(e){c.g.push(r.createElement(or,{role:e}))}render(){let e=yn.roleMember,{nick:t,name:n,assigned:i,icon:a}=e,o=r.createElement("div",null,r.createElement("div",null,r.createElement(gt,null,"\u552f\u4e00\u540d: ")," \xa0 ",n),r.createElement("div",null,r.createElement(gt,null,"\u6635\u79f0: ")," \xa0 ",t||r.createElement(gt,null,"[\u65e0]"))),s=["",{type:"component",component:r.createElement(xt,{icon:a||Dt,main:e.assigned||t||n,discription:o})},"",{label:"\u5907\u6ce8\u540d",type:"string",name:"assigned",onClick:()=>c.g.push(r.createElement(Vn,{title:"\u4fee\u6539\u5907\u6ce8\u540d",value:e.assigned,onChanged:this.onAssigned,info:"\u52a0\u4e00\u4e2a\u5907\u6ce8\uff0c\u4fbf\u4e8e\u7504\u522b\u7528\u6237"}))},""],u=r.createElement("button",{className:"btn btn-success btn-sm",onClick:this.setRole},"\u4fee\u6539\u89d2\u8272");return r.createElement(c.d,{header:"\u7528\u6237\u8be6\u60c5",right:u},r.createElement(ut,{rows:s,values:e}),r.createElement("div",{className:"px-3 py-1"},r.createElement("small",null,r.createElement(yt,{name:"angle-double-right"})," \u6240\u5c5e\u89d2\u8272")),r.createElement(We,{items:yn.memberRoles,item:{render:this.renderMemberRole,onClick:this.roleClick}}))}};ur=sr([E.a],ur);let lr=class extends r.Component{constructor(e){super(e),this.submit=this.submit.bind(this)}componentDidMount(){return cr(this,void 0,void 0,function*(){yield yn.loadRoles(),yield yn.loadMemberRoles()})}renderRole(e,t){return r.createElement(vt,{className:"py-2 px-3 align-items-center",left:e.name,right:r.createElement("small",{className:"text-muted"},e.discription)})}roleSelect(e,t,n){}submit(){return cr(this,void 0,void 0,function*(){yield yn.setMemberRoles(this.list.selectedItems),c.g.pop()})}render(){let e=r.createElement("button",{className:"btn btn-success btn-sm",onClick:this.submit},"\u4fdd\u5b58"),t=yn.roles,n=yn.memberRoles;return r.createElement(c.d,{header:"\u4fee\u6539\u89d2\u8272",right:e},r.createElement(We,{ref:e=>this.list=e,items:t,selectedItems:n,compare:(e,t)=>e.id===t.id,item:{render:this.renderRole,onSelect:this.roleSelect}}))}};lr=sr([E.a],lr);var hr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};let dr=class extends r.Component{componentDidMount(){return hr(this,void 0,void 0,function*(){yield yn.loadMembers()})}renderMember(e,t){return r.createElement(fr,Object.assign({},e))}userClick(e){yn.setRoleUser(e),c.g.push(r.createElement(ur,null))}onSearch(){let e=yn.role,t=void 0===e?0:e.id;c.g.push(r.createElement(pr,{roleId:t}))}render(){let e=r.createElement("button",{className:"btn btn-sm",onClick:this.onSearch},r.createElement(yt,{name:"search"}));return r.createElement(c.d,{header:"\u7528\u6237",right:e},r.createElement(We,{items:yn.roleMembers,item:{render:this.renderMember,onClick:this.userClick}}))}};dr=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o}([E.a],dr);const fr=e=>{let t,{nick:n,name:i,assigned:a,icon:o}=e;return t=a?r.createElement(r.Fragment,null,r.createElement("div",null,r.createElement("b",null,a)," ",r.createElement(gt,null,n)),r.createElement(gt,null,i)):n?r.createElement(r.Fragment,null,r.createElement("div",null,r.createElement("b",null,n)),r.createElement(gt,null,i)):r.createElement("div",null,r.createElement("b",null,i)),r.createElement(vt,{className:"py-2 px-3 align-items-stretch",left:r.createElement(dt,{size:"sm"},r.createElement("img",{src:o||Dt}))},r.createElement("div",{className:"px-3"},t))};class pr extends r.Component{constructor(e){super(e),this.onSearch=this.onSearch.bind(this),this.state={members:null}}onSearch(e){return hr(this,void 0,void 0,function*(){let t=yield zt.unitMembers(yn.unit.id,this.props.roleId,e,0,100);this.setState({members:t})})}renderMember(e,t){return r.createElement(fr,Object.assign({},e))}userClick(e){yn.setRoleUser(e),c.g.push(r.createElement(ur,null))}render(){let e=r.createElement(qt,{className:"w-100 mx-1",onSearch:this.onSearch,maxLength:100,placeholder:"\u641c\u7d22\u7528\u6237"});return r.createElement(c.d,{header:e},r.createElement(We,{items:this.state.members,item:{render:this.renderMember,onClick:this.userClick}}))}}var vr=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},mr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};let yr=class extends r.Component{constructor(){super(...arguments),this.renderRoleApp=((e,t)=>r.createElement(vt,{className:"py-2 px-3 align-items-center",left:e.name,right:r.createElement("small",{className:"text-muted"},e.discription)})),this.roleAppClick=(e=>{c.g.push(r.createElement(gr,null))})}componentDidMount(){return mr(this,void 0,void 0,function*(){yield yn.loadApps(),yield yn.loadRoleApps()})}editRole(){c.g.push(r.createElement(br,null))}addRoleApp(){c.g.push(r.createElement(gr,null))}members(){c.g.push(r.createElement(dr,null))}render(){let e,t,n,{name:i,discription:a,count:o}=yn.role;void 0===o||null===o||0===o?t=r.createElement("small",{className:"text-muted"},"\u65e0\u7528\u6237"):(t=`\u5171\u6709 ${o} \u7528\u6237`,n=r.createElement("div",null,r.createElement(yt,{name:"chevron-right"})),e=this.members);let s=["",{type:"component",component:r.createElement(xt,{icon:void 0,main:i,discription:a}),onClick:this.editRole},"",{type:"component",component:r.createElement(vt,{className:"py-2",left:t,right:n}),onClick:e},"="],u=r.createElement("button",{className:"btn btn-success btn-sm",onClick:()=>this.addRoleApp()},r.createElement(yt,{name:"plus"})," APP");return r.createElement(c.d,{header:"\u89d2\u8272",right:u},r.createElement(ut,{rows:s,values:{}}),r.createElement("div",{className:"px-3 py-1"},r.createElement("small",null,r.createElement(yt,{name:"angle-double-right"})," \u53ef\u7528APP\u5217\u8868")),r.createElement(We,{items:yn.roleApps,item:{render:this.renderRoleApp,onClick:this.roleAppClick},none:r.createElement("small",{className:"text-muted px-3 py-1"},"\u6ca1\u6709APP, \u70b9\u51fb\u53f3\u4e0a\u89d2\u6309\u94ae\u9009\u62e9APP")}))}};yr=vr([E.a],yr);let br=class extends r.Component{onNameChanged(e,t){return mr(this,void 0,void 0,function*(){yield yn.roleChangeProp("name",e)})}onDiscriptionChanged(e,t){return mr(this,void 0,void 0,function*(){yield yn.roleChangeProp("discription",e)})}render(){let e=yn.role,{id:t}=e,n=1===t||2===t,i=["",{label:"\u540d\u79f0",type:"string",name:"name",onClick:n?void 0:()=>c.g.push(r.createElement(Vn,{title:"\u4fee\u6539\u540d\u79f0",value:e.name,onChanged:this.onNameChanged,info:"\u597d\u7684\u540d\u5b57\u4fbf\u4e8e\u7406\u89e3"}))},{label:"\u63cf\u8ff0",type:"string",name:"discription",onClick:n?void 0:()=>c.g.push(r.createElement(Vn,{title:"\u4fee\u6539\u63cf\u8ff0",value:e.discription,onChanged:this.onDiscriptionChanged,info:"\u5bf9\u89d2\u8272\u505a\u4e00\u4e2a\u8bf4\u660e"}))}];return r.createElement(c.d,{header:"\u4fee\u6539\u89d2\u8272\u4fe1\u606f"},r.createElement(ut,{rows:i,values:e,alignValue:"right"}))}};br=vr([E.a],br);let gr=class extends r.Component{constructor(e){super(e),this.submit=this.submit.bind(this)}componentDidMount(){return mr(this,void 0,void 0,function*(){yield yn.loadApps(),yield yn.loadRoleApps()})}renderApp(e,t){return r.createElement(vt,{className:"py-1 px-2 align-items-center",left:e.name,right:r.createElement("small",{className:"text-muted"},e.discription)})}appSelect(e,t,n){}submit(){return mr(this,void 0,void 0,function*(){yield yn.setRoleApps(this.list.selectedItems),c.g.pop()})}render(){let e=r.createElement("button",{className:"btn btn-success btn-sm",onClick:this.submit},"\u4fdd\u5b58"),t=yn.apps,n=yn.roleApps;return r.createElement(c.d,{header:"\u9009\u62e9APP",right:e},r.createElement(We,{ref:e=>this.list=e,items:t,selectedItems:n,item:{render:this.renderApp,onSelect:this.appSelect}}))}};gr=vr([E.a],gr);var wr=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},kr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};const xr=gn()("d-flex","h-100","align-items-center","px-5","small","text-muted");let Er=class extends r.Component{constructor(){super(...arguments),this.renderRole=((e,t)=>{let{name:n,discription:i,count:a}=e;return r.createElement(vt,{className:"px-3 py-2",left:n,right:String(a||"")},r.createElement("div",{className:xr},i))}),this.roleClick=(e=>{yn.setRole(e),c.g.push(r.createElement(yr,null))}),this.newRole=(e=>{e.preventDefault(),c.g.push(r.createElement(ir,null))}),this.allUsersClick=(()=>{yn.setRole(void 0),c.g.push(r.createElement(dr,null))})}componentDidMount(){return kr(this,void 0,void 0,function*(){yield yn.loadRoles()})}render(){let e=r.createElement("a",{className:"small",href:"#",onClick:this.newRole},"\u65b0\u589e"),t=r.createElement(vt,{className:"px-3 small bg-light",left:"\u89d2\u8272",right:e});return r.createElement(c.d,{header:"\u7528\u6237\u89d2\u8272"},r.createElement(vt,{className:"my-3 px-3 py-2 bg-white",left:"\u7528\u6237",right:String(yn.memberCount),onClick:this.allUsersClick},r.createElement("div",{className:xr},"\u8bbe\u7f6e\u7528\u6237\u89d2\u8272")),r.createElement(We,{header:t,items:yn.roles,none:"[\u65e0]",item:{render:this.renderRole,onClick:this.roleClick}}))}};Er=wr([E.a],Er);var Or=n(2),jr=n.n(Or),Cr=n(6),Sr=n(4),Nr=n(7),Pr=n(10),_r=n(19),Rr=n(17),Ar=n(32),qr=n.n(Ar),Ir=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Fr=function(){function e(t,n,r){Object(f.a)(this,e),this.fieldMaps={},this.entities=t,this.name=n,this.typeId=r,this.sys=this.name.indexOf("$")>=0}return Object(p.a)(e,[{key:"getApiFrom",value:function(){return Ir(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.entities.uqApi);case 1:case"end":return e.stop()}},e,this)}))}},{key:"fieldMap",value:function(e){void 0===e&&(e="$");var t=this.fieldMaps[e];if(void 0===t){var n;if("$"===e)n=this.fields;else if(void 0!==this.arrFields){var r=this.arrFields.find(function(t){return t.name===e});void 0!==r&&(n=r.fields)}else if(void 0!==this.returns){var i=this.returns.find(function(t){return t.name===e});void 0!==i&&(n=i.fields)}if(void 0===n)return{};t={};var a=!0,o=!1,s=void 0;try{for(var c,u=n[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var l=c.value;t[l.name]=l}}catch(h){o=!0,s=h}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}this.fieldMaps[e]=t}return t}},{key:"loadSchema",value:function(){return Ir(this,void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===this.schema){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.entities.uqApi.schema(this.name);case 4:t=e.sent,this.setSchema(t);case 6:case"end":return e.stop()}},e,this)}))}},{key:"setSchema",value:function(e){if(void 0!==e&&void 0===this.schema){this.schema=e;var t=e.name,n=e.fields,r=e.arrs,i=e.returns;t!==this.name&&(this.jName=t),this.entities.buildFieldTuid(this.fields=n),this.entities.buildArrFieldsTuid(this.arrFields=r,n),this.entities.buildArrFieldsTuid(this.returns=i,n)}}},{key:"schemaStringify",value:function(){return JSON.stringify(this.schema,function(e,t){if("_tuid"!==e)return t},4)}},{key:"tuidFromField",value:function(e){var t=e._tuid,n=e.tuid;if(void 0!==n)return void 0!==t?t:e._tuid=this.entities.getTuid(n,void 0)}},{key:"tuidFromName",value:function(e,t){if(void 0!==this.schema){var n=this.schema,r=n.fields,i=n.arrs,a=this.entities,o=e.toLowerCase();if(void 0===t)return u(o,r);if(void 0!==i){var s=t.toLowerCase(),c=i.find(function(e){return e.name===s});if(void 0!==c)return u(o,c.fields)}}function u(e,t){if(void 0!==t){var n=t.find(function(t){return t.name===e});if(void 0!==n)return a.getTuid(n.tuid,void 0)}}}},{key:"buildParams",value:function(e){var t={},n=this.fields;void 0!==n&&this.buildFieldsParams(t,n,e);var r=this.arrFields;if(void 0!==r){var i=!0,a=!1,o=void 0;try{for(var s,c=r[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value,l=u.name,h=u.fields;if(void 0!==e[l]){var d=[];t[l]=d;var f=!0,p=!1,v=void 0;try{for(var m,y=e[Symbol.iterator]();!(f=(m=y.next()).done);f=!0){var b=m.value,g={};this.buildFieldsParams(g,h,b),d.push(g)}}catch(w){p=!0,v=w}finally{try{f||null==y.return||y.return()}finally{if(p)throw v}}}}}catch(w){a=!0,o=w}finally{try{i||null==c.return||c.return()}finally{if(a)throw o}}}return t}},{key:"buildFieldsParams",value:function(e,t,n){var r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value,u=c.name,l=n[u],h=void 0;switch(typeof l){default:h=l;break;case"object":var d=c._tuid;h=void 0===d?l.id:d.getIdFromObj(l)}e[u]=h}}catch(f){i=!0,a=f}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}},{key:"pack",value:function(e){var t=[],n=this.fields;void 0!==n&&this.packRow(t,n,e);var r=this.arrFields;if(void 0!==r){var i=!0,a=!1,o=void 0;try{for(var s,c=r[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;this.packArr(t,u.fields,e[u.name])}}catch(l){a=!0,o=l}finally{try{i||null==c.return||c.return()}finally{if(a)throw o}}}return t.join("")}},{key:"escape",value:function(e,t){var n=e[t.name];switch(typeof n){default:return n;case"object":var r=t._tuid;return void 0===r?n.id:r.getIdFromObj(n);case"string":for(var i=n.length,a="",o=0,s=0;s<i;s++){switch(n.charCodeAt(s)){case 9:a+=n.substring(o,s)+"\\t",o=s+1;break;case 10:a+=n.substring(o,s)+"\\n",o=s+1}}return a+n.substring(o);case"undefined":return""}}},{key:"packRow",value:function(e,t,n){var r=t.length;if(0!==r){var i="";i+=this.escape(n,t[0]);for(var a=1;a<r;a++){var o=t[a];i+="\t"+this.escape(n,o)}e.push(i+"\n")}}},{key:"packArr",value:function(e,t,n){if(void 0!==n){var r=!0,i=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value;this.packRow(e,t,c)}}catch(u){i=!0,a=u}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}e.push("\n")}},{key:"unpackSheet",value:function(e){var t={},n=this.fields,r=0;void 0!==n&&(r=this.unpackRow(t,n,e,r));var i=this.arrFields;if(void 0!==i){var a=!0,o=!1,s=void 0;try{for(var c,u=i[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var l=c.value;r=this.unpackArr(t,l,e,r)}}catch(h){o=!0,s=h}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}}return t}},{key:"unpackReturns",value:function(e){var t={},n=0,r=this.returns;if(void 0!==r){var i=!0,a=!1,o=void 0;try{for(var s,c=r[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value;n=this.unpackArr(t,u,e,n)}}catch(l){a=!0,o=l}finally{try{i||null==c.return||c.return()}finally{if(a)throw o}}}return t}},{key:"unpackRow",value:function(e,t,n,r){for(var i=0,a=0,o=r,s=0,c=n.length,u=t.length;r<c;r++)if(i=a,9===(a=n.charCodeAt(r))){var l=t[s];if(8!==i){if(r>o){var h=n.substring(o,r);e[l.name]=this.to(e,h,l)}}else e[l.name]=null;if(o=r+1,++s>=u)break}else if(10===a){var d=t[s];if(8!==i){if(r>o){var f=n.substring(o,r);e[d.name]=this.to(e,f,d)}}else e[d.name]=null;++r,++s;break}return r}},{key:"to",value:function(e,t,n){switch(n.type){default:return t;case"datetime":case"date":case"time":return new Date(Number(t));case"tinyint":case"smallint":case"int":case"dec":return Number(t);case"bigint":var r=Number(t),i=n._tuid;return void 0===i?r:(i.useId(r,!0),i.boxId(r))}}},{key:"unpackArr",value:function(e,t,n,r){for(var i=[],a=n.length,o=t.name,s=t.fields;r<a;){if(10===n.charCodeAt(r)){++r;break}var c={};i.push(c),r=this.unpackRow(c,s,n,r)}return e[o]=i,r}},{key:"sName",get:function(){return this.jName||this.name}},{key:"tvApi",get:function(){return this.entities.uqApi}}]),e}(),Vr=n(60),Tr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Ur=function(e){function t(e,n,r){var i;return Object(f.a)(this,t),(i=Object(Cr.a)(this,Object(Sr.a)(t).call(this,e,n,r))).queue=[],i.waitingIds=[],i.cache=Rr.k.map({},{deep:!1}),i.buildIdBoxer(),i}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"buildIdBoxer",value:function(){this.BoxId=function(){};var e=this.BoxId.prototype;Object.defineProperty(e,"_$tuid",{value:this,writable:!1,enumerable:!1}),Object.defineProperty(e,"obj",{enumerable:!1,get:function(){if(!(void 0===this.id||this.id<=0))return this._$tuid.valueFromId(this.id)}}),e.valueFromFieldName=function(e){return this._$tuid.valueFromFieldName(e,this.obj)},e.toJSON=function(){return this.id}}},{key:"boxId",value:function(e){this.useId(e);var t=new this.BoxId;return t.id=e,t}},{key:"getTuidContent",value:function(){return this.entities.cUq.getTuidContent(this)}},{key:"getIdFromObj",value:function(e){return e[this.idName]}},{key:"setSchema",value:function(e){Object(_r.a)(Object(Sr.a)(t.prototype),"setSchema",this).call(this,e);var n=e.id,r=e.unique;this.idName=n,this.unique=r,this.schemaFrom=this.schema.from}},{key:"moveToHead",value:function(e){var t=this.queue.findIndex(function(t){return t===e});this.queue.splice(t,1),this.queue.push(e)}},{key:"valueFromId",value:function(e){var t;switch(typeof e){case"object":t=e.id;break;case"number":t=e;break;default:return}var n=this.cache.get(t);return void 0!==this.owner&&"object"===typeof n&&(n.$owner=this.owner.boxId(n.owner)),n}},{key:"valueFromFieldName",value:function(e,t){if(void 0!==t){var n=this.fields.find(function(t){return t.name===e});if(void 0!==n){var r=t[e],i=n._tuid;return void 0===i?r:i.valueFromId(r)}}}},{key:"resetCache",value:function(e){this.cache.delete(e);var t=this.queue.findIndex(function(t){return t===e});this.queue.splice(t,1),this.useId(e)}},{key:"useId",value:function(e,t){if(void 0!==e&&0!==e&&!1!==Object(Vr.isNumber)(e))if(!0!==this.cache.has(e))if(this.entities.cacheTuids(!0===t?70:20),this.cache.set(e,e),this.waitingIds.findIndex(function(t){return t===e})>=0)this.moveToHead(e);else{if(this.queue.length>=1e3){var n=this.queue.shift();if(n===e)return void this.queue.push(n);if(!0===this.cache.has(n))this.cache.delete(n);else{var r=this.waitingIds.findIndex(function(e){return e===n});this.waitingIds.splice(r,1)}}this.waitingIds.push(e),this.queue.push(e)}else this.moveToHead(e)}},{key:"proxied",value:function(e,t){return Tr(this,void 0,void 0,d.a.mark(function n(){var r;return d.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return this.entities.getTuid(e,void 0).useId(t),n.next=4,this.tvApi.proxied(this.name,e,t);case 4:return r=n.sent,this.cacheValue(r),n.abrupt("return",r);case 7:case"end":return n.stop()}},n,this)}))}},{key:"cacheValue",value:function(e){if(void 0===e)return!1;var t=this.getIdFromObj(e);if(void 0===t)return!1;var n=this.waitingIds.findIndex(function(e){return e===t});return n>=0&&this.waitingIds.splice(n,1),this.cache.set(t,e),!0}},{key:"afterCacheId",value:function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=this.fields[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value,s=o._tuid;void 0!==s&&s.useId(e[o.name])}}catch(c){n=!0,r=c}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"cacheIds",value:function(){return Tr(this,void 0,void 0,d.a.mark(function e(){var t,n,r,i,a,o,s,c,u,l;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.waitingIds.length){e.next=2;break}return e.abrupt("return");case 2:return void 0===this.owner?t=this.name:(t=this.owner.name,n=this.name),e.next=5,this.getApiFrom();case 5:return r=e.sent,e.next=8,r.tuidIds(t,n,this.waitingIds);case 8:i=e.sent,a=!0,o=!1,s=void 0,e.prev=12,c=i[Symbol.iterator]();case 14:if(a=(u=c.next()).done){e.next=23;break}if(l=u.value,!1!==this.cacheValue(l)){e.next=18;break}return e.abrupt("continue",20);case 18:this.cacheTuidFieldValues(l),this.afterCacheId(l);case 20:a=!0,e.next=14;break;case 23:e.next=29;break;case 25:e.prev=25,e.t0=e.catch(12),o=!0,s=e.t0;case 29:e.prev=29,e.prev=30,a||null==c.return||c.return();case 32:if(e.prev=32,!o){e.next=35;break}throw s;case 35:return e.finish(32);case 36:return e.finish(29);case 37:return e.next=39,this.cacheDivIds();case 39:case"end":return e.stop()}},e,this,[[12,25,29,37],[30,,32,36]])}))}},{key:"cacheDivIds",value:function(){return Tr(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)}))}},{key:"load",value:function(e){return Tr(this,void 0,void 0,d.a.mark(function t(){var n,r;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e&&0!==e){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.getApiFrom();case 4:return n=t.sent,t.next=7,n.tuidGet(this.name,e);case 7:if(void 0!==(r=t.sent)){t.next=10;break}return t.abrupt("return");case 10:return r._$tuid=this,this.cacheValue(r),this.cacheTuidFieldValues(r),t.abrupt("return",r);case 14:case"end":return t.stop()}},t,this)}))}},{key:"getDiv",value:function(e){}},{key:"cacheTuidFieldValues",value:function(e){var t=this.schema,n=t.fields,r=t.arrs;if(this.cacheFieldsInValue(e,n),void 0!==r){var i=!0,a=!1,o=void 0;try{for(var s,c=r[Symbol.iterator]();!(i=(s=c.next()).done);i=!0){var u=s.value,l=u.name,h=u.fields,d=e[l];if(void 0!==d){var f=this.getDiv(l),p=!0,v=!1,m=void 0;try{for(var y,b=d[Symbol.iterator]();!(p=(y=b.next()).done);p=!0){var g=y.value;g._$tuid=f,g.$owner=this.boxId(g.owner),f.cacheValue(g),this.cacheFieldsInValue(g,h)}}catch(w){v=!0,m=w}finally{try{p||null==b.return||b.return()}finally{if(v)throw m}}}}}catch(w){a=!0,o=w}finally{try{i||null==c.return||c.return()}finally{if(a)throw o}}}}},{key:"cacheFieldsInValue",value:function(e,t){var n=!0,r=!1,i=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,c=s.name,u=s._tuid;if(void 0!==u){var l=e[c];e[c]=u.boxId(l)}}}catch(h){r=!0,i=h}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}},{key:"save",value:function(e,t){return Tr(this,void 0,void 0,d.a.mark(function n(){var r,i,a;return d.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return(r=qr.a.clone(t)).$id=e,n.next=4,this.tvApi.tuidSave(this.name,r);case 4:return i=n.sent,a=i.id,i.inId,void 0===a?(r.id=e,this.cacheValue(r)):a>0&&(r.id=a,this.cacheValue(r)),n.abrupt("return",i);case 8:case"end":return n.stop()}},n,this)}))}},{key:"search",value:function(e,t,n){return Tr(this,void 0,void 0,d.a.mark(function r(){var i;return d.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.searchArr(void 0,e,t,n);case 2:return i=r.sent,r.abrupt("return",i);case 4:case"end":return r.stop()}},r,this)}))}},{key:"searchArr",value:function(e,t,n,r){return Tr(this,void 0,void 0,d.a.mark(function i(){var a,o,s,c,u,l,h,f,p,v,m;return d.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return a=this.schema.fields,void 0!==this.owner?(o=this.owner.name,s=this.name):(o=this.name,s=void 0),i.next=4,this.getApiFrom();case 4:return c=i.sent,i.next=7,c.tuidSearch(o,s,e,t,n,r);case 7:for(u=i.sent,l=!0,h=!1,f=void 0,i.prev=11,p=u[Symbol.iterator]();!(l=(v=p.next()).done);l=!0)m=v.value,this.cacheFieldsInValue(m,a),void 0!==this.owner&&(m.$owner=this.owner.boxId(m.owner));i.next=19;break;case 15:i.prev=15,i.t0=i.catch(11),h=!0,f=i.t0;case 19:i.prev=19,i.prev=20,l||null==p.return||p.return();case 22:if(i.prev=22,!h){i.next=25;break}throw f;case 25:return i.finish(22);case 26:return i.finish(19);case 27:return i.abrupt("return",u);case 28:case"end":return i.stop()}},i,this,[[11,15,19,27],[20,,22,26]])}))}},{key:"loadArr",value:function(e,t,n){return Tr(this,void 0,void 0,d.a.mark(function r(){var i;return d.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(void 0!==n&&0!==n){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,this.getApiFrom();case 4:return i=r.sent,r.next=7,i.tuidArrGet(this.name,e,t,n);case 7:return r.abrupt("return",r.sent);case 8:case"end":return r.stop()}},r,this)}))}},{key:"saveArr",value:function(e,t,n,r){return Tr(this,void 0,void 0,d.a.mark(function i(){var a;return d.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return(a=qr.a.clone(r)).$id=n,i.next=4,this.tvApi.tuidArrSave(this.name,e,t,a);case 4:return i.abrupt("return",i.sent);case 5:case"end":return i.stop()}},i,this)}))}},{key:"posArr",value:function(e,t,n,r){return Tr(this,void 0,void 0,d.a.mark(function i(){return d.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.tvApi.tuidArrPos(this.name,e,t,n,r);case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}},i,this)}))}},{key:"showInfo",value:function(e){return Tr(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.entities.cUq.showTuid(this,e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"typeName",get:function(){return"tuid"}}]),t}(Fr),Dr=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"setSchema",value:function(e){Object(_r.a)(Object(Sr.a)(t.prototype),"setSchema",this).call(this,e);var n=e.arrs;if(void 0!==n){this.divs={};var r=!0,i=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value,u=c.name,l=new Lr(this.entities,u,this.typeId);l.owner=this,this.divs[u]=l,l.setSchema(c)}}catch(h){i=!0,a=h}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}}},{key:"getDiv",value:function(e){return this.divs[e]}},{key:"cacheDivIds",value:function(){return Tr(this,void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.divs){e.next=2;break}return e.abrupt("return");case 2:e.t0=d.a.keys(this.divs);case 3:if((e.t1=e.t0()).done){e.next=9;break}return t=e.t1.value,e.next=7,this.divs[t].cacheIds();case 7:e.next=3;break;case 9:case"end":return e.stop()}},e,this)}))}},{key:"cUqFrom",value:function(){return Tr(this,void 0,void 0,d.a.mark(function e(){var t,n,r,i,a,o,s;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.schemaFrom){e.next=2;break}return e.abrupt("return",this.entities.cUq);case 2:return t=this.schemaFrom,n=t.owner,r=t.uq,e.next=5,this.entities.cUq;case 5:if(i=e.sent,void 0!==(a=i.cApp)){e.next=9;break}return e.abrupt("return",i);case 9:return e.next=11,a.getImportUq(n,r);case 11:if(void 0!==(o=e.sent)){e.next=16;break}return console.error("".concat(n,"/").concat(r," \u4e0d\u5b58\u5728")),e.abrupt("return",i);case 16:return e.next=18,o.loadSchema();case 18:if(void 0===(s=e.sent)){e.next=23;break}return console.error("cUq.loadSchema: "+s),e.abrupt("return",i);case 23:return e.abrupt("return",o);case 24:case"end":return e.stop()}},e,this)}))}},{key:"getApiFrom",value:function(){return Tr(this,void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.from();case 2:if(void 0===(t=e.sent)){e.next=5;break}return e.abrupt("return",t.entities.uqApi);case 5:return e.abrupt("return",this.entities.uqApi);case 6:case"end":return e.stop()}},e,this)}))}},{key:"from",value:function(){return Tr(this,void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cUqFrom();case 2:return t=e.sent,e.abrupt("return",t.tuid(this.name));case 4:case"end":return e.stop()}},e,this)}))}},{key:"cFrom",value:function(){return Tr(this,void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cUqFrom();case 2:return t=e.sent,e.abrupt("return",t.cTuidMainFromName(this.name));case 4:case"end":return e.stop()}},e,this)}))}},{key:"cEditFrom",value:function(){return Tr(this,void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cUqFrom();case 2:return t=e.sent,e.abrupt("return",t.cTuidEditFromName(this.name));case 4:case"end":return e.stop()}},e,this)}))}},{key:"cInfoFrom",value:function(){return Tr(this,void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cUqFrom();case 2:return t=e.sent,e.abrupt("return",t.cTuidInfoFromName(this.name));case 4:case"end":return e.stop()}},e,this)}))}},{key:"cSelectFrom",value:function(){return Tr(this,void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.cUqFrom();case 2:if(void 0!==(t=e.sent)){e.next=5;break}return e.abrupt("return");case 5:return e.abrupt("return",t.cTuidSelectFromName(this.name));case 6:case"end":return e.stop()}},e,this)}))}},{key:"afterCacheId",value:function(e){if(Object(_r.a)(Object(Sr.a)(t.prototype),"afterCacheId",this).call(this,e),void 0!==this.proxies){var n=e.type,r=e.$proxy;this.proxies[n].useId(r)}}},{key:"Main",get:function(){return this}},{key:"uqApi",get:function(){return this.entities.uqApi}}]),t}(Ur),Lr=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"getApiFrom",value:function(){return Tr(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.owner.getApiFrom();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"Main",get:function(){return this.owner}}]),t}(Ur),Mr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Br=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"submit",value:function(e){return Mr(this,void 0,void 0,d.a.mark(function t(){var n;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadSchema();case 2:return n=this.pack(e),t.next=5,this.tvApi.action(this.name,{data:n});case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}},t,this)}))}},{key:"typeName",get:function(){return"action"}}]),t}(Fr),Hr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},$r=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"setSchema",value:function(e){Object(_r.a)(Object(Sr.a)(t.prototype),"setSchema",this).call(this,e),this.states=e.states}},{key:"build",value:function(e){this.states=[];var t=!0,n=!1,r=void 0;try{for(var i,a=e.ops[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;this.states.push({name:o,actions:void 0})}}catch(s){n=!0,r=s}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}},{key:"createSheetState",value:function(e,t){var n={name:e,actions:[]},r=n.actions;for(var i in t){var a={name:i};r.push(a)}return n}},{key:"save",value:function(e,t){return Hr(this,void 0,void 0,d.a.mark(function n(){var r,i,a;return d.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.loadSchema();case 2:return r=this.entities.appId,i=this.pack(t),n.next=6,this.tvApi.sheetSave(this.name,{app:r,discription:e,data:i});case 6:return a=n.sent,n.abrupt("return",a);case 8:case"end":return n.stop()}},n,this)}))}},{key:"action",value:function(e,t,n,r){return Hr(this,void 0,void 0,d.a.mark(function i(){return d.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.loadSchema();case 2:return i.next=4,this.tvApi.sheetAction(this.name,{id:e,flow:t,state:n,action:r});case 4:return i.abrupt("return",i.sent);case 5:case"end":return i.stop()}},i,this)}))}},{key:"unpack",value:function(e){return Hr(this,void 0,void 0,d.a.mark(function t(){var n,r,i,a;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e[0],r=n[0],i=this.unpackSheet(r.data),a=e[1],t.abrupt("return",{brief:r,data:i,flows:a});case 5:case"end":return t.stop()}},t,this)}))}},{key:"getSheet",value:function(e){return Hr(this,void 0,void 0,d.a.mark(function t(){var n;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadSchema();case 2:return t.next=4,this.tvApi.getSheet(this.name,e);case 4:if(0!==(n=t.sent)[0].length){t.next=9;break}return t.next=8,this.getArchive(e);case 8:return t.abrupt("return",t.sent);case 9:return t.next=11,this.unpack(n);case 11:return t.abrupt("return",t.sent);case 12:case"end":return t.stop()}},t,this)}))}},{key:"getArchive",value:function(e){return Hr(this,void 0,void 0,d.a.mark(function t(){var n;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadSchema();case 2:return t.next=4,this.tvApi.sheetArchive(this.name,e);case 4:return n=t.sent,t.next=7,this.unpack(n);case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t,this)}))}},{key:"getArchives",value:function(e,t){return Hr(this,void 0,void 0,d.a.mark(function n(){var r;return d.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.loadSchema();case 2:return n.next=4,this.tvApi.sheetArchives(this.name,{pageStart:e,pageSize:t});case 4:return r=n.sent,n.abrupt("return",r);case 6:case"end":return n.stop()}},n,this)}))}},{key:"getStateSheets",value:function(e,t,n){return Hr(this,void 0,void 0,d.a.mark(function r(){var i;return d.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.loadSchema();case 2:return r.next=4,this.tvApi.stateSheets(this.name,{state:e,pageStart:t,pageSize:n});case 4:return i=r.sent,r.abrupt("return",i);case 6:case"end":return r.stop()}},r,this)}))}},{key:"createPageStateItems",value:function(){return new zr(this)}},{key:"stateSheetCount",value:function(){return Hr(this,void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadSchema();case 2:return e.next=4,this.tvApi.stateSheetCount(this.name);case 4:return t=e.sent,e.abrupt("return",this.states.map(function(e){var n=e.name,r=0,i=t.find(function(e){return e.state===n});return void 0!==i&&(r=i.count),{state:n,count:r}}));case 6:case"end":return e.stop()}},e,this)}))}},{key:"typeName",get:function(){return"sheet"}}]),t}(Fr),zr=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(Cr.a)(this,Object(Sr.a)(t).call(this,!0))).sheet=e,n.pageSize=10,n}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"load",value:function(e,t,n){return Hr(this,void 0,void 0,d.a.mark(function r(){var i;return d.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.sheet.getStateSheets(e,t,n);case 2:return i=r.sent,r.abrupt("return",i);case 4:case"end":return r.stop()}},r,this)}))}},{key:"setPageStart",value:function(e){this.pageStart=void 0===e?0:e.id}}]),t}(b),Wr=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Qr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Kr=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"setSchema",value:function(e){Object(_r.a)(Object(Sr.a)(t.prototype),"setSchema",this).call(this,e);var n=e.returns;this.returns=n,this.isPaged=void 0!==n.find(function(e){return"$page"===e.name})}},{key:"resetPage",value:function(e,t){this.pageStart=void 0,this.pageSize=e,this.params=t,this.more=!1,this.list=void 0}},{key:"loadPage",value:function(){return Qr(this,void 0,void 0,d.a.mark(function e(){var t,n,r,i;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.pageSize){e.next=2;break}throw"call resetPage(size:number, params:any) first";case 2:if(void 0===this.pageStart){e.next=10;break}e.t0=this.startField.type,e.next="date"===e.t0?8:"time"===e.t0?8:"datetime"===e.t0?8:6;break;case 6:return t=this.pageStart,e.abrupt("break",10);case 8:return t=this.pageStart.getTime(),e.abrupt("break",10);case 10:return e.next=12,this.page(this.params,t,this.pageSize+1);case 12:n=e.sent,this.list=Rr.k.array([],{deep:!1}),void 0!==n&&(n.length>this.pageSize?(this.more=!0,n.pop(),i=this.returns.find(function(e){return"$page"===e.name}),this.startField=i.fields[0],this.pageStart=n[n.length-1][this.startField.name]):this.more=!1,(r=this.list).push.apply(r,Object(l.a)(n)));case 15:case"end":return e.stop()}},e,this)}))}},{key:"page",value:function(e,t,n){return Qr(this,void 0,void 0,d.a.mark(function r(){var i,a;return d.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.loadSchema();case 2:return r.next=4,this.tvApi.page(this.name,t,n+1,this.buildParams(e));case 4:return i=r.sent,r.next=7,this.unpackReturns(i);case 7:return a=r.sent,r.abrupt("return",a.$page);case 9:case"end":return r.stop()}},r,this)}))}},{key:"query",value:function(e){return Qr(this,void 0,void 0,d.a.mark(function t(){var n,r;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadSchema();case 2:return t.next=4,this.tvApi.query(this.name,this.buildParams(e));case 4:return n=t.sent,t.next=7,this.unpackReturns(n);case 7:return r=t.sent,t.abrupt("return",r);case 9:case"end":return t.stop()}},t,this)}))}},{key:"table",value:function(e){return Qr(this,void 0,void 0,d.a.mark(function t(){var n,r;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.query(e);case 2:n=t.sent,t.t0=d.a.keys(n);case 4:if((t.t1=t.t0()).done){t.next=9;break}return r=t.t1.value,t.abrupt("return",n[r]);case 9:case"end":return t.stop()}},t,this)}))}},{key:"obj",value:function(e){return Qr(this,void 0,void 0,d.a.mark(function t(){var n;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.table(e);case 2:if(!((n=t.sent).length>0)){t.next=5;break}return t.abrupt("return",n[0]);case 5:case"end":return t.stop()}},t,this)}))}},{key:"scalar",value:function(e){return Qr(this,void 0,void 0,d.a.mark(function t(){var n,r;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.obj(e);case 2:n=t.sent,t.t0=d.a.keys(n);case 4:if((t.t1=t.t0()).done){t.next=9;break}return r=t.t1.value,t.abrupt("return",n[r]);case 9:case"end":return t.stop()}},t,this)}))}},{key:"typeName",get:function(){return"query"}},{key:"hasMore",get:function(){return this.more}}]),t}(Fr);Wr([Rr.k],Kr.prototype,"list",void 0);var Jr=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).queryApiName="book",e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"typeName",get:function(){return"book"}}]),t}(Kr),Gr=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).queryApiName="history",e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"typeName",get:function(){return"history"}}]),t}(Kr),Yr=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Xr=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).actions={},e.queries={},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"setSchema",value:function(e){Object(_r.a)(Object(Sr.a)(t.prototype),"setSchema",this).call(this,e),this.schemaFrom=this.schema.from;var n=e.actions,r=e.queries,i=e.keys;for(var a in this.entities.buildFieldTuid(this.keys=i),n){var o=n[a],s=o.name,c=this.entities.newAction(s,void 0);c.setSchema(o),this.actions[a]=c}for(var u in r){var l=r[u],h=(s=l.name,this.entities.newQuery(s,void 0));h.setSchema(l),this.queries[u]=h}}},{key:"add",value:function(e){return Yr(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadSchema();case 2:return t.next=4,this.actions.add.submit(e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}},t,this)}))}},{key:"del",value:function(e){return Yr(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadSchema();case 2:return t.next=4,this.actions.del.submit(e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}},t,this)}))}},{key:"all",value:function(){return Yr(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadSchema();case 2:return e.next=4,this.queries.all.query({});case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}},e,this)}))}},{key:"page",value:function(e,t,n){return Yr(this,void 0,void 0,d.a.mark(function r(){return d.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.loadSchema();case 2:return r.next=4,this.queries.page.page(e,t,n);case 4:return r.abrupt("return",r.sent);case 5:case"end":return r.stop()}},r,this)}))}},{key:"query",value:function(e){return Yr(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadSchema();case 2:return t.next=4,this.queries.query.query(e);case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}},t,this)}))}},{key:"table",value:function(e){return Yr(this,void 0,void 0,d.a.mark(function t(){var n,r;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.query(e);case 2:n=t.sent,t.t0=d.a.keys(n);case 4:if((t.t1=t.t0()).done){t.next=9;break}return r=t.t1.value,t.abrupt("return",n[r]);case 9:case"end":return t.stop()}},t,this)}))}},{key:"obj",value:function(e){return Yr(this,void 0,void 0,d.a.mark(function t(){var n;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.table(e);case 2:if(!((n=t.sent).length>0)){t.next=5;break}return t.abrupt("return",n[0]);case 5:case"end":return t.stop()}},t,this)}))}},{key:"scalar",value:function(e){return Yr(this,void 0,void 0,d.a.mark(function t(){var n,r;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.obj(e);case 2:n=t.sent,t.t0=d.a.keys(n);case 4:if((t.t1=t.t0()).done){t.next=9;break}return r=t.t1.value,t.abrupt("return",n[r]);case 9:case"end":return t.stop()}},t,this)}))}},{key:"typeName",get:function(){return"map"}}]),t}(Fr),Zr=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).queryApiName="pending",e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"typeName",get:function(){return"pending"}}]),t}(Kr),ei=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};function ti(e){switch(e){case"tinyint":case"smallint":case"int":case"bigint":case"dec":return 0;case"char":case"text":return"";case"datetime":case"date":return"2000-1-1";case"time":return"0:00"}}var ni=function(){function e(t,n,r){var i=this;Object(f.a)(this,e),this.tuids={},this.actions={},this.sheets={},this.queries={},this.books={},this.maps={},this.histories={},this.pendings={},this.tuidArr=[],this.actionArr=[],this.sheetArr=[],this.queryArr=[],this.bookArr=[],this.mapArr=[],this.historyArr=[],this.pendingArr=[],this.loadIds=function(){for(var e in i.clearCacheTimer(),i.tuids){i.tuids[e].cacheIds()}},this.cUq=t,this.uqApi=n,this.appId=r}return Object(p.a)(e,[{key:"tuid",value:function(e){return this.tuids[e.toLowerCase()]}},{key:"action",value:function(e){return this.actions[e.toLowerCase()]}},{key:"sheet",value:function(e){return this.sheets[e.toLowerCase()]}},{key:"query",value:function(e){return this.queries[e.toLowerCase()]}},{key:"book",value:function(e){return this.books[e.toLowerCase()]}},{key:"map",value:function(e){return this.maps[e.toLowerCase()]}},{key:"history",value:function(e){return this.histories[e.toLowerCase()]}},{key:"pending",value:function(e){return this.pendings[e.toLowerCase()]}},{key:"sheetFromTypeId",value:function(e){for(var t in this.sheets){var n=this.sheets[t];if(n.typeId===e)return n}}},{key:"loadAccess",value:function(){return ei(this,void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.uqApi.loadAccess();case 2:if(void 0!==(t=e.sent)){e.next=5;break}return e.abrupt("return");case 5:this.buildEntities(t);case 6:case"end":return e.stop()}},e,this)}))}},{key:"loadEntities",value:function(){return ei(this,void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.uqApi.loadEntities();case 2:t=e.sent,this.buildEntities(t);case 4:case"end":return e.stop()}},e,this)}))}},{key:"buildEntities",value:function(e){var t=e.access,n=e.tuids;this.buildTuids(n),this.buildAccess(t)}},{key:"getTuid",value:function(e,t,n){var r=this.tuids[e];if(void 0!==r)return void 0===t?r:r.divs[t]}},{key:"cacheTuids",value:function(e){this.clearCacheTimer(),this.cacheTimer=setTimeout(this.loadIds,e)}},{key:"clearCacheTimer",value:function(){void 0!==this.cacheTimer&&(clearTimeout(this.cacheTimer),this.cacheTimer=void 0)}},{key:"buildTuids",value:function(e){var t={};for(var n in e){var r=e[n],i=(r.name,r.typeId),a=r.proxies;this.newTuid(n,i).sys=!0,void 0!==a&&(t[n]=a)}for(var o in e){var s=e[o];s.name;this.getTuid(o).setSchema(s)}for(var c in t){a=t[c];var u=this.tuids[c];u.proxies={};var l=!0,h=!1,d=void 0;try{for(var f,p=a[Symbol.iterator]();!(l=(f=p.next()).done);l=!0){var v=f.value;u.proxies[v]=this.tuids[v]}}catch(m){h=!0,d=m}finally{try{l||null==p.return||p.return()}finally{if(h)throw d}}}}},{key:"buildAccess",value:function(e){for(var t in e){var n=e[t];switch(typeof n){case"string":this.fromType(t,n);break;case"object":this.fromObj(t,n)}}}},{key:"newAction",value:function(e,t){var n=this.actions[e];return void 0!==n?n:(n=this.actions[e]=new Br(this,e,t),this.actionArr.push(n),n)}},{key:"newTuid",value:function(e,t){var n=this.tuids[e];return void 0!==n?n:(n=this.tuids[e]=new Dr(this,e,t),this.tuidArr.push(n),n)}},{key:"newQuery",value:function(e,t){var n=this.queries[e];return void 0!==n?n:(n=this.queries[e]=new Kr(this,e,t),this.queryArr.push(n),n)}},{key:"newBook",value:function(e,t){var n=this.books[e];return void 0!==n?n:(n=this.books[e]=new Jr(this,e,t),this.bookArr.push(n),n)}},{key:"newMap",value:function(e,t){var n=this.maps[e];return void 0!==n?n:(n=this.maps[e]=new Xr(this,e,t),this.mapArr.push(n),n)}},{key:"newHistory",value:function(e,t){var n=this.histories[e];if(void 0===n)return n=this.histories[e]=new Gr(this,e,t),this.historyArr.push(n),n}},{key:"newPending",value:function(e,t){var n=this.pendings[e];if(void 0===n)return n=this.pendings[e]=new Zr(this,e,t),this.pendingArr.push(n),n}},{key:"newSheet",value:function(e,t){var n=this.sheets[e];return void 0!==n?n:(n=this.sheets[e]=new $r(this,e,t),this.sheetArr.push(n),n)}},{key:"fromType",value:function(e,t){var n=t.split("|");t=n[0];var r=Number(n[1]);switch(t){case"uq":this.uqId=r;break;case"tuid":this.newTuid(e,r).sys=!1;break;case"action":this.newAction(e,r);break;case"query":this.newQuery(e,r);break;case"book":this.newBook(e,r);break;case"map":this.newMap(e,r);break;case"history":this.newHistory(e,r);break;case"sheet":this.newSheet(e,r);break;case"pending":this.newPending(e,r)}}},{key:"fromObj",value:function(e,t){switch(t.$){case"sheet":this.buildSheet(e,t)}}},{key:"buildSheet",value:function(e,t){var n=this.sheets[e];void 0===n&&(n=this.newSheet(e,t.id)),n.build(t)}},{key:"buildFieldTuid",value:function(e,t){var n=this;if(void 0!==e){var r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value,u=c.tuid,l=c.arr,h=c.url;void 0!==u&&(c._tuid=this.getTuid(u,l,h))}}catch(b){i=!0,a=b}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}var d=!0,f=!1,p=void 0;try{for(var v,m=function(){var r=v.value,i=r.owner;if(void 0===i)return"continue";var a=e.find(function(e){return e.name===i});if(void 0===a&&(void 0!==t&&(a=t.find(function(e){return e.name===i})),void 0===a))throw"owner field ".concat(i," is undefined");r._ownerField=a;var o=r.arr,s=r.url;if(r._tuid=n.getTuid(a._tuid.name,o,s),void 0===r._tuid)throw"owner field ${owner} is not tuid"},y=e[Symbol.iterator]();!(d=(v=y.next()).done);d=!0)m()}catch(b){f=!0,p=b}finally{try{d||null==y.return||y.return()}finally{if(f)throw p}}}}},{key:"buildArrFieldsTuid",value:function(e,t){if(void 0!==e){var n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value.fields;void 0!==s&&this.buildFieldTuid(s,t)}}catch(c){r=!0,i=c}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}}}}]),e}(),ri=n(15),ii=n.n(ri),ai=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},oi=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(Cr.a)(this,Object(Sr.a)(t).call(this))).onClick=function(){return ai(Object(Pr.a)(Object(Pr.a)(n)),void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.controller.start();case 2:case"end":return e.stop()}},e,this)}))},n.controller=e,n.icon=e.icon,n.label=e.label,n}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"render",value:function(e){return Or.createElement("div",{className:ii()("px-3","py-2","align-items-center","cursor-pointer",e),onClick:this.onClick},this.icon," \xa0 ",this.label)}}]),t}(function e(){Object(f.a)(this,e)}),si=n(20),ci=function(){function e(t){Object(f.a)(this,e),this.view=function(){return Or.createElement("div",null)},this.label=t}return Object(p.a)(e,[{key:"render",value:function(){return Or.createElement("div",{key:this.key,className:"px-3"},Or.createElement("div",{className:"form-group row"},Or.createElement("label",{className:"col-sm-2 col-form-label"},this.label),Or.createElement("div",{className:"col-sm-10"},this.renderContent())))}},{key:"setAddRow",value:function(e){}},{key:"getVFields",value:function(){}},{key:"getVArr",value:function(){}},{key:"getVSubmit",value:function(){}},{key:"renderContent",value:function(){return Or.createElement("div",{className:"form-control form-control-plaintext bg-white border border-info rounded "},"content")}},{key:"key",get:function(){return this.label}}]),e}(),ui=function(e){function t(e,n){var r;return Object(f.a)(this,t),(r=Object(Cr.a)(this,Object(Sr.a)(t).call(this,e))).vField=n,r}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"getVFields",value:function(){return[this.vField]}},{key:"renderContent",value:function(){return this.vField.render()}},{key:"key",get:function(){return this.vField.name}}]),t}(ci),li=function(e){function t(e,n){var r;return Object(f.a)(this,t),(r=Object(Cr.a)(this,Object(Sr.a)(t).call(this,e))).vArr=n,r}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"setAddRow",value:function(e){this.vArr.setAddRow(e)}},{key:"getVArr",value:function(){return this.vArr}},{key:"render",value:function(){return Or.createElement(Or.Fragment,{key:this.key},this.vArr&&this.vArr.render())}},{key:"key",get:function(){return this.vArr.name}}]),t}(ci),hi=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(Cr.a)(this,Object(Sr.a)(t).call(this,void 0))).vSubmit=e,n}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"getVSubmit",value:function(){return this.vSubmit}},{key:"render",value:function(){return Or.createElement("div",{key:"$submit",className:"px-3"},Or.createElement("div",{className:"form-group row"},Or.createElement("div",{className:"offset-sm-2 col-sm-10"},this.vSubmit.render())))}},{key:"key",get:function(){return"$submit"}}]),t}(ci);function di(e,t){switch(e.substr(0,1)){default:return t;case"$":case"_":return}}function fi(e){return JSON.stringify(e,di," ")}var pi=Object(si.a)(function(e){var t=e.tuidValue,n=e.ui,r=e.x,i=e.nullUI,a=typeof t;switch(a){default:if(void 0===n)return Or.createElement(Or.Fragment,null,a,"-",t);var o=n(t,r);return void 0!==o?o:Or.createElement(Or.Fragment,null,t);case"undefined":break;case"object":if(null!==t)return function(e,t,n){if("number"===typeof e)return Or.createElement(Or.Fragment,null,e);var r=e.id,i=e._$tuid,a=e._$com,o=i;if(void 0===o)return void 0!==t?t(e,n):yi(e,n);var s=t||a;void 0===s&&(s=e._$com=o.getTuidContent());var c=o.valueFromId(r);if("number"===typeof c&&(c={id:c}),void 0!==t){var u=t(c,n);return void 0!==u?u:Or.createElement(Or.Fragment,null,r)}return Or.createElement(s,c)}(t,n,r);break;case"number":return Or.createElement(Or.Fragment,null,"id...",t)}return void 0===i?Or.createElement(Or.Fragment,null,"null"):i()}),vi=function(e,t,n,r){return Or.createElement(pi,{tuidValue:e,ui:t,x:n,nullUI:r})},mi=function(){function e(){Object(f.a)(this,e)}return Object(p.a)(e,[{key:"render",value:function(e){return void 0===this.view?Or.createElement("div",null,"??? viewModel \u5fc5\u987b\u5b9a\u4e49 view ???"):Or.createElement(this.view,{vm:this,className:e})}}]),e}(),yi=function(e,t){return Or.createElement(Or.Fragment,null,"content: ",fi(e))},bi=Object(si.a)(yi),gi=function(e){return Or.createElement("div",{className:"px-3 py-2"},fi(e))},wi=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},ki=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},xi=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(Cr.a)(this,Object(Sr.a)(t).call(this))).onClickSubmit=function(){return ki(Object(Pr.a)(Object(Pr.a)(n)),void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.vForm.submit();case 1:case"end":return e.stop()}},e,this)}))},n.view=Object(si.a)(function(){var e=n.vForm.isOk;return Or.createElement("button",{type:"button",onClick:n.onClickSubmit,className:n.className,disabled:!1===e},n.caption)}),n.vForm=e,n.caption=n.vForm.submitCaption,n.className="btn btn-primary w-25",n}return Object(Nr.a)(t,e),t}(mi);wi([Rr.k],xi.prototype,"caption",void 0),wi([Rr.k],xi.prototype,"className",void 0);var Ei=function e(){Object(f.a)(this,e)},Oi=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"check",value:function(e,t){switch(typeof t){default:case"boolean":return;case"object":if(null!==t)return;break;case"string":if(t.trim().length>0)return;break;case"number":if(NaN!==t)return;break;case"undefined":}e.push("\u4e0d\u80fd\u4e3a\u7a7a")}}]),t}(Ei),ji=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"check",value:function(e,t){void 0!==t&&null!==t&&(NaN===Number(t)&&e.push("\u5fc5\u987b\u662f\u6570\u5b57"))}}]),t}(Ei),Ci=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"check",value:function(e,t){if(void 0!==t&&null!==t){var n=Number(t);!0!==Number.isNaN(n)&&!1!==Number.isInteger(n)||e.push("\u5fc5\u987b\u662f\u6574\u6570")}}}]),t}(Ei),Si=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(Cr.a)(this,Object(Sr.a)(t).call(this))).min=e,n}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"check",value:function(e,n){Object(_r.a)(Object(Sr.a)(t.prototype),"check",this).call(this,e,n),Number(n)<this.min&&e.push("\u4e0d\u80fd\u5c0f\u4e8e"+this.min)}}]),t}(ji),Ni=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(Cr.a)(this,Object(Sr.a)(t).call(this))).max=e,n}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"check",value:function(e,n){Object(_r.a)(Object(Sr.a)(t.prototype),"check",this).call(this,e,n),Number(n)>this.max&&e.push("\u4e0d\u80fd\u5c0f\u4e8e"+this.max)}}]),t}(ji),Pi=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},_i=function(e){function t(e,n,r,i){var a;return Object(f.a)(this,t),(a=Object(Cr.a)(this,Object(Sr.a)(t).call(this))).form=e,a.field=n,a.name=n.name,a.fieldUI=r||{},a.fieldRes=i||{},a.init(),a}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"init",value:function(){this.buildRules()}},{key:"buildRules",value:function(){this.rules=[],(!0===this.fieldUI.required||void 0!==this.field&&!1===this.field.null)&&this.rules.push(new Oi)}},{key:"setValue",value:function(e){this.form.values[this.name]=e}},{key:"parse",value:function(e){return e}},{key:"checkRules",get:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var i,a=this.rules[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){i.value.check(e,this.value)}}catch(o){n=!0,r=o}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}return e}},{key:"isOk",get:function(){return 0===this.rules.length||0===this.checkRules.length}},{key:"value",get:function(){return this.form.values[this.name]}},{key:"error",get:function(){return this.form.errors[this.name]},set:function(e){this.form.errors[this.name]=e}},{key:"readonly",get:function(){var e=this.form.mode;return e===Mi.readonly||e===Mi.edit&&!1===this.fieldUI.editable}}]),t}(mi);Pi([Rr.d],_i.prototype,"checkRules",null),Pi([Rr.d],_i.prototype,"isOk",null),Pi([Rr.d],_i.prototype,"value",null);var Ri=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).renderError=function(t){var n=e.form.errors[e.name];if(void 0!==n)return Or.createElement("div",{className:t},Or.createElement(yt,{name:"exclamation-circle"})," ",n)},e.ref=function(t){e.input=t,e.setInputValue()},e.onFocus=function(){e.error=void 0},e.onBlur=function(){var t=e.checkRules;t.length>0&&(e.error=t[0]),e.form.computeFields()},e.onChange=function(t){var n=e.parse(t.currentTarget.value);null!==n&&e.setValue(n)},e.view=Object(si.a)(function(){var t,n,r,i=e.fieldUI.required,a=e.fieldRes,o=a.placeHolder,s=a.suffix,c=["form-control","form-control-input"];return!0===e.readonly?n=Or.createElement("input",{className:ii()(c,"bg-light"),ref:e.ref,type:e.inputType,readOnly:!0}):(n=Or.createElement("input",{className:ii()(c),ref:e.ref,type:e.inputType,onFocus:e.onFocus,onBlur:e.onBlur,onChange:e.onChange,placeholder:o,readOnly:!1,maxLength:e.maxLength,onKeyPress:e.onKeyPress}),!0!==i&&!1!==e.field.null||(t=Or.createElement(Ai,null))),r=void 0===s?n:Or.createElement("div",{className:"input-group"},n,Or.createElement("div",{className:"input-group-append"},Or.createElement("span",{className:"input-group-text"},s))),Or.createElement(Or.Fragment,null,t,r,e.renderError("text-danger small mt-1 mx-2"))}),e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"setValue",value:function(e){Object(_r.a)(Object(Sr.a)(t.prototype),"setValue",this).call(this,e),this.setInputValue()}},{key:"setInputValue",value:function(){if(this.input){var e=this.value;this.input.value=null===e||void 0===e?"":e}}},{key:"maxLength",get:function(){}}]),t}(_i),Ai=function(){return Or.createElement("b",{style:{color:"red",position:"absolute",left:"0.1em",top:"0.5em"}},"*")},qi=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).inputType="text",e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"maxLength",get:function(){return this.field.size}}]),t}(Ri),Ii=45,Fi=46,Vi=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).inputType="number",e.onKeyPress=function(t){var n=t.charCode;if(!(8===n||0===n||13===n||n>=48&&n<=57))if(void 0!==e.extraChars&&e.extraChars.indexOf(n)>=0)switch(n){case Fi:e.onKeyDot();break;case Ii:e.onKeyNeg(),t.preventDefault()}else t.preventDefault()},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"init",value:function(){if(Object(_r.a)(Object(Sr.a)(t.prototype),"init",this).call(this),this.extraChars=[],void 0!==this.fieldUI){var e=this.fieldUI,n=e.min;e.max;void 0!==n?n<0&&this.extraChars.push(Ii):this.extraChars.push(Ii)}switch(this.field.type){case"dec":case"bigint":case"int":case"smallint":case"tinyint":this.extraChars.push(Fi)}}},{key:"buildRules",value:function(){Object(_r.a)(Object(Sr.a)(t.prototype),"buildRules",this).call(this),this.rules.push(new ji);var e=this.fieldUI,n=e.min,r=e.max;void 0!==n&&this.rules.push(new Si(n)),void 0!==r&&this.rules.push(new Ni(r))}},{key:"parse",value:function(e){try{if(0===e.trim().length)return;var t=Number(e);return NaN===t?null:t}catch(n){return null}}},{key:"setInputValue",value:function(){if(this.input){var e=this.value;this.parse(this.input.value)!=e&&(this.input.value=null===e||void 0===e?"":e)}}},{key:"onKeyDot",value:function(){var e=this.input.value;e.indexOf(".")>=0&&(this.input.value=e.replace(".",""))}},{key:"onKeyNeg",value:function(){var e=this.input.value,t=e.indexOf("-");e=t>=0?e.replace("-",""):"-"+e,this.input.value=e}}]),t}(Ri),Ti=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"buildRules",value:function(){Object(_r.a)(Object(Sr.a)(t.prototype),"buildRules",this).call(this),this.rules.push(new Ci)}}]),t}(Vi),Ui=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),t}(Vi),Di=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),t}(qi),Li=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),t}(qi);var Mi,Bi=function(e){function t(e,n,r){var i;return Object(f.a)(this,t),(i=Object(Cr.a)(this,Object(Sr.a)(t).call(this,e,n,void 0,r))).view=Object(si.a)(function(){var e=i.form.values[i.field.name],t=i.fieldRes,n=t.placeHolder,r=t.suffix;null===e&&(e="");var a=jr.a.createElement("input",{className:"form-control form-control-input bg-light",type:"text",placeholder:n,readOnly:!0,value:e});return void 0===r?a:jr.a.createElement("div",{className:"input-group"},a,jr.a.createElement("div",{className:"input-group-append"},jr.a.createElement("span",{className:"input-group-text"},r)))}),i}return Object(Nr.a)(t,e),t}(_i),Hi=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},$i=function(e){function t(e,n,r){var i;Object(f.a)(this,t),(i=Object(Cr.a)(this,Object(Sr.a)(t).call(this))).rowPage=function(){return Or.createElement(c.d,{header:i.label,back:"close"},i.vForm.render("py-3"))},i.onSubmit=function(){return Hi(Object(Pr.a)(Object(Pr.a)(i)),void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.vForm.valueBoxs,e.next=3,this.onRowChanged(t);case 3:case"end":return e.stop()}},e,this)}))},i.onRowChanged=function(e){return Hi(Object(Pr.a)(Object(Pr.a)(i)),void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==this.rowValues){t.next=11;break}if(e.$owner=this.ownerForm.values,this.list.push(e),void 0!==this.onEditRow){t.next=7;break}this.vForm.reset(),t.next=9;break;case 7:return t.next=9,this.onEditRow(void 0,this.onRowChanged);case 9:t.next=13;break;case 11:qr.a.merge(this.rowValues,e),void 0===this.onEditRow&&c.g.pop();case 13:case"end":return t.stop()}},t,this)}))},i.renderItem=function(e,t){return void 0===i.rowContent?Or.createElement("div",{className:"px-3 py-2"},Or.createElement(bi,Object.assign({},e))):Or.createElement(i.rowContent,Object.assign({},e))},i.showRow=function(e){return Hi(Object(Pr.a)(Object(Pr.a)(i)),void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===this.onEditRow){t.next=4;break}return t.next=3,this.onEditRow(e,this.onRowChanged);case 3:return t.abrupt("return");case 4:this.vForm.reset(),void 0!==e&&this.vForm.setValues(e),c.g.push(Or.createElement(this.rowPage,null));case 7:case"end":return t.stop()}},t,this)}))},i.editRow=function(e){return Hi(Object(Pr.a)(Object(Pr.a)(i)),void 0,void 0,d.a.mark(function t(){var n;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.rowValues=e,void 0!==(n=this.vForm.vSubmit)&&(n.caption=this.editSubmitCaption,n.className="btn btn-outline-success"),this.vForm.mode=this.ownerForm.mode,t.next=6,this.showRow(e);case 6:case"end":return t.stop()}},t,this)}))},i.internalAddRow=function(){return Hi(Object(Pr.a)(Object(Pr.a)(i)),void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.rowValues=void 0,(t=this.vForm.vSubmit).caption=this.newSubmitCaption,t.className="btn btn-outline-success",this.vForm.reset(),this.vForm.mode=Mi.new,e.next=8,this.showRow(void 0);case 8:case"end":return e.stop()}},e,this)}))},i.view=function(){var e;void 0===i.addRow&&i.mode===Mi.readonly||(e=Or.createElement("button",{onClick:i.addRow||i.internalAddRow,type:"button",className:"btn btn-link p-0"},i.ownerForm.arrTitleNewButton));var t=i.header||Or.createElement("div",{className:"px-3 bg-light small",style:{paddingTop:"1px",paddingBottom:"1px"}},Or.createElement("div",{className:"flex-fill align-self-center"},i.label),e);return Or.createElement(We,{className:"pb-3",header:t,none:Or.createElement(gt,{className:"px-3 py-2"},i.none),items:i.list,item:{render:i.renderItem,onClick:i.editRow}})},i.ownerForm=e;var a=n.name,o=n.fields;i.name=a;var s=e.ui,u=e.res,l=e.mode,h=e.inputs,p=e.values,v=u.arrs,m=void 0!==v?v[a]:{},y=m.label,b=m.none,g=m.newSubmit,w=m.editSubmit;i.none=b||e.none,i.newSubmitCaption=g||e.arrNewCaption,i.editSubmitCaption=w||e.arrEditCaption,i.label=y||a;var k=s&&s.items[a]||{};return i.rowContent=k.rowContent,i.mode=l,void 0===i.onEditRow?i.vForm=new Yi({fields:o,arrs:void 0,ui:k,res:m,inputs:h[a],none:e.none,submitCaption:"submit",arrNewCaption:void 0,arrEditCaption:void 0,arrTitleNewButton:void 0,mode:l},l===Mi.readonly?void 0:i.onSubmit):i.onEditRow=r,i.list=p[a],i}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"reset",value:function(){this.vForm.reset(),this.list.clear()}},{key:"setAddRow",value:function(e){this.addRow=e}}]),t}(mi),zi=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Wi={textAlign:"left",paddingLeft:"0.75rem",paddingRight:"0.75rem",overflow:"hidden"},Qi=function(e){function t(e,n,r,i){var a;return Object(f.a)(this,t),(a=Object(Cr.a)(this,Object(Sr.a)(t).call(this,e,n,r,i))).onClick=function(){return zi(Object(Pr.a)(Object(Pr.a)(a)),void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!0!==this.readonly){e.next=6;break}if(this.value){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.tuid.showInfo(this.value.id);case 5:return e.abrupt("return");case 6:if(void 0===this.input){e.next=12;break}return e.next=9,this.input.select(this.vForm,this.field,this.vForm.getValues());case 9:t=e.sent,e.next=14;break;case 12:alert("call undefined"),t=0;case 14:this.setValue(this.tuid.boxId(t));case 15:case"end":return e.stop()}},e,this)}))},a.view=Object(si.a)(function(){var e,t,n=a.fieldRes.placeHolder,r=!1,i=a.field._ownerField;if(void 0!==i){var o=i.name;i.arr;r=null===a.vForm.getValue(o)}if(null===a.value)e=Or.createElement(Or.Fragment,null,n||a.input.placeHolder);else if("object"===typeof a.value)e=vi(a.value);else{var s=a.tuid.boxId(a.value);e=vi(s)}return!0===a.readonly?Or.createElement("div",{className:"form-control form-control-plaintext border border-info rounded bg-light cursor-pointer",onClick:a.onClick},e):(!0!==a.fieldUI.required&&!1!==a.field.null||(t=Or.createElement(Ai,null)),Or.createElement(Or.Fragment,null,t,Or.createElement("button",{className:"form-control btn btn-outline-info",type:"button",disabled:r,style:Wi,onClick:a.onClick},e)))}),a.tuid=n._tuid,a.vForm=e,a.input=e.inputs[n.name],a}return Object(Nr.a)(t,e),t}(_i),Ki=function(){function e(t,n,r){Object(f.a)(this,e),this.vForm=t,this.onSubmit=r;var i=n.fields,a=n.arrs,o=n.ui,s=n.res;if(this.fields=i,this.arrs=a,void 0!==o){var c=o.items,u=o.layout;this.formItems=c,this.layout=u}this.res=s}return Object(p.a)(e,[{key:"build",value:function(){return void 0===this.layout?this.bandsOnFly():this.bandsFromLayout()}},{key:"resFromName",value:function(e,t){if(void 0!==t){var n=t.fields;if(void 0!==n)return n[e]||e}}},{key:"bandsOnFly",value:function(){var e=[];if(this.bandsFromFields(e,this.fields,this.res),void 0!==this.arrs){var t=!0,n=!1,r=void 0;try{for(var i,a=this.arrs[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;e.push(this.bandFromArr(o))}}catch(s){n=!0,r=s}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}return void 0!==this.onSubmit&&e.push(new hi(new xi(this.vForm))),e}},{key:"bandsFromFields",value:function(e,t,n){if(void 0!==t){var r=!0,i=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value;e.push(this.bandFromField(c,n))}}catch(u){i=!0,a=u}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}}},{key:"bandsFromLayout",value:function(){return[]}},{key:"bandFromField",value:function(e,t){var n,r,i,a,o=e.name,s=this.resFromName(o,t);return"object"===typeof s?(r=s.label,n=s):(r=s,n=void 0),void 0!==this.formItems&&(a=this.formItems[o]),void 0===(i="function"===typeof a?new Bi(this.vForm,e,n):function(e,t,n,r){var i;switch(t.type){default:return;case"tinyint":case"smallint":case"int":i=Ti;break;case"bigint":if(void 0!==t._tuid)return;i=Ti;break;case"dec":i=Ui;break;case"char":i=qi;break;case"text":i=Di;break;case"datetime":i=Li}return new i(e,t,n,r)}(this.vForm,e,a,n))&&(i=new Qi(this.vForm,e,a,n)),new ui(r||o,i)}},{key:"bandFromArr",value:function(e){var t=e.name,n=(e.fields,new $i(this.vForm,e));return new li(t,n)}}]),e}(),Ji=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Gi=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};!function(e){e[e.new=0]="new",e[e.edit=1]="edit",e[e.readonly=2]="readonly"}(Mi||(Mi={}));var Yi=function(){function e(t,n){var r=this;Object(f.a)(this,e),this.vFields={},this.vArrs={},this.onFormSubmit=function(e){return e.preventDefault(),!1},this.view=Object(si.a)(function(e){var t=e.className;return Or.createElement("form",{className:t,onSubmit:r.onFormSubmit},r.bands.map(function(e){return e.render()}))});var i=t.fields,a=t.arrs,o=t.ui,s=t.res,c=t.inputs,u=t.none,l=t.submitCaption,h=t.arrNewCaption,d=t.arrEditCaption,p=t.arrTitleNewButton,v=t.mode;this.fields=i,this.arrs=a,this.ui=o,void 0!==this.ui&&(this.formItems=this.ui.items),this.res=s,this.inputs=c,this.none=u,this.submitCaption=l,this.arrNewCaption=h,this.arrEditCaption=d,this.arrTitleNewButton=p||Or.createElement("small",null,Or.createElement(yt,{name:"plus"})," \u65b0\u589e"),this.mode=void 0===n?Mi.readonly:v,this.buildFormValues(),this.buildBands(t,n),this.onSubmit=n}return Object(p.a)(e,[{key:"buildBands",value:function(e,t){this.bandColl={};var n=new Ki(this,e,t);this.bands=n.build();var r=!0,i=!1,a=void 0;try{for(var o,s=this.bands[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value;this.bandColl[c.key]=c;var u=c.getVFields();if(void 0!==u){var l=!0,h=!1,d=void 0;try{for(var f,p=u[Symbol.iterator]();!(l=(f=p.next()).done);l=!0){var v=f.value;this.vFields[v.name]=v}}catch(b){h=!0,d=b}finally{try{l||null==p.return||p.return()}finally{if(h)throw d}}}var m=c.getVArr();void 0!==m&&(this.vArrs[m.name]=m);var y=c.getVSubmit();void 0!==y&&(this.vSubmit=y)}}catch(b){i=!0,a=b}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}}},{key:"getBand",value:function(e){return this.bandColl[e]}},{key:"computeFields",value:function(){if(void 0!==this.formItems){var e=this.values;for(var t in this.formItems){var n=this.formItems[t];"function"===typeof n&&(e[t]=n.call(e))}}}},{key:"submit",value:function(){return Gi(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==this.onSubmit){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.onSubmit();case 4:case"end":return e.stop()}},e,this)}))}},{key:"getValues",value:function(){var e={},t=this.values,n=!0,r=!1,i=void 0;try{for(var a,o=this.fields[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=t[p=a.value.name];e[p]=null!==s&&"object"===typeof s?s.id:s}}catch(I){r=!0,i=I}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}if(void 0!==this.arrs){var c=!0,u=!1,l=void 0;try{for(var h,d=this.arrs[Symbol.iterator]();!(c=(h=d.next()).done);c=!0){var f=h.value,p=f.name,v=f.fields,m=f.id,y=f.order,b=e[p]=[],g=this.vArrs[p].list,w=!0,k=!1,x=void 0;try{for(var E,O=g[Symbol.iterator]();!(w=(E=O.next()).done);w=!0){var j=E.value,C={};void 0!==m&&(C[m]=j[m]),void 0!==y&&(C[y]=j[y]);var S=!0,N=!1,P=void 0;try{for(var _,R=v[Symbol.iterator]();!(S=(_=R.next()).done);S=!0){var A=_.value.name,q=j[A];C[A]=null!==q&&"object"===typeof q?q.id:q}}catch(I){N=!0,P=I}finally{try{S||null==R.return||R.return()}finally{if(N)throw P}}b.push(C)}}catch(I){k=!0,x=I}finally{try{w||null==O.return||O.return()}finally{if(k)throw x}}}}catch(I){u=!0,l=I}finally{try{c||null==d.return||d.return()}finally{if(u)throw l}}}return e}},{key:"setValues",value:function(e){if(void 0!==e){var t=this.values,n=this.errors,r=!0,i=!1,a=void 0;try{for(var o,s=this.fields[Symbol.iterator]();!(r=(o=s.next()).done);r=!0){var c=o.value.name;n[c]=void 0;var u=e[c];t[c]=u}}catch(p){i=!0,a=p}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}for(var h in this.vArrs){var d=e[h];if(void 0!==d){var f=t[h];f.clear(),f.push.apply(f,Object(l.a)(d))}}}else this.reset()}},{key:"reset",value:function(){var e=this.values,t=this.errors,n=!0,r=!1,i=void 0;try{for(var a,o=this.fields[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value.name;e[s]=null,t[s]=void 0}}catch(h){r=!0,i=h}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}for(var c in this.vFields){var u=this.vFields[c];void 0!==u.name&&u.setValue(null)}for(var l in this.vArrs){this.vArrs[l].reset()}}},{key:"getValue",value:function(e){return this.values[e]}},{key:"setValue",value:function(e,t){this.values[e]=t}},{key:"setError",value:function(e,t){this.errors[e]=t}},{key:"buildFieldValues",value:function(e){var t={valueFromFieldName:function(e){return this[e]}},n=!0,r=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){t[a.value.name]=null}}catch(s){r=!0,i=s}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}return t}},{key:"buildObservableValues",value:function(){var e=this.buildFieldValues(this.fields);if(void 0!==this.arrs){var t=!0,n=!1,r=void 0;try{for(var i,a=this.arrs[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){e[i.value.name]=Rr.k.array([],{deep:!0})}}catch(o){n=!0,r=o}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}return Object(Rr.k)(e)}},{key:"buildFormValues",value:function(){this.values=this.buildObservableValues(),this.errors=Object(Rr.k)(this.buildFieldValues(this.fields))}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"py-3";return Or.createElement(this.view,{className:e})}},{key:"valueBoxs",get:function(){var e={},t=this.values,n=!0,r=!1,i=void 0;try{for(var a,o=this.fields[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,c=s.name,u=s._tuid,l=t[c];e[c]=void 0===u||"object"===typeof l?l:u.boxId(l)}}catch(q){r=!0,i=q}finally{try{n||null==o.return||o.return()}finally{if(r)throw i}}if(void 0===this.arrs)return e;var h=!0,d=!1,f=void 0;try{for(var p,v=this.arrs[Symbol.iterator]();!(h=(p=v.next()).done);h=!0){var m=p.value,y=(c=m.name,m.fields),b=(m.id,m.order,e[c]=this.vArrs[c].list.slice()),g=!0,w=!1,k=void 0;try{for(var x,E=b[Symbol.iterator]();!(g=(x=E.next()).done);g=!0){var O=x.value,j=!0,C=!1,S=void 0;try{for(var N,P=y[Symbol.iterator]();!(j=(N=P.next()).done);j=!0){var _=N.value,R=_.name,A=(u=_._tuid,O[R]);O[R]=void 0===u||"object"===typeof A?A:u.boxId(A)}}catch(q){C=!0,S=q}finally{try{j||null==P.return||P.return()}finally{if(C)throw S}}}}catch(q){w=!0,k=q}finally{try{g||null==E.return||E.return()}finally{if(w)throw k}}}}catch(q){d=!0,f=q}finally{try{h||null==v.return||v.return()}finally{if(d)throw f}}return e}},{key:"isOk",get:function(){for(var e in this.vFields)if(!1===this.vFields[e].isOk)return!1;return!0}}]),e}();function Xi(e,t){return jr.a.createElement(yt,{className:e,name:t,fixWidth:!0})}Ji([Rr.d],Yi.prototype,"isOk",null);var Zi={tuid:Xi("text-info","list-alt"),action:Xi("text-info","hand-o-right"),map:Xi("text-muted","list-ul"),book:Xi("text-muted","book"),query:Xi("text-warning","search"),history:Xi("text-info","hand-o-right"),pending:Xi("text-info","forward"),sheet:Xi("text-primary","wpforms")},ea=function(e){function t(e,n){var r;return Object(f.a)(this,t),(r=Object(Cr.a)(this,Object(Sr.a)(t).call(this,n))).cUq=e,r}return Object(Nr.a)(t,e),t}(c.a),ta=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},na=function(e){function t(e,n,r,i){var a;Object(f.a)(this,t),a=Object(Cr.a)(this,Object(Sr.a)(t).call(this,e,i)),Object.setPrototypeOf(a.x,e.x);var o=n.name,s=n.typeName;return a.entity=n,a.ui=r,a.label=a.res.label||o,a.icon=Zi[s],a}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"beforeStart",value:function(){return ta(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.entity.loadSchema();case 2:return e.abrupt("return",!0);case 3:case"end":return e.stop()}},e,this)}))}},{key:"createForm",value:function(e,t,n){var r=this.buildFormOptions(n),i=new Yi(r,e);return i.setValues(t),i}},{key:"buildFormOptions",value:function(e){var t,n,r,i,a,o=this.entity,s=o.fields,c=o.arrFields;void 0!==this.res&&(t=this.res.none,n=this.res.submit,r=this.res.arrNew,i=this.res.arrEdit,a=this.res.arrTitleNewButton),void 0===t&&(t=this.cUq.res.none||"none"),void 0===n&&(n=this.cUq.res.submit||"Submit"),void 0===r&&(r=this.cUq.res.arrNew||"New"),void 0===i&&(i=this.cUq.res.arrEdit||"Edit"),void 0===a&&(a=this.cUq.res.arrTitleNewButton),void 0===e&&(e=Mi.new);var u=this.ui.form;return{fields:s,arrs:c,ui:u,res:this.res||{},inputs:this.buildInputs(u),none:t,submitCaption:n,arrNewCaption:r,arrEditCaption:i,arrTitleNewButton:a,mode:e}}},{key:"buildInputs",value:function(e){var t=this.entity,n=t.fields,r=t.arrFields,i={};if(this.buildFieldsInputs(i,n,void 0,e),void 0!==r){var a=!0,o=!1,s=void 0;try{for(var c,u=r[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var l=c.value,h=l.name,d=l.fields,f=e&&e.items;this.buildFieldsInputs(i,d,h,f&&f[h])}}catch(p){o=!0,s=p}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}}return i}},{key:"buildFieldsInputs",value:function(e,t,n,r){if(void 0!==n){var i=e[n];void 0===i&&(e[n]=i={},e=i)}var a=!0,o=!1,s=void 0;try{for(var c,u=t[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var l=c.value,h=l.name,d=l._tuid;if(void 0!==d){var f=r&&r.items&&r.items[h];e[h]={select:this.buildSelect(l,n,f),content:this.buildContent(l,n),placeHolder:this.cUq.getTuidPlaceHolder(d)}}}}catch(p){o=!0,s=p}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}}},{key:"buildSelect",value:function(e,t,n){var r=this;return function(e,t,i){return ta(r,void 0,void 0,d.a.mark(function r(){var i,a,o,s,c,u;return d.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=t._tuid,a=t._ownerField,r.next=3,i.cSelectFrom();case 3:return o=r.sent,s=void 0,void 0!==a&&(s=e.getValue(a.name)),n&&!0===n.autoList&&(console.log("select search set param=empty string"),s=""),r.next=9,o.call(s);case 9:if(c=r.sent,o.removeCeased(),void 0!==c){r.next=13;break}return r.abrupt("return",void 0);case 13:return u=o.idFromItem(c),i.useId(u),r.abrupt("return",u);case 16:case"end":return r.stop()}},r,this)}))}}},{key:"buildContent",value:function(e,t){}},{key:"cQuerySelect",value:function(e){return this.cUq.cQuerySelect(e)}}]),t}(ea),ra=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(Cr.a)(this,Object(Sr.a)(t).call(this,e))).entity=e.entity,n.ui=e.ui,n}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"createForm",value:function(e,t,n){return this.controller.createForm(e,t,n)}},{key:"label",get:function(){return this.controller.label}}]),t}(c.e),ia=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},aa=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).view=function(){return Or.createElement(c.d,{header:e.label},"Book")},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return ia(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.openPage(this.view);case 1:case"end":return e.stop()}},e,this)}))}}]),t}(ra),oa=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},sa=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"internalStart",value:function(){return oa(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.showVPage(this.VBookMain);case 2:case"end":return e.stop()}},e,this)}))}},{key:"VBookMain",get:function(){return aa}}]),t}(na),ca=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},ua=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).newClick=function(){return e.event("new")},e.schemaClick=function(){return e.event("schema")},e.archivesClick=function(){return e.event("archives")},e.sheetStateClick=function(t){return e.event("state",t)},e.renderState=function(t,n){var r=t.state,i=t.count;if(0===i)return null;var a=Or.createElement("span",{className:"badge badge-success ml-5 align-self-end"},i);return Or.createElement(vt,{className:"px-3 py-2",left:e.controller.getStateLabel(r),right:a})},e.view=Object(si.a)(function(){var t,n=e.controller.statesCount.filter(function(e){return e.count}),r=Or.createElement("button",{className:"btn btn-outline-primary",onClick:e.archivesClick},"\u5df2\u5f52\u6863");return!0===e.isDev&&(t=Or.createElement("button",{className:"btn btn-primary mr-2",color:"primary",onClick:e.schemaClick},"\u6a21\u677f")),Or.createElement(c.d,{header:e.label},Or.createElement(vt,{className:"mx-3 my-2",right:r},Or.createElement("button",{className:"btn btn-primary mr-2",color:"primary",onClick:e.newClick},"\u65b0\u5efa"),t),Or.createElement(We,{className:"my-2",header:Or.createElement(gt,{className:"mx-3 my-1"},"\u5f85\u5904\u7406",e.label),none:"[ \u65e0 ]",items:n,item:{render:e.renderState,onClick:e.sheetStateClick}}))}),e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(){return ca(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.openPage(this.view);case 1:case"end":return e.stop()}},e,this)}))}}]),t}(ra),la=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},ha=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).onSubmit=function(){return la(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){var t,n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.vForm.getValues(),n=this.vForm.values,e.next=4,this.controller.onSave(t,n);case 4:case"end":return e.stop()}},e,this)}))},e.view=function(){return Or.createElement(c.d,{header:e.label},e.vForm.render())},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return la(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.vForm=this.createForm(this.onSubmit,e),this.openPage(this.view);case 2:case"end":return t.stop()}},t,this)}))}}]),t}(ra),da={width:"8rem"},fa=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).flowRow=function(e,t){var n,r=e.date,i=(e.user,e.preState,e.state),a=e.action;switch(void 0===a&&(a=Or.createElement(Or.Fragment,null,Or.createElement(yt,{className:"text-primary",name:"pencil-square-o"})," \u5236\u5355")),i){case"$":break;case"#":n=Or.createElement(Or.Fragment,null,Or.createElement(yt,{className:"text-success",name:"file-archive-o"}));break;default:n=Or.createElement(Or.Fragment,null,Or.createElement(yt,{className:"text-muted",name:"arrow-right"})," \xa0 ",i)}return Or.createElement(vt,{left:Or.createElement("div",{className:"pl-3 py-2",style:da},a),right:Or.createElement("div",{className:"p-2"},Or.createElement(gt,null,Or.createElement(Ge,{date:r})))},Or.createElement("div",{className:"p-2"},n))},e.sheetView=function(){var t,n=e.sheetData,r=n.brief,i=n.flows;return"-"===r.state&&(t=Or.createElement("div",{className:"mx-3 my-2",style:{color:"red"}},"\u672c\u5355\u636e\u4f5c\u5e9f")),Or.createElement("div",null,t,e.vForm.render(),Or.createElement(We,{header:Or.createElement(gt,{className:"mx-3 my-1"},"\u6d41\u7a0b"),items:i,item:{render:e.flowRow}}))},e}return Object(Nr.a)(t,e),t}(ra),pa=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},va=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).onSubmit=function(){return pa(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.vForm.getValues(),e.next=3,this.controller.saveSheet(t,this.vForm.values);case 3:this.closePage(),this.returnCall(this.vForm.values);case 5:case"end":return e.stop()}},e,this)}))},e.view=function(){return Or.createElement(c.d,{header:e.label},e.vForm.render())},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return pa(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.sheetData=e,this.vForm=this.createForm(this.onSubmit,e.data,Mi.edit),this.openPage(this.view);case 3:case"end":return t.stop()}},t,this)}))}}]),t}(fa),ma=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},ya=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).actionClick=function(t){return ma(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){var n,r,i,a;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.sheetData.brief,r=n.id,i=n.flow,a=n.state,e.next=3,this.controller.action(r,i,a,t.name);case 3:e.sent,this.ceasePage(),this.openPage(this.acted);case 6:case"end":return e.stop()}},e,this)}))},e.deleteClick=function(){return ma(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:alert("\u5355\u636e\u4f5c\u5e9f\uff1a\u7a0b\u5e8f\u6b63\u5728\u8bbe\u8ba1\u4e2d");case 1:case"end":return e.stop()}},e,this)}))},e.editClick=function(){return ma(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.controller.editSheet(this.sheetData);case 2:t=e.sent,this.vForm.setValues(t);case 4:case"end":return e.stop()}},e,this)}))},e.page=function(){var t,n,r=e.sheetData.brief,i=r.state,a=r.no,o=e.controller.getStateLabel(i),s=e.entity.states.find(function(e){return e.name===i});if(void 0===s){var u,l;switch(i){default:u="\u4e0d\u8ba4\u8bc6\u7684\u5355\u636e\u72b6\u6001'"+i+"'",l="text-info";break;case"-":u="\u5df2\u4f5c\u5e9f",l="text-danger";break;case"#":u="\u5df2\u5f52\u6863",l="text-success"}t=jr.a.createElement("div",{className:ii()(l)},"[",u,"]")}else t=jr.a.createElement("div",{className:"flex-grow-1"},s.actions.map(function(t,n){return jr.a.createElement("button",{key:n,className:"btn btn-primary mr-2",onClick:function(){return e.actionClick(t)}},e.controller.getActionLabel(i,t.name))})),"$"===i&&(n=jr.a.createElement("div",null,jr.a.createElement("button",{className:"btn btn-outline-info ml-2",onClick:e.editClick},"\u4fee\u6539"),jr.a.createElement("button",{className:"btn btn-outline-danger ml-2",onClick:e.deleteClick},"\u4f5c\u5e9f")));return jr.a.createElement(c.d,{header:e.label+":"+o+"-"+a},jr.a.createElement("div",{className:"mb-2"},jr.a.createElement("div",{className:"d-flex px-3 py-2 border-bottom bg-light"},t,n),jr.a.createElement(e.sheetView,null)))},e.acted=function(){var t=e.sheetData.brief.discription;return jr.a.createElement(c.d,{header:"\u5df2\u5904\u7406",back:"close"},jr.a.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},jr.a.createElement("div",{className:"p-3"},t),jr.a.createElement("div",{className:"text-success"},jr.a.createElement(yt,{name:"check-circle-o"})," \u5355\u636e\u5df2\u5904\u7406\uff01"),jr.a.createElement("div",{className:"p-3"},jr.a.createElement("button",{className:"btn btn-outline-info",onClick:function(){return e.backPage()}},"\u8fd4\u56de"))))},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return ma(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.sheetData=e,this.vForm=this.createForm(void 0,e.data),this.openPage(this.page);case 3:case"end":return t.stop()}},t,this)}))}}]),t}(fa),ba=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},ga=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).view=function(){return Or.createElement(c.d,{header:e.label+"\u6a21\u677f"},Or.createElement("pre",{className:"mx-3 my-2"},e.entity.schemaStringify()))},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return ba(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.openPage(this.view);case 1:case"end":return e.stop()}},e,this)}))}}]),t}(ra),wa=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},ka=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).archiveClick=function(t){return wa(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==t.processing){e.next=2;break}return e.abrupt("return");case 2:this.event("archived",t);case 3:case"end":return e.stop()}},e,this)}))},e.archiveRow=function(e,t){e.id,e.no,e.discription;var n=e.date,r=Or.createElement(Or.Fragment,null,1===e.processing?"... ":"",e.no," \xa0 ",e.discription),i=Or.createElement(gt,null,Or.createElement(Ge,{date:n}));return Or.createElement(vt,{className:"px-3 py-2",left:r,right:i})},e.view=function(){return Or.createElement(c.d,{header:"\u5df2\u5f52\u6863"+e.label},Or.createElement(We,{items:e.list,item:{render:e.archiveRow,onClick:e.archiveClick}}))},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(){return wa(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.entity.getArchives(void 0,10);case 2:this.list=e.sent,this.openPage(this.view);case 4:case"end":return e.stop()}},e,this)}))}}]),t}(ra),xa=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Ea=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).rowClick=function(t){return xa(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(1!==t.processing){e.next=3;break}return this.event("processing",t.id),e.abrupt("return");case 3:this.event("action",t.id);case 4:case"end":return e.stop()}},e,this)}))},e.onScrollBottom=function(){console.log("onScrollBottom"),e.controller.pageStateItems.more()},e.rowContent=function(e){e.id;var t=e.no,n=e.discription,r=e.date,i=e.processing,a=Or.createElement(Or.Fragment,null,t," \xa0 ",Or.createElement(gt,null,n)," ",1===i?"...":""),o=Or.createElement(gt,null,Or.createElement(Ge,{date:r}));return Or.createElement(vt,{className:"px-3 py-2",left:a,right:o})},e.renderRow=function(t,n){return Or.createElement(e.row,Object.assign({},t))},e.view=function(){var t=e.controller.pageStateItems;return Or.createElement(c.d,{header:e.label+" - "+e.stateLabel,onScrollBottom:e.onScrollBottom},Or.createElement(We,{items:t,item:{render:e.renderRow,onClick:e.rowClick}}))},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return xa(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.row=this.ui.listRow||this.rowContent,this.stateName=e.state,this.stateLabel=this.controller.getStateLabel(this.stateName),t.next=5,this.controller.pageStateItems.first(this.stateName);case 5:this.openPage(this.view);case 6:case"end":return t.stop()}},t,this)}))}}]),t}(ra),Oa=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},ja=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).view=function(){var t=e.sheetData.brief;return Or.createElement(c.d,{header:e.label+":-"+t.no},Or.createElement(e.sheetView,null))},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return Oa(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.sheetData=e,this.vForm=this.createForm(void 0,this.sheetData.data),this.openPage(this.view);case 3:case"end":return t.stop()}},t,this)}))}}]),t}(fa),Ca=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Sa=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).restart=function(){return Ca(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.ceasePage(),e.next=3,this.event("new");case 3:case"end":return e.stop()}},e,this)}))},e.actionClick=function(t){return Ca(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){var n,r,i,a;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.ceasePage(),n=this.brief,r=n.id,i=n.flow,a=n.state,e.next=4,this.controller.action(r,i,a,t.name);case 4:e.sent,this.openPage(this.acted);case 6:case"end":return e.stop()}},e,this)}))},e.buttons=Or.createElement(Or.Fragment,null,Or.createElement("button",{className:"btn btn-outline-primary mr-3",onClick:e.restart},"\u7ee7\u7eed\u5f00\u5355"),Or.createElement("button",{className:"btn btn-outline-info",onClick:function(){return e.backPage()}},"\u8fd4\u56de")),e.view=function(){var t=e.entity.states,n=t.find(function(e){return"$"===e.name}),r=Or.createElement(Or.Fragment,null,n.actions.map(function(t,n){return Or.createElement("button",{key:n,className:"btn btn-primary mr-3",onClick:function(){return e.actionClick(t)}},e.controller.getActionLabel("$",t.name))}));return Or.createElement(c.d,{header:"\u5df2\u4fdd\u5b58",back:"close"},Or.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},Or.createElement("div",{className:"text-success"},Or.createElement(yt,{name:"check-circle-o"})," \u5355\u636e\u5df2\u4fdd\u5b58\uff01\u7cfb\u7edf\u5c1a\u672a\u5904\u7406"),Or.createElement("div",{className:"p-3"},r,e.buttons)))},e.acted=function(){return Or.createElement(c.d,null,Or.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},Or.createElement("div",{className:"text-success"},Or.createElement(yt,{name:"check-circle-o"})," \u5355\u636e\u5df2\u5904\u7406\uff01"),Or.createElement("div",{className:"p-3"},e.buttons)))},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return Ca(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.brief=e,this.openPage(this.view);case 2:case"end":return t.stop()}},t,this)}))}}]),t}(function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),t}(ra)),Na=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Pa=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).page=function(){var t=e.sheetData.brief,n=t.state,r=t.no,i=e.controller.getStateLabel(n);return jr.a.createElement(c.d,{header:e.label+":"+i+"-"+r},jr.a.createElement("div",{className:"mb-2"},jr.a.createElement("div",{className:"d-flex px-3 py-2 border-bottom bg-light"},"\u6b63\u5728\u5904\u7406\u4e2d..."),jr.a.createElement(e.sheetView,null)))},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return Na(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.sheetData=e,this.vForm=this.createForm(void 0,e.data),this.openPage(this.page);case 3:case"end":return t.stop()}},t,this)}))}}]),t}(fa),_a=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Ra=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).statesCount=Rr.k.array([],{deep:!0}),e.onSave=function(t,n){return _a(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){var r;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveSheet(t,n);case 2:return r=e.sent,this.ceasePage(),e.next=6,this.showSaved(r);case 6:case"end":return e.stop()}},e,this)}))},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"internalStart",value:function(){return _a(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadStateSheetCount();case 2:return this.pageStateItems=this.entity.createPageStateItems(),e.next=5,this.showVPage(this.VSheetMain);case 5:case"end":return e.stop()}},e,this)}))}},{key:"onMessage",value:function(e){return _a(this,void 0,void 0,d.a.mark(function t(){var n,r,i,a;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:n=e.type,r=e.body,i=e.from,a=e.to,e.push,"sheet"===n&&this.onSheet(i,a,r);case 2:case"end":return t.stop()}},t,this)}))}},{key:"onSheet",value:function(e,t,n){var r=this.user.id,i=n.id,a=n.preState,o=n.state;console.log({$:"onMessage sheet",from:e,to:t.join(","),id:i,preState:a,state:o,me:r,sheetData:n}),e===r&&this.sheetActPreState(i,a),void 0!==t.find(function(e){return e===r})&&this.sheetActState(i,o,n)}},{key:"sheetActPreState",value:function(e,t){if(this.changeStateCount(t,-1),void 0!==this.curState&&this.curState===t){var n=this.pageStateItems.items.findIndex(function(t){return t.id===e});n>=0&&this.pageStateItems.items.splice(n,1)}}},{key:"sheetActState",value:function(e,t,n){this.changeStateCount(t,1),void 0!==this.curState&&this.curState===t&&this.pageStateItems.items.findIndex(function(t){return t.id===e})<0&&this.pageStateItems.items.push(n)}},{key:"changeStateCount",value:function(e,t){if(void 0!==e){var n=this.statesCount.findIndex(function(t){return t.state===e});if(console.log({$:"changeState",state:e,delta:t,index:n}),!(n<0)){var r=this.statesCount[n];r.count+=t,r.count<0&&(r.count=0)}}}},{key:"onEvent",value:function(e,t){return _a(this,void 0,void 0,d.a.mark(function n(){var r;return d.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:n.t0=e,n.next="new"===n.t0?4:"schema"===n.t0?6:"archives"===n.t0?8:"state"===n.t0?10:"archived"===n.t0?13:"action"===n.t0?16:"processing"===n.t0?19:3;break;case 3:return n.abrupt("return");case 4:return r=this.VSheetNew,n.abrupt("break",22);case 6:return r=this.VSheetSchema,n.abrupt("break",22);case 8:return r=this.VArchives,n.abrupt("break",22);case 10:return this.curState=t.state,r=this.VSheetList,n.abrupt("break",22);case 13:return n.next=15,this.showArchived(t);case 15:return n.abrupt("return");case 16:return n.next=18,this.showAction(t);case 18:return n.abrupt("return");case 19:return n.next=21,this.showProcessing(t);case 21:return n.abrupt("return");case 22:return n.next=24,this.showVPage(r,t);case 24:case"end":return n.stop()}},n,this)}))}},{key:"startSheet",value:function(e){return _a(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.beforeStart();case 2:if(t.t0=t.sent,!1!==t.t0){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,this.onEvent("action",e);case 7:case"end":return t.stop()}},t,this)}))}},{key:"showAction",value:function(e){return _a(this,void 0,void 0,d.a.mark(function t(){var n;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getSheetData(e);case 2:return n=t.sent,Object(s.k)({body:{$type:"msg",action:"$sheet",msg:{id:e,uq:this.cUq.id,state:n.brief.state}}}),t.next=6,this.showVPage(this.VSheetAction,n);case 6:case"end":return t.stop()}},t,this)}))}},{key:"showProcessing",value:function(e){return _a(this,void 0,void 0,d.a.mark(function t(){var n;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getSheetData(e);case 2:return n=t.sent,t.next=5,this.showVPage(this.VSheetProcessing,n);case 5:case"end":return t.stop()}},t,this)}))}},{key:"editSheet",value:function(e){return _a(this,void 0,void 0,d.a.mark(function t(){var n;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.vCall(this.VSheetEdit,e);case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}},t,this)}))}},{key:"showArchived",value:function(e){return _a(this,void 0,void 0,d.a.mark(function t(){var n;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getArchived(e.id);case 2:return n=t.sent,t.next=5,this.showVPage(this.VArchived,n);case 5:case"end":return t.stop()}},t,this)}))}},{key:"showSaved",value:function(e){return _a(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.showVPage(this.VSheetSaved,e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"getStateUI",value:function(e){var t=this.res.states;if(void 0!==t)return t[e]}},{key:"getStateLabel",value:function(e){var t=this.getStateUI(e),n=t&&t.label||e;switch(n){default:return n;case"$":return"\u65b0\u5355"}}},{key:"getActionLabel",value:function(e,t){var n=this.getStateUI(e);if(void 0===n)return t;var r=n.actions;if(void 0===r)return t;var i=r[t];return i&&i.label||t}},{key:"loadStateSheetCount",value:function(){return _a(this,void 0,void 0,d.a.mark(function e(){var t,n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.statesCount.clear(),e.next=3,this.entity.stateSheetCount();case 3:n=e.sent,(t=this.statesCount).splice.apply(t,[0,0].concat(Object(l.a)(n)));case 5:case"end":return e.stop()}},e,this)}))}},{key:"getSheetData",value:function(e){return _a(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.entity.getSheet(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"getArchived",value:function(e){return _a(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.entity.getArchive(e);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}},{key:"saveSheet",value:function(e,t){return _a(this,void 0,void 0,d.a.mark(function n(){var r,i,a;return d.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=this.ui.sheetTitle,i=void 0===r?this.label:r(t,this.x),n.next=4,this.entity.save(i,e);case 4:return a=n.sent,n.abrupt("return",a);case 6:case"end":return n.stop()}},n,this)}))}},{key:"action",value:function(e,t,n,r){return _a(this,void 0,void 0,d.a.mark(function i(){return d.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,this.entity.action(e,t,n,r);case 2:return i.abrupt("return",i.sent);case 3:case"end":return i.stop()}},i,this)}))}},{key:"VSheetMain",get:function(){return this.ui&&this.ui.main||ua}},{key:"VSheetNew",get:function(){return this.ui.sheetNew||ha}},{key:"VSheetSaved",get:function(){return this.ui.sheetSaved||Sa}},{key:"VSheetEdit",get:function(){return this.ui.sheetEdit||va}},{key:"VSheetSchema",get:function(){return ga}},{key:"VArchives",get:function(){return ka}},{key:"VArchived",get:function(){return ja}},{key:"VSheetList",get:function(){return Ea}},{key:"VSheetAction",get:function(){return this.ui.sheetAction||ya}},{key:"VSheetProcessing",get:function(){return Pa}}]),t}(na),Aa=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},qa=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).onSubmit=function(){return Aa(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.vForm.getValues(),e.next=3,this.controller.submit(t);case 3:this.returns=e.sent,this.closePage(),this.openPage(this.resultPage);case 6:case"end":return e.stop()}},e,this)}))},e.mainPage=function(){var t=e.controller.label;return Or.createElement(c.d,{header:t},e.vForm.render("mx-3 my-2"))},e.resultPage=function(){var t=e.controller.label;return Or.createElement(c.d,{header:t,back:"close"},"\u5b8c\u6210\uff01",Or.createElement("pre",null,fi(e.returns)))},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return Aa(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.vForm=this.createForm(this.onSubmit,e),this.openPage(this.mainPage);case 2:case"end":return t.stop()}},t,this)}))}}]),t}(ra),Ia=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Fa=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"internalStart",value:function(){return Ia(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.showVPage(this.VActionMain);case 2:case"end":return e.stop()}},e,this)}))}},{key:"submit",value:function(e){return Ia(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.entity.submit(e));case 1:case"end":return t.stop()}},t,this)}))}},{key:"VActionMain",get:function(){return qa}}]),t}(na),Va=function(e){return jr.a.createElement("div",{className:"px-3 py-2"},fi(e))},Ta=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Ua=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).onSubmit=function(){return Ta(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){var t,n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.vForm.getValues(),!0!==this.entity.isPaged){e.next=9;break}return e.next=4,this.entity.resetPage(30,t);case 4:return e.next=6,this.entity.loadPage();case 6:this.replacePage(this.pageResult),e.next=13;break;case 9:return e.next=11,this.entity.query(t);case 11:n=e.sent,this.replacePage(this.queryResult,n);case 13:case"end":return e.stop()}},e,this)}))},e.again=function(){e.vForm.reset(),e.replacePage(e.view)},e.renderRow=function(t,n){return Or.createElement(e.row,Object.assign({},t))},e.view=function(){return Or.createElement(c.d,{header:e.label},e.vForm.render("mx-3 my-2"),e.renderExtra())},e.pageResult=function(){var t=e.entity,n=(t.name,t.list),r=Or.createElement("button",{className:"btn btn-outline-success",onClick:e.again},Or.createElement(yt,{name:"search"})," \u518d\u67e5\u8be2");return Or.createElement(c.d,{header:e.label,right:r},Or.createElement(We,{items:n,item:{render:e.renderRow}}))},e.queryResult=Object(si.a)(function(t){var n=Or.createElement("button",{className:"btn btn-outline-success",onClick:e.again},Or.createElement(yt,{name:"search"})," \u518d\u67e5\u8be2");return Or.createElement(c.d,{header:e.label,right:n},Or.createElement("pre",null,JSON.stringify(t,void 0,"\t")))}),e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return Ta(this,void 0,void 0,d.a.mark(function t(){var n,r,i;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.vForm=this.createForm(this.onSubmit,e),n=this.ui,r=n.row,i=n.queryRow,this.row=i||r||Va,this.openPage(this.view);case 4:case"end":return t.stop()}},t,this)}))}},{key:"renderExtra",value:function(){}}]),t}(ra),Da=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},La=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).onSearch=function(t){return Da(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.PageItems.first(t);case 2:case"end":return e.stop()}},e,this)}))},e.renderRow=function(t,n){return Or.createElement(e.row,Object.assign({},t))},e.clickRow=function(t){e.callOnSelected(t)},e.view=function(){var t=Or.createElement(qt,{className:"mx-1 w-100",initKey:"",onSearch:e.onSearch,placeholder:"\u641c\u7d22"+e.label});return Or.createElement(c.d,{header:t},Or.createElement(We,{items:e.PageItems.items,item:{render:e.renderRow,onClick:e.clickRow},before:"\u641c\u7d22"+e.label+"\u8d44\u6599"}))},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return Da(this,void 0,void 0,d.a.mark(function t(){var n,r,i;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=this.ui,r=n.row,i=n.selectRow,this.row=i||r||Va,this.PageItems=new Ma(this.entity),t.next=5,this.onSearch(e);case 5:this.openPage(this.view);case 6:case"end":return t.stop()}},t,this)}))}},{key:"callOnSelected",value:function(e){this.closePage(),this.returnCall(e)}}]),t}(ra),Ma=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(Cr.a)(this,Object(Sr.a)(t).call(this))).query=e,n}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"load",value:function(){return Da(this,void 0,void 0,d.a.mark(function e(){var t,n;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.query.loadSchema();case 2:if(!0!==this.query.isPaged){e.next=8;break}return e.next=5,this.query.page(this.param,this.pageStart,this.pageSize);case 5:t=e.sent,e.next=12;break;case 8:return e.next=10,this.query.query(this.param);case 10:n=e.sent,t=n[this.query.returns[0].name];case 12:return e.abrupt("return",t);case 13:case"end":return e.stop()}},e,this)}))}},{key:"setPageStart",value:function(e){void 0===e&&(this.pageStart=0)}}]),t}(b),Ba=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Ha=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),t}(na),$a=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"internalStart",value:function(){return Ba(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.showVPage(this.VQueryMain);case 2:case"end":return e.stop()}},e,this)}))}},{key:"VQueryMain",get:function(){return this.ui&&this.ui.main||Ua}}]),t}(Ha),za=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"internalStart",value:function(e){return Ba(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.showVPage(this.VQuerySelect,e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"VQuerySelect",get:function(){return La}}]),t}(Ha),Wa=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Qa=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).onNew=function(){return e.event("new")},e.onList=function(){return e.event("list")},e.onSearch=function(t){return Wa(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.event("list",t));case 1:case"end":return e.stop()}},e,this)}))},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return Wa(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.openPage(this.view);case 1:case"end":return e.stop()}},e,this)}))}},{key:"entityRender",value:function(e,t){return e.render()}},{key:"entityClick",value:function(e){return Wa(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.onClick();case 2:case"end":return t.stop()}},t,this)}))}},{key:"view",get:function(){var e,t=this,n=this.controller,r=n.label,i=n.proxyLinks;return!1===n.isFrom&&(e=Or.createElement("button",{className:"btn btn-primary ml-3",onClick:this.onNew},"\u65b0\u589e")),function(){return Or.createElement(c.d,{header:r},void 0===i?Or.createElement(Or.Fragment,null,Or.createElement(qt,{className:"w-100",onSearch:t.onSearch,placeholder:"\u641c\u7d22"+r}),Or.createElement("div",{className:"my-3"},e,Or.createElement("button",{className:"btn btn-primary ml-3",onClick:t.onList},"\u5217\u8868"))):Or.createElement(We,{className:"my-2",header:Or.createElement(gt,null,r," \u4ee3\u7406\u4e0b\u5217Tuid"),items:i,item:{render:t.entityRender,onClick:t.entityClick}}))}}}]),t}(ra),Ka=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Ja=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).next=function(){return Ka(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.vForm.reset(),this.closePage();case 2:case"end":return e.stop()}},e,this)}))},e.finish=function(){e.closePage(2),e.event("edit-end")},e.onSubmit=function(){return Ka(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){var t,n,r,i,a,o,s,u,l,h;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.vForm.getValues(),e.next=3,this.controller.entity.save(this.id,t);case 3:if(n=e.sent,!((r=n.id)<0)){e.next=28;break}if(void 0===(i=this.controller.entity.unique)){e.next=27;break}for(a=!0,o=!1,s=void 0,e.prev=11,u=i[Symbol.iterator]();!(a=(l=u.next()).done);a=!0)h=l.value,this.vForm.setError(h,"\u4e0d\u80fd\u91cd\u590d");e.next=19;break;case 15:e.prev=15,e.t0=e.catch(11),o=!0,s=e.t0;case 19:e.prev=19,e.prev=20,a||null==u.return||u.return();case 22:if(e.prev=22,!o){e.next=25;break}throw s;case 25:return e.finish(22);case 26:return e.finish(19);case 27:return e.abrupt("return");case 28:if(!this.controller.isCalling){e.next=32;break}return this.returnCall(r),this.closePage(),e.abrupt("return");case 32:return this.openPageElement(Or.createElement(c.d,{header:this.label+"\u63d0\u4ea4\u6210\u529f",back:"none"},Or.createElement("div",{className:"m-3"},Or.createElement("span",{className:"text-success"},Or.createElement(yt,{name:"check-circle",size:"lg"})," \u6210\u529f\u63d0\u4ea4\uff01"),Or.createElement("div",{className:"mt-5"},Or.createElement("button",{className:"btn btn-primary mr-3",onClick:this.next},"\u7ee7\u7eed\u5f55\u5165"),Or.createElement("button",{className:"btn btn-outline-primary",onClick:this.finish},"\u4e0d\u7ee7\u7eed"))))),this.event("item-changed",{id:this.id,values:t}),e.abrupt("return");case 35:case"end":return e.stop()}},e,this,[[11,15,19,27],[20,,22,26]])}))},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return Ka(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.vForm=this.createForm(this.onSubmit,e),void 0!==e&&(this.id=e.id),this.openPage(this.editView);case 3:case"end":return t.stop()}},t,this)}))}},{key:"resetForm",value:function(){this.vForm.reset()}},{key:"editView",get:function(){var e=this;return function(){return Or.createElement(c.d,{header:(void 0===e.id?"\u65b0\u589e":"\u7f16\u8f91")+" - "+e.label},e.vForm.render("py-3"))}}}]),t}(ra),Ga=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Ya=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).mainView=Object(si.a)(function(){var t=jr.a.createElement(qt,{className:"mx-1 w-100",initKey:"",onSearch:e.onSearchMain,placeholder:"\u641c\u7d22"+e.label});return jr.a.createElement(c.d,{header:t,back:"close"},jr.a.createElement(We,{items:e.controller.PageItems.items,item:{render:e.renderMainRow,onClick:e.clickMainRow},before:"\u641c\u7d22"+e.label+"\u8d44\u6599"}))}),e.onSearchMain=function(t){return Ga(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.controller.searchMain(t);case 2:case"end":return e.stop()}},e,this)}))},e.renderMainRow=function(t,n){return jr.a.createElement(e.mainRowContent,Object.assign({},t))},e.clickMainRow=function(t){return Ga(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ceasePage(),void 0!==this.controller.entity.owner){e.next=4;break}return this.returnCall(t),e.abrupt("return");case 4:return e.next=6,this.showDiv(this.entity.getIdFromObj(t));case 6:case"end":return e.stop()}},e,this)}))},e.divView=function(t){return jr.a.createElement(c.d,{header:"\u9009\u62e9Div"},jr.a.createElement(We,{items:t.items,item:{render:e.renderDivRow,onClick:e.clickDivRow}}))},e.renderDivRow=function(t,n){return jr.a.createElement(e.divRowContent,Object.assign({},t))},e.clickDivRow=function(t){e.ceasePage(),e.returnCall(t)},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return Ga(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==e){t.next=5;break}return t.next=3,this.showMain(e);case 3:t.next=7;break;case 5:return t.next=7,this.showDiv(e);case 7:case"end":return t.stop()}},t,this)}))}},{key:"showMain",value:function(e){return Ga(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.mainRowContent=this.ui.rowContent||gi,t.next=3,this.controller.searchMain(e);case 3:this.openPage(this.mainView);case 4:case"end":return t.stop()}},t,this)}))}},{key:"showDiv",value:function(e){return Ga(this,void 0,void 0,d.a.mark(function t(){var n,r;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return void 0!==(n=this.ui.divs)&&(this.divRowContent=n[this.entity.name].rowContent),void 0===this.divRowContent&&(this.divRowContent=gi),t.next=5,this.controller.getDivItems(e);case 5:r=t.sent,this.openPage(this.divView,{items:r});case 7:case"end":return t.stop()}},t,this)}))}}]),t}(ra),Xa=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Za=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),t}(function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).next=function(){return Xa(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.vForm.reset(),this.closePage();case 2:case"end":return e.stop()}},e,this)}))},e.finish=function(){e.closePage(2)},e.onSubmit=function(){return Xa(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){var t,n,r=this;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.vForm.getValues(),e.next=3,this.entity.save(this.id,t);case 3:return(n=e.sent)&&alert("\u8fd9\u91cc\u8fd8\u8981\u5224\u65ad\u8fd4\u56de\u503c\uff0c\u5148\u4e0d\u5904\u7406\u4e86 \n"+fi(n)),this.openPage(function(){return Or.createElement(c.d,{header:r.label+"\u63d0\u4ea4\u6210\u529f",back:"none"},Or.createElement("div",{className:"m-3"},Or.createElement("span",{className:"text-success"},Or.createElement(yt,{name:"check-circle",size:"lg"})," \u6210\u529f\u63d0\u4ea4\uff01"),Or.createElement("div",{className:"mt-5"},Or.createElement("button",{className:"btn btn-primary mr-3",onClick:r.next},"\u7ee7\u7eed\u5f55\u5165"),Or.createElement("button",{className:"btn btn-outline-primary",onClick:r.finish},"\u4e0d\u7ee7\u7eed"))))}),e.abrupt("return");case 7:case"end":return e.stop()}},e,this)}))},e.view=function(){return Or.createElement(c.d,{header:e.label},e.vForm.render("py-3"))},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"buildForm",value:function(e){this.vForm=this.createForm(void 0,e)}},{key:"showEntry",value:function(e){return Xa(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.buildForm(e),this.openPage(this.view);case 2:case"end":return t.stop()}},t,this)}))}},{key:"render",value:function(e){return this.buildForm(e),this.vForm.render()}},{key:"loadId",value:function(e){return Xa(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.id=e;case 1:case"end":return t.stop()}},t,this)}))}},{key:"resetForm",value:function(){this.vForm.reset()}}]),t}(ra)),eo=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},to=function(e){function t(e){var n;return Object(f.a)(this,t),(n=Object(Cr.a)(this,Object(Sr.a)(t).call(this,!0))).tuid=e,n}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"load",value:function(e,t,n){return eo(this,void 0,void 0,d.a.mark(function r(){var i;return d.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,this.tuid.search(e,t,n);case 2:return i=r.sent,r.abrupt("return",i);case 4:case"end":return r.stop()}},r,this)}))}},{key:"setPageStart",value:function(e){this.pageStart=void 0===e?0:e.id}}]),t}(b),no=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},ro=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"onSelected",value:function(e){return no(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:!1===this.controller.isFrom?this.event("edit",e.id):this.event("info",e.id);case 1:case"end":return t.stop()}},t,this)}))}}]),t}(function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).onSearch=function(t){return no(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.controller.searchMain(t);case 2:case"end":return e.stop()}},e,this)}))},e.renderRow=function(t,n){return Or.createElement(e.rowContent,Object.assign({},t))},e.clickRow=function(t){e.callOnSelected(t)},e.rowKey=function(e){return e.id},e.view=Object(si.a)(function(){var t,n=Or.createElement(qt,{className:"mx-1 w-100",initKey:"",onSearch:e.onSearch,placeholder:"\u641c\u7d22"+e.label}),r=e.entity.owner;if(void 0!==r){var i=r.valueFromId(e.ownerId);t=Or.createElement("div",null,"owner: ",fi(i))}return Or.createElement(c.d,{header:n},t,Or.createElement(We,{items:e.controller.PageItems.items,item:{render:e.renderRow,onClick:e.clickRow,key:e.rowKey},before:"\u641c\u7d22"+e.label+"\u8d44\u6599"}))}),e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return no(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.rowContent=this.ui.rowContent||gi,void 0!==this.entity.owner&&(this.ownerId=Number(e)),t.next=4,this.controller.searchMain("");case 4:this.openPage(this.view);case 5:case"end":return t.stop()}},t,this)}))}},{key:"callOnSelected",value:function(e){void 0!==this.onSelected?this.onSelected(e):alert("onSelect is undefined")}}]),t}(ra)),io=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},ao=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"buildPageItems",value:function(){return new to(this.entity.owner||this.entity)}},{key:"searchMain",value:function(e){return io(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===this.PageItems&&(this.PageItems=this.buildPageItems()),void 0===e){t.next=4;break}return t.next=4,this.PageItems.first(e);case 4:case"end":return t.stop()}},t,this)}))}},{key:"getDivItems",value:function(e){return io(this,void 0,void 0,d.a.mark(function t(){var n;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.entity.searchArr(e,void 0,0,1e3);case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}},t,this)}))}}]),t}(na),oo=function(e){function t(e,n,r,i){var a;Object(f.a)(this,t);var o=(a=Object(Cr.a)(this,Object(Sr.a)(t).call(this,e,n,r,i))).entity;if(a.proxies=o.proxies,void 0!==a.proxies)for(var s in a.proxyLinks=[],a.proxies){var c=a.cUq.linkFromName("tuid",s);a.proxyLinks.push(c)}return a}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"from",value:function(){return io(this,void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.entity.cFrom();case 2:if(void 0!==(t=e.sent)){e.next=5;break}return e.abrupt("return",this);case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}},e,this)}))}},{key:"cUqFrom",value:function(){return io(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.entity.cUqFrom();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}))}},{key:"cEditFrom",value:function(){return io(this,void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.entity.cUqFrom();case 2:return t=e.sent,e.next=5,t.cTuidEditFromName(this.entity.name);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}))}},{key:"cInfoFrom",value:function(){return io(this,void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.entity.cUqFrom();case 2:return t=e.sent,e.next=5,t.cTuidInfoFromName(this.entity.name);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}))}},{key:"cSelectFrom",value:function(){return io(this,void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.entity.cUqFrom();case 2:return t=e.sent,e.next=5,t.cTuidSelectFromName(this.entity.name);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e,this)}))}},{key:"getLable",value:function(e){if(e===this.entity)return this.label;var t=e.name,n=this.res.arrs;if(void 0!==n){var r=n[t];if(void 0!==r){var i=r.label;if(void 0!==i)return i}}return t}},{key:"internalStart",value:function(e){return io(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.isFrom=void 0!==this.entity.schemaFrom,e.next=3,this.showVPage(this.VTuidMain);case 3:case"end":return e.stop()}},e,this)}))}},{key:"onEvent",value:function(e,t){return io(this,void 0,void 0,d.a.mark(function n(){var r,i;return d.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:n.t0=e,n.next="new"===n.t0?4:"list"===n.t0?6:"edit"===n.t0?8:"item-changed"===n.t0?11:"info"===n.t0?13:3;break;case 3:return n.abrupt("return");case 4:return r=this.VTuidEdit,n.abrupt("break",17);case 6:return r=this.VTuidList,n.abrupt("break",17);case 8:return n.next=10,this.edit(t);case 10:return n.abrupt("return");case 11:return this.itemChanged(t),n.abrupt("return");case 13:return i=new lo(this.cUq,this.entity,this.ui,this.res),n.next=16,i.start(t);case 16:return n.abrupt("return");case 17:return n.next=19,this.showVPage(r,t);case 19:case"end":return n.stop()}},n,this)}))}},{key:"edit",value:function(e){return io(this,void 0,void 0,d.a.mark(function t(){var n,r;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n=void 0,void 0===e){t.next=5;break}return t.next=4,this.entity.load(e);case 4:n=t.sent;case 5:return r=this.VTuidEdit,t.next=8,this.showVPage(r,n);case 8:case"end":return t.stop()}},t,this)}))}},{key:"itemChanged",value:function(e){var t=e.id,n=e.values;if(void 0!==this.PageItems){var r=this.PageItems.items.find(function(e){return e.id===t});void 0!==r&&qr.a.merge(r,n)}}},{key:"VTuidMain",get:function(){return Qa}},{key:"VTuidEdit",get:function(){return Ja}},{key:"VTuidList",get:function(){return ro}}]),t}(ao),so=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"internalStart",value:function(e){return io(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.edit(e);case 2:case"end":return t.stop()}},t,this)}))}}]),t}(oo),co=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"internalStart",value:function(e){return io(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.showVPage(this.VTuidList);case 2:case"end":return e.stop()}},e,this)}))}}]),t}(oo),uo=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"internalStart",value:function(e){return io(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.showVPage(this.VTuidSelect,e);case 2:case"end":return t.stop()}},t,this)}))}},{key:"beforeStart",value:function(){return io(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.entity.loadSchema();case 2:return void 0!==this.PageItems&&this.PageItems.reset(),e.abrupt("return",!0);case 4:case"end":return e.stop()}},e,this)}))}},{key:"idFromItem",value:function(e){return e.id}},{key:"VTuidSelect",get:function(){return Ya}}]),t}(ao),lo=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"internalStart",value:function(e){return io(this,void 0,void 0,d.a.mark(function t(){var n;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.entity.load(e);case 2:return n=t.sent,t.next=5,this.showVPage(this.VTuidInfo,n);case 5:case"end":return t.stop()}},t,this)}))}},{key:"VTuidInfo",get:function(){return Za}}]),t}(ao),ho=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},fo=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).itemRender=function(t,n){return Or.createElement(e.ItemRow,{item:t})},e.ItemRow=Object(si.a)(function(t){var n,r,i,a,o,s,c=t.item,u=(c.tuid,c.box),l=c.children,h=c.isLeaf,d=c.keyIndex,f=c.values,p=e.controller.keyUIs[d],v=p.content,m=p.valuesContent,y=p.none;if(!1===e.isFrom&&(n=Or.createElement("button",{className:"btn btn-link btn-sm",onClick:function(){return e.controller.addClick(c)}},Or.createElement(yt,{name:"plus"})),r=Or.createElement("button",{className:"btn btn-link btn-sm",onClick:function(){return e.controller.removeClick(c)}},Or.createElement(yt,{className:"text-info",name:"trash"}))),!1===h?i=0===d?n:Or.createElement(Or.Fragment,null,r," \xa0 ",n):d>0&&(i=r),!0===h)a=void 0,f&&(s=(m||yi)(f,e.x));else{o="border-bottom";var b=y&&y(e.x);a=Or.createElement(We,{className:"ml-4",items:l,item:{onClick:void 0,render:e.itemRender},none:b})}return Or.createElement("div",{className:"d-flex flex-column"},Or.createElement(vt,{className:ii()("px-3","py-2",o),right:i},Or.createElement("div",{className:"py-1"},vi(u,v,e.x)),Or.createElement("div",{className:"py-1 font-weight-bold"},s)),a)}),e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return ho(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.isFrom=this.controller.isFrom,this.openPage(this.view);case 2:case"end":return e.stop()}},e,this)}))}},{key:"view",get:function(){var e=this;return function(){return Or.createElement(c.d,{header:e.label},Or.createElement(We,{items:e.controller.items,item:{className:"my-2",onClick:void 0,render:e.itemRender}}))}}}]),t}(ra),po=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},vo=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).onValuesSubmit=function(){return po(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){var t;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.ceasePage(),t=this.vForm.getValues(),this.returnCall(t);case 3:case"end":return e.stop()}},e,this)}))},e.view=function(){return Or.createElement(c.d,null,e.vForm.render())},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return po(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.vForm=this.createForm(this.onValuesSubmit),this.openPageElement(Or.createElement(this.view,null));case 2:case"end":return e.stop()}},e,this)}))}}]),t}(ra),mo=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},yo=function e(t,n,r,i){Object(f.a)(this,e),this.children=Rr.k.array([],{deep:!0}),this.parent=t,this.tuid=n,this.box=r,this.keyIndex=i,this.isLeaf=!1},bo=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).addClick=function(t){return mo(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){var n,r,i,a,o,s,c,u,l,h,f,p,v,m,y,b,g,w,k,x,E,O,j,C,S,N,P,_,R,A,q,I,F;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.keyIndex,r=t.children,i=this.keyFields.length,a=i-1,!((o=n+1)>=i)){e.next=6;break}return e.abrupt("return");case 6:for(s=this.keyFields[o],c=s.name,u=s._tuid,l={},h={},f=t;void 0!==f;f=f.parent)v=(p=f).keyIndex,m=p.box,y=this.keyFields[v].name,l[y]=h[y]=m.id;return e.next=14,this.searchOnKey(s,l);case 14:if(!(void 0===(b=e.sent)||b<=0)){e.next=17;break}return e.abrupt("return");case 17:if(u.useId(b),g=u.boxId(b),w={},k={},n+1!==a){e.next=31;break}if(u.useId(b),k[c]=w[c]=g,!(this.entity.fields.length>0)){e.next=29;break}return e.next=27,this.vCall(vo,h);case 27:for(E in x=e.sent)k[E]=w[E]=x[E];case 29:e.next=54;break;case 31:for(k[c]=h[c]=g,O=o+1;O<a;O++)h[this.keyFields[O].name]=0;for(w[this.keyFields[a].name]=0,j=this.entity.fields,C=!0,S=!1,N=void 0,e.prev=38,P=j[Symbol.iterator]();!(C=(_=P.next()).done);C=!0)R=_.value,R.name,A=R.type,!0!==R.null&&(w[R.name]=ti(A));e.next=46;break;case 42:e.prev=42,e.t0=e.catch(38),S=!0,N=e.t0;case 46:e.prev=46,e.prev=47,C||null==P.return||P.return();case 49:if(e.prev=49,!S){e.next=52;break}throw N;case 52:return e.finish(49);case 53:return e.finish(46);case 54:return h.arr1=[w],e.next=57,this.entity.actions.add.submit(h);case 57:(q=r.findIndex(function(e){return e.box.id===b}))<0?r.push(this.createItem(t,u,g,o,k)):void 0!==(I=this.entity.fields)&&I.length>0&&(F=r[q],r.splice(q,1),F.values=k,r.splice(q,0,F)),this.removeCeased();case 60:case"end":return e.stop()}},e,this,[[38,42,46,54],[47,,49,53]])}))},e.removeClick=function(t){return mo(Object(Pr.a)(Object(Pr.a)(e)),void 0,void 0,d.a.mark(function e(){var n,r,i,a,o,s,c,u,l,h,f,p,v,m,y,b;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.keyFields[t.keyIndex],r=n._tuid,i=this.cUq.cTuidMain(r.Main),a=i.getLable(r),o=this.res.confirmDelete||qr.a.template("do you really want to remove ${label}?"),!1!==confirm(o({label:a}))){e.next=7;break}return e.abrupt("return");case 7:for(s=this.entity,u=(c={}).arr1=[],l={},u.push(l),h=t;void 0!==h;h=h.parent)f=h.keyIndex,l[this.keyFields[f].name]=h.box.id;for(p=this.keyFields.length,v=t.keyIndex+1;v<p;v++)m=this.keyFields[v],l[m.name]=-1;return e.next=17,s.actions.del.submit(c);case 17:y=t.parent.children,(b=y.findIndex(function(e){return e===t}))>=0&&y.splice(b,1);case 20:case"end":return e.stop()}},e,this)}))},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"internalStart",value:function(){return mo(this,void 0,void 0,d.a.mark(function e(){var t,n,r,i,a,o,s,c,u,l,h,f,p,v,m,y,b;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.entity,n=t.keys,r=t.schemaFrom,this.isFrom=void 0!==r,i=this.entity.queries.all,e.next=5,i.query({});case 5:for(a=e.sent,o=a.ret,s=n.length,this.keyUIs=qr.a.clone(this.ui.keys||[]),this.keyFields=[],c=i.returns[0].fields,u=0;u<s;u++)this.keyFields.push(c[u]),u>=this.keyUIs.length&&this.keyUIs.push({content:yi});for(this.items=Object(Rr.k)([]),l=void 0,h=!0,f=!1,p=void 0,e.prev=17,v=o[Symbol.iterator]();!(h=(m=v.next()).done);h=!0)y=m.value,void 0!==(b=this.addItem(l,y))&&(this.items.push(b),l=b);e.next=25;break;case 21:e.prev=21,e.t0=e.catch(17),f=!0,p=e.t0;case 25:e.prev=25,e.prev=26,h||null==v.return||v.return();case 28:if(e.prev=28,!f){e.next=31;break}throw p;case 31:return e.finish(28);case 32:return e.finish(25);case 33:return e.next=35,this.showVPage(this.VMapMain);case 35:case"end":return e.stop()}},e,this,[[17,21,25,33],[26,,28,32]])}))}},{key:"createItem",value:function(e,t,n,r,i){var a=new yo(e,t,n,r);return r===this.keyFields.length-1&&(a.isLeaf=!0,a.values=i),a}},{key:"addItem",value:function(e,t){for(var n=void 0,r=this.keyFields.length,i=e,a=0;a<r;a++){var o=this.keyFields[a],s=o.name,c=o._tuid,u=t[s];if(void 0===u)break;var l=u.id;if(0!==a){var h=i,d=h.children,f=(h.box,d.length);if(f>0){var p=d[f-1];if(p.box.id===l){i=p;continue}}l>0&&d.push(i=this.createItem(i,c,u,a,t))}else{if(0===l)continue;void 0!==i&&i.box.id===l||(n=i=this.createItem(void 0,c,u,a,t))}}return n}},{key:"searchOnKey",value:function(e,t){return mo(this,void 0,void 0,d.a.mark(function n(){var r,i,a,o,s;return d.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=e._tuid,i=e._ownerField,a=this.cUq.cTuidSelect(r),o=t,void 0!==i&&"object"===typeof(o=t[i.name])&&(o=o.id),n.next=6,a.call(o);case 6:return s=n.sent,n.abrupt("return",r.getIdFromObj(s));case 8:case"end":return n.stop()}},n,this)}))}},{key:"VMapMain",get:function(){return fo}}]),t}(na),go=function(e){function t(e){var n;Object(f.a)(this,t),(n=Object(Cr.a)(this,Object(Sr.a)(t).call(this,e))).isSysVisible=!1,n.view=function(){var e,t=n.controller,r=t.res,i=t.uq,a=t.error,o={render:function(e,t){return e.render()},onClick:void 0},s=[{header:r.tuid||"TUID",items:n.tuidLinks},{cn:"my-2",header:r.map||"MAP",items:n.mapLinks},{cn:"my-2",header:r.sheet||"SHEET",items:n.sheetLinks},{cn:"my-2",header:r.action||"ACTION",items:n.actionLinks},{cn:"my-2",header:r.query||"QUERY",items:n.queryLinks},{cn:"mt-2 mb-4",header:r.book||"BOOK",items:n.bookLinks},{cn:"mt-2 mb-4",header:r.history||"HISTORY",items:n.historyLinks},{cn:"mt-2 mb-4",header:r.pending||"PENDING",items:n.pendingLinks}];return e=void 0!==a?jr.a.createElement("div",{className:"p-3 text-danger"},"\u8fde\u63a5\u9519\u8bef: ",a):s.map(function(e,t){var n=e.cn,r=e.header,i=e.items;return i.length>0&&jr.a.createElement(We,{key:t,className:n,header:jr.a.createElement("div",{className:"px-3 py-1 bg-light"},jr.a.createElement(gt,null,r)),items:i,item:o})}),jr.a.createElement(jr.a.Fragment,null,jr.a.createElement("div",{className:"px-3 py-1 small"},r.uq||i),e)};var r=e.entities,i=r.tuidArr,a=r.mapArr,o=r.sheetArr,s=r.actionArr,c=r.queryArr,u=r.bookArr,l=r.historyArr,h=r.pendingArr;return n.tuidLinks=i.filter(function(e){return n.isVisible(e)}).map(function(e){return new oi(n.controller.cTuidMain(e))}),n.mapLinks=a.filter(function(e){return n.isVisible(e)}).map(function(e){return new oi(n.controller.cMap(e))}),n.sheetLinks=o.filter(function(e){return n.isVisible(e)}).map(function(e){return new oi(n.controller.cSheet(e))}),n.actionLinks=s.filter(function(e){return n.isVisible(e)}).map(function(e){return new oi(n.controller.cAction(e))}),n.queryLinks=c.filter(function(e){return n.isVisible(e)}).map(function(e){return new oi(n.controller.cQuery(e))}),n.bookLinks=u.filter(function(e){return n.isVisible(e)}).map(function(e){return new oi(n.controller.cBook(e))}),n.historyLinks=l.filter(function(e){return n.isVisible(e)}).map(function(e){return new oi(n.controller.cHistory(e))}),n.pendingLinks=h.filter(function(e){return n.isVisible(e)}).map(function(e){return new oi(n.controller.cPending(e))}),n}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"isVisible",value:function(e){return!0!==e.sys||this.isSysVisible}},{key:"render",value:function(e){return void 0===this.view?jr.a.createElement("div",null,"??? viewModel \u5fc5\u987b\u5b9a\u4e49 view ???"):jr.a.createElement(this.view)}}]),t}(c.f),wo=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},ko=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).view=function(){return Or.createElement(c.d,{header:e.label},"History")},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return wo(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.openPage(this.view);case 1:case"end":return e.stop()}},e,this)}))}}]),t}(ra),xo=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Eo=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"internalStart",value:function(){return xo(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.showVPage(this.VHistoryMain);case 2:case"end":return e.stop()}},e,this)}))}},{key:"VHistoryMain",get:function(){return ko}}]),t}(na),Oo=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},jo=function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).view=function(){return Or.createElement(c.d,{header:e.label},"pending")},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return Oo(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.openPage(this.view);case 1:case"end":return e.stop()}},e,this)}))}}]),t}(ra),Co=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},So=function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"internalStart",value:function(){return Co(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.showVPage(this.VPendingMain);case 2:case"end":return e.stop()}},e,this)}))}},{key:"VPendingMain",get:function(){return jo}}]),t}(na),No=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};function Po(e){if(void 0!==e)for(var t in e)e[t.toLowerCase()]=e[t]}var _o=function(e){function t(e,n,r,i,a,o){var u;Object(f.a)(this,t),(u=Object(Cr.a)(this,Object(Sr.a)(t).call(this,Object(c.h)(o.res)))).schemaLoaded=!1,u.isSysVisible=!1,u.cApp=e,u.uq=n,u.id=i,Po(o.tuid),Po(o.sheet),Po(o.map),Po(o.query),Po(o.action),Po(o.book),Po(o.history),Po(o.pending),u.ui=o,u.CTuidMain=o.CTuidMain||oo,u.CTuidEdit=o.CTuidEdit||so,u.CTuidList=o.CTuidList||co,u.CTuidSelect=o.CTuidSelect||uo,u.CTuidInfo=o.CTuidInfo||lo,u.CQuery=o.CQuery||$a,u.CQuerySelect=o.CQuerySelect||za,u.CMap=o.CMap||bo,u.CAction=o.CAction||Fa,u.CSheet=o.CSheet||Ra,u.CBook=o.CBook||sa,u.CHistory=o.CHistory||Eo,u.CPending=o.CPending||So;var l,h,d=n.split("/");switch(d.length){case 1:l="$$$",h=d[0];break;case 2:l=d[0],h=d[1];break;default:return console.log("uq must be uqOwner/uqName format"),Object(Cr.a)(u)}var p,v,m=document.location.hash,y=void 0===m||""===m?"debug/":"tv/";return p=null===a||void 0===a||"*"===a?[]:a.split(";").map(function(e){return e.trim()}).filter(function(e){return e.length>0}),v="$$$/$unitx"===n?new s.b(s.j.unit):new s.c(y,l,h,p,!0),u.entities=new ni(Object(Pr.a)(Object(Pr.a)(u)),v,r),u}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"internalStart",value:function(){return No(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,this)}))}},{key:"loadEntites",value:function(){return No(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.entities.loadAccess();case 2:case"end":return e.stop()}},e,this)}))}},{key:"loadSchema",value:function(){return No(this,void 0,void 0,d.a.mark(function e(){var t,n,r,i;return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!0!==this.schemaLoaded){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.loadEntites();case 5:void 0===this.id&&(this.id=this.entities.uqId),e.t0=d.a.keys(this.ui);case 7:if((e.t1=e.t0()).done){e.next=18;break}if(t=e.t1.value,void 0!==(n=this.ui[t])){e.next=12;break}return e.abrupt("continue",7);case 12:if(n.caption,void 0!==(r=n.collection)){e.next=15;break}return e.abrupt("continue",7);case 15:for(i in r)void 0===this.entities[t](i)&&console.warn(t+":'"+i+"' is not uq entity");e.next=7;break;case 18:return this.schemaLoaded=!0,e.abrupt("return");case 22:return e.prev=22,e.t2=e.catch(0),console.error(e.t2),e.abrupt("return",this.error=e.t2);case 26:case"end":return e.stop()}},e,this,[[0,22]])}))}},{key:"getQuerySearch",value:function(e){return No(this,void 0,void 0,d.a.mark(function t(){var n;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0!==(n=this.entities.query(e))){t.next=5;break}alert("QUERY ".concat(e," \u6ca1\u6709\u5b9a\u4e49!")),t.next=9;break;case 5:return t.next=7,n.loadSchema();case 7:n.returns.length>1&&alert("QUERY ".concat(e," \u8fd4\u56de\u591a\u5f20\u8868, \u65e0\u6cd5\u505aQuerySearch"));case 9:return t.abrupt("return",n);case 10:case"end":return t.stop()}},t,this)}))}},{key:"getTuidPlaceHolder",value:function(e){var t=this.res,n=t.tuidPlaceHolder,r=t.entity,i=e.name;if(void 0!==r){var a=r[i];void 0!==a&&a.label}return n||"Select"}},{key:"getNone",value:function(){return this.res.none||"none"}},{key:"isVisible",value:function(e){return!0!==e.sys||this.isSysVisible}},{key:"navSheet",value:function(e,t){return No(this,void 0,void 0,d.a.mark(function n(){var r,i;return d.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(void 0!==(r=this.entities.sheetFromTypeId(e))){n.next=4;break}return alert("sheetTypeId "+e+" is not exists!"),n.abrupt("return");case 4:return i=this.cSheet(r),n.next=7,i.startSheet(t);case 7:case"end":return n.stop()}},n,this)}))}},{key:"sheet",value:function(e){return this.entities.sheet(e)}},{key:"action",value:function(e){return this.entities.action(e)}},{key:"query",value:function(e){return this.entities.query(e)}},{key:"book",value:function(e){return this.entities.book(e)}},{key:"map",value:function(e){return this.entities.map(e)}},{key:"history",value:function(e){return this.entities.history(e)}},{key:"pending",value:function(e){return this.entities.pending(e)}},{key:"tuid",value:function(e){return this.entities.tuid(e)}},{key:"tuidDiv",value:function(e,t){var n=this.entities.tuid(e);if(void 0!==n){var r=n.divs;if(void 0!==r)return r[t]}}},{key:"cSheetFromName",value:function(e){var t=this.entities.sheet(e);if(void 0!==t)return this.cSheet(t)}},{key:"cActionFromName",value:function(e){var t=this.entities.action(e);if(void 0!==t)return this.cAction(t)}},{key:"cQueryFromName",value:function(e){var t=this.entities.query(e);if(void 0!==t)return this.cQuery(t)}},{key:"cBookFromName",value:function(e){var t=this.entities.book(e);if(void 0!==t)return this.cBook(t)}},{key:"cMapFromName",value:function(e){var t=this.entities.map(e);if(void 0!==t)return this.cMap(t)}},{key:"cHistoryFromName",value:function(e){var t=this.entities.history(e);if(void 0!==t)return this.cHistory(t)}},{key:"cPendingFromName",value:function(e){var t=this.entities.pending(e);if(void 0!==t)return this.cPending(t)}},{key:"cTuidMainFromName",value:function(e){var t=this.entities.tuid(e);if(void 0!==t)return this.cTuidMain(t)}},{key:"cTuidEditFromName",value:function(e){var t=this.entities.tuid(e);if(void 0!==t)return this.cTuidEdit(t)}},{key:"cTuidInfoFromName",value:function(e){var t=this.entities.tuid(e);if(void 0!==t)return this.cTuidInfo(t)}},{key:"cTuidSelectFromName",value:function(e){var t=this.entities.tuid(e);if(void 0!==t)return this.cTuidSelect(t)}},{key:"cFromName",value:function(e,t){switch(e){case"sheet":var n=this.entities.sheet(t);if(void 0===n)return;return this.cSheet(n);case"action":var r=this.entities.action(t);if(void 0===r)return;return this.cAction(r);case"tuid":var i=this.entities.tuid(t);if(void 0===i)return;return this.cTuidMain(i);case"query":var a=this.entities.query(t);if(void 0===a)return;return this.cQuery(a);case"book":var o=this.entities.book(t);if(void 0===o)return;return this.cBook(o);case"map":var s=this.entities.map(t);if(void 0===s)return;return this.cMap(s);case"history":var c=this.entities.history(t);if(void 0===c)return;return this.cHistory(c);case"pending":var u=this.entities.pending(t);if(void 0===u)return;return this.cPending(u)}}},{key:"linkFromName",value:function(e,t){return this.link(this.cFromName(e,t))}},{key:"getUI",value:function(e){var t,n,r=e.name,i=e.typeName;if(void 0!==this.ui){var a=this.ui[i];void 0!==a&&(t=a[r])}var o=this.res.entity;return void 0!==o&&(n=o[r]),{ui:t||{},res:n||{}}}},{key:"link",value:function(e){return new oi(e)}},{key:"cTuidMain",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CTuidMain||this.CTuidMain)(this,e,n,r)}},{key:"cTuidEdit",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CTuidEdit||this.CTuidEdit)(this,e,n,r)}},{key:"cTuidList",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CTuidList||this.CTuidList)(this,e,n,r)}},{key:"cTuidSelect",value:function(e){var t=this.getUI(e.owner||e),n=t.ui,r=t.res;return new(n&&n.CTuidSelect||this.CTuidSelect)(this,e,n,r)}},{key:"cTuidInfo",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CTuidInfo||this.CTuidInfo)(this,e,n,r)}},{key:"cSheet",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CSheet||this.CSheet)(this,e,n,r)}},{key:"cAction",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CAction||this.CAction)(this,e,n,r)}},{key:"cQuery",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CQuery||this.CQuery)(this,e,n,r)}},{key:"cQuerySelect",value:function(e){var t=this.entities.query(e);if(void 0!==t){var n=this.getUI(t),r=n.ui,i=n.res;return new(r&&r.CQuerySelect||this.CQuerySelect)(this,t,r,i)}}},{key:"cBook",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CBook||this.CBook)(this,e,n,r)}},{key:"cHistory",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CHistory||this.CHistory)(this,e,n,r)}},{key:"cPending",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CPending||this.CPending)(this,e,n,r)}},{key:"cMap",value:function(e){var t=this.getUI(e),n=t.ui,r=t.res;return new(n&&n.CMap||this.CMap)(this,e,n,r)}},{key:"getTuidContent",value:function(e){var t=e.owner;if(void 0===t){var n=this.getUI(e).ui;return n&&n.content||yi}var r=this.getUI(t).ui;return r&&r.divs&&r.divs[e.name].content||yi}},{key:"showTuid",value:function(e,t){return No(this,void 0,void 0,d.a.mark(function n(){var r,i;return d.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return r=e.owner,i=this.cTuidInfo(r||e),n.next=4,i.start(t);case 4:case"end":return n.stop()}},n,this)}))}},{key:"render",value:function(){return new this.VUq(this).render()}},{key:"tuidLinks",get:function(){var e=this;return this.entities.tuidArr.filter(function(t){return e.isVisible(t)}).map(function(t){return e.link(e.cTuidMain(t))})}},{key:"sheetLinks",get:function(){var e=this;return this.entities.sheetArr.filter(function(t){return e.isVisible(t)}).map(function(t){return e.link(e.cSheet(t))})}},{key:"actionLinks",get:function(){var e=this;return this.entities.actionArr.filter(function(t){return e.isVisible(t)}).map(function(t){return e.link(e.cAction(t))})}},{key:"queryLinks",get:function(){var e=this;return this.entities.queryArr.filter(function(t){return e.isVisible(t)}).map(function(t){return e.link(e.cQuery(t))})}},{key:"bookLinks",get:function(){var e=this;return this.entities.bookArr.filter(function(t){return e.isVisible(t)}).map(function(t){return e.link(e.cBook(t))})}},{key:"historyLinks",get:function(){var e=this;return this.entities.historyArr.filter(function(t){return e.isVisible(t)}).map(function(t){return e.link(e.cHistory(t))})}},{key:"pendingLinks",get:function(){var e=this;return this.entities.pendingArr.filter(function(t){return e.isVisible(t)}).map(function(t){return e.link(e.cPending(t))})}},{key:"mapLinks",get:function(){var e=this;return this.entities.mapArr.filter(function(t){return e.isVisible(t)}).map(function(t){return e.link(e.cMap(t))})}},{key:"VUq",get:function(){return go}}]),t}(c.a),Ro=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Ao=new(function(e){function t(){return Object(f.a)(this,t),Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"userAppUnits",value:function(e){return Ro(this,void 0,void 0,d.a.mark(function t(){return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.get("tie/user-app-units",{app:e});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)}))}}]),t}(s.a))("tv/",void 0),qo=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})},Io=(c.a,function(e){function t(){var e;return Object(f.a)(this,t),(e=Object(Cr.a)(this,Object(Sr.a)(t).apply(this,arguments))).appContent=function(){var t,n=e.controller.cUqArr;return t=0===n.length?Or.createElement("div",{className:"text-danger"},Or.createElement(yt,{name:""})," \u6b64APP\u6ca1\u6709\u7ed1\u5b9a\u4efb\u4f55\u7684UQ"):n.map(function(e,t){return Or.createElement("div",{key:t},e.render())}),Or.createElement(Or.Fragment,null,t)},e}return Object(Nr.a)(t,e),Object(p.a)(t,[{key:"showEntry",value:function(e){return qo(this,void 0,void 0,d.a.mark(function e(){return d.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.openPage(this.appPage);case 1:case"end":return e.stop()}},e,this)}))}},{key:"render",value:function(e){return this.appContent()}},{key:"appPage",value:function(){var e=this.controller.caption;return Or.createElement(c.d,{header:e,logout:function(){s.j.unit=void 0}},this.appContent())}}]),t}(c.e));var Fo=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};var Vo=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};var To={map:{teamPerson:{CMap:class extends bo{searchOnKey(e,t){const n=e=>super[e];return Fo(this,void 0,void 0,function*(){switch(e.name){default:return yield n("searchOnKey").call(this,e,t);case"post":return yield this.searchOnPost(t)}})}searchOnPost(e){return Fo(this,void 0,void 0,function*(){let t=this.cQuerySelect("teamPosts");return(yield t.call(e)).post.id})}},keys:[{content:({name:e,id:t},n)=>r.createElement(r.Fragment,null,r.createElement(gt,null,n.team," \xa0 ")," ",e),none:e=>e.noStaff},{content:({name:e,id:t},n)=>r.createElement(r.Fragment,null,r.createElement(gt,null,n.staff," \xa0 ")," ",e," \xa0 ",r.createElement(gt,null,n.no," ",function(e,t){if(void 0===e)return"";var n=e.toString(),r=t-n.length;return r<=0?n:o.substr(0,r)+n}(t,4))),none:e=>e.noPost},{content:({title:e,id:t},n)=>r.createElement(r.Fragment,null,r.createElement(gt,null,n.post," \xa0 ")," ",e),none:void 0}]}},tuid:{user:{CTuidSelect:class extends uo{buildPageItems(){let e=this.cUq.cFromName("query","SearchUser");return new Ma(e.entity)}idFromItem(e){return e.id}searchMain(e){return Vo(this,void 0,void 0,function*(){void 0===this.PageItems&&(this.PageItems=this.buildPageItems()),void 0!==e&&(yield this.PageItems.first({key:e}))})}},content:e=>r.createElement(r.Fragment,null,e.name)},organization:{divs:{post:{content:e=>{let{title:t}=e;return r.createElement(r.Fragment,null,t)},rowContent:e=>{let{title:t}=e;return r.createElement(r.Fragment,null,t)}}}}},query:{teamPosts:{row:Object(E.a)(e=>{let{post:t}=e;return r.createElement("div",{className:"px-3 py-2"},t.content())})}},res:{zh:{CN:{x:{no:"\u7f16\u53f7",team:"\u90e8\u95e8",staff:"\u5458\u5de5",noStaff:"\u65e0\u5458\u5de5",post:"\u804c\u4f4d",noPost:"\u65e0\u804c\u4f4d",a:"aaa",b:{s:"sss",d:()=>i.a.createElement("span",{className:"text-success"},"ddd")},c:()=>i.a.createElement("span",{className:"text-danger"},"ccc")},uq:"$UNITX",tuid:"\u57fa\u7840\u6863\u6848",map:"\u5bf9\u7167\u8868",sheet:"\u5355\u636e",pending:"\u5f85\u5904\u7406",book:"\u5e10",action:"\u64cd\u4f5c",tuidNullCaption:"\u9009\u62e9",submit:"\u63d0\u4ea4",arrNew:"\u65b0\u589e",arrEdit:"\u4fdd\u5b58",entity:{message:{label:"\u6d88\u606f-message",arrNew:"\u65b0\u589e\u6d88\u606f",arrEdit:"\u4fdd\u5b58\u6d88\u606f",fields:{fromUser:"\u53d1\u9001\u4eba",fromUnit:"\u53d1\u9001\u90e8\u95e8",type:"\u7c7b\u578b",date:"\u65e5\u671f",subject:"\u4e3b\u9898",discription:"\u63cf\u8ff0",content:"\u5185\u5bb9"}},getMessage:{label:"\u83b7\u53d6Message",submit:"\u83b7\u53d6\u6d88\u606f",fields:{msg:"\u6d88\u606f"}},newMessage:{label:"\u65b0\u5efa\u6d88\u606f",fields:{type:"\u7c7b\u578b",subject:"\u4e3b\u9898"},arrs:{to:{label:"\u53d1\u9001",newSubmit:"\u65b0\u589eto",editSumbit:"\u4fdd\u5b58to"},cc:{label:"\u6284\u9001",newSubmit:"\u65b0\u589ecc",editSumbit:"\u4fdd\u5b58cc"}}},sectionTeam:{label:"\u5927\u90e8-\u56e2\u961f\u5bf9\u7167\u8868"},teamPerson:{label:"\u5458\u5de5-\u5c97\u4f4d\u5bf9\u7167\u8868",fields:{},confirmDelete:Ht.a.template("\u771f\u7684\u8981\u5220\u9664${label}\u5417")},teamOrganization:{label:"\u56e2\u961f-\u673a\u6784\u5bf9\u7167\u8868"},teamPosts:{label:"\u56e2\u961f-\u5c97\u4f4d\u5bf9\u7167\u8868"},person:{label:"\u5458\u5de5",fields:{name:"\u59d3\u540d",nick:"\u522b\u540d",given:"\u540d\u5b57",sur:"\u59d3",gender:"\u6027\u522b",user:"\u7528\u6237"}},organization:{label:"\u673a\u6784",arrs:{post:{label:"\u5c97\u4f4d"}}},user:{label:"\u7528\u6237"},team:{label:"\u56e2\u961f"},section:{label:"\u5927\u90e8"}}}}}},Uo=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class Do extends c.e{constructor(){super(...arguments),this.sheetOpsChanged=!1,this.stateTosView=Object(E.a)(({tosText:e})=>{let t=e.get();return i.a.createElement("div",{className:"bg-light py-1 px-2"},void 0===t||0===t.length?i.a.createElement(gt,null,"[\u65e0\u5c97\u4f4d]"):t.map((e,t)=>i.a.createElement("span",{key:e,className:"d-inline-block border bg-white rounded mr-2 my-1 py-1 px-2"},e)))}),this.organizationRow=((e,t)=>{let{id:n,name:r}=e;return i.a.createElement("div",null,"id:",n," name:",r)}),this.teamRow=((e,t)=>i.a.createElement(this.observableTeamRow,Object.assign({},e))),this.sectionRow=((e,t)=>i.a.createElement(this.observableSectionRow,Object.assign({},e))),this.postRow=((e,t)=>i.a.createElement(this.observablePostRow,Object.assign({},e))),this.stateView=(e=>{let{caption:t}=e,n=i.a.createElement("button",{className:"btn btn-sm btn-success",onClick:()=>Uo(this,void 0,void 0,function*(){return yield this.saveOps(e)})},"\u4fdd\u5b58");return i.a.createElement(c.d,{header:`${this.sheet.name} - ${t}`,back:"close",right:n},i.a.createElement("div",{className:"mx-3 my-2"},i.a.createElement(gt,null,"\u8bbe\u7f6e\u5355\u636e\u72b6\u6001\u8ddf\u5c97\u4f4d\u7684\u5bf9\u5e94\u5173\u7cfb")),i.a.createElement(We,{className:"my-2",items:this.selectablePosts,item:{render:this.postRow}}))}),this.observablePostRow=Object(E.a)(e=>{let t,{post:n,selected:r,teams:a}=e,{title:o}=n,s=r.get();return!0===s&&(t=i.a.createElement(We,{className:"ml-4 va-list-top-border",items:a,item:{render:this.teamRow}})),i.a.createElement("div",{className:"flex-column"},i.a.createElement("label",{className:"px-3 py-2 w-100 mb-0"},i.a.createElement("input",{className:"mr-3 align-middle",type:"checkbox",defaultChecked:s,onChange:t=>this.onPostSelectChanged(e,t.target.checked)}),i.a.createElement(gt,null,"\u5c97\u4f4d")," \xa0 ",o),t)}),this.observableTeamRow=Object(E.a)(e=>{let t,{team:n,selected:r,sections:a}=e,{name:o}=n,s=r.get();return!0===s&&a.length>0&&(t=i.a.createElement(We,{className:"ml-4 va-list-top-border",items:a,item:{render:this.sectionRow}})),i.a.createElement("div",{className:"flex-column"},i.a.createElement("label",{className:"px-3 py-2 w-100 mb-0"},i.a.createElement("input",{className:"mr-3 align-middle",type:"checkbox",defaultChecked:s,onChange:t=>this.onTeamSelectChanged(e,t.target.checked)}),i.a.createElement(gt,null,"\u90e8\u95e8")," \xa0 ",o),t)}),this.observableSectionRow=Object(E.a)(e=>{let{section:t,selected:n}=e,{name:r}=t,a=n.get();return i.a.createElement("div",{className:"flex-column"},i.a.createElement("label",{className:"px-3 py-2 w-100 mb-0"},i.a.createElement("input",{className:"mr-3 align-middle",type:"checkbox",defaultChecked:a,onChange:t=>this.onSectionSelectChanged(e,t.target.checked)}),i.a.createElement(gt,null,"\u5927\u90e8")," \xa0 ",r))})}stateClick(e){let{organizations:t,teams:n,sections:r,posts:i}=this.controller,a={},{tos:o}=e;if(void 0!==o)for(let s of o){let{post:e}=s,t=e.id,n=a[t];void 0===n&&(a[t]=n=[]),n.push(s)}this.selectablePosts=i.map(e=>this.buildSelectablePost(e,a)),this.sheetOpsChanged=!1,this.openPage(this.stateView,e),this.regConfirmClose(()=>Uo(this,void 0,void 0,function*(){return!1===this.sheetOpsChanged||confirm("\u672a\u4fdd\u5b58\n\u771f\u7684\u4e0d\u4fdd\u5b58\u5417\uff1f")}))}buildSelectablePost(e,t){let n,r,i=t[e.id];return void 0===i?(n=!1,r=[]):(n=!0,r=this.buildSelectableTeams(e,i)),{post:e,selected:Mt.j.box(n),teams:r}}buildSelectableTeams(e,t){let n={},r=!1;for(let u of t){let e,{team:t}=u;void 0===t?(e=0,r=!0):e=t.id;let i=n[e];void 0===i&&(n[e]=i=[]),i.push(u)}let i=[],{organization:a}=e;if(void 0!==a&&void 0!==a.teams)for(let u of e.organization.teams)void 0!==u.sections&&i.push(...u.sections);let o=[],s=n[0],c=this.buildSelectableSections(i,s);if(o.push({team:{id:0,name:"* \u6240\u6709\u90e8\u95e8",no:void 0,sections:i,organizations:void 0},selected:Mt.j.box(void 0!==s),sections:c}),void 0!==a&&void 0!==a.teams&&e.organization.teams.forEach(e=>{let t=n[e.id];o.push({team:e,selected:Mt.j.box(void 0!==t),sections:this.buildSelectableSections(i,t)})}),!0===r&&1===t.length){let e=o[0],t=!1;for(let n of e.sections)if(!0===n.selected.get()){t=!0;break}!1===t&&(e.selected.set(!1),e.sections=[])}return o}buildSelectableSections(e,t){let n=[];for(let r of e)n.push({section:r,selected:Mt.j.box(t&&void 0!==t.find(e=>e.section&&r.id===e.section.id))});return n}renderState(e){let t,{name:n,caption:r,tos:a,tosText:o,configable:s}=e;if(!0===s){let n=i.a.createElement(yt,{className:"text-muted align-self-center",name:"chevron-right"}),a=()=>this.stateClick(e),s=i.a.createElement(this.stateTosView,{tosText:o});t=i.a.createElement(i.a.Fragment,null,i.a.createElement(vt,{className:"bg-white py-1 px-2 cursor-pointer",right:n,onClick:a},r),s)}else t=i.a.createElement("div",{className:"bg-white py-1 px-2"},r);return i.a.createElement("div",{key:n,className:"border border-light rounded mx-1 my-3"},t)}tosTexts(e){return e&&e.map((e,t)=>{let{post:n,team:r,section:i}=e,a=n.title;return void 0!==r&&r.id>0&&(a+=" @ "+r.name),void 0!==i&&(void 0!==r&&0!==r.id||(a+=" @ * "),a+=" / "+i.name),a})}showEntry({entity:e,opTos:t}){return Uo(this,void 0,void 0,function*(){this.sheet=e;let{name:n,states:r}=e;if(void 0===r){let e=t.$;return this.states=[{name:"$",caption:"\u5141\u8bb8\u5c97\u4f4d",configable:!0,tos:e,tosText:Mt.j.box(this.tosTexts(e))}],void this.openPageElement(i.a.createElement(c.d,{header:n+" - \u5c97\u4f4d"},this.states.map(e=>this.renderState(e))))}this.states=r.map(e=>{let n,r,a;switch(e.substr(0,1)){case"<":n=i.a.createElement(i.a.Fragment,null,e.substr(1)," \xa0 ",i.a.createElement(gt,null,"\u56de\u590d")),r=!1;break;case"#":n=i.a.createElement(i.a.Fragment,null,e.substr(1)," \xa0 ",i.a.createElement(gt,null,"\u8fd4\u521d")),r=!1;break;case"$":n="[\u65b0\u5f00\u5355]",r=!0,a=t[e];break;default:n=e,r=!0,a=t[e]}return{name:e,caption:n,configable:r,tos:a,tosText:Mt.j.box(this.tosTexts(a))}}),this.openPageElement(i.a.createElement(c.d,{header:"\u5355\u636e\u72b6\u6001\u5bf9\u5e94\u5c97\u4f4d - "+n},this.states.map(e=>this.renderState(e))))})}saveOps(e){return Uo(this,void 0,void 0,function*(){let t=e.name,n=[],r=[];for(let e of this.selectablePosts){if(!1===e.selected.get())continue;let t=e.post.id,i=0;for(let a of e.teams){if(!1===a.selected.get())continue;let o=a.team.id;++i;let s=0;for(let i of a.sections){if(!1===i.selected.get())continue;let c=i.section.id;++s,r.push({post:t,team:o,section:c}),n.push({post:e.post,team:a.team,section:i.section})}0===s&&(r.push({post:t,team:o,section:0}),n.push({post:e.post,team:a.team,section:void 0}))}0===i&&(r.push({post:t,team:0,section:0}),n.push({post:e.post,team:void 0,section:void 0}))}yield this.controller.saveSheetStatePosts(this.sheet,t,r);let i=this.states.find(e=>e.name===t);i.tos=n;let a=this.tosTexts(n);i.tosText.set(a),this.closePage()})}onPostSelectChanged(e,t){this.sheetOpsChanged=!0;let{post:n,selected:r}=e;if(!0===t){let t=[],{organization:r}=n;if(void 0!==r&&void 0!==r.teams)for(let e of n.organization.teams)void 0!==e.sections&&t.push(...e.sections);e.teams.push({team:{id:0,name:"* \u6240\u6709\u90e8\u95e8",no:void 0,sections:t,organizations:void 0},selected:Mt.j.box(!1),sections:[]}),void 0!==r&&void 0!==r.teams&&n.organization.teams.forEach(t=>{e.teams.push({team:t,selected:Mt.j.box(!1),sections:[]})})}else e.teams.splice(0);r.set(t)}onTeamSelectChanged(e,t){this.sheetOpsChanged=!0;let{team:n,selected:r}=e;!0===t?n.sections.forEach(t=>{e.sections.push({section:t,selected:Mt.j.box(!1)})}):e.sections.splice(0),r.set(t)}onSectionSelectChanged(e,t){this.sheetOpsChanged=!0;let{section:n,selected:r}=e;r.set(t)}}var Lo=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class Mo extends c.e{constructor(){super(...arguments),this.checked={},this.isChanged=!1,this.onCheckChanged=((e,t)=>{this.checked[e.name].checked=t;let n=!1;for(let r in this.checked){let{def:e,checked:t}=this.checked[r];if(e!==t){n=!0;break}}this.isChanged=n}),this.saveChange=(()=>Lo(this,void 0,void 0,function*(){let e=[];for(let n in this.checked)!0===this.checked[n].checked&&e.push({entity:n});let t=this.controller.cUq.cFromName("action","saveEntityOpForAll");yield t.entity.submit({uq:this.uq.id,entities:e});this.ceasePage(),this.openPageElement(r.createElement(c.d,{header:"\u6240\u6709\u5c97\u4f4d\u53ef\u64cd\u4f5c",back:"close"},r.createElement("div",{className:"p-3"},r.createElement(yt,{name:"check-circle",className:"text-success"})," \xa0 \u5df2\u4fdd\u5b58")))})),this.pageRender=Object(E.a)(()=>{let e=!0===this.isChanged?r.createElement("button",{className:"btn btn-sm btn-success",onClick:this.saveChange},"\u4fdd\u5b58"):null;return r.createElement(c.d,{header:"\u6240\u6709\u5c97\u4f4d\u53ef\u64cd\u4f5c",right:e},r.createElement("div",{className:"text-muted p-3 small"},r.createElement("div",{style:{lineHeight:"1.8",fontWeight:"bold"}},"\u8bf4\u660e"),r.createElement("ol",{className:"pl-3",style:{listStyleType:"1",lineHeight:"1.8"}},r.createElement("li",null,"\u6709\u4e9b\u64cd\u4f5c\uff0c\u9ed8\u8ba4\u5141\u8bb8\u6240\u6709\u7528\u6237\u53ef\u64cd\u4f5c\uff0c\u53ef\u4ee5\u5728\u8fd9\u91cc\u8bbe\u7f6e\u3002"),r.createElement("li",null,"\u6bd4\u5982\uff0c\u7528\u6237\u4e0b\u8ba2\u5355\u3002\u4efb\u4f55\u5ba2\u6237\uff0c\u767b\u5f55\u8fdb\u7cfb\u7edf\uff0c\u90fd\u53ef\u4ee5\u4e0b\u5355\u3002"),r.createElement("li",null,"\u5982\u679c\u6bcf\u4e2a\u7528\u6237\u90fd\u9700\u8981\u8bbe\u7f6e\uff0c\u7528\u6237\u4f1a\u4e22\u5931\uff0c\u7ba1\u7406\u4eba\u5458\u4f1a\u7e41\u7410\u3002"))),this.blocks.map(e=>{let{items:t,type:n}=e,i=Zi[n];return t&&t.length>0&&r.createElement(We,{key:n,className:"mt-3",header:r.createElement(gt,{className:"px-3 pt-1 bg-light w-100"},this.res[n]||n),items:t,item:{render:(e,t)=>this.entityRender(e,i),onClick:void 0}})}))})}showEntry(e){return Lo(this,void 0,void 0,function*(){this.uq=e;let{name:t,tuids:n,actions:r,maps:i,books:a,queries:o,histories:s,pendings:c,sheets:u}=this.uq;this.blocks=[{items:n,type:"tuid"},{items:u,type:"sheet"},{items:r,type:"action"},{items:i,type:"map"},{items:a,type:"book"},{items:o,type:"query"},{items:s,type:"history"},{items:c,type:"pending"}];let l=this.controller.cUq.cFromName("query","getEntityOpForAll"),h=yield l.entity.query({uq:this.uq.id}),d={};for(let e of h.ret)d[e.entity]=!0;for(let e of this.blocks){let{items:t}=e;if(void 0!==t)for(let e of t){let{name:t}=e,n=!0===d[t];this.checked[t]={def:n,checked:n}}}this.openPage(this.pageRender),this.regConfirmClose(()=>Lo(this,void 0,void 0,function*(){return!1===this.isChanged||confirm("\u672a\u4fdd\u5b58\n\u771f\u7684\u4e0d\u4fdd\u5b58\u5417\uff1f")}))})}entityRender(e,t){let{name:n}=e,i=r.createElement("input",{className:"mr-3 align-middle",type:"checkbox",defaultChecked:this.checked[n].def,onChange:t=>this.onCheckChanged(e,t.target.checked)});return r.createElement(vt,{className:"px-3 py-2 align-items-center",right:i},t," \xa0 ",n)}}(function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);a>3&&o&&Object.defineProperty(t,n,o)})([Mt.j],Mo.prototype,"isChanged",void 0);var Bo=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class Ho extends c.e{constructor(){super(...arguments),this.users=[],this.onStopFully=(e=>Bo(this,void 0,void 0,function*(){this.openPageElement(r.createElement(c.d,{header:"\u505c\u6b62\u5168\u529f\u80fd"},r.createElement("div",{className:"p-3"},r.createElement("div",null,r.createElement("b",{className:"text-danger h4"},e.user.content())," \u505c\u6b62\u5168\u529f\u80fd\u7528\u6237\u3002",r.createElement("br",null),"\u8bf7\u786e\u8ba4\u3002"),r.createElement("div",{className:"p-3"},r.createElement("button",{className:"btn btn-success",onClick:()=>this.onSumitStopFully(e)},"\u505c\u6b62\u5168\u529f\u80fd"),r.createElement("button",{className:"ml-3 btn btn-outline-danger",onClick:this.onCancelStop},"\u4e0d\u505c")))))})),this.onSumitStopFully=(e=>Bo(this,void 0,void 0,function*(){let t={_uq:this.uq.id,arr1:[{_user:e.user.id}]};yield this.entityOpUserFully.entity.actions.del.submit(t);let n=this.users.findIndex(t=>t===e);n>=0&&this.users.splice(n,1),this.closePage()})),this.onCancelStop=(()=>this.closePage()),this.addClick=(()=>Bo(this,void 0,void 0,function*(){let e=yield this.controller.callSearchUser(this.uq);this.onUserSelected(e)})),this.renderUser=((e,t)=>r.createElement("div",{className:"px-3 py-2"},e.user.content())),this.onSearch=(e=>Bo(this,void 0,void 0,function*(){yield this.pageUsers.first({key:e})})),this.onSetFully=(e=>Bo(this,void 0,void 0,function*(){yield this.entityOpUserFully.entity.actions.add.submit({_uq:this.uq.id,arr1:[{_user:e.id}]}),this.tuidUser.entity.useId(e.id);let t={uq:this.uq.id,user:this.tuidUser.entity.boxId(e.id)};this.users.push(t),this.closePage(2)})),this.onCancelFully=(()=>{this.backPage()}),this.onUserSelected=(e=>{this.openPageElement(r.createElement(c.d,{header:"\u786e\u8ba4"},r.createElement("div",{className:"p-3"},r.createElement("div",null,r.createElement("b",{className:"text-danger h4"},e.name)," \u5c06\u8bbe\u7f6e\u4e3a\u5168\u529f\u80fd\u7528\u6237\u3002\u53ea\u6709\u7cfb\u7edf\u7ba1\u7406\u5458\u6216\u8005\u6d4b\u8bd5\u4eba\u5458\u624d\u9700\u8981\u5168\u529f\u80fd\uff0c\u53ef\u4ee5\u64cd\u4f5c\u6240\u6709\u6570\u636e\u3002",r.createElement("br",null),"\u8bf7\u786e\u8ba4\u3002"),r.createElement("div",{className:"p-3"},r.createElement("button",{className:"btn btn-success",onClick:()=>this.onSetFully(e)},"\u8bbe\u7f6e\u4e3a\u5168\u529f\u80fd\u7528\u6237"),r.createElement("button",{className:"ml-3 btn btn-outline-danger",onClick:this.onCancelFully},"\u53d6\u6d88")))))}),this.renderSelectUser=((e,t)=>r.createElement("div",{className:"px-3 py-2"},JSON.stringify(e))),this.usersView=(()=>{let e=r.createElement(qt,{className:"w-100",onSearch:this.onSearch,placeholder:"\u9009\u62e9\u7528\u6237"});return r.createElement(c.d,{header:e},r.createElement(We,{before:"\u641c\u7d22\u7528\u6237\u540d",items:this.pageUsers,item:{render:this.renderSelectUser,onClick:this.onUserSelected}}))})}showEntry(e){return Bo(this,void 0,void 0,function*(){this.uq=e,this.entityOpUserFully=this.controller.cUq.cFromName("map","entityOpUserFully"),this.tuidUser=this.controller.cUq.cFromName("tuid","user"),yield this.entityOpUserFully.entity.loadSchema();let t=yield this.entityOpUserFully.entity.queries.all.query({_uq:this.uq.id}),n=r.createElement("button",{className:"btn btn-sm btn-success",onClick:this.addClick},r.createElement(yt,{name:"plus"}));this.users.push(...t.ret),this.openPageElement(r.createElement(c.d,{header:"\u5168\u529f\u80fd\u7528\u6237",right:n},r.createElement(We,{items:this.users,item:{render:this.renderUser,onClick:this.onStopFully}})))})}}(function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);a>3&&o&&Object.defineProperty(t,n,o)})([Mt.j],Ho.prototype,"users",void 0);var $o=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class zo extends c.e{constructor(){super(...arguments),this.pageUsers=new Wo,this.onUserClick=(e=>{this.closePage(),this.returnCall(e)}),this.onSearch=(e=>$o(this,void 0,void 0,function*(){yield this.pageUsers.first({key:e,unit:this.unit,role:void 0})})),this.renderSelectUser=((e,t)=>r.createElement("div",{className:"px-3 py-2"},JSON.stringify(e)))}showEntry(e){return $o(this,void 0,void 0,function*(){this.unit=e;let t=r.createElement(qt,{className:"w-100",onSearch:this.onSearch,placeholder:"\u9009\u62e9\u7528\u6237"});this.openPageElement(r.createElement(c.d,{header:t},r.createElement(We,{before:"\u641c\u7d22\u7528\u6237\u540d",items:this.pageUsers,item:{render:this.renderSelectUser,onClick:this.onUserClick}})))})}}class Wo extends b{load(e,t,n){return $o(this,void 0,void 0,function*(){let{unit:r,role:i,key:a}=e;return yield Ao.get("unit/members",{key:a,unit:r,role:i,pageStart:t,pageSize:n})})}setPageStart(e){this.pageStart=void 0===e?0:e.id}}var Qo=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class Ko extends ea{constructor(){super(...arguments),this.icon=i.a.createElement(yt,{name:"map-o",className:"text-success",fixWidth:!0}),this.label="\u5c97\u4f4d\u6743\u9650 - UQ\u5bf9\u8c61",this.appRender=((e,t)=>{let{name:n,discription:r}=e;return i.a.createElement(vt,{className:"px-3 py-2",right:r&&i.a.createElement(gt,null,r)},n)}),this.appClick=(e=>{this.openPage(i.a.createElement(this.appView,Object.assign({},e)))}),this.appsView=(()=>i.a.createElement(c.d,{header:this.label},i.a.createElement("div",{className:"text-muted p-3 small"},i.a.createElement("div",{style:{lineHeight:"1.8",fontWeight:"bold"}},"\u8bf4\u660e"),i.a.createElement("ol",{className:"pl-3",style:{listStyleType:"1",lineHeight:"1.8"}},i.a.createElement("li",null,"\u4e0b\u9762\u662f\u5168\u90e8\u542f\u7528\u7684APP\u3002\u8bf7\u9009\u62e9"),i.a.createElement("li",null,"\u6bcf\u4e2aAPP\u4f1a\u4f7f\u7528\u4e00\u4e2a\u4ee5\u4e0a\u7684UQ\u3002UQ\u91cc\u9762\u5b9a\u4e49\u4e86Tuid\uff0cAction\uff0cMap\u548cSheet\u7b49\u5bf9\u8c61\u3002"),i.a.createElement("li",null,"\u8bbe\u7f6e\u5bf9\u8c61\u8ddf\u5c97\u4f4d\u7684\u5173\u8054"))),i.a.createElement(We,{items:this.apps,item:{render:this.appRender,onClick:this.appClick}}))),this.entityClick=((e,t)=>Qo(this,void 0,void 0,function*(){let e=this.cUq.cFromName("query","getEntityPost"),n=yield e.entity.query({uq:t.uq.id,entityName:t.name}),r={};for(let t of n.ret){let{op:e,post:n,team:i,section:a}=t,o=r[e];void 0===o&&(r[e]=o=[]),o.push({post:this.postDict[n],team:this.teamDict[i],section:this.sectionDict[a]})}this.showVPage(Do,{entity:t,opTos:r})})),this.sheetClick=((e,t)=>Qo(this,void 0,void 0,function*(){this.sheetClickOld(t)})),this.sheetClickOld=(e=>Qo(this,void 0,void 0,function*(){let t=this.cUq.cFromName("query","getEntityPost"),n=yield t.entity.query({uq:e.uq.id,entityName:e.name}),r={};for(let e of n.ret){let{op:t,post:n,team:i,section:a}=e,o=r[t];void 0===o&&(r[t]=o=[]),o.push({post:this.postDict[n],team:this.teamDict[i],section:this.sectionDict[a]})}this.showVPage(Do,{entity:e,opTos:r})})),this.renderSetting=((e,t)=>{let{icon:n,color:r,text:a}=e;return i.a.createElement("div",{className:"px-3 py-2 align-items-center"},i.a.createElement(yt,{name:n,fixWidth:!0,className:r})," \xa0 ",a)}),this.settingClick=((e,t)=>{let n,{name:r}=e;switch(r){default:return;case"entity-by-all-post":n=Mo;break;case"user-all-entities":n=Ho}this.showVPage(n,t)}),this.uqRender=((e,t)=>{let{name:n,tuids:r,actions:a,maps:o,books:s,queries:c,histories:u,pendings:l,sheets:h}=e,d=this.entityRender,f=[{items:r,type:"tuid",itemClick:this.entityClick},{items:h,type:"sheet",itemClick:this.sheetClick,itemRender:this.sheetRender},{items:a,type:"action",itemClick:this.entityClick},{items:o,type:"map",itemClick:this.entityClick},{items:s,type:"book",itemClick:this.entityClick},{items:c,type:"query",itemClick:this.entityClick},{items:u,type:"history",itemClick:this.entityClick},{items:l,type:"pending",itemClick:this.entityClick}];return i.a.createElement("div",{key:n,className:"my-2"},i.a.createElement("div",{className:"px-3 font-weight-bold"},n),i.a.createElement(We,{className:"mt-3",items:[{name:"entity-by-all-post",icon:"cog",color:"text-success",text:"\u6240\u6709\u5c97\u4f4d\u53ef\u64cd\u4f5c"},{name:"user-all-entities",icon:"cog",color:"text-success",text:"\u5168\u529f\u80fd\u7528\u6237"}],item:{key:e=>e.name,render:this.renderSetting,onClick:t=>this.settingClick(t,e)}}),f.map(e=>{let{items:t,type:n,itemClick:r,itemRender:a}=e,o=Zi[n];return t&&t.length>0&&i.a.createElement(We,{key:n,className:"mt-3",header:i.a.createElement(gt,{className:"px-3 pt-1 bg-light w-100"},this.res[n]||n),items:t,item:{key:e=>e.name,render:(e,t)=>(a||d)(e,o),onClick:t=>r(e,t)}})}))}),this.appView=(e=>i.a.createElement(c.d,{header:e.name+"\u64cd\u4f5c\u6743\u9650"},e.uqs.map((e,t)=>this.uqRender(e,t))))}internalStart(){return Qo(this,void 0,void 0,function*(){yield this.buildPosts(),yield this.buildAppsUqs(),this.openPage(i.a.createElement(this.appsView,null))})}buildAppsUqs(){return Qo(this,void 0,void 0,function*(){let e=s.j.unit,t=yield Ao.get("/unit/apps-uqs",{unit:e});this.apps=t[0];let n=t[1];for(let r of this.apps)r.uqs=[];for(let r of n){let e=this.apps.find(e=>e.id===r.app);void 0!==e&&(e.uqs.push(r),this.setUqEntities(r))}})}buildPosts(){return Qo(this,void 0,void 0,function*(){let e=this.cUq.cFromName("query","allteams"),t=yield e.entity.query(void 0);this.teams=t.teams,this.organizations=t.organization,this.posts=t.organizationpost,this.sections=t.sections,this.postDict={},this.teamDict={},this.organizationDict={},this.sectionDict={};for(let n of this.organizations)n.posts=[],n.teams=[],this.organizationDict[n.id]=n;for(let n of this.teams)n.organizations=[],n.sections=[],this.teamDict[n.id]=n;for(let n of this.sections)n.teams=[],this.sectionDict[n.id]=n;for(let n of this.posts){this.postDict[n.id]=n;let e=this.organizationDict[n.owner];void 0!==e&&(n.organization=e,e.posts.push(n))}for(let n of t.teamorganization){let{team:e,organization:t}=n,r=this.teamDict[e],i=this.organizationDict[t];r.organizations.push(i),i.teams.push(r)}for(let n of t.sectionteam){let{section:e,team:t}=n,r=this.sectionDict[e],i=this.teamDict[t];r.teams.push(i),i.sections.push(r)}})}setUqEntities(e){let t=e.entities;if(null===t)return;let n,r=t.split("\n"),i=r.length;for(let a=0;a<i;){switch(r[a]){case"tuid":n=this.setEntities(e.tuids=[],r,a,e);break;case"map":n=this.setEntities(e.maps=[],r,a,e);break;case"book":n=this.setEntities(e.books=[],r,a,e);break;case"history":n=this.setEntities(e.histories=[],r,a,e);break;case"pending":n=this.setEntities(e.pendings=[],r,a,e);break;case"query":n=this.setEntities(e.queries=[],r,a,e);break;case"action":n=this.setEntities(e.actions=[],r,a,e);break;case"sheet":n=this.setSheets(e.sheets=[],r,a,e);break;default:return void alert("unknown entity type: "+r[a])}a=n}}setEntities(e,t,n,r){let i=t.length,a=n+1;for(;a<i;a++){let n=t[a];if(!(n.length>0))return a+1;{let t=n;e.push({uq:r,name:t,states:void 0})}}return a}setSheets(e,t,n,r){let i=t.length,a=n+1;for(;a<i;a++){let n=t[a];if(!(n.length>0))return a+1;{let t=n.split("\t"),i=t[0];t[0]="$";let a={uq:r,name:i,states:t};e.push(a)}}return a}saveSheetStatePosts(e,t,n){return Qo(this,void 0,void 0,function*(){let r=this.cUq.cFromName("action","saveentityoppost"),{uq:i,name:a}=e;yield r.submit({uq:i.id,entityName:a,opName:t,posts:n})})}callSearchUser(e){return Qo(this,void 0,void 0,function*(){return yield this.vCall(zo,s.j.unit)})}entityRender(e,t){let{name:n}=e;return i.a.createElement("div",{className:"px-3 py-2 align-items-center"},t," \xa0 ",n)}sheetRender(e,t){let{name:n,states:r}=e;return i.a.createElement("div",{className:"px-3 py-2 align-items-center"},t," \xa0 ",n," ",i.a.createElement(gt,null," \xa0 ",e.states.join(", ")))}}var Jo=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class Go extends _o{constructor(){super(void 0,"$$$/$unitx",0,0,void 0,To),this.label="\u5c97\u4f4d\u6743\u9650",this.icon="sitemap"}clearPrevPages(){}loadEntites(){return Jo(this,void 0,void 0,function*(){yield this.entities.loadEntities()})}internalStart(){return Jo(this,void 0,void 0,function*(){yield this.loadSchema(),this.links=["",new oi(new Ko(this,this.res)),"",this.linkFromName("map","teamPerson"),this.linkFromName("map","sectionTeam"),this.linkFromName("map","teamOrganization"),"",this.linkFromName("tuid","person"),this.linkFromName("tuid","team"),this.linkFromName("tuid","section"),this.linkFromName("tuid","organization")],this.showVPage(Yo)})}}class Yo extends c.e{constructor(){super(...arguments),this.renderRow=((e,t)=>e.render("bg-white")),this.appPage=(()=>{let{links:e,label:t}=this.controller;return r.createElement(c.d,{header:t,logout:()=>{}},r.createElement(We,{items:e,item:{render:this.renderRow}}))})}showEntry(){return Jo(this,void 0,void 0,function*(){this.openPage(this.appPage)})}}var Xo=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};function Zo(e){return function(t,n){return new Promise((i,a)=>{c.g.push(r.createElement(es,Object.assign({resolve:i,face:t,params:n},e)))})}}class es extends r.Component{constructor(e){super(e),this.state={items:null},this.itemClick=this.itemClick.bind(this),this.onSearch=this.onSearch.bind(this)}componentDidMount(){return Xo(this,void 0,void 0,function*(){let{face:e,candidateItems:t,params:n}=this.props;this.setState({items:Array.isArray(t)?t:yield t(n,"")})})}itemClick(e){let{resolve:t}=this.props;t(e),c.g.pop()}onSearch(e){return Xo(this,void 0,void 0,function*(){let{candidateItems:t,params:n}=this.props;if("function"===typeof t){let r=yield t(n,e);this.setState({items:r})}})}render(){let{caption:e,row:t,searchPlaceHolder:n}=this.props;return r.createElement(c.d,{header:e,back:"close"},r.createElement("div",{className:"container"},r.createElement(qt,{className:"my-2",onSearch:this.onSearch,placeholder:n,maxLength:100})),r.createElement(We,{items:this.state.items,item:{onClick:this.itemClick,render:t}}))}}var ts=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};const ns=e=>{let{discription:t,cloud:n,ip:i}=e;return r.createElement(r.Fragment,null,t," ",n," ",i)},rs=[{label:"\u540d\u79f0",field:{name:"name",type:"string",maxLength:100,required:!0}},{label:"\u63cf\u8ff0",field:{name:"discription",type:"string",maxLength:250},face:{type:"textarea"}},{label:"\u56fe\u6807",field:{name:"icon",type:"string",maxLength:250}},{label:"URL",field:{name:"url",type:"string",maxLength:200}},{label:"\u670d\u52a1\u5668",field:{name:"server",type:"id"},face:{type:"pick-id",initCaption:"\u8bf7\u9009\u62e9\u670d\u52a1\u5668",pick:Zo({caption:"\u9009\u62e9\u670d\u52a1\u5668",searchPlaceHolder:"\u641c\u7d22\u670d\u52a1\u5668",candidateItems:(e,t)=>ts(void 0,void 0,void 0,function*(){return yield yn.dev.searchServer.first(t),yn.dev.searchServer.items}),moreCandidates:()=>ts(void 0,void 0,void 0,function*(){yield yn.dev.searchServer.more()}),row:(e,t)=>r.createElement("div",{className:"px-3 py-2"},r.createElement(ns,Object.assign({},e)))}),fromPicked:e=>({id:e.id,caption:r.createElement(ns,Object.assign({},e))}),itemFromId:e=>yn.cacheServers.get(e)}},{label:"\u516c\u5f00",field:{name:"public",type:"bool",defaultValue:1}}];class is extends c.e{constructor(){super(...arguments),this.onSubmit=(e=>ts(this,void 0,void 0,function*(){yield this.controller.saveApp(e),c.g.pop()}))}showEntry(){return ts(this,void 0,void 0,function*(){this.openPage(this.page)})}form(e){return r.createElement(Ie,{className:"m-3",formRows:rs,onSubmit:this.onSubmit,initValues:e})}}class as extends is{constructor(){super(...arguments),this.page=(()=>{let{app:e}=this.controller,{name:t}=e;return r.createElement(c.d,{header:"\u4fee\u6539APP - "+t,back:"close"},this.form(e))})}}class os extends is{constructor(){super(...arguments),this.page=(()=>r.createElement(c.d,{header:"\u65b0\u5efaAPP",back:"close"},this.form({})))}}var ss=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class cs extends c.e{constructor(){super(...arguments),this.newItem=(()=>{this.showVPage(os)}),this.page=(()=>{let{appList:e,listRowClick:t}=this.controller,n=r.createElement("button",{className:"btn btn-secondary btn-sm",onClick:()=>this.newItem()},r.createElement(yt,{name:"plus"}));return r.createElement(c.d,{header:"App",right:n},r.createElement(We,{items:e,item:{render:this.listRow,onClick:t}}))}),this.listRow=(e=>{let{name:t,discription:n}=e,i=Lt;return r.createElement(vt,{className:"py-1 px-3 align-items-stretch",left:r.createElement(dt,{size:"sm",className:"pt-1"},r.createElement("img",{src:i}))},r.createElement("div",{className:"px-3"},r.createElement("div",null,r.createElement("b",null,t)),r.createElement("div",null,r.createElement(gt,null,n))))})}showEntry(e){return ss(this,void 0,void 0,function*(){this.openPage(this.page)})}}var us=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},ls=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class hs extends c.e{constructor(){super(...arguments),this.onSearch=(e=>ls(this,void 0,void 0,function*(){this.uqs=yield this.controller.searchUq(e,0,100)})),this.page=Object(E.a)(()=>{let e=r.createElement(qt,{className:"w-100 mx-1",onSearch:this.onSearch,placeholder:"\u641c\u7d22UQ\u540d\u5b57",maxLength:100});return r.createElement(c.d,{back:"close",header:e},r.createElement(We,{items:this.uqs,item:{render:this.row,onClick:this.controller.onUq}}))}),this.row=(e=>{let{owner:t,name:n,discription:i}=e;return r.createElement(vt,{className:"py-2 px-3",right:i},r.createElement("div",null,t," / ",n))})}showEntry(){return ls(this,void 0,void 0,function*(){this.uqs=yield this.controller.getMyUqs(),this.openPage(this.page)})}}us([Mt.j],hs.prototype,"uqs",void 0);let ds=class extends r.Component{constructor(){super(...arguments),this.anySelected=!1,this.onSelect=((e,t,n)=>{this.anySelected=n}),this.row=(e=>{let{name:t,unit:n,discription:i}=e;return r.createElement(vt,{className:"p-2",right:r.createElement("small",{className:"text-muted"},i)},r.createElement(xn,{id:n}),"/",t)}),this.removeBind=(()=>{if(null===this.list)return;let{selectedItems:e}=this.list;void 0!==e&&0!==e.length&&yn.dev.apps.appBindUq(e.map(e=>({id:e.id,access:["*"]})),!1)})}render(){let e=this.anySelected?{color:"danger",onClick:this.removeBind,icon:"trash",text:"\u53d6\u6d88"}:{color:"primary",onClick:()=>c.g.push(r.createElement(fs,null)),icon:"plus",text:"\u65b0\u589e"},t=r.createElement("div",{className:"va-row py-1 justify-content-center"},(e=>r.createElement("button",{className:gn()("btn","btn-outline-"+e.color,"btn-sm"),onClick:e.onClick},r.createElement("i",{className:"fa fa-"+e.icon})," ",e.text,"\u5173\u8054"))(e));return r.createElement(c.d,{header:"\u5173\u8054UQ"},r.createElement(We,{ref:e=>this.list=e,header:t,items:yn.dev.apps.uqs,item:{render:this.row,onSelect:this.onSelect}}))}};us([Mt.j],ds.prototype,"anySelected",void 0),ds=us([E.a],ds);let fs=class extends r.Component{constructor(){super(...arguments),this.onSearch=(e=>ls(this,void 0,void 0,function*(){yield yn.dev.apps.searchUq(e)})),this.row=(e=>{let t,n,i=["btn","btn-sm"];return void 0!==yn.dev.apps.uqs.find(t=>t.id===e.id)?(i.push("btn-success"),n=(()=>this.onBind(e,!1)),t="\u5df2\u5173\u8054"):(i.push("btn-primary"),n=(()=>this.onBind(e,!0)),t=r.createElement("span",null,r.createElement("i",{className:"fa fa-check"})," \u5173\u8054")),r.createElement("div",{className:"d-flex justify-content-start py-1 px-3"},r.createElement("div",{className:"align-self-center"},e.name+" - "+e.discription),r.createElement("footer",{className:"ml-auto"},r.createElement("button",{className:gn()(i),onClick:n},t)))})}onBind(e,t){yn.dev.apps.appBindUq([{id:e.id,access:["*"]}],t)}render(){let e=r.createElement(qt,{className:"w-100 mx-1",onSearch:this.onSearch,placeholder:"\u641c\u7d22UQ\u540d\u5b57",maxLength:100});return r.createElement(c.d,{back:"close",header:e},r.createElement(We,{items:yn.dev.apps.searchedUqs,item:{render:this.row},loading:null}))}};fs=us([E.a],fs);var ps=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class vs extends c.e{constructor(){super(...arguments),this.editItem=(()=>ps(this,void 0,void 0,function*(){yield this.showVPage(as)})),this.deleteItem=(()=>ps(this,void 0,void 0,function*(){!0===confirm("\u771f\u7684\u8981\u5220\u9664\u5417\uff1f\u7cfb\u7edf\u5220\u9664\u65f6\u5e76\u4e0d\u4f1a\u68c0\u67e5\u76f8\u5173\u5f15\u7528\uff0c\u8bf7\u8c28\u614e")&&(yield this.controller.deleteApp(),c.g.pop())})),this.page=(()=>{let{app:e}=this.controller,{unit:t,name:n,discription:i,icon:a,server:o,date_init:s,date_update:u}=e,l=r.createElement("div",null,r.createElement("div",null,i),r.createElement(Ut,{date_update:u,date_init:s})),h=[{caption:"\u4fee\u6539App",action:this.editItem,icon:"edit"},{caption:"\u5220\u9664",action:this.deleteItem,icon:"trash-o"}],d=r.createElement(Ke,{actions:h}),f=["",{type:"component",component:r.createElement(xt,{icon:a||Dt,main:n,discription:l})},"",{type:"component",label:"\u5f00\u53d1\u53f7",component:r.createElement("div",{className:"py-2"},r.createElement(xn,{id:t,isLink:!0}))},{label:"URL",name:"url",type:"string"},{type:"component",label:"\u670d\u52a1\u5668",component:r.createElement(qn,{id:o})},""],p=r.createElement("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>this.showVPage(hs)},"\u589e\u52a0\u5173\u8054");return r.createElement(c.d,{header:"App - "+n,right:d},r.createElement(ut,{rows:f,values:e}),r.createElement(vt,{className:"mx-3 mt-3 mb-1",right:p},"\u5173\u8054UQ"),r.createElement(We,{items:this.controller.uqAccesses,item:{render:this.renderUqRow,onClick:this.uqClick}}))}),this.uqClick=(e=>{this.controller.onUq(e.uq)}),this.renderUqRow=((e,t)=>{let n,i,{uq:a,bind_access:o}=e,{name:s,discription:c,unit:u}=a;return o&&o.length>0&&(i=r.createElement(r.Fragment,null," + ",o.join(", ")," ")),c&&(n=r.createElement("div",{className:"small text-muted"}," \xa0 ",c)),r.createElement(vt,{className:"px-3 py-2 align-items-center",right:n},r.createElement(En,{id:u})," / ",s," ",i)})}showEntry(){return ps(this,void 0,void 0,function*(){this.openPage(this.page)})}}var ms=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class ys extends c.e{constructor(){super(...arguments),this.onCheckChanged=(e=>{let{target:t}=e;this.accessChecked[t.name]=t.checked}),this.saveUqBind=(()=>ms(this,void 0,void 0,function*(){let e=[];if(this.accesses)for(let t in this.accessChecked)!0===this.accessChecked[t]&&e.push(t);yield this.controller.saveUqBind(this.uqAccess.uq,e),c.g.pop()})),this.removeUqBind=(()=>ms(this,void 0,void 0,function*(){yield this.controller.removeUqBind(this.uqAccess.uq),c.g.pop()})),this.page=(()=>{let e,t,{uq:n,bind_access:i}=this.uqAccess,{owner:a,name:o,discription:s,access:u}=n;return null!==i&&void 0!==i&&(e=r.createElement("button",{className:"btn btn-outline-danger btn-sm",onClick:this.removeUqBind},"\u53d6\u6d88\u5173\u8054")),this.accesses&&(t=r.createElement("div",{className:"mt-3"},this.accesses.map(e=>{let t=this.accessChecked[e];return r.createElement("label",{key:e,className:"d-inline-block mr-4"},r.createElement("input",{onChange:this.onCheckChanged,style:{width:"1.1rem",height:"1.1rem"},name:e,type:"checkbox",defaultChecked:t}),"\xa0",e)}))),r.createElement(c.d,{header:"\u5173\u8054UQ"},r.createElement("div",{className:"m-3 py-3 px-3 bg-white border"},r.createElement("div",null,a," / ",o),r.createElement("div",{className:"text-muted"},s),t,r.createElement(vt,{className:"pt-3",right:e},r.createElement("button",{className:"btn btn-primary btn-sm",onClick:this.saveUqBind},"\u4fdd\u5b58\u5173\u8054"))))})}showEntry(e){return ms(this,void 0,void 0,function*(){this.uqAccess=e;let{uq:t,bind_access:n}=this.uqAccess,{access:r}=t;if(r){this.accessChecked={},this.accesses=r.split(",");for(let e of this.accesses)this.accessChecked[e]=void 0!==(n&&n.find(t=>t===e))}this.openPage(this.page)})}}var bs=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},gs=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class ws extends c.a{constructor(){super(...arguments),this.listRowClick=(e=>gs(this,void 0,void 0,function*(){this.app=e;let t=yield Qt.loadAppUqs(e.id);this.uqAccesses=t.map(e=>{let{owner:t,access:n,id:r,name:i,discription:a,unit:o,date_init:s,date_update:c,bind_access:u}=e;return{uq:{id:r,name:i,discription:a,unit:o,access:n,owner:t,date_init:s,date_update:c,service_count:void 0},uqOwner:t,bind_access:u&&u.split(",")}}),this.showVPage(vs)})),this.saveApp=(e=>gs(this,void 0,void 0,function*(){let t=Ht.a.clone(e);t.unit=this.unitId;let n=yield Qt.saveApp(t);t.id=n,this.appList.push(t)})),this.deleteApp=(()=>gs(this,void 0,void 0,function*(){yield Qt.delApp(this.unitId,this.app.id);let e=this.appList.findIndex(e=>e.id===this.app.id);e>=0&&this.appList.splice(e)})),this.searchUq=((e,t,n)=>gs(this,void 0,void 0,function*(){return yield Qt.searchUq(this.unitId,e,t,n)})),this.getMyUqs=(()=>gs(this,void 0,void 0,function*(){return yield Qt.getMyUqs(this.unitId)})),this.onUq=(e=>{let t=this.uqAccesses.find(t=>t.uq.id===e.id);if(void 0===t)t={uq:e,bind_access:void 0};else{let e=t.bind_access;null!==e&&void 0!==e||(t.bind_access=[])}this.showVPage(ys,t)}),this.saveUqBind=((e,t)=>gs(this,void 0,void 0,function*(){let n=this.buildBindUqs(e,t);if(yield Qt.appBindUq(this.unitId,this.app.id,n),n.length>this.uqAccesses.length)this.uqAccesses.unshift({uq:e,bind_access:t});else{this.uqAccesses.find(t=>t.uq.id===e.id).bind_access=t}})),this.removeUqBind=(e=>gs(this,void 0,void 0,function*(){let t=this.buildBindUqs(e);yield Qt.appBindUq(this.unitId,this.app.id,t);let n=this.uqAccesses.findIndex(t=>t.uq.id===e.id);n>=0&&this.uqAccesses.splice(n,1)}))}internalStart(e){return gs(this,void 0,void 0,function*(){this.unitId=e,this.appList=yield Qt.apps(this.unitId),this.showVPage(cs)})}buildBindUqs(e,t){let n=[],r=!0;for(let i of this.uqAccesses){let{uq:a,bind_access:o}=i;if(a.id===e.id){if(void 0===t)continue;o=t,r=!1}n.push({id:a.id,access:o||[]})}return void 0!==t&&!0===r&&n.push({id:e.id,access:t}),n}}bs([Mt.j],ws.prototype,"appList",void 0),bs([Mt.j],ws.prototype,"uqAccesses",void 0);var ks=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class xs extends r.Component{constructor(e){super(e),this.onFilesChange=(e=>{let t=[],n=e.target.files.length;for(let r=0;r<n;r++){let n=e.target.files[r];t.push(n)}this.setState({files:t})}),this.fileClick=(e=>{let t=new FileReader;t.onload=function(t){c.g.push(r.createElement(Es,{name:e.name,content:this.result}))},t.readAsText(e,"utf8")}),this.onSubmit=(e=>{e.preventDefault()}),this.onUpdate=(()=>ks(this,void 0,void 0,function*(){yield this.update(!1)})),this.onUpdateThoroughly=(()=>ks(this,void 0,void 0,function*(){yield this.update(!0)})),this.state={files:void 0}}fileRender(e,t){let{name:n,size:i,lastModifiedDate:a}=e;return r.createElement(vt,{className:"px-2 py-1",right:r.createElement(gt,null,function(){let e,t;return i<1024?(e=i,t="b"):i<1048576?(e=Math.trunc(i/1024*100)/100,t="k"):(e=Math.trunc(i/1024/1024*100)/100,t="m"),e+" "+t}())},r.createElement("div",null,n),r.createElement("div",null,r.createElement(gt,null,"\u4fee\u6539\u65e5\u671f: ",r.createElement(Ge,{date:a}))))}update(e){return ks(this,void 0,void 0,function*(){var t=this.fileInput.files,n=new FormData;let i=t.length;for(let e=0;e<i;e++){let r=t[e];n.append("files[]",r,r.name)}let a=yn.uqServer+"uq-compile/"+this.props.uq.id+"/update";!0===e&&(a+="-thoroughly");try{let e=new AbortController,t=yield fetch(a,{method:"POST",body:n,signal:e.signal});c.g.push(r.createElement(Os,Object.assign({},this.props,{res:t,abortController:e})))}catch(o){console.error("%s %s",a,o)}})}render(){let e,t,{files:n}=this.state;return void 0!==n&&(e=r.createElement(We,{className:"my-3",items:n,item:{render:this.fileRender,onClick:this.fileClick}})),void 0!==n&&n.length>0&&(t=r.createElement("div",{className:"my-2 d-flex"},r.createElement("button",{className:"btn btn-success",type:"submit",onClick:this.onUpdate},"\u4f18\u5316\u7f16\u8bd1"),r.createElement("div",{className:"py-2 flex-grow-1"}),r.createElement("button",{className:"btn btn-outline-warning",type:"submit",onClick:this.onUpdateThoroughly},"\u5b8c\u5168\u7f16\u8bd1"))),r.createElement(c.d,{header:"\u7f16\u8bd1 - "+this.props.uq.name},r.createElement("div",{className:"py-2 px-3"},r.createElement("div",null,"\u8bf7\u9009\u62e9UQ\u6e90\u4ee3\u7801\u6587\u4ef6"),r.createElement("form",{className:"my-1",encType:"multipart/form-data",onSubmit:this.onSubmit},r.createElement("div",{className:"my-1"},r.createElement("input",{ref:e=>this.fileInput=e,type:"file",id:"photo",className:"w-100 form-control-file",name:"files",multiple:!0,onChange:this.onFilesChange})),e,t),r.createElement("pre",null,this.state.compiled),r.createElement("div",null,this.state.text)))}}class Es extends r.Component{render(){return r.createElement(c.d,{header:this.props.name},r.createElement("pre",{className:"px-3 py-2"},this.props.content))}}class Os extends r.Component{constructor(e){super(e),this.doubleClick=(()=>{var e=document.getElementById("scrollDiv");let t=this.getParent(e);t&&(t.scrollTop>=t.scrollHeight/2?this.topIntoView():this.bottomIntoView())}),this.texts=[],this.state={texts:this.texts,seconds:-1}}componentWillMount(){c.g.regConfirmClose(()=>ks(this,void 0,void 0,function*(){return this.state.seconds>=0||new Promise((e,t)=>{try{if(!0===confirm("\u6b63\u5728\u7f16\u8bd1\u4e2d\uff0c\u771f\u7684\u8981\u4e2d\u6b62\u5417\uff1f")){try{this.props.abortController.abort()}catch(n){console.error(n)}e(!0)}else e(!1)}catch(n){t(n)}})}))}clearTimeHandler(){void 0!==this.timeHandler&&(clearTimeout(this.timeHandler),this.timeHandler=void 0)}getParent(e){if(e)return"MAIN"===e.tagName?e:this.getParent(e.parentElement)}scrollToBottom(e=100){this.clearTimeHandler();let t=this;this.timeHandler=setTimeout(()=>{var e=document.getElementById("bottomDiv");e&&e.scrollIntoView(),t.clearTimeHandler()},e)}topIntoView(){var e=document.getElementById("topDiv");e&&e.scrollIntoView()}bottomIntoView(){var e=document.getElementById("bottomDiv");e&&e.scrollIntoView()}componentDidMount(){return ks(this,void 0,void 0,function*(){let e=this,t=new Date;try{yield(n=this.props.res.body.getReader(),new Promise((r,i)=>{!function a(){n.read().then(({done:n,value:i})=>{if(n)return e.scrollToBottom(),e.setState({seconds:(new Date).getTime()-t.getTime()}),void r();let o=function(e){var t=String.fromCharCode.apply(null,e);return decodeURIComponent(escape(t))}(i);e.texts.push(o),e.setState({texts:e.texts}),i.byteLength,e.scrollToBottom(),a()}).catch(i)}()}))}catch(r){console.error(r)}var n})}render(){let{seconds:e,texts:t}=this.state;return r.createElement(c.d,{header:e>=0?"\u7f16\u8bd1\u5b8c\u6210":"\u7f16\u8bd1\u4e2d...",back:"close"},r.createElement("div",{id:"topDiv"}),r.createElement("div",{id:"scrollDiv",onDoubleClick:this.doubleClick,className:"py-2 px-3",style:{wordWrap:"break-word",whiteSpace:"normal"}},t.map((e,t)=>r.createElement("pre",{style:{whiteSpace:"pre-wrap"},key:t},e))),e>=0?r.createElement("div",{className:"px-3 pb-3",style:{color:"red",fontWeight:"bold"}},"\u7f16\u8bd1\u5b8c\u6210\u3002\u5171\u8ba1\u7528\u65f6",Math.floor(e/1e3),"\u79d2"):void 0,r.createElement("div",{id:"bottomDiv"}))}}var js=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};const Cs=e=>{let{discription:t,cloud:n,ip:i}=e;return r.createElement(r.Fragment,null,t," ",n," ",i)},Ss={label:"URL",field:{name:"url",type:"string",required:!0,maxLength:200}},Ns={label:"\u670d\u52a1\u5668",field:{name:"server",type:"id"},face:{type:"pick-id",initCaption:"\u8bf7\u9009\u62e9\u670d\u52a1\u5668",pick:Zo({caption:"\u9009\u62e9\u670d\u52a1\u5668",searchPlaceHolder:"\u641c\u7d22\u670d\u52a1\u5668",candidateItems:(e,t)=>js(void 0,void 0,void 0,function*(){return yield yn.dev.searchServer.first(t),yn.dev.searchServer.items}),moreCandidates:()=>js(void 0,void 0,void 0,function*(){yield yn.dev.searchServer.more()}),row:(e,t)=>r.createElement("div",{className:"px-3 py-2"},r.createElement(Cs,Object.assign({},e)))}),fromPicked:e=>({id:e.id,caption:r.createElement(Cs,Object.assign({},e))}),itemFromId:e=>yn.cacheServers.get(e)}},Ps={label:"\u6570\u636e\u5e93\u7c7b\u578b",field:{name:"db_type",type:"string",maxLength:20,defaultValue:"mysql"},face:{type:"string",readonly:!0}},_s={label:"\u6570\u636e\u5e93\u540d\u5b57",field:{name:"db",type:"string",maxLength:50,required:!0}},Rs={label:"\u8fde\u63a5\u5b57\u7b26\u4e32",field:{name:"connection",type:"string",maxLength:250},face:{type:"textarea",maxLength:250,rows:8}};class As extends c.e{constructor(){super(...arguments),this.formRows=[Ss,Ns,Ps,_s,Rs],this.onSubmit=(e=>js(this,void 0,void 0,function*(){e.type=2,e.bindId=this.controller.uq.id,0!==(yield this.controller.saveService(e))?c.g.pop():void 0!==this.tonvaForm&&this.tonvaForm.formView.setError("url","\u5df2\u7ecf\u6709Service\u4f7f\u7528\u8fd9\u4e2aurl")})),this.page=(()=>r.createElement(c.d,{header:"\u65b0\u5efaService"},r.createElement(Ie,{ref:e=>this.tonvaForm=e,className:"m-3",formRows:this.formRows,onSubmit:this.onSubmit})))}showEntry(){return js(this,void 0,void 0,function*(){this.openPage(this.page)})}}var qs=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class Is extends c.e{constructor(){super(...arguments),this.onUrlChanged=((e,t)=>qs(this,void 0,void 0,function*(){if(0===(yield this.changeProp("url",e)))return"URL\u5df2\u7ecf\u88ab\u4f7f\u7528\u4e86";this.service.url=e})),this.onDbChanged=((e,t)=>qs(this,void 0,void 0,function*(){if(0===(yield this.changeProp("db",e)))return"Db\u5df2\u7ecf\u88ab\u4f7f\u7528\u4e86";this.service.db=e})),this.onDbTypeChanged=((e,t)=>qs(this,void 0,void 0,function*(){if(void 0===e||null===e)return;if("mysql"!==e.toLowerCase().trim())return"\u76ee\u524d\u53ea\u652f\u6301mysql";yield this.changeProp("db_type",e);this.service.db_type=e})),this.onConnectionChanged=((e,t)=>qs(this,void 0,void 0,function*(){yield this.changeProp("connection",e),this.service.connection=e})),this.onDeleteClick=(()=>qs(this,void 0,void 0,function*(){!0===confirm("\u771f\u7684\u8981\u5220\u9664Service\u5417\uff1f\u5220\u9664\u4e86\u4e0d\u53ef\u6062\u590d\uff0c\u9700\u8981\u91cd\u65b0\u5f55\u5165\u3002")&&(yield this.controller.delService(this.service),c.g.pop())})),this.page=(()=>{let{uq:e}=this.controller,{type:t,name:n,discription:i,server:a,url:o,db:s,db_type:u,connection:l}=this.service,h=["",{type:"string",name:"url",label:"URL",onClick:()=>c.g.push(r.createElement(Vn,{title:"\u4fee\u6539URL",value:o,onChanged:this.onUrlChanged}))},{type:"component",label:"\u670d\u52a1\u5668",component:r.createElement(qn,{id:a})},{type:"string",name:"db_type",label:"\u6570\u636e\u5e93\u7c7b\u578b",onClick:()=>c.g.push(r.createElement(Vn,{title:"\u6570\u636e\u5e93\u7c7b\u578b",value:u,onChanged:this.onDbTypeChanged}))},{type:"string",name:"db",label:"\u6570\u636e\u5e93\u540d",onClick:()=>c.g.push(r.createElement(Vn,{title:"\u6570\u636e\u5e93\u540d\u5b57",value:s,onChanged:this.onDbChanged}))},{type:"string",name:"connection",label:"\u8fde\u63a5\u5b57\u7b26\u4e32",onClick:()=>c.g.push(r.createElement(Tn,{title:"\u8fde\u63a5\u5b57\u7b26\u4e32",value:l,onChanged:this.onConnectionChanged}))}],d=r.createElement("button",{onClick:this.onDeleteClick,className:"btn btn-success"},"\u5220\u9664");return r.createElement(c.d,{header:"UQ - "+e.name,right:d},r.createElement(ut,{rows:h,values:this.service}))})}showEntry(e){return qs(this,void 0,void 0,function*(){this.service=e,this.openPage(this.page)})}changeProp(e,t){return qs(this,void 0,void 0,function*(){return yield this.controller.changeServiceProp(this.service,e,t)})}}(function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);a>3&&o&&Object.defineProperty(t,n,o)})([Mt.j],Is.prototype,"service",void 0);var Fs=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};const Vs=[{label:"\u540d\u79f0",field:{name:"name",type:"string",maxLength:100,required:!0}},{label:"\u63cf\u8ff0",field:{name:"discription",type:"string",maxLength:250},face:{type:"textarea"}}];class Ts extends c.e{constructor(){super(...arguments),this.onSubmit=(e=>Fs(this,void 0,void 0,function*(){yield this.controller.saveUq(e),c.g.pop()}))}showEntry(){return Fs(this,void 0,void 0,function*(){this.openPage(this.page)})}form(e){return r.createElement(Ie,{className:"m-3",formRows:Vs,onSubmit:this.onSubmit,initValues:e})}}class Us extends Ts{constructor(){super(...arguments),this.page=(()=>{let{uq:e}=this.controller,{name:t}=e;return r.createElement(c.d,{header:"\u4fee\u6539UQ - "+t,back:"close"},this.form(e))})}}class Ds extends Ts{constructor(){super(...arguments),this.page=(()=>r.createElement(c.d,{header:"\u65b0\u5efaUQ",back:"close"},this.form({})))}}var Ls=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class Ms extends c.e{constructor(){super(...arguments),this.editItem=(()=>Ls(this,void 0,void 0,function*(){yield this.showVPage(Us)})),this.deleteItem=(()=>Ls(this,void 0,void 0,function*(){!0===confirm("\u771f\u7684\u8981\u5220\u9664UQ\u5417\uff1f")&&(yield this.controller.deleteUq(),c.g.pop())})),this.page=(()=>{let{onUqUpload:e,serviceClick:t,uq:n,services:i}=this.controller,{id:a,name:o,discription:s,access:u,unit:l,date_init:h,date_update:d}=n,f=r.createElement("div",null,r.createElement("div",null,s),r.createElement(Ut,{date_update:d,date_init:h})),p=[{caption:"\u4fee\u6539UQ",action:this.editItem,icon:"edit"},{caption:"\u5220\u9664",action:this.deleteItem,icon:"trash-o"}],v=r.createElement(Ke,{actions:p}),m=["",{type:"component",component:r.createElement(xt,{icon:Dt,main:o,discription:f})},{type:"component",label:"\u5f00\u53d1\u53f7",component:r.createElement("div",{className:"py-2"},r.createElement(xn,{id:l,isLink:!0}))},"",{type:"component",label:"\u7f16\u8bd1\u4ee3\u7801",component:r.createElement(vt,{onClick:()=>e(),className:"w-100 py-2 cursor-pointer",left:"\u4e0a\u4f20\u7f16\u8bd1uq\u4ee3\u7801",right:r.createElement(yt,{className:"align-self-center",name:"chevron-right"})})}];return r.createElement(c.d,{header:"UQ - "+o,right:v},r.createElement(ut,{rows:m,values:n}),r.createElement("div",{className:"d-flex mx-3 mt-3 mb-1 align-items-end"},r.createElement(gt,{style:{display:"block",flex:1}},"Service"),r.createElement("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>this.controller.showNewServicePage()},"\u589e\u52a0")),r.createElement(We,{items:i,item:{render:this.renderService,onClick:t}}))})}showEntry(){return Ls(this,void 0,void 0,function*(){this.openPage(this.page)})}renderService(e,t){let{url:n,server:i,db:a,db_type:o,compile_time:s}=e,c=s?r.createElement(r.Fragment,null,r.createElement(gt,null,"\u7f16\u8bd1: "),r.createElement(Ge,{date:s})):r.createElement(gt,null,"\u672a\u7f16\u8bd1");return r.createElement(vt,{className:"d-flex w-100 align-items-center cursor-pointer py-2 px-3",right:r.createElement("small",null,c)},r.createElement("div",null,r.createElement("div",null,n),r.createElement("div",null,o," ",a),r.createElement(gt,null,r.createElement(qn,{id:i}))))}}var Bs=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class Hs extends c.e{constructor(){super(...arguments),this.newItem=(()=>{this.showVPage(Ds)}),this.page=(()=>{let{uqList:e,listRowClick:t}=this.controller,n=r.createElement("button",{className:"btn btn-secondary btn-sm",onClick:()=>this.newItem()},r.createElement(yt,{name:"plus"}));return r.createElement(c.d,{header:"UQ",right:n},r.createElement(We,{items:e,item:{render:this.listRow,onClick:t}}))}),this.listRow=(e=>{let{name:t,discription:n,service_count:i}=e,a=Lt;return r.createElement(vt,{className:"py-1 px-3 align-items-stretch",left:r.createElement(dt,{size:"sm",className:"pt-1"},r.createElement("img",{src:a})),right:r.createElement(r.Fragment,null,i)},r.createElement("div",{className:"px-3"},r.createElement("div",null,r.createElement("b",null,t)),r.createElement("div",null,r.createElement(gt,null,n))))})}showEntry(e){return Bs(this,void 0,void 0,function*(){this.openPage(this.page)})}}var $s=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},zs=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class Ws extends c.a{constructor(){super(...arguments),this.listRowClick=(e=>zs(this,void 0,void 0,function*(){this.uq=e,yield this.loadUqEntities(e.id),this.showVPage(Ms)})),this.serviceClick=(e=>{this.showVPage(Is,e)}),this.onUqUpload=(()=>zs(this,void 0,void 0,function*(){c.g.push(r.createElement(xs,{uq:this.uq,services:this.services}),()=>{})})),this.saveUq=(e=>zs(this,void 0,void 0,function*(){let t=Ht.a.clone(e);t.unit=this.unitId;let n=yield Qt.saveUq(t);t.id=n,this.uqList.push(t)})),this.deleteUq=(()=>zs(this,void 0,void 0,function*(){yield Qt.delUq(this.unitId,this.uq.id);let e=this.uqList.findIndex(e=>e.id===this.uq.id);e>=0&&this.uqList.splice(e)})),this.showNewServicePage=(()=>zs(this,void 0,void 0,function*(){yield this.showVPage(As)}))}internalStart(e){return zs(this,void 0,void 0,function*(){this.unitId=e,this.uqList=yield Qt.uqs(this.unitId),this.showVPage(Hs)})}loadUqEntities(e){return zs(this,void 0,void 0,function*(){let t=yield Qt.uqGetEntities(this.unitId,e),n=t[0][0];this.access=n.access,this.entities=n.entities,this.services=t[1]})}changeServiceProp(e,t,n){return zs(this,void 0,void 0,function*(){return yield Qt.changeServiceProp(this.unitId,e.id,t,n)})}saveService(e){return zs(this,void 0,void 0,function*(){let t=Ht.a.clone(e);t.unit=this.unitId;let n=yield Qt.saveService(t);return t.id=n,this.services.push(t),n})}delService(e){return zs(this,void 0,void 0,function*(){yield Qt.delService(this.unitId,e.id);let t=this.services.findIndex(t=>t.id==e.id);t>=0&&this.services.splice(t)})}}$s([Mt.j],Ws.prototype,"uqList",void 0),$s([Mt.j],Ws.prototype,"services",void 0);class Qs extends r.Component{render(){let{icon:e,main:t,vice:n}=this.props;return r.createElement(vt,{className:"py-1 px-3 align-items-stretch",left:r.createElement(dt,{size:"sm",className:"pt-1"},r.createElement("img",{src:e}))},r.createElement("div",{className:"px-3"},r.createElement("div",null,r.createElement("b",null,t)),r.createElement("div",null,r.createElement(gt,null,n))))}}var Ks=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},Js=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};let Gs=class extends r.Component{componentDidMount(){return Js(this,void 0,void 0,function*(){})}render(){let{unit:e,name:t,discription:n,schema:i,date_init:a,date_update:o}=this.props,s=r.createElement("div",null,r.createElement("div",null,n),r.createElement(Ut,{date_update:o,date_init:a})),c=["",{type:"component",component:r.createElement(xt,{icon:Dt,main:t,discription:s})},"",{type:"component",label:"\u6240\u6709\u8005",component:r.createElement("div",{className:"py-2"},r.createElement(xn,{id:e,isLink:!0}))},"",{type:"component",label:"Schema",vAlign:"stretch",component:r.createElement(Ys,null)}];return r.createElement("div",null,r.createElement(ut,{rows:c,values:this.props}))}};Gs=Ks([E.a],Gs);let Ys=class extends r.Component{render(){let e=yn.dev.buses.cur;if(null===e)return"...";let t=e.schema;return r.createElement("div",{className:"d-flex py-2 w-100 align-items-center",style:{flex:1}},r.createElement("pre",null,t))}};Ys=Ks([E.a],Ys);var Xs={title:"BUS",formRows:[{label:"\u540d\u79f0",field:{name:"name",type:"string",maxLength:100,required:!0}},{label:"\u63cf\u8ff0",field:{name:"discription",type:"string",maxLength:250},face:{type:"textarea"}},{label:"Schema",field:{name:"schema",type:"string",maxLength:2500},face:{type:"textarea",rows:8}}],row:e=>r.createElement(Qs,{icon:Lt,main:e.name,vice:e.discription}),items:()=>yn.dev.buses,repeated:{name:"name",err:"\u8ddf\u5df2\u6709\u7684\u540d\u79f0\u91cd\u590d"},info:Gs};var Zs={title:"Server",info:class extends r.Component{render(){let{discription:e,cloud:t,ip:n,unit:i,date_init:a,date_update:o}=this.props,s=(r.createElement("div",null,r.createElement("div",null,e),r.createElement(Ut,{date_update:o,date_init:a})),["",{type:"component",component:r.createElement(xt,{icon:Dt,main:e,discription:n})},"",{type:"component",label:"\u5f00\u53d1\u53f7",component:r.createElement("div",{className:"py-2"},r.createElement(xn,{id:i,isLink:!0}))},{type:"string",label:"\u4e91\u670d\u52a1",name:"cloud"}]);return r.createElement("div",null,r.createElement(ut,{rows:s,values:this.props}))}},formRows:[{label:"\u63cf\u8ff0",field:{name:"discription",type:"string",maxLength:50,required:!0}},{label:"\u4e91\u670d\u52a1\u5546",field:{name:"cloud",type:"string",maxLength:20,required:!0}},{label:"IP\u5730\u5740",field:{name:"ip",type:"string",maxLength:20}}],row:e=>r.createElement(Qs,{icon:Lt,main:e.discription,vice:r.createElement(r.Fragment,null,e.cloud,"  ",e.ip)}),items:()=>yn.dev.servers,repeated:{name:"discription",err:"\u91cd\u590d\u7684\u63cf\u8ff0"}},ec=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};const tc={caption:"\u9009\u62e9APP",searchPlaceHolder:"\u641c\u7d22APP",candidateItems:(e,t)=>ec(void 0,void 0,void 0,function*(){return yield yn.dev.searchApp.first(t),yn.dev.searchApp.items}),moreCandidates:()=>ec(void 0,void 0,void 0,function*(){yield yn.dev.searchApp.more()}),row:(e,t)=>r.createElement("div",null,e.name+" "+e.discription)},nc={caption:"\u9009\u62e9UQ",searchPlaceHolder:"\u641c\u7d22UQ",candidateItems:(e,t)=>ec(void 0,void 0,void 0,function*(){return yield yn.dev.searchUq.first(t),yn.dev.searchUq.items}),moreCandidates:()=>ec(void 0,void 0,void 0,function*(){yield yn.dev.searchUq.more()}),row:(e,t)=>r.createElement("div",null,e.name+" "+e.discription)},rc=["\u4e2d\u5fc3","\u4ea4\u6362","APP","UQ"],ic={name:"bindId",type:"number"},ac={label:"URL",field:{name:"url",type:"string",required:!0,maxLength:200}},oc={label:"\u63cf\u8ff0",field:{name:"discription",type:"string",maxLength:100}},sc={label:"\u670d\u52a1\u5668",field:{name:"server",type:"id"},face:{type:"pick-id",initCaption:"\u8bf7\u9009\u62e9\u670d\u52a1\u5668",pick:Zo({caption:"\u9009\u62e9\u670d\u52a1\u5668",searchPlaceHolder:"\u641c\u7d22\u670d\u52a1\u5668",candidateItems:(e,t)=>ec(void 0,void 0,void 0,function*(){return yield yn.dev.searchServer.first(t),yn.dev.searchServer.items}),moreCandidates:()=>ec(void 0,void 0,void 0,function*(){yield yn.dev.searchServer.more()}),row:(e,t)=>r.createElement("div",{className:"px-3 py-2"},e.discription+" "+e.cloud+" "+e.ip)}),fromPicked:e=>({id:e.id,caption:e.discription+" "+e.ip}),itemFromId:e=>yn.cacheServers.get(e)}};Zo(tc),Zo(nc);var cc=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},uc=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};let lc=class extends r.Component{constructor(){super(...arguments),this.itemClick=(e=>{this.props.items().cur=Object(Mt.j)(e),c.g.push(r.createElement(dc,Object.assign({},this.props)))})}componentDidMount(){return uc(this,void 0,void 0,function*(){yield this.props.items().load()})}newItem(){this.props.items().cur=void 0,c.g.push(r.createElement(hc,Object.assign({},this.props)))}render(){let{title:e,items:t}=this.props,n=r.createElement("button",{className:"btn btn-secondary btn-sm",onClick:()=>this.newItem()},r.createElement(yt,{name:"plus"}));return r.createElement(c.d,{header:e,right:n},r.createElement(We,{items:t().items,item:{render:this.props.row,onClick:this.itemClick}}))}};lc=cc([E.a],lc);class hc extends r.Component{constructor(e){super(e),this.onSubmit=this.onSubmit.bind(this)}onSubmit(e){return uc(this,void 0,void 0,function*(){if(!0===(yield this.props.items().saveCur(e)))c.g.pop();else{this.props.repeated}})}render(){let e,{title:t,steps:n,stepHeader:i}=this.props,{formRows:a,items:o}=this.props;return e=void 0!==n?r.createElement(Vt,{className:"mt-4",header:i,steps:n,first:"step1",onSubmit:this.onSubmit}):void 0!==a?r.createElement(Ie,{className:"m-3",formRows:a,onSubmit:this.onSubmit,initValues:o().cur}):"ObjViewProps: no steps and no formRows",r.createElement(c.d,{header:"\u65b0\u589e"+t},e)}}let dc=class extends r.Component{constructor(){super(...arguments),this.menuItems=[{caption:"\u4fee\u6539"+this.props.title,action:this.editItem.bind(this),icon:"edit"},{caption:"\u5220\u9664",action:this.deleteItem.bind(this),icon:"trash-o"}]}deleteItem(){return uc(this,void 0,void 0,function*(){!0===confirm("\u771f\u7684\u8981\u5220\u9664\u5417\uff1f\u7cfb\u7edf\u5220\u9664\u65f6\u5e76\u4e0d\u4f1a\u68c0\u67e5\u76f8\u5173\u5f15\u7528\uff0c\u8bf7\u8c28\u614e")&&(yield this.props.items().del(),c.g.pop())})}editItem(){c.g.push(r.createElement(fc,Object.assign({},this.props)))}render(){let e=[],t=this.props.extraMenuActions;void 0!==t&&e.push(...t),e.push(...this.menuItems);let n=r.createElement(Ke,{actions:e}),i=this.props.items().cur;return r.createElement(c.d,{header:this.props.title+" - \u8be6\u7ec6\u8d44\u6599",right:n},r.createElement(this.props.info,Object.assign({},i)))}};dc=cc([E.a],dc);class fc extends r.Component{constructor(e){super(e),this.actions=[{caption:"\u5220\u9664",action:this.deleteItem.bind(this),icon:"trash-o"}],this.onSubmit=this.onSubmit.bind(this)}componentWillMount(){}onSubmit(e){return uc(this,void 0,void 0,function*(){yield this.props.items().saveCur(e),c.g.pop()})}deleteItem(){return uc(this,void 0,void 0,function*(){!0===confirm("\u771f\u7684\u8981\u5220\u9664\u5417\uff1f\u7cfb\u7edf\u5220\u9664\u65f6\u5e76\u4e0d\u4f1a\u68c0\u67e5\u76f8\u5173\u5f15\u7528\uff0c\u8bf7\u8c28\u614e")&&(yield this.props.items().del(),c.g.pop())})}render(){let e=r.createElement(Ke,{actions:this.actions});return r.createElement(c.d,{header:"\u4fee\u6539 "+this.props.title,right:e,back:"close"},r.createElement(Ie,{className:"m-3",formRows:this.props.formRows,onSubmit:this.onSubmit,initValues:this.props.items().cur}))}}n(57);var pc=function(e,t,n,r){var i,a=arguments.length,o=a<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(i=e[s])&&(o=(a<3?i(o):a>3?i(t,n,o):i(t,n))||o);return a>3&&o&&Object.defineProperty(t,n,o),o},vc=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};class mc extends c.a{loadAdminUnits(){return vc(this,void 0,void 0,function*(){let e=yield zt.userAdminUnits();this.adminUnits=e,1===e.length&&(s.j.unit=e[0].id,yield yn.loadUnit())})}internalStart(e){return vc(this,void 0,void 0,function*(){if(yn.init(),this.isProduction=document.location.hash.startsWith("#tv"),console.log("admins isProduction %s",this.isProduction),!1===this.isProduction)return yield this.loadAdminUnits(),void this.showVPage(yc);yield yn.loadUnit(),this.showVPage(yc)})}}class yc extends c.e{constructor(){super(...arguments),this.selectUnitPage=(()=>r.createElement(c.d,{header:"\u9009\u62e9\u5c0f\u53f7",logout:bc},r.createElement(We,{items:this.controller.adminUnits,item:{render:this.renderRow,onClick:this.onRowClick}}))),this.noUnitPage=(()=>{let{nick:e,name:t}=c.g.user;return r.createElement(c.d,{header:"\u6ca1\u6709\u5c0f\u53f7",logout:bc},r.createElement("div",{className:"p-3 small text-info"},e||t,": \u6ca1\u6709\u9700\u8981\u7ba1\u7406\u7684\u5c0f\u53f7"))}),this.renderRow=((e,t)=>r.createElement(vt,{className:"p-2",right:"id: "+e.id},r.createElement("div",null,e.nick||e.name))),this.onRowClick=(e=>vc(this,void 0,void 0,function*(){s.j.unit=e.id,yield yn.loadUnit(),this.closePage(),this.openPageElement(r.createElement(wc,null))}))}showEntry(){return vc(this,void 0,void 0,function*(){let{isProduction:e,adminUnits:t}=this.controller;if(!1===e)switch(t.length){default:return void this.openPage(this.selectUnitPage);case 0:return void this.openPage(this.noUnitPage);case 1:return void this.openPageElement(r.createElement(wc,null))}void 0!==yn.unit?this.openPageElement(r.createElement(wc,null)):this.openPage(this.noUnitPage)})}get view(){}}const bc=()=>{yn.logout()},gc=r.createElement(yt,{name:"chevron-right"});let wc=class extends r.Component{constructor(){super(...arguments),this.appsAction={main:"\u542f\u505cApp",right:gc,icon:"play",page:nr},this.usersAction={main:"\u7528\u6237\u89d2\u8272",right:gc,icon:"users",page:Er},this.adminsAction={main:"\u7ba1\u7406\u5458",right:gc,icon:"universal-access",page:Qn},this.cOrganization=new Go,this.organizeAction={main:this.cOrganization.label,right:gc,icon:this.cOrganization.icon,controller:this.cOrganization},this.noneAction={main:"\u8bf7\u8010\u5fc3\u7b49\u5f85\u5206\u914d\u4efb\u52a1",icon:"hourglass-start"},this.row=((e,t)=>{let n,i,a,{title:o}=e;if(void 0!==o){let{icon:t,count:s}=e;n=r.createElement(yt,{className:"text-primary",name:t,fixWidth:!0,size:"lg"}),i=o,a=s>0&&r.createElement("span",null,s)}else{let{right:t,main:o,icon:s}=e;n="string"===typeof s?r.createElement(yt,{className:"text-primary",name:s,fixWidth:!0,size:"lg"}):e.icon,i=o,a=r.createElement("span",null,t)}return r.createElement(vt,{className:"px-3 py-2 align-items-center",left:n,right:a},r.createElement("div",{className:"px-3"},r.createElement("b",null,i)))}),this.rowClick=(e=>vc(this,void 0,void 0,function*(){let{title:t}=e;if(void 0!==t){let{objProps:t,onClick:n}=e;return void 0!==t?c.g.push(r.createElement(lc,Object.assign({},t))):void n()}{let{page:t,controller:n}=e;void 0!==t?c.g.push(r.createElement(t,null)):yield n.start()}}))}componentWillMount(){return vc(this,void 0,void 0,function*(){let{unit:e,dev:t}=yn,{isAdmin:n,isOwner:r,type:i}=e;0!==(1&i)?(this.caption="\u5f00\u53d1\u53f7",yield yn.dev.loadCounts()):this.caption="\u5c0f\u53f7"})}buildItems(){let{unit:e,dev:t}=yn,{isAdmin:n,isOwner:r,type:i}=e,a=[];if(1===r&&a.push(this.adminsAction),1===n&&(0!==(2&i)&&"$$$"!==e.name&&a.push(this.appsAction,this.usersAction,this.organizeAction),0!==(1&i))){let{counts:n}=t;if(void 0!==n){let t=[{title:"APP",count:n.app,icon:"tablet",onClick:()=>new ws(void 0).start(e.id)},{title:"UQ",count:n.uq,icon:"cogs",onClick:()=>new Ws(void 0).start(e.id)},{title:"BUS",count:n.bus,icon:"cogs",objProps:Xs},{title:"Server",count:n.server,icon:"server",objProps:Zs}];a.push(...t)}}return a}render(){let e=yn.unit;if(void 0===e)return console.log("admin render without unit"),null;console.log("admin render with unit");let t=this.buildItems();if(void 0===t)return r.createElement(c.d,{header:""});let n,i=this.caption,a=i;if(void 0!==e){let{name:t,nick:o,icon:s,discription:u}=e;a=i+" - "+(e.nick||e.name),n=r.createElement(vt,{className:"px-3 my-4 bg-white py-2 cursor-pointer",onClick:()=>c.g.push(r.createElement(kc,null)),left:r.createElement("div",null,r.createElement("img",{src:s||Dt}))},r.createElement("div",{className:"px-3"},r.createElement("h6",{className:"text-dark"},t),r.createElement("h6",null,r.createElement("small",{className:"text-secondary"},o)),r.createElement("div",{className:"small text-info"},u)))}return r.createElement(c.d,{header:a,logout:bc},n,r.createElement(We,{items:t,item:{render:this.row,onClick:this.rowClick}}))}};wc=pc([E.a],wc);class kc extends r.Component{constructor(){super(...arguments),this.rows=["",{label:"\u6807\u5fd7\u56fe",type:"string",name:"icon"},"=",{label:"\u552f\u4e00\u53f7",type:"string",name:"name"},{label:"\u540d\u79f0",type:"string",name:"nick",onClick:()=>c.g.push(r.createElement(Vn,{title:"\u4fee\u6539\u540d\u79f0",value:yn.unit.nick,onChanged:this.onNickChanged,info:"\u597d\u7684\u540d\u5b57\u4f1a\u63d0\u5347\u63a5\u53d7\u5ea6"}))},{label:"\u8bf4\u660e",type:"string",name:"discription",onClick:()=>c.g.push(r.createElement(Vn,{title:"\u4fee\u6539\u8bf4\u660e",value:yn.unit.discription,onChanged:this.onDiscriptionChanged,info:"\u5bf9\u5c0f\u53f7\u505a\u4e00\u4e2a\u8bf4\u660e"}))}]}onNickChanged(e,t){return vc(this,void 0,void 0,function*(){yield yn.unitChangeProp("nick",e)})}onDiscriptionChanged(e,t){return vc(this,void 0,void 0,function*(){yield yn.unitChangeProp("discription",e)})}render(){return r.createElement(c.d,{header:"\u5c0f\u53f7\u4fe1\u606f"},r.createElement(ut,{rows:this.rows,values:yn.unit,alignValue:"right"}))}}n(100);var xc=function(e,t,n,r){return new(n||(n=Promise))(function(i,a){function o(e){try{c(r.next(e))}catch(t){a(t)}}function s(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(o,s)}c((r=r.apply(e,t||[])).next())})};var Ec=class extends r.Component{onLogined(){return xc(this,void 0,void 0,function*(){document.location,c.g.clear();let e=new mc({});yield e.start()})}render(){return r.createElement(c.c,{onLogined:this.onLogined})}};const Oc=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function jc(e){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=(()=>{const t=e.installing;t&&(t.onstatechange=(()=>{"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}))})}).catch(e=>{console.error("Error during service worker registration:",e)})}n(102),n(104);a.render(r.createElement(Ec,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL(".",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",()=>{const e="./service-worker.js";Oc?function(e){fetch(e).then(t=>{404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):jc(e)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(e):jc(e)})}}()}]),[[63,3,2]]]);
//# sourceMappingURL=main.cc781814.chunk.js.map