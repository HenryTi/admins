(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,function(e,t,i){"use strict";var n=i(57);i.d(t,"left0",function(){return n.a});i(22);var s=i(10);i.d(t,"CenterApi",function(){return s.a}),i.d(t,"UnitxApi",function(){return s.c}),i.d(t,"UqApi",function(){return s.d}),i.d(t,"appInFrame",function(){return s.f}),i.d(t,"getExHash",function(){return s.g}),i.d(t,"host",function(){return s.i}),i.d(t,"loadAppUqs",function(){return s.k}),i.d(t,"postWsToTop",function(){return s.m});var r=i(14);i.o(r,"Controller")&&i.d(t,"Controller",function(){return r.Controller}),i.o(r,"Edit")&&i.d(t,"Edit",function(){return r.Edit}),i.o(r,"Form")&&i.d(t,"Form",function(){return r.Form}),i.o(r,"Image")&&i.d(t,"Image",function(){return r.Image}),i.o(r,"NavView")&&i.d(t,"NavView",function(){return r.NavView}),i.o(r,"Page")&&i.d(t,"Page",function(){return r.Page}),i.o(r,"VPage")&&i.d(t,"VPage",function(){return r.VPage}),i.o(r,"View")&&i.d(t,"View",function(){return r.View}),i.o(r,"nav")&&i.d(t,"nav",function(){return r.nav}),i.o(r,"resLang")&&i.d(t,"resLang",function(){return r.resLang});i(24);var o=i(65);i.d(t,"PageItems",function(){return o.a});var a=i(66);i.d(t,"CacheIds",function(){return a.a});i(86)},function(e,t,i){"use strict";var n=i(41);i.o(n,"Badge")&&i.d(t,"Badge",function(){return n.Badge}),i.o(n,"DropdownActions")&&i.d(t,"DropdownActions",function(){return n.DropdownActions}),i.o(n,"EasyDate")&&i.d(t,"EasyDate",function(){return n.EasyDate}),i.o(n,"FA")&&i.d(t,"FA",function(){return n.FA}),i.o(n,"LMR")&&i.d(t,"LMR",function(){return n.LMR}),i.o(n,"List")&&i.d(t,"List",function(){return n.List}),i.o(n,"Media")&&i.d(t,"Media",function(){return n.Media}),i.o(n,"MultiStep")&&i.d(t,"MultiStep",function(){return n.MultiStep}),i.o(n,"Muted")&&i.d(t,"Muted",function(){return n.Muted}),i.o(n,"PropGrid")&&i.d(t,"PropGrid",function(){return n.PropGrid}),i.o(n,"SearchBox")&&i.d(t,"SearchBox",function(){return n.SearchBox}),i.o(n,"TonvaForm")&&i.d(t,"TonvaForm",function(){return n.TonvaForm});var s=i(81);i.d(t,"List",function(){return s.a});var r=i(71);i.d(t,"DropdownActions",function(){return r.a});var o=i(72);i.d(t,"EasyDate",function(){return o.a});var a=i(83);i.d(t,"PropGrid",function(){return a.a});var l=i(80);i.d(t,"Badge",function(){return l.a}),i.d(t,"FA",function(){return l.b}),i.d(t,"LMR",function(){return l.c}),i.d(t,"Muted",function(){return l.d});var c=i(73);i.d(t,"Media",function(){return c.a});i(84);var u=i(74);i.d(t,"SearchBox",function(){return u.a});var d=i(75);i.d(t,"MultiStep",function(){return d.a});i(19)},,,,,function(e,t,i){"use strict";i.d(t,"a",function(){return l}),i.d(t,"b",function(){return c});var n=i(1),s=i(26),r=i(44),o=i(45),a=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class l extends o.a{constructor(e,t,i,n){super(e,n),Object.setPrototypeOf(this.x,e.x);let{name:s,typeName:o}=t;this.entity=t,this.ui=i,this.label=this.res.label||s,this.icon=r.a[o]}beforeStart(){return a(this,void 0,void 0,function*(){return yield this.entity.loadSchema(),!0})}createForm(e,t,i){let n=this.buildFormOptions(i),r=new s.b(n,e);return r.setValues(t),r}buildFormOptions(e){let t,i,n,r,o,{fields:a,arrFields:l}=this.entity;void 0!==this.res&&(t=this.res.none,i=this.res.submit,n=this.res.arrNew,r=this.res.arrEdit,o=this.res.arrTitleNewButton),void 0===t&&(t=this.cUq.res.none||"none"),void 0===i&&(i=this.cUq.res.submit||"Submit"),void 0===n&&(n=this.cUq.res.arrNew||"New"),void 0===r&&(r=this.cUq.res.arrEdit||"Edit"),void 0===o&&(o=this.cUq.res.arrTitleNewButton),void 0===e&&(e=s.a.new);let c=this.ui.form;return{fields:a,arrs:l,ui:c,res:this.res||{},inputs:this.buildInputs(c),none:t,submitCaption:i,arrNewCaption:n,arrEditCaption:r,arrTitleNewButton:o,mode:e}}buildInputs(e){let{fields:t,arrFields:i}=this.entity,n={};if(this.buildFieldsInputs(n,t,void 0,e),void 0!==i)for(let s of i){let{name:t,fields:i}=s,r=e&&e.items;this.buildFieldsInputs(n,i,t,r&&r[t])}return n}buildFieldsInputs(e,t,i,n){if(void 0!==i){let t=e[i];void 0===t&&(e[i]=t={},e=t)}for(let s of t){let{name:t,_tuid:r}=s;if(void 0===r)continue;let o=n&&n.items&&n.items[t];e[t]={select:this.buildSelect(s,i,o),content:this.buildContent(s,i),placeHolder:this.cUq.getTuidPlaceHolder(r)}}}buildSelect(e,t,i){return(e,t,n)=>a(this,void 0,void 0,function*(){let{_tuid:n,_ownerField:s}=t,r=yield n.cSelectFrom(),o=void 0;void 0!==s&&(o=e.getValue(s.name)),i&&!0===i.autoList&&(console.log("select search set param=empty string"),o="");let a=yield r.call(o);if(r.removeCeased(),void 0===a)return;let l=r.idFromItem(a);return n.useId(l),l})}buildContent(e,t){}cQuerySelect(e){return this.cUq.cQuerySelect(e)}}class c extends n.VPage{constructor(e){super(e),this.entity=e.entity,this.ui=e.ui}get label(){return this.controller.label}createForm(e,t,i){return this.controller.createForm(e,t,i)}}},function(e,t,i){"use strict";(function(e){i.d(t,"b",function(){return v}),i.d(t,"a",function(){return w}),i.d(t,"c",function(){return x});var n=i(0),s=i(3),r=i(15),o=i(54),a=i(87),l=i(13),c=i(88),u=i(10),d=i(18),h=i(29),m=i(39),p=(i(59),i(90),i(102),i(104),function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}),f=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const v=new RegExp("Android|webOS|iPhone|iPad|BlackBerry|Windows Phone|Opera Mini|IEMobile|Mobile","i").test(navigator.userAgent)?{minHeight:"3em"}:void 0;i(91);let g;const y=[];let b=1;class w extends n.Component{constructor(e){super(e),this.waitCount=0,this.isHistoryBack=!1,this.clearError=(()=>{this.setState({fetchError:void 0})}),this.back=this.back.bind(this),this.navBack=this.navBack.bind(this),this.stack=[],this.state={stack:this.stack,wait:0,fetchError:void 0}}componentWillMount(){return f(this,void 0,void 0,function*(){window.addEventListener("popstate",this.navBack)})}componentDidMount(){return f(this,void 0,void 0,function*(){x.set(this),yield x.start()})}get level(){return this.stack.length}startWait(){0===this.waitCount&&(this.setState({wait:1}),this.waitTimeHandler=e.setTimeout(()=>{this.waitTimeHandler=void 0,this.setState({wait:2})},1e3)),++this.waitCount,this.setState({fetchError:void 0})}endWait(){setTimeout(()=>{--this.waitCount,0===this.waitCount&&(void 0!==this.waitTimeHandler&&(clearTimeout(this.waitTimeHandler),this.waitTimeHandler=void 0),this.setState({wait:0}))},100)}onError(e){return f(this,void 0,void 0,function*(){let t=e.error;void 0===t||!0!==t.unauthorized?this.setState({fetchError:e}):yield x.showLogin(void 0)})}show(e,t){return this.clear(),this.push(e,t)}push(e,t){this.removeCeased(),this.stack.length>0&&window.history.pushState("forward",null,null);let i=b++;return this.stack.push({key:i,view:e,ceased:!1,disposer:t}),this.refresh(),i}replace(e,t){let i=void 0,n=this.stack;n.length>0&&(i=n.pop());let s=b++;return this.stack.push({key:s,view:e,ceased:!1,disposer:t}),void 0!==i&&this.dispose(i.disposer),this.refresh(),s}ceaseTop(e=1){let t=this.stack.length-1;for(let i=0;i<e&&!(t<0);i++,t--){this.stack[t].ceased=!0}}pop(e=1){let t=this.stack,i=t.length;if(e<=0||i<=1)return;i<e&&(e=i);let n=0;for(let s=0;s<e&&0!==t.length;s++)this.popAndDispose(),++n;n>=i&&n--,this.refresh(),this.isHistoryBack}popTo(e){if(void 0!==e&&void 0!==this.stack.find(t=>t.key===e))for(;this.stack.length>0;){let t=this.stack.length;if(this.stack[t-1].key===e)break;this.pop()}}topKey(){let e=this.stack.length;if(0!==e)return this.stack[e-1].key}removeCeased(){for(;;){let e=this.stack.length-1;if(e<0)break;if(!1===this.stack[e].ceased)break;let t=this.stack.pop(),{disposer:i}=t;this.dispose(i)}this.refresh()}popAndDispose(){this.removeCeased();let e=this.stack.pop();if(void 0===e)return;let{disposer:t}=e;return this.dispose(t),this.removeCeased(),e}dispose(e){if(void 0===e)return;void 0===this.stack.find(t=>t.disposer===e)&&e()}clear(){this.stack.length;for(;this.stack.length>0;)this.popAndDispose()}regConfirmClose(e){let t=this.stack,i=t.length;0!==i&&(t[i-1].confirmClose=e)}navBack(){x.log("backbutton pressed - nav level: "+this.stack.length),this.isHistoryBack=!0,this.back(!0),this.isHistoryBack=!1}back(e=!0){return f(this,void 0,void 0,function*(){let t=this.stack,i=t.length;if(0===i)return;if(1===i)return void(self!=window.top&&window.top.postMessage({type:"pop-app"},"*"));let n=t[i-1];!0===e&&n.confirmClose?!0===(yield n.confirmClose())&&this.pop():this.pop()})}confirmBox(e){return window.confirm(e)}render(){const{wait:e,fetchError:t}=this.state;let i=this.state.stack,s=i.length-1,r=null,o=null;switch(e){case 1:r=n.createElement("li",{className:"va-wait va-wait1"});break;case 2:r=n.createElement("li",{className:"va-wait va-wait2"},n.createElement(m.a,null))}return t&&(o=n.createElement(a.a,Object.assign({clearError:this.clearError},t))),n.createElement("ul",{className:"va"},i.map((e,t)=>{let{key:i,view:r}=e;return n.createElement("li",{key:i,style:t<s?{visibility:"hidden"}:void 0},r)}),r,o)}refresh(){this.setState({stack:this.stack})}}class E{constructor(){this.local=new c.a,this.user=void 0;let{lang:e,district:t}=h.b;this.language=e,this.culture=t}get guest(){let e=this.local.guest;if(void 0===e)return 0;let t=e.get();return void 0===t?0:t.guest}set(e){this.nav=e}registerReceiveHandler(e){if(void 0!==this.ws)return this.ws.onWsReceiveAny(e)}unregisterReceiveHandler(e){void 0!==this.ws&&void 0!==e&&this.ws.endWsReceive(e)}onReceive(e){return f(this,void 0,void 0,function*(){void 0!==this.ws&&(yield this.ws.receive(e))})}getPredefinedUnitName(){return f(this,void 0,void 0,function*(){try{let t=yield fetch("unit.json",{});return(yield t.json()).unit}catch(e){return void this.local.unit.clear()}})}loadPredefinedUnit(){return f(this,void 0,void 0,function*(){let e,t=Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56",REACT_APP_ICON:"http://101.200.46.56/imgs/Bear-icon.png",REACT_APP_ITEM_ICON:"http://101.200.46.56/imgs/Bear-icon.png"}).REACT_APP_UNIT;if(void 0!==t)return Number(t);let i=this.local.unit.get();if(void 0!==i){if(!0!==u.j)return i.id;if(void 0===(e=yield this.getPredefinedUnitName()))return;if(i.name===e)return i.id}else if(void 0===(e=yield this.getPredefinedUnitName()))return;let n=yield u.h.unitFromName(e);return void 0!==n&&this.local.unit.set({id:n,name:e}),n})}setSettings(e){this.navSettings=e}start(){return f(this,void 0,void 0,function*(){try{let t=document.location.hash;if(void 0!==t&&t.length>0){let e=Object(l.g)();e<0&&(e=void 0),this.hashParam=t.substring(1,e)}x.clear(),this.startWait(),yield u.i.start();let{url:i,ws:n,resHost:s}=u.i;this.centerHost=i,this.resUrl="http://"+s+"/res/",this.wsHost=n,Object(u.p)(i);let r=this.local.guest.get();void 0===r&&(r=yield u.h.guest()),x.setGuest(r);let o=Object(l.f)(),a=Object(l.j)(o);if(void 0!==o&&window!==window.parent&&void 0!==a)return this.ws=d.d,console.log("this.ws = wsBridge in sub frame"),void(self!==window.parent&&window.parent.postMessage({type:"sub-frame-started",hash:a.hash},"*"));let c=yield this.loadPredefinedUnit();a.predefinedUnit=c;let h=this.local.user.get();if(void 0===h){let{notLogined:e}=this.nav.props;return void(void 0!==e?yield e():yield x.showLogin(void 0))}yield x.logined(h)}catch(e){}finally{this.endWait()}})}showAppView(){return f(this,void 0,void 0,function*(){let{onLogined:e}=this.nav.props;void 0!==e?(x.clear(),yield e(),console.log("logined: AppView shown")):x.push(n.createElement("div",null,"NavView has no prop onLogined"))})}setGuest(e){this.local.guest.set(e),o.a.set(0,e.token)}saveLocalUser(){this.local.user.set(this.user)}logined(e,t){return f(this,void 0,void 0,function*(){Object(u.l)(),(this.ws=new u.e(this.wsHost,e.token)).connect(),console.log("logined: %s",JSON.stringify(e)),this.user=e,this.saveLocalUser(),o.a.set(e.id,e.token),void 0!==t?t(e):yield this.showAppView()})}loginTop(e){return this.navSettings&&this.navSettings.loginTop||e}showLogin(e,t){return f(this,void 0,void 0,function*(){let s=yield i.e(1).then(i.bind(null,124)),r=n.createElement(s.default,{withBack:t,callback:e});!0!==t&&(this.nav.clear(),this.pop()),this.nav.push(r)})}showLogout(e){return f(this,void 0,void 0,function*(){x.push(n.createElement(r.a,{header:"\u5b89\u5168\u9000\u51fa",back:"close"},n.createElement("div",{className:"m-5 border border-info bg-white rounded p-3 text-center"},n.createElement("div",null,"\u9000\u51fa\u5f53\u524d\u8d26\u53f7\u4e0d\u4f1a\u5220\u9664\u4efb\u4f55\u5386\u53f2\u6570\u636e\uff0c\u4e0b\u6b21\u767b\u5f55\u4f9d\u7136\u53ef\u4ee5\u4f7f\u7528\u672c\u8d26\u53f7"),n.createElement("div",{className:"mt-3"},n.createElement("button",{className:"btn btn-danger",onClick:()=>this.logout(e)},"\u9000\u51fa")))))})}logout(e){return f(this,void 0,void 0,function*(){u.f.unit=void 0,this.local.logoutClear(),this.user=void 0,Object(u.l)();let t=this.local.guest.get();Object(u.o)(0,t&&t.token),this.ws=void 0,void 0===e?yield x.start():yield e()})}changePassword(){return f(this,void 0,void 0,function*(){let e=yield i.e(2).then(i.bind(null,123));x.push(n.createElement(e.ChangePasswordPage,null))})}get level(){return this.nav.level}startWait(){this.nav.startWait()}endWait(){this.nav.endWait()}onError(e){return f(this,void 0,void 0,function*(){yield this.nav.onError(e)})}show(e,t){this.nav.show(e,t)}push(e,t){this.nav.push(e,t)}replace(e,t){this.nav.replace(e,t)}pop(e=1){this.nav.pop(e)}topKey(){return this.nav.topKey()}popTo(e){this.nav.popTo(e)}clear(){this.nav.clear()}navBack(){this.nav.navBack()}ceaseTop(e){this.nav.ceaseTop(e)}removeCeased(){this.nav.removeCeased()}back(e=!0){return f(this,void 0,void 0,function*(){yield this.nav.back(e)})}regConfirmClose(e){this.nav.regConfirmClose(e)}confirmBox(e){return this.nav.confirmBox(e)}navToApp(e,t,i,s,r){return f(this,void 0,void 0,function*(){return new Promise((o,a)=>{let c=!0===this.centerHost.includes("http://localhost:")?"sheet_debug":"sheet",u=void 0===r?Object(l.c)(e,t):Object(l.c)(e,t,c,[i,s,r]);console.log("navToApp: %s",JSON.stringify(u)),x.push(n.createElement("article",{className:"app-container"},n.createElement("span",{id:u.hash,onClick:()=>this.back(),style:v},n.createElement("i",{className:"fa fa-arrow-left"})),n.createElement("iframe",{src:u.url})),()=>{o()})})})}navToSite(e){window.open(e)}get logs(){return y}log(e){y.push(e)}logMark(){let e=new Date;g=e.getTime(),y.push("log-mark: "+e.toTimeString())}logStep(e){y.push(e+": "+((new Date).getTime()-g))}}p([s.l],E.prototype,"user",void 0);const x=new E}).call(this,i(38))},function(e,t,i){"use strict";i.d(t,"d",function(){return o}),i.d(t,"b",function(){return a}),i.d(t,"a",function(){return l}),i.d(t,"c",function(){return c});var n=i(0),s=i(4),r=i(11);class o{render(e){return void 0===this.view?n.createElement("div",null,"??? viewModel \u5fc5\u987b\u5b9a\u4e49 view ???"):n.createElement(this.view,{vm:this,className:e})}}const a=(e,t)=>n.createElement(n.Fragment,null,"content: ",Object(r.a)(e)),l=Object(s.a)(a),c=e=>n.createElement("div",{className:"px-3 py-2"},Object(r.a)(e))},function(e,t,i){"use strict";var n=i(18),s=i(34),r=i(22),o=i(16),a=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const l=new class extends o.a{guest(){return a(this,void 0,void 0,function*(){let e=yield this.get("",{});switch(typeof e){default:return;case"string":return Object(r.a)(e);case"object":return Object(r.a)(e.token)}})}unitFromName(e){return a(this,void 0,void 0,function*(){let t=yield this.get(e);return t&&t.unit})}}("tv/guest/",void 0);var c=i(13),u=i(21);i(27);i.d(t,"e",function(){return n.a}),i.d(t,"m",function(){return n.b}),i.d(t,"n",function(){return s.b}),i.d(t,"h",function(){return l}),i.d(t,"l",function(){return o.h}),i.d(t,"d",function(){return o.d}),i.d(t,"c",function(){return o.c}),i.d(t,"p",function(){return o.j}),i.d(t,"o",function(){return o.i}),i.d(t,"a",function(){return o.a}),i.d(t,"b",function(){return o.b}),i.d(t,"k",function(){return o.g}),i.d(t,"f",function(){return c.a}),i.d(t,"g",function(){return c.f}),i.d(t,"j",function(){return u.b}),i.d(t,"i",function(){return u.a})},function(e,t,i){"use strict";function n(e,t){switch(e.substr(0,1)){default:return t;case"$":case"_":return}}function s(e){return JSON.stringify(e,n," ")}var r=i(0),o=i(4),a=i(30),l=i(2);const c=Object(o.a)(({tuidValue:e,ui:t,x:i,nullUI:n})=>{if(void 0===e)return void 0===n?r.createElement(r.Fragment,null,"[undefined]"):n();if(null===e)return void 0===n?r.createElement(r.Fragment,null,"[null]"):n();let s=typeof e;switch(s){default:if(void 0===t)return r.createElement(r.Fragment,null,s,"-",e);{let n=t(e,i);return void 0!==n?n:r.createElement(r.Fragment,null,e)}case"object":let o=function(e,t,i){if("number"===typeof e)return r.createElement(r.Fragment,null,e);let{id:n,_$tuid:s,_$com:o}=e;if(void 0===n||null===n)return;let c=s;if(void 0===c)return void 0!==t?t(e,i):Object(a.PureJSONContent)(e,i);let u=t||o;void 0===u&&(u=e._$com=c.getTuidContent());let d=c.valueFromId(n);if(void 0===d)return r.createElement(r.Fragment,null,"[",r.createElement(l.FA,{className:"text-danger",name:"bug"})," no ",c.name," on id=",n,"]");switch(typeof d){case"number":d={id:d}}if(void 0!==t){let e=t(d,i);return void 0!==e?e:r.createElement(r.Fragment,null,n)}return r.createElement(u,d)}(e,t,i);return void 0!==o?o:n();case"number":return r.createElement(r.Fragment,null,"id...",e)}}),u=(e,t,i,n)=>r.createElement(c,{tuidValue:e,ui:t,x:i,nullUI:n});i.d(t,"a",function(){return s}),i.d(t,"b",function(){return u})},function(e,t,i){"use strict";i(0);var n=i(30);i(32);i.o(n,"CLink")&&i.d(t,"CLink",function(){return n.CLink}),i.o(n,"CMap")&&i.d(t,"CMap",function(){return n.CMap}),i.o(n,"CTuidSelect")&&i.d(t,"CTuidSelect",function(){return n.CTuidSelect}),i.o(n,"CUq")&&i.d(t,"CUq",function(){return n.CUq}),i.o(n,"ControllerUq")&&i.d(t,"ControllerUq",function(){return n.ControllerUq}),i.o(n,"QueryPageItems")&&i.d(t,"QueryPageItems",function(){return n.QueryPageItems}),i.o(n,"VMapMain")&&i.d(t,"VMapMain",function(){return n.VMapMain}),i.o(n,"centerApi")&&i.d(t,"centerApi",function(){return n.centerApi}),i.o(n,"entityIcons")&&i.d(t,"entityIcons",function(){return n.entityIcons});var s=i(46);i.d(t,"centerApi",function(){return s.a});i(11)},function(e,t,i){"use strict";i.d(t,"i",function(){return h}),i.d(t,"a",function(){return p}),i.d(t,"h",function(){return f}),i.d(t,"j",function(){return v}),i.d(t,"g",function(){return g}),i.d(t,"f",function(){return y}),i.d(t,"c",function(){return b}),i.d(t,"e",function(){return E}),i.d(t,"b",function(){return x}),i.d(t,"d",function(){return k});var n=i(6),s=i.n(n),r=i(14),o=i(24),a=i(16),l=i(18),c=i(21),u=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const d={};function h(){for(let e in d)d[e]=void 0}const m={};let p=new class{get unit(){return this._unit}set unit(e){this._unit=e}};function f(){return self!==window.parent}function v(e){if(e){let t=e.split("-"),i=t.length;if(i>0){let e=1;p.hash=t[e++],i>0&&(p.unit=Number(t[e++])),i>1&&(p.page=t[e++]),i>2&&(p.param=t.slice(e++))}}return p}function g(){let e=document.location.hash;if(void 0!==e&&e.length>0){let t=e.lastIndexOf("#tv-");return t<0&&(t=e.lastIndexOf("#tvdebug-")),t}return-1}function y(){let e=g();if(!(e<0))return document.location.hash.substring(e)}function b(e,t,i,n){let s;for(;;){if(s=Object(o.a)(),void 0===m[s]){m[s]={hash:s,unit:t};break}}if(e+="#tv-"+s+"-"+t,void 0!==i&&(e+="-"+i,void 0!==n))for(let r=0;r<n.length;r++)e+="-"+n[r];return{url:e,hash:s}}window.addEventListener("message",function(e){return u(this,void 0,void 0,function*(){var t=e.data;switch(t.type){case"sub-frame-started":!function(e){var t=e.data;let i=e.source;Object(l.c)(i),function(e){let t=document.getElementById(e);void 0!==t&&(t.hidden=!0)}(t.hash);let n=s.a.clone(r.nav.user);n.type="init-sub-win",i.postMessage(n,"*")}(e);break;case"ws":yield r.nav.onReceive(t.msg);break;case"init-sub-win":yield function(e){return u(this,void 0,void 0,function*(){console.log("initSubWin: set nav.user",e);let t=r.nav.user=e;Object(a.i)(t.id,t.token),yield r.nav.showAppView()})}(t);break;case"pop-app":r.nav.navBack();break;case"center-api":yield function(e,t){return u(this,void 0,void 0,function*(){let{callId:i,url:n,method:s,body:r}=t,o=yield a.e.directCall(n,s,r);e.postMessage({type:"center-api-return",callId:i,result:o},"*")})}(e.source,t);break;case"center-api-return":!function(e){let{callId:t,result:i}=e,n=C[t];if(void 0===n)return;C[t]=void 0,n.resolve(i)}(t);break;case"app-api":let i=yield function(e,t){return u(this,void 0,void 0,function*(){let i=m[e];if(void 0===i)return{name:t,url:void 0,urlDebug:void 0,token:void 0};let{unit:n,predefinedUnit:s}=i;(n=n||s)||console.error("no unit defined in unit.json or not logined in",n);let r=t.split("/"),o={unit:n,uqOwner:r[0],uqName:r[1]};console.log("uqTokenApi.uq onReceiveAppApiMessage",o);let l=yield a.k.uq(o);return{name:t,url:l.url,urlDebug:l.urlDebug,token:l.token}})}(t.hash,t.apiName);e.source.postMessage({type:"app-api-return",apiName:t.apiName,url:i.url,urlDebug:i.urlDebug,token:i.token},"*");break;case"app-api-return":console.log("app-api-return: %s",JSON.stringify(t)),console.log("await onAppApiReturn(message);"),yield function(e){return u(this,void 0,void 0,function*(){let{apiName:t,url:i,urlDebug:n,token:s}=e,r=w[t];if(void 0===r)throw"error app api return";let o=c.a.getUrlOrDebug(i,n);console.log("onAppApiReturn(message:any): url="+i+", debug="+n+", real="+o),r.resolve({name:t,url:o,urlDebug:n,token:s})})}(t);break;default:this.console.log("message: %s",JSON.stringify(t))}})});const w={};function E(e,t,i){return u(this,void 0,void 0,function*(){if(!f()){let n=function(){let{unit:e,predefinedUnit:t}=p,i=e||t;if(void 0===i)throw"no unit defined in unit.json or not logined in";return i}(),s=yield a.k.uq({unit:n,uqOwner:t,uqName:i});void 0===s.token&&(s.token=a.f);let{url:r,urlDebug:o}=s,l=c.a.getUrlOrDebug(r,o);return console.log("realUrl: %s",l),s.url=l,d[e]=s,s}if(console.log("**** before buildAppUq ****",p),void 0===w[e])return new Promise((t,i)=>{w[e]={resolve:i=>u(this,void 0,void 0,function*(){let{url:n,urlDebug:s,token:r}=yield i;d[e]={name:e,url:n,urlDebug:s,token:r},w[e]=void 0,console.log("**** after buildAppUq ****",p),t()}),reject:i},(window.opener||window.parent).postMessage({type:"app-api",apiName:e,hash:p.hash},"*")})})}function x(e){return d[e]}const C={};function k(e,t,i){return u(this,void 0,void 0,function*(){return console.log("bridgeCenterApi: url=%s, method=%s",e,t),yield new Promise((n,s)=>u(this,void 0,void 0,function*(){let r;for(;;){if(r=Object(o.a)(),void 0===C[r]){C[r]={id:r,resolve:n,reject:s};break}}(window.opener||window.parent).postMessage({type:"center-api",callId:r,url:e,method:t,body:i},"*")}))})}},function(e,t,i){"use strict";var n=i(8);i.d(t,"NavView",function(){return n.a}),i.d(t,"nav",function(){return n.c});i(35);var s=i(15);i.d(t,"Page",function(){return s.a});var r=i(60);i.d(t,"Controller",function(){return r.a}),i.d(t,"VPage",function(){return r.b}),i.d(t,"View",function(){return r.c});var o=i(61);i.o(o,"Edit")&&i.d(t,"Edit",function(){return o.Edit}),i.o(o,"Form")&&i.d(t,"Form",function(){return o.Form}),i.o(o,"Image")&&i.d(t,"Image",function(){return o.Image}),i.o(o,"emailRegex")&&i.d(t,"emailRegex",function(){return o.emailRegex}),i.o(o,"mobileRegex")&&i.d(t,"mobileRegex",function(){return o.mobileRegex}),i.o(o,"resLang")&&i.d(t,"resLang",function(){return o.resLang});var a=i(79);i.d(t,"Form",function(){return a.a});var l=i(82);i.d(t,"Edit",function(){return l.a});var c=i(29);i.d(t,"resLang",function(){return c.a});i(85),i(39);var u=i(20);i.d(t,"Image",function(){return u.a});i(40);var d=i(64);i.d(t,"emailRegex",function(){return d.a}),i.d(t,"mobileRegex",function(){return d.b})},function(e,t,i){"use strict";i.d(t,"a",function(){return m});var n=i(0),s=i(4),r=i(5),o=i.n(r),a=i(6),l=i.n(a),c=i(35),u=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const d=100;class h extends n.Component{constructor(){super(...arguments),this.bottomTime=0,this.topTime=0,this.onScroll=(e=>u(this,void 0,void 0,function*(){let{onScroll:t,onScrollTop:i,onScrollBottom:n}=this.props;t&&this.props.onScroll(e);let s=e.target;if(s.scrollTop<30&&void 0!==i){let e=(new Date).getTime();e-this.topTime>d&&(this.topTime=e,i())}if(s.scrollTop+s.offsetHeight>s.scrollHeight-30&&void 0!==n){let e=(new Date).getTime();e-this.bottomTime>d&&(this.bottomTime=e,n())}}))}eachChild(e,t){let{props:i}=e;if(void 0===i)return;let{children:s}=i;void 0!==s&&n.Children.forEach(s,(e,i)=>{let{_$scroll:n}=e;n&&n(t),console.log(e.toString()),this.eachChild(e,t)})}render(){return n.createElement("main",{className:this.props.className,onScroll:this.onScroll},this.props.children)}}let m=class extends n.Component{constructor(e){super(e);let t,{tabs:i}=e;if(void 0===i||0===i.length)return;this.tabs=i;let n=[];for(let s of i){let e=l.a.clone(s);void 0===t&&!0===e.isSelected?t=e:e.isSelected=!1,e.isMounted=!1,n.push(e)}this.state={cur:t,tabs:n}}componentDidMount(){return u(this,void 0,void 0,function*(){if(void 0===this.tabs)return;let e=this.state.tabs[0];void 0!==e&&(yield this.onTabClick(e))})}onTabClick(e){return u(this,void 0,void 0,function*(){if(!0===e.isSelected)return;let t,i=this.state.tabs;for(let n of i)n===e?(n.isSelected=!0,t=n):n.isSelected=!1;if(!0!==t.isMounted){let{load:e}=t;void 0!==e&&(yield e())}this.setState({cur:t,tabs:i})})}onTouchStart(e){}renderTabs(e){const{header:t,back:i,right:s,keepHeader:r,headerClassName:a}=this.props;let l=this.state.cur,u=n.createElement("div",null,this.state.tabs.map((e,t)=>{const{icon:i,isSelected:s,title:r,redDot:a}=e;let l,c,u;if(void 0!==i&&(l=n.createElement("img",{src:i})),void 0!==a){let e=a.get();e<0?(u=o()("red-dot"),c=n.createElement("u",null)):e>0&&(u=o()("red-dot","num"),c=n.createElement("u",null,e))}return n.createElement("div",{key:t,className:o()("va-tab",{cur:s}),onClick:()=>this.onTabClick(e)},l,n.createElement("div",{className:u},r,c))})),d=!1!==t&&n.createElement(c.a,{back:i,center:!0===r?t:l&&(l.header||l.title),right:s,className:a});return n.createElement("article",{className:"page-container"},d,n.createElement("section",{className:"position-relative"},this.props.sideBar,this.state.tabs.map((e,t)=>{let{isSelected:i,isMounted:s,content:r}=e;if(!0===i||!0===s)return e.isMounted=!0,n.createElement(h,{key:t,className:o()({invisible:!1===i}),onScroll:e.onScroll,onScrollTop:e.onScrollTop,onScrollBottom:e.onScrollBottom},"function"===typeof r?r():r)})),u,e)}renderSingle(e){const{back:t,header:i,right:s,onScroll:r,onScrollTop:o,onScrollBottom:a,children:l,headerClassName:u}=this.props;let d=!1!==i&&n.createElement(c.a,{back:t,center:i,right:s,logout:this.props.logout,className:u});return n.createElement("article",{className:"page-container",onTouchStart:this.onTouchStart},d,n.createElement("section",{className:"position-relative"},this.props.sideBar,n.createElement(h,{onScroll:r,onScrollTop:o,onScrollBottom:a},l)),e)}render(){const{footer:e}=this.props;let t=void 0!==e&&n.createElement("footer",null,e);return void 0!==this.tabs?this.renderTabs(t):this.renderSingle(t)}};m=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([s.a],m)},function(e,t,i){"use strict";var n=i(6),s=i.n(n),r=i(27),o=i(8),a=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class l{startWait(){o.c.startWait()}endWait(){o.c.endWait()}showError(e){return a(this,void 0,void 0,function*(){o.c.endWait(),yield o.c.onError(e)})}}var c=i(13),u=i(34),d=i(21),h=i(14);i.d(t,"h",function(){return v}),i.d(t,"d",function(){return b}),i.d(t,"c",function(){return x}),i.d(t,"j",function(){return C}),i.d(t,"f",function(){return N}),i.d(t,"i",function(){return A}),i.d(t,"a",function(){return R}),i.d(t,"k",function(){return F}),i.d(t,"e",function(){return I}),i.d(t,"b",function(){return U}),i.d(t,"g",function(){return V});var m=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let p={},f={};function v(){p={},f={},E={},Object(c.i)()}const g="uqLocalEntities";const y=new class{loadAccess(e){return m(this,void 0,void 0,function*(){try{let i,{uqOwner:n,uqName:r}=e;if(void 0===this.local){let e=localStorage.getItem(g);null!==e&&(this.local=JSON.parse(e))}if(void 0!==this.local){let{user:e,uqs:t}=this.local;if(e!==S||void 0===t)this.local=void 0;else for(let i in t)t[i].isNet=void 0}void 0===this.local&&(this.local={user:S,unit:void 0,uqs:{}});let o=n+"/"+r,a=this.local.uqs[o];if(void 0!==a){let{value:e}=a;i=e}return void 0===i&&(i=yield e.__loadAccess(),this.saveLocal(o,i)),s.a.cloneDeep(i)}catch(t){throw this.local=void 0,localStorage.removeItem(g),t}})}saveLocal(e,t){this.local.uqs[e]={value:t,isNet:!0};let i=JSON.stringify(this.local);localStorage.setItem(g,i)}checkAccess(e){return m(this,void 0,void 0,function*(){if(void 0===this.local)return!1;let{uqOwner:t,uqName:i}=e,n=t+"/"+i,r=this.local.uqs[n];if(void 0===r)return!1;let{isNet:o,value:a}=r;if(!0===o)return!0;let l=yield e.__loadAccess();return!1===s.a.isMatch(a,l)?(this.saveLocal(n,l),!1):(r.isNet=!0,!0)})}};class b extends u.a{constructor(e,t,i,n,s){super(e,s),i&&(this.uqOwner=t,this.uqName=i,this.uq=t+"/"+i),this.access=n,this.showWaiting=s}init(){return m(this,void 0,void 0,function*(){yield Object(c.e)(this.uq,this.uqOwner,this.uqName)})}getHttpChannel(){return m(this,void 0,void 0,function*(){let e,t;!0===this.showWaiting||void 0===this.showWaiting?(e=p,t=new l):e=f;let i=e[this.uq];if(void 0!==i)return i;let n=Object(c.b)(this.uq);return this.token=n.token,i=new r.a(!1,n.url,n.token,t),e[this.uq]=i})}update(){return m(this,void 0,void 0,function*(){return yield this.get("update")})}__loadAccess(){return m(this,void 0,void 0,function*(){let e=void 0===this.access?"":this.access.join("|");return yield this.get("access",{acc:e})})}loadAccess(){return m(this,void 0,void 0,function*(){return yield y.loadAccess(this)})}loadEntities(){return m(this,void 0,void 0,function*(){return yield this.get("entities")})}checkAccess(){return m(this,void 0,void 0,function*(){return yield y.checkAccess(this)})}schema(e){return m(this,void 0,void 0,function*(){return yield this.get("schema/"+e)})}schemas(e){return m(this,void 0,void 0,function*(){return yield this.post("schema",e)})}tuidGet(e,t){return m(this,void 0,void 0,function*(){return yield this.get("tuid/"+e+"/"+t)})}tuidGetAll(e){return m(this,void 0,void 0,function*(){return yield this.get("tuid-all/"+e+"/")})}tuidSave(e,t){return m(this,void 0,void 0,function*(){return yield this.post("tuid/"+e,t)})}tuidSearch(e,t,i,n,s,r){return m(this,void 0,void 0,function*(){return yield this.post("tuids/"+e,{arr:t,owner:i,key:n,pageStart:s,pageSize:r})})}tuidArrGet(e,t,i,n){return m(this,void 0,void 0,function*(){return yield this.get("tuid-arr/"+e+"/"+i+"/"+t+"/"+n)})}tuidArrGetAll(e,t,i){return m(this,void 0,void 0,function*(){return yield this.get("tuid-arr-all/"+e+"/"+i+"/"+t+"/")})}tuidArrSave(e,t,i,n){return m(this,void 0,void 0,function*(){return yield this.post("tuid-arr/"+e+"/"+i+"/"+t+"/",n)})}tuidArrPos(e,t,i,n,s){return m(this,void 0,void 0,function*(){return yield this.post("tuid-arr-pos/"+e+"/"+i+"/"+t+"/",{id:n,$order:s})})}tuidIds(e,t,i){return m(this,void 0,void 0,function*(){try{let s="tuidids/"+e+"/";return s+=void 0!==t?t:"$",yield this.post(s,i)}catch(n){console.error(n)}})}proxied(e,t,i){return m(this,void 0,void 0,function*(){try{let s="tuid-proxy/"+e+"/"+t+"/"+i;return yield this.get(s)}catch(n){console.error(n)}})}sheetSave(e,t){return m(this,void 0,void 0,function*(){return yield this.post("sheet/"+e,t)})}sheetAction(e,t){return m(this,void 0,void 0,function*(){return yield this.put("sheet/"+e,t)})}stateSheets(e,t){return m(this,void 0,void 0,function*(){return yield this.post("sheet/"+e+"/states",t)})}stateSheetCount(e){return m(this,void 0,void 0,function*(){return yield this.get("sheet/"+e+"/statecount")})}mySheets(e,t){return m(this,void 0,void 0,function*(){return yield this.post("sheet/"+e+"/my-sheets",t)})}getSheet(e,t){return m(this,void 0,void 0,function*(){return yield this.get("sheet/"+e+"/get/"+t)})}sheetArchives(e,t){return m(this,void 0,void 0,function*(){return yield this.post("sheet/"+e+"/archives",t)})}sheetArchive(e,t){return m(this,void 0,void 0,function*(){return yield this.get("sheet/"+e+"/archive/"+t)})}action(e,t){return m(this,void 0,void 0,function*(){return yield this.post("action/"+e,t)})}page(e,t,i,n){return m(this,void 0,void 0,function*(){let r;switch(typeof n){case"undefined":r={key:""};break;default:r=s.a.clone(n)}return r.$pageStart=t,r.$pageSize=i,yield this.post("query-page/"+e,r)})}query(e,t){return m(this,void 0,void 0,function*(){return yield this.post("query/"+e,t)})}user(){return m(this,void 0,void 0,function*(){return yield this.get("user")})}}let w,E={};class x extends b{constructor(e){super("tv/",void 0,void 0,void 0,!0),this.unitId=e}getHttpChannel(){return m(this,void 0,void 0,function*(){let e=E[this.unitId];return void 0!==e?e:E[this.unitId]=yield this.buildChannel()})}buildChannel(){return m(this,void 0,void 0,function*(){let e=new l,t=new U("tv/",void 0),i=yield t.unitxUq(this.unitId),{token:n,url:s,urlDebug:o}=i,a=d.a.getUrlOrDebug(s,o);return this.token=n,new r.a(!1,a,n,e)})}}function C(e){console.log("setCenterUrl %s",e),w=e,N=void 0,P=void 0,k=void 0}let k,P,N=void 0,S=0;function A(e,t){S=e,N=t,console.log("setCenterToken %s",t),P=void 0,k=void 0}class R extends u.a{constructor(e,t){super(e,t)}getHttpChannel(){return m(this,void 0,void 0,function*(){return!0===this.showWaiting||void 0===this.showWaiting?void 0!==k?k:k=new r.a(!0,w,N,new l):void 0!==P?P:P=new r.a(!0,w,N)})}}const O="uqTokens";const F=new class extends R{uq(e){return m(this,void 0,void 0,function*(){try{let{unit:i,uqOwner:n,uqName:r}=e;if(void 0===this.local){let e=localStorage.getItem(O);null!==e&&(this.local=JSON.parse(e))}if(void 0!==this.local){let{unit:e,user:t}=this.local;e===i&&t===S||(this.local=void 0)}void 0===this.local&&(this.local={user:S,unit:e.unit,uqs:{}});let o=n+"/"+r,a=(new Date).getTime(),l=this.local.uqs[o];if(void 0!==l){let{tick:e,value:t}=l;if(void 0!==t&&a-e<864e5)return s.a.clone(t)}let c=yield this.get("app-uq",e);if(void 0===c){let{unit:t,uqOwner:i,uqName:n}=e;throw`center get app-uq(unit=${t}, '${i}/${n}') - not exists or no unit-service`}return this.local.uqs[o]={tick:a,value:c},localStorage.setItem(O,JSON.stringify(this.local)),s.a.clone(c)}catch(t){throw this.local=void 0,localStorage.removeItem(O),t}})}}("tv/tie/",void 0);const I=new class extends R{directCall(e,t,i){return this.call(e,t,i)}}("",void 0),q="appUqs";class U extends R{uqs(e,t){return m(this,void 0,void 0,function*(){let i,n=localStorage.getItem(q);if(null!==n){let s=JSON.parse(n),{appOwner:r,appName:o,value:a}=s;e===r&&t===o&&(i=a)}if(void 0===i){i=yield this.uqsPure(e,t);let n={appOwner:e,appName:t,value:i};localStorage.setItem(q,JSON.stringify(n))}return this.cachedUqs=s.a.cloneDeep(i)})}uqsPure(e,t){return m(this,void 0,void 0,function*(){return yield this.get("tie/app-uqs",{appOwner:e,appName:t})})}checkUqs(e,t){return m(this,void 0,void 0,function*(){let i=yield this.uqsPure(e,t),{id:n,uqs:r}=this.cachedUqs,{id:o,uqs:a}=i;if(n!==o)return!1;if(r.length!==a.length)return!1;let l=r.length;for(let e=0;e<l;e++)if(!1===s.a.isMatch(r[e],a[e]))return!1;return!0})}unitxUq(e){return m(this,void 0,void 0,function*(){return yield this.get("tie/unitx-uq",{unit:e})})}changePassword(e){return m(this,void 0,void 0,function*(){return yield this.post("tie/reset-password",e)})}}function V(e,t){return m(this,void 0,void 0,function*(){let i=new U("tv/",void 0),n=yield i.uqs(e,t);return i.checkUqs(e,t).then(e=>{!1===e&&(localStorage.removeItem(q),h.nav.start())}),n})}},function(e,t,i){"use strict";var n=i(0),s=i(5),r=i.n(s),o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a{}class l extends a{constructor(e){super(),this.onClick=(()=>o(this,void 0,void 0,function*(){yield this.controller.start()})),this.controller=e,this.icon=e.icon,this.label=e.label}render(e){return n.createElement("div",{className:r()("px-3","py-2","align-items-center","cursor-pointer",e),onClick:this.onClick},this.icon," \xa0 ",this.label)}}i.d(t,"a",function(){return l})},function(e,t,i){"use strict";i.d(t,"c",function(){return r}),i.d(t,"b",function(){return o}),i.d(t,"d",function(){return c}),i.d(t,"a",function(){return u});var n=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let s;function r(e){s=e}function o(e){window.top.postMessage({type:"ws",msg:e},"*")}class a{constructor(){this.handlerSeed=1,this.anyHandlers={},this.msgHandlers={}}onWsReceiveAny(e){let t=this.handlerSeed++;return this.anyHandlers[t]=e,t}onWsReceive(e,t){let i=this.handlerSeed++;return this.msgHandlers[i]={type:e,handler:t},i}endWsReceive(e){delete this.anyHandlers[e],delete this.msgHandlers[e]}receive(e){return n(this,void 0,void 0,function*(){let{$type:t}=e;for(let i in this.anyHandlers)yield this.anyHandlers[i](e);for(let i in this.msgHandlers){let{type:n,handler:s}=this.msgHandlers[i];n===t&&(yield s(e))}})}}let l=1;const c=new class extends a{constructor(){super(...arguments),this.wsBaseId="WsBridge seed "+l++}};class u extends a{constructor(e,t){super(),this.wsBaseId="WSChannel seed "+l++,this.wsHost=e,this.token=t}static setCenterToken(e){u.centerToken=e}connect(){if(void 0!==this.ws)return;let e=this;return new Promise((t,i)=>{let s=new WebSocket(this.wsHost,this.token||u.centerToken);console.log("connect webSocket %s",this.wsHost),s.onopen=(i=>{console.log("webSocket connected %s",this.wsHost),e.ws=s,t()}),s.onerror=(e=>{i("webSocket can't open!")}),s.onmessage=(t=>n(this,void 0,void 0,function*(){return yield e.wsMessage(t)})),s.onclose=(t=>{e.ws=void 0,console.log("webSocket closed!")})})}close(){void 0!==this.ws&&(this.ws.close(),this.ws=void 0)}wsMessage(e){return n(this,void 0,void 0,function*(){try{console.log("websocket message: %s",e.data);let i=JSON.parse(e.data);!function(e){void 0!==s&&s.postMessage({type:"ws",msg:e},"*")}(i),yield this.receive(i)}catch(t){console.log("ws msg error: ",t)}})}sendWs(e){let t=this;this.connect().then(()=>{t.ws.send(e)})}}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});const n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",s=8;function r(){let e=n.length,t="";for(let i=0;i<s;i++)t+=n.charAt(Math.floor(Math.random()*e));return t}},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(0),s=i(5),r=i.n(s),o=i(8);function a(e){let{className:t,style:i,src:s,altImage:a}=e;return s?(!0===s.startsWith(":")&&(s=o.c.resUrl+s.substr(1)),n.createElement("img",{src:s,className:t,style:i,onError:e=>e.currentTarget.src=a})):n.createElement("div",{className:r()(t,"image-none"),style:i},n.createElement("i",{className:"fa fa-file-o"}))}},function(e,t,i){"use strict";i.d(t,"b",function(){return s}),i.d(t,"a",function(){return c});var n=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const s=!1,r="101.200.46.56",o=Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56",REACT_APP_ICON:"http://101.200.46.56/imgs/Bear-icon.png",REACT_APP_ITEM_ICON:"http://101.200.46.56/imgs/Bear-icon.png"}).REACT_APP_RES_HOST||r,a={centerhost:{value:Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56",REACT_APP_ICON:"http://101.200.46.56/imgs/Bear-icon.png",REACT_APP_ITEM_ICON:"http://101.200.46.56/imgs/Bear-icon.png"}).REACT_APP_CENTER_DEBUG_HOST||"localhost:3000",local:!1},reshost:{value:Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56",REACT_APP_ICON:"http://101.200.46.56/imgs/Bear-icon.png",REACT_APP_ITEM_ICON:"http://101.200.46.56/imgs/Bear-icon.png"}).REACT_APP_RES_DEBUG_HOST||"localhost:3015",local:!1},uqhost:{value:Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56",REACT_APP_ICON:"http://101.200.46.56/imgs/Bear-icon.png",REACT_APP_ITEM_ICON:"http://101.200.46.56/imgs/Bear-icon.png"}).REACT_APP_UQ_DEBUG_HOST||"localhost:3015",local:!1},unitxhost:{value:Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56",REACT_APP_ICON:"http://101.200.46.56/imgs/Bear-icon.png",REACT_APP_ITEM_ICON:"http://101.200.46.56/imgs/Bear-icon.png"}).REACT_APP_UQ_DEBUG_HOST||"localhost:3015",local:!1},"uq-build":{value:Object({NODE_ENV:"production",PUBLIC_URL:".",REACT_APP_CENTER_HOST:"101.200.46.56",REACT_APP_ICON:"http://101.200.46.56/imgs/Bear-icon.png",REACT_APP_ITEM_ICON:"http://101.200.46.56/imgs/Bear-icon.png"}).REACT_APP_UQ_DEBUG_BUILDER_HOST||"localhost:3009",local:!1}};const l={method:"GET",mode:"no-cors",headers:{"Content-Type":"text/plain"}};const c=new class{start(){return n(this,void 0,void 0,function*(){!0===s&&(yield this.tryLocal());let e=this.getCenterHost();this.url=function(e){return`http://${e}/`}(e),this.ws=function(e){return`ws://${e}/tv/`}(e),this.resHost=this.getResHost()})}debugHostUrl(e){return`http://${e}/hello`}tryLocal(){return n(this,void 0,void 0,function*(){let e=[],t=[];for(let s in a){let e=a[s],{value:i}=e;t.findIndex(e=>e===i)<0&&t.push(i)}for(let s of t){let t=this.debugHostUrl(s);e.push(d(t))}let i=yield Promise.all(e),n=t.length;for(let s=0;s<n;s++){let e=i[s],n=t[s];for(let t in a){let i=a[t];i.value===n&&(i.local=e)}}})}getCenterHost(){let{value:e,local:t}=a.centerhost;return!0===document.location.hash.includes("sheet_debug")?e:!0===s&&!0===t?e:r}getResHost(){let{value:e,local:t}=a.reshost;return!0===document.location.hash.includes("sheet_debug")?e:!0===s&&!0===t?e:o}getUrlOrDebug(e,t){if(!0!==s)return e;if(!t)return e;for(let i in a){let n=a[i],{value:s,local:r}=n,o=`://${i}/`;if(t.indexOf(o)>0)return!1===r?e:t=t.replace(o,`://${s}/`)}return e}localCheck(e){return n(this,void 0,void 0,function*(){return yield d(e)})}},u=200;function d(e){return n(this,void 0,void 0,function*(){try{return yield function(e){return new Promise((t,i)=>{fetch(e,l).then(e=>{e.text().then(t).catch(i)}).catch(i);const n=new Error("Connection timed out");setTimeout(i,u,n)})}(e),!0}catch(t){return!1}})}},function(e,t,i){"use strict";i.d(t,"b",function(){return r}),i.d(t,"a",function(){return o});var n=i(53),s=i.n(n);function r(e){let t=s()(e);return{id:t.id,name:t.name,guest:t.guest,token:e}}function o(e){return{id:0,guest:s()(e).guest,token:e}}},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(8),s=i(3),r=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a{constructor(e,t,i,n){this.isChanged=!1,this.itemSchema=e,this.uiItem=t,this.value=n;let{name:s}=e;this.name=s,this.label=i}start(){return o(this,void 0,void 0,function*(){return yield this.internalStart()})}end(){return o(this,void 0,void 0,function*(){yield this.internalEnd()})}internalEnd(){return o(this,void 0,void 0,function*(){n.c.pop()})}verifyValue(){if(void 0===this.uiItem)return;let{rules:e}=this.uiItem;if(void 0===e)return;let t=this.newValue;function i(e,i){let n=e(t);if(void 0!==n)return"object"!==typeof n?n:JSON.stringify(n)}if(Array.isArray(e))for(let n of e){let e=i(n);if(void 0!==e){this.error=e;break}}else this.error=i(e)}}r([s.l],a.prototype,"error",void 0),r([s.l],a.prototype,"isChanged",void 0)},function(e,t,i){"use strict";i.d(t,"a",function(){return r});const n="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",s=8;function r(){let e=n.length,t="";for(let i=0;i<s;i++)t+=n.charAt(Math.floor(Math.random()*e));return t}},function(e,t,i){"use strict";var n=i(6),s=i.n(n),r=i(7),o=i(0),a=i.n(o),l=i(2),c=i(1),u=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class d extends r.b{constructor(){super(...arguments),this.onNew=(()=>this.event("new")),this.onList=(()=>this.event("list")),this.onSearch=(e=>u(this,void 0,void 0,function*(){return this.event("list",e)}))}open(e){return u(this,void 0,void 0,function*(){this.openPage(this.view)})}entityRender(e,t){return e.render()}entityClick(e){return u(this,void 0,void 0,function*(){yield e.onClick()})}get view(){let e,t,{label:i,proxyLinks:n,isFrom:s}=this.controller;if(!1===s&&(e=o.createElement("button",{className:"btn btn-outline-success ml-2",onClick:this.onNew},"\u65b0\u589e")),void 0===n){let n=o.createElement(o.Fragment,null,e,o.createElement("button",{className:"btn btn-outline-info ml-2",onClick:this.onList},"\u5168\u90e8"));t=o.createElement(l.LMR,{className:"m-3",right:n},o.createElement(l.SearchBox,{className:"w-100",size:"md",onSearch:this.onSearch,placeholder:"\u641c\u7d22"+i}))}else t=o.createElement(l.List,{className:"my-2",header:o.createElement(l.Muted,null,i," \u4ee3\u7406\u4e0b\u5217Tuid"),items:n,item:{render:this.entityRender,onClick:this.entityClick}});return()=>o.createElement(c.Page,{header:i},t)}}var h=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class m extends r.b{constructor(){super(...arguments),this.next=(()=>h(this,void 0,void 0,function*(){this.vForm.reset(),this.closePage()})),this.finish=(()=>{this.closePage(2),this.event("edit-end")}),this.onSubmit=(()=>h(this,void 0,void 0,function*(){let e=this.vForm.getValues(),t=yield this.controller.entity.save(this.id,e),{id:i}=t;if(i<0){let{unique:e}=this.controller.entity;if(void 0!==e)for(let t of e)this.vForm.setError(t,"\u4e0d\u80fd\u91cd\u590d")}else{if(this.controller.isCalling)return this.returnCall(i),void this.closePage();this.openPageElement(o.createElement(c.Page,{header:this.label+"\u63d0\u4ea4\u6210\u529f",back:"none"},o.createElement("div",{className:"m-3"},o.createElement("span",{className:"text-success"},o.createElement(l.FA,{name:"check-circle",size:"lg"})," \u6210\u529f\u63d0\u4ea4\uff01"),o.createElement("div",{className:"mt-5"},o.createElement("button",{className:"btn btn-primary mr-3",onClick:this.next},"\u7ee7\u7eed\u5f55\u5165"),o.createElement("button",{className:"btn btn-outline-primary",onClick:this.finish},"\u4e0d\u7ee7\u7eed"))))),this.event("item-changed",{id:this.id,values:e})}}))}open(e){return h(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e),void 0!==e&&(this.id=e.id),this.openPage(this.editView)})}get editView(){return()=>o.createElement(c.Page,{header:(void 0===this.id?"\u65b0\u589e":"\u7f16\u8f91")+" - "+this.label},this.vForm.render("py-3"))}resetForm(){this.vForm.reset()}}var p=i(9),f=i(4),v=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class g extends r.b{constructor(){super(...arguments),this.mainView=Object(f.a)(()=>{let e=a.a.createElement(l.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearchMain,placeholder:"\u641c\u7d22"+this.label});return a.a.createElement(c.Page,{header:e,back:"close"},a.a.createElement(l.List,{items:this.controller.PageItems.items,item:{render:this.renderMainRow,onClick:this.clickMainRow},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))}),this.onSearchMain=(e=>v(this,void 0,void 0,function*(){yield this.controller.searchMain(e)})),this.renderMainRow=((e,t)=>a.a.createElement(this.mainRowContent,Object.assign({},e))),this.clickMainRow=(e=>v(this,void 0,void 0,function*(){this.ceasePage(),void 0!==this.controller.entity.owner?yield this.showDiv(this.entity.getIdFromObj(e)):this.returnCall(e)})),this.divView=(e=>a.a.createElement(c.Page,{header:"\u9009\u62e9Div"},a.a.createElement(l.List,{items:e.items,item:{render:this.renderDivRow,onClick:this.clickDivRow}}))),this.renderDivRow=((e,t)=>a.a.createElement(this.divRowContent,Object.assign({},e))),this.clickDivRow=(e=>{this.ceasePage(),this.returnCall(e)})}open(e){return v(this,void 0,void 0,function*(){void 0===e?yield this.showMain(e):yield this.showDiv(e)})}showMain(e){return v(this,void 0,void 0,function*(){this.mainRowContent=this.ui.rowContent||p.c,yield this.controller.searchMain(e),this.openPage(this.mainView)})}showDiv(e){return v(this,void 0,void 0,function*(){let{divs:t}=this.ui;void 0!==t&&(this.divRowContent=t[this.entity.name].rowContent),void 0===this.divRowContent&&(this.divRowContent=p.c);let i=yield this.controller.getDivItems(e);this.openPage(this.divView,{items:i})})}}var y=i(11),b=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class w extends r.b{constructor(){super(...arguments),this.next=(()=>b(this,void 0,void 0,function*(){this.vForm.reset(),this.closePage()})),this.finish=(()=>{this.closePage(2)}),this.onSubmit=(()=>b(this,void 0,void 0,function*(){let e=this.vForm.getValues(),t=yield this.entity.save(this.id,e);t&&alert("\u8fd9\u91cc\u8fd8\u8981\u5224\u65ad\u8fd4\u56de\u503c\uff0c\u5148\u4e0d\u5904\u7406\u4e86 \n"+Object(y.a)(t)),this.openPage(()=>o.createElement(c.Page,{header:this.label+"\u63d0\u4ea4\u6210\u529f",back:"none"},o.createElement("div",{className:"m-3"},o.createElement("span",{className:"text-success"},o.createElement(l.FA,{name:"check-circle",size:"lg"})," \u6210\u529f\u63d0\u4ea4\uff01"),o.createElement("div",{className:"mt-5"},o.createElement("button",{className:"btn btn-primary mr-3",onClick:this.next},"\u7ee7\u7eed\u5f55\u5165"),o.createElement("button",{className:"btn btn-outline-primary",onClick:this.finish},"\u4e0d\u7ee7\u7eed")))))})),this.view=(()=>o.createElement(c.Page,{header:this.label},this.vForm.render("py-3")))}buildForm(e){this.vForm=this.createForm(void 0,e)}open(e){return b(this,void 0,void 0,function*(){this.buildForm(e),this.openPage(this.view)})}render(e){return this.buildForm(e),this.vForm.render()}loadId(e){return b(this,void 0,void 0,function*(){this.id=e})}resetForm(){this.vForm.reset()}}class E extends w{}var x=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class C extends c.PageItems{constructor(e){super(!0),this.tuid=e}load(e,t,i){return x(this,void 0,void 0,function*(){return yield this.tuid.search(e,t,i)})}setPageStart(e){this.pageStart=void 0===e?0:e.id}}var k=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class P extends r.b{constructor(){super(...arguments),this.onSearch=(e=>k(this,void 0,void 0,function*(){yield this.controller.searchMain(e)})),this.renderRow=((e,t)=>o.createElement(this.rowContent,Object.assign({},e))),this.clickRow=(e=>{this.callOnSelected(e)}),this.rowKey=(e=>{let{id:t}=e;return t}),this.view=Object(f.a)(()=>{let e,t=o.createElement(l.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearch,placeholder:"\u641c\u7d22"+this.label}),{owner:i}=this.entity;if(void 0!==i){let t=i.valueFromId(this.ownerId);e=o.createElement("div",null,"owner: ",Object(y.a)(t))}return o.createElement(c.Page,{header:t},e,o.createElement(l.List,{items:this.controller.PageItems.items,item:{render:this.renderRow,onClick:this.clickRow,key:this.rowKey},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))})}open(e){return k(this,void 0,void 0,function*(){this.rowContent=this.ui.rowContent||p.c,void 0!==this.entity.owner&&(this.ownerId=Number(e)),yield this.controller.searchMain(""),this.openPage(this.view)})}callOnSelected(e){void 0!==this.onSelected?this.onSelected(e):alert("onSelect is undefined")}}class N extends P{onSelected(e){return k(this,void 0,void 0,function*(){!1===this.controller.isFrom?this.event("edit",e.id):this.event("info",e.id)})}}var S=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class A extends r.a{buildPageItems(){return new C(this.entity.owner||this.entity)}searchMain(e){return S(this,void 0,void 0,function*(){void 0===this.PageItems&&(this.PageItems=this.buildPageItems()),void 0!==e&&(yield this.PageItems.first(e))})}getDivItems(e){return S(this,void 0,void 0,function*(){return yield this.entity.searchArr(e,void 0,0,1e3)})}}class R extends A{constructor(e,t,i,n){if(super(e,t,i,n),void 0!==this.proxies){this.proxyLinks=[];for(let e in this.proxies){let t=this.cUq.linkFromName("tuid",e);this.proxyLinks.push(t)}}}from(){let e=this.entity.cFrom();return void 0===e?this:e}cUqFrom(){return this.entity.cUqFrom()}cEditFrom(){return this.entity.cUqFrom().cTuidEditFromName(this.entity.name)}cInfoFrom(){return this.entity.cUqFrom().cTuidInfoFromName(this.entity.name)}cSelectFrom(){return this.entity.cUqFrom().cTuidSelectFromName(this.entity.name)}getLable(e){if(e===this.entity)return this.label;let{name:t}=e,{arrs:i}=this.res;if(void 0!==i){let e=i[t];if(void 0!==e){let t=e.label;if(void 0!==t)return t}}return t}get VTuidMain(){return d}get VTuidEdit(){return m}get VTuidList(){return N}internalStart(e){return S(this,void 0,void 0,function*(){this.isFrom=void 0!==this.entity.schemaFrom,yield this.openVPage(this.VTuidMain)})}onEvent(e,t){return S(this,void 0,void 0,function*(){switch(e){default:return;case"new":yield this.onNew();break;case"list":yield this.onList();break;case"edit":return void(yield this.onEdit(t));case"item-changed":return void this.itemChanged(t);case"info":let i=new U(this.cUq,this.entity,this.ui,this.res);return void(yield i.start(t))}})}edit(e){return S(this,void 0,void 0,function*(){let t=this.ui&&this.ui.CTuidEdit;void 0===t?yield this.openVPage(this.VTuidEdit,e):yield new t(this.cUq,this.entity,this.ui,this.res).start(e)})}onNew(){return S(this,void 0,void 0,function*(){yield this.edit(void 0)})}onList(){return S(this,void 0,void 0,function*(){let e=this.ui&&this.ui.CTuidList;void 0===e?yield this.openVPage(this.VTuidList,void 0):yield new e(this.cUq,this.entity,this.ui,this.res).start(void 0)})}onEdit(e){return S(this,void 0,void 0,function*(){let t=void 0;void 0!==e&&(t=yield this.entity.load(e)),this.edit(t)})}itemChanged({id:e,values:t}){if(void 0===this.PageItems)return;let i=this.PageItems.items.find(t=>t.id===e);void 0!==i&&s.a.merge(i,t)}}class O extends R{internalStart(e){return S(this,void 0,void 0,function*(){this.isFrom=void 0!==this.entity.schemaFrom,yield this.openVPage(this.VTuidMain)})}}class F extends R{internalStart(e){return S(this,void 0,void 0,function*(){this.isFrom=void 0!==this.entity.schemaFrom,"number"===typeof e?yield this.onEdit(e):yield this.edit(e)})}edit(e){return S(this,void 0,void 0,function*(){yield this.openVPage(this.VTuidEdit,e)})}}class I extends R{internalStart(e){return S(this,void 0,void 0,function*(){this.isFrom=void 0!==this.entity.schemaFrom,yield this.openVPage(this.VTuidList)})}}class q extends A{internalStart(e){return S(this,void 0,void 0,function*(){yield this.openVPage(this.VTuidSelect,e)})}beforeStart(){return S(this,void 0,void 0,function*(){return yield this.entity.loadSchema(),void 0!==this.PageItems&&this.PageItems.reset(),!0})}get VTuidSelect(){return g}idFromItem(e){return e.id}}class U extends A{internalStart(e){return S(this,void 0,void 0,function*(){let t=yield this.entity.load(e);yield this.openVPage(this.VTuidInfo,t)})}get VTuidInfo(){return E}}i.d(t,"d",function(){return O}),i.d(t,"a",function(){return F}),i.d(t,"c",function(){return I}),i.d(t,"e",function(){return q}),i.d(t,"b",function(){return U})},function(e,t,i){"use strict";var n=i(0),s=i.n(n),r=i(4);class o{constructor(e){this.view=(()=>n.createElement("div",null)),this.label=e}render(){return n.createElement("div",{key:this.key,className:"px-3"},n.createElement("div",{className:"form-group row"},n.createElement("label",{className:"col-sm-2 col-form-label"},this.label),n.createElement("div",{className:"col-sm-10"},this.renderContent())))}setAddRow(e){}get key(){return this.label}getVFields(){}getVArr(){}getVSubmit(){}renderContent(){return n.createElement("div",{className:"form-control form-control-plaintext bg-white border border-info rounded "},"content")}}class a extends o{constructor(e,t){super(e),this.vField=t}get key(){return this.vField.name}getVFields(){return[this.vField]}renderContent(){return this.vField.render()}}class l extends o{constructor(e,t){super(e),this.vArr=t}setAddRow(e){this.vArr.setAddRow(e)}get key(){return this.vArr.name}getVArr(){return this.vArr}render(){return n.createElement(n.Fragment,{key:this.key},this.vArr&&this.vArr.render())}}class c extends o{constructor(e){super(void 0),this.vSubmit=e}get key(){return"$submit"}getVSubmit(){return this.vSubmit}render(){return n.createElement("div",{key:"$submit",className:"px-3"},n.createElement("div",{className:"form-group row"},n.createElement("div",{className:"offset-sm-2 col-sm-10"},this.vSubmit.render())))}}var u=i(9),d=i(3),h=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},m=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class p extends u.d{constructor(e){super(),this.onClickSubmit=(()=>m(this,void 0,void 0,function*(){this.vForm.submit()})),this.view=Object(r.a)(()=>{let{isOk:e}=this.vForm;return n.createElement("button",{type:"button",onClick:this.onClickSubmit,className:this.className,disabled:!1===e},this.caption)}),this.vForm=e,this.caption=this.vForm.submitCaption,this.className="btn btn-primary w-25"}}h([d.l],p.prototype,"caption",void 0),h([d.l],p.prototype,"className",void 0);var f=i(5),v=i.n(f),g=i(2);class y{}class b extends y{check(e,t){switch(typeof t){default:case"boolean":return;case"object":if(null!==t)return;break;case"string":if(t.trim().length>0)return;break;case"number":if(NaN!==t)return;break;case"undefined":}e.push("\u4e0d\u80fd\u4e3a\u7a7a")}}class w extends y{check(e,t){if(void 0===t||null===t)return;NaN===Number(t)&&e.push("\u5fc5\u987b\u662f\u6570\u5b57")}}class E extends y{check(e,t){if(void 0===t||null===t)return;let i=Number(t);!0!==Number.isNaN(i)&&!1!==Number.isInteger(i)||e.push("\u5fc5\u987b\u662f\u6574\u6570")}}class x extends w{constructor(e){super(),this.min=e}check(e,t){super.check(e,t),Number(t)<this.min&&e.push("\u4e0d\u80fd\u5c0f\u4e8e"+this.min)}}class C extends w{constructor(e){super(),this.max=e}check(e,t){super.check(e,t),Number(t)>this.max&&e.push("\u4e0d\u80fd\u5c0f\u4e8e"+this.max)}}var k=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};class P extends u.d{constructor(e,t,i,n){super(),this.form=e,this.field=t,this.name=t.name,this.fieldUI=i||{},this.fieldRes=n||{},this.init()}init(){this.buildRules()}buildRules(){this.rules=[];let{required:e}=this.fieldUI;(!0===e||void 0!==this.field&&!1===this.field.null)&&this.rules.push(new b)}get checkRules(){let e=[];for(let t of this.rules)t.check(e,this.value);return e}get isOk(){if(0===this.rules.length)return!0;return 0===this.checkRules.length}get value(){return this.form.values[this.name]}setValue(e){this.form.values[this.name]=e}get error(){return this.form.errors[this.name]}set error(e){this.form.errors[this.name]=e}parse(e){return e}get readonly(){let{mode:e}=this.form;return e===K.readonly||e===K.edit&&!1===this.fieldUI.editable}}k([d.e],P.prototype,"checkRules",null),k([d.e],P.prototype,"isOk",null),k([d.e],P.prototype,"value",null);class N extends P{constructor(){super(...arguments),this.renderError=(e=>{let{errors:t}=this.form,i=t[this.name];if(void 0!==i)return n.createElement("div",{className:e},n.createElement(g.FA,{name:"exclamation-circle"})," ",i)}),this.ref=(e=>{this.input=e,this.setInputValue()}),this.onFocus=(()=>{this.error=void 0}),this.onBlur=(()=>{let e=this.checkRules;e.length>0&&(this.error=e[0]),this.form.computeFields()}),this.onChange=(e=>{let t=this.parse(e.currentTarget.value);null!==t&&this.setValue(t)}),this.view=Object(r.a)(()=>{let e,t,i,{required:s}=this.fieldUI,{placeHolder:r,suffix:o}=this.fieldRes,a=["form-control","form-control-input"];return!0===this.readonly?t=n.createElement("input",{className:v()(a,"bg-light"),ref:this.ref,type:this.inputType,readOnly:!0}):(t=n.createElement("input",{className:v()(a),ref:this.ref,type:this.inputType,onFocus:this.onFocus,onBlur:this.onBlur,onChange:this.onChange,placeholder:r,readOnly:!1,maxLength:this.maxLength,onKeyPress:this.onKeyPress}),!0!==s&&!1!==this.field.null||(e=n.createElement(S,null))),i=void 0===o?t:n.createElement("div",{className:"input-group"},t,n.createElement("div",{className:"input-group-append"},n.createElement("span",{className:"input-group-text"},o))),n.createElement(n.Fragment,null,e,i,this.renderError("text-danger small mt-1 mx-2"))})}get maxLength(){}setValue(e){super.setValue(e),this.setInputValue()}setInputValue(){if(!this.input)return;let e=this.value;this.input.value=null===e||void 0===e?"":e}}const S=()=>n.createElement("b",{style:{color:"red",position:"absolute",left:"0.1em",top:"0.5em"}},"*");class A extends N{constructor(){super(...arguments),this.inputType="text"}get maxLength(){return this.field.size}}const R=45,O=46;class F extends N{constructor(){super(...arguments),this.inputType="number",this.onKeyPress=(e=>{let t=e.charCode;if(!(8===t||0===t||13===t||t>=48&&t<=57))if(void 0!==this.extraChars&&this.extraChars.indexOf(t)>=0)switch(t){case O:this.onKeyDot();break;case R:this.onKeyNeg(),e.preventDefault()}else e.preventDefault()})}init(){if(super.init(),this.extraChars=[],void 0!==this.fieldUI){let{min:e,max:t}=this.fieldUI;void 0!==e?e<0&&this.extraChars.push(R):this.extraChars.push(R)}switch(this.field.type){case"dec":case"bigint":case"int":case"smallint":case"tinyint":this.extraChars.push(O)}}buildRules(){super.buildRules(),this.rules.push(new w);let{min:e,max:t}=this.fieldUI;void 0!==e&&this.rules.push(new x(e)),void 0!==t&&this.rules.push(new C(t))}parse(e){try{if(0===e.trim().length)return;let i=Number(e);return NaN===i?null:i}catch(t){return null}}setInputValue(){if(!this.input)return;let e=this.value;this.parse(this.input.value)!=e&&(this.input.value=null===e||void 0===e?"":e)}onKeyDot(){let e=this.input.value;e.indexOf(".")>=0&&(this.input.value=e.replace(".",""))}onKeyNeg(){let e=this.input.value,t=e.indexOf("-");e=t>=0?e.replace("-",""):"-"+e,this.input.value=e}}class I extends F{buildRules(){super.buildRules(),this.rules.push(new E)}}class q extends F{}class U extends A{}class V extends A{}class j extends A{}class T extends P{constructor(e,t,i){super(e,t,void 0,i),this.view=Object(r.a)(()=>{let e=this.form.values[this.field.name],{placeHolder:t,suffix:i}=this.fieldRes;null===e&&(e="");let n,r=s.a.createElement("input",{className:"form-control form-control-input bg-light",type:"text",placeholder:t,readOnly:!0,value:e});return n=void 0===i?r:s.a.createElement("div",{className:"input-group"},r,s.a.createElement("div",{className:"input-group-append"},s.a.createElement("span",{className:"input-group-text"},i)))})}}var L=i(6),M=i.n(L),D=i(1),_=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class B extends u.d{constructor(e,t,i){super(),this.rowPage=(()=>n.createElement(D.Page,{header:this.label,back:"close"},this.vForm.render("py-3"))),this.onSubmit=(()=>_(this,void 0,void 0,function*(){let{valueBoxs:e}=this.vForm;yield this.onRowChanged(e)})),this.onRowChanged=(e=>_(this,void 0,void 0,function*(){void 0===this.rowValues?(e.$owner=this.ownerForm.values,this.list.push(e),void 0===this.onEditRow?this.vForm.reset():yield this.onEditRow(void 0,this.onRowChanged)):(M.a.merge(this.rowValues,e),void 0===this.onEditRow&&D.nav.pop())})),this.renderItem=((e,t)=>void 0===this.rowContent?n.createElement("div",{className:"px-3 py-2"},n.createElement(u.a,Object.assign({},e))):n.createElement(this.rowContent,Object.assign({},e))),this.showRow=(e=>_(this,void 0,void 0,function*(){void 0===this.onEditRow?(this.vForm.reset(),void 0!==e&&this.vForm.setValues(e),D.nav.push(n.createElement(this.rowPage,null))):yield this.onEditRow(e,this.onRowChanged)})),this.editRow=(e=>_(this,void 0,void 0,function*(){this.rowValues=e;let{vSubmit:t}=this.vForm;void 0!==t&&(t.caption=this.editSubmitCaption,t.className="btn btn-outline-success"),this.vForm.mode=this.ownerForm.mode,yield this.showRow(e)})),this.internalAddRow=(()=>_(this,void 0,void 0,function*(){this.rowValues=void 0;let{vSubmit:e}=this.vForm;e.caption=this.newSubmitCaption,e.className="btn btn-outline-success",this.vForm.reset(),this.vForm.mode=K.new,yield this.showRow(void 0)})),this.view=(()=>{let e;void 0===this.addRow&&this.mode===K.readonly||(e=n.createElement("button",{onClick:this.addRow||this.internalAddRow,type:"button",className:"btn btn-link p-0"},this.ownerForm.arrTitleNewButton));let t=this.header||n.createElement("div",{className:"px-3 bg-light small",style:{paddingTop:"1px",paddingBottom:"1px"}},n.createElement("div",{className:"flex-fill align-self-center"},this.label),e);return n.createElement(g.List,{className:"pb-3",header:t,none:n.createElement(g.Muted,{className:"px-3 py-2"},this.none),items:this.list,item:{render:this.renderItem,onClick:this.editRow}})}),this.ownerForm=e;let{name:s,fields:r}=t;this.name=s;let{ui:o,res:a,mode:l,inputs:c,values:d}=e,h=a.arrs,m=void 0!==h?h[s]:{},{label:p,none:f,newSubmit:v,editSubmit:y}=m;this.none=f||e.none,this.newSubmitCaption=v||e.arrNewCaption,this.editSubmitCaption=y||e.arrEditCaption,this.label=p||s;let b=o&&o.items[s]||{};this.rowContent=b.rowContent,this.mode=l,void 0===this.onEditRow?this.vForm=new Y({fields:r,arrs:void 0,ui:b,res:m,inputs:c[s],none:e.none,submitCaption:"submit",arrNewCaption:void 0,arrEditCaption:void 0,arrTitleNewButton:void 0,mode:l},l===K.readonly?void 0:this.onSubmit):this.onEditRow=i,this.list=d[s]}reset(){this.vForm.reset(),this.list.clear()}setAddRow(e){this.addRow=e}}var H=i(11),$=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const z={textAlign:"left",paddingLeft:"0.75rem",paddingRight:"0.75rem",overflow:"hidden"};class W extends P{constructor(e,t,i,s){super(e,t,i,s),this.onClick=(()=>$(this,void 0,void 0,function*(){if(!0===this.readonly){if(!this.value)return;return void(yield this.tuid.showInfo(this.value.id))}let e;void 0!==this.input?e=yield this.input.select(this.vForm,this.field,this.vForm.getValues()):(alert("call undefined"),e=0),this.setValue(this.tuid.boxId(e))})),this.view=Object(r.a)(()=>{let e,t,{placeHolder:i}=this.fieldRes,s=!1,{_ownerField:r}=this.field;if(void 0!==r){let{name:e,arr:t}=r;s=null===this.vForm.getValue(e)}if(null===this.value)e=n.createElement(n.Fragment,null,i||this.input.placeHolder);else if("object"===typeof this.value)e=Object(H.b)(this.value);else{let t=this.tuid.boxId(this.value);e=Object(H.b)(t)}if(!0===this.readonly)return n.createElement("div",{className:"form-control form-control-plaintext border border-info rounded bg-light cursor-pointer",onClick:this.onClick},e);let{required:o}=this.fieldUI;return!0!==o&&!1!==this.field.null||(t=n.createElement(S,null)),n.createElement(n.Fragment,null,t,n.createElement("button",{className:"form-control btn btn-outline-info",type:"button",disabled:s,style:z,onClick:this.onClick},e))}),this.tuid=t._tuid,this.vForm=e,this.input=e.inputs[t.name]}}class Q{constructor(e,t,i){this.vForm=e,this.onSubmit=i;let{fields:n,arrs:s,ui:r,res:o}=t;if(this.fields=n,this.arrs=s,void 0!==r){let{items:e,layout:t}=r;this.formItems=e,this.layout=t}this.res=o}build(){return void 0===this.layout?this.bandsOnFly():this.bandsFromLayout()}resFromName(e,t){if(void 0===t)return;let{fields:i}=t;return void 0!==i?i[e]||e:void 0}bandsOnFly(){let e=[];if(this.bandsFromFields(e,this.fields,this.res),void 0!==this.arrs)for(let t of this.arrs)e.push(this.bandFromArr(t));return void 0!==this.onSubmit&&e.push(new c(new p(this.vForm))),e}bandsFromFields(e,t,i){if(void 0!==t)for(let n of t)e.push(this.bandFromField(n,i))}bandsFromLayout(){return[]}bandFromField(e,t){let i,n,s,r,{name:o}=e,l=this.resFromName(o,t);return"object"===typeof l?(n=l.label,i=l):(n=l,i=void 0),void 0!==this.formItems&&(r=this.formItems[o]),void 0===(s="function"===typeof r?new T(this.vForm,e,i):function(e,t,i,n){let s;switch(t.type){default:return;case"tinyint":case"smallint":case"int":s=I;break;case"bigint":let{_tuid:e}=t;if(void 0!==e)return;s=I;break;case"dec":s=q;break;case"char":s=A;break;case"text":s=U;break;case"datetime":s=V;break;case"date":s=j}return new s(e,t,i,n)}(this.vForm,e,r,i))&&(s=new W(this.vForm,e,r,i)),new a(n||o,s)}bandFromArr(e){let{name:t,fields:i}=e,n=new B(this.vForm,e);return new l(t,n)}}var K,G=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},J=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};!function(e){e[e.new=0]="new",e[e.edit=1]="edit",e[e.readonly=2]="readonly"}(K||(K={}));class Y{constructor(e,t){this.vFields={},this.vArrs={},this.onFormSubmit=(e=>(e.preventDefault(),!1)),this.view=Object(r.a)(({className:e})=>n.createElement("form",{className:e,onSubmit:this.onFormSubmit},this.bands.map(e=>e.render())));let{fields:i,arrs:s,ui:o,res:a,inputs:l,none:c,submitCaption:u,arrNewCaption:d,arrEditCaption:h,arrTitleNewButton:m,mode:p}=e;this.fields=i,this.arrs=s,this.ui=o,void 0!==this.ui&&(this.formItems=this.ui.items),this.res=a,this.inputs=l,this.none=c,this.submitCaption=u,this.arrNewCaption=d,this.arrEditCaption=h,this.arrTitleNewButton=m||n.createElement("small",null,n.createElement(g.FA,{name:"plus"})," \u65b0\u589e"),this.mode=void 0===t?K.readonly:p,this.buildFormValues(),this.buildBands(e,t),this.onSubmit=t}buildBands(e,t){this.bandColl={};let i=new Q(this,e,t);this.bands=i.build();for(let n of this.bands){this.bandColl[n.key]=n;let e=n.getVFields();if(void 0!==e)for(let n of e)this.vFields[n.name]=n;let t=n.getVArr();void 0!==t&&(this.vArrs[t.name]=t);let i=n.getVSubmit();void 0!==i&&(this.vSubmit=i)}}getBand(e){return this.bandColl[e]}computeFields(){if(void 0===this.formItems)return;let e=this.values;for(let t in this.formItems){let i=this.formItems[t];"function"===typeof i&&(e[t]=i.call(this,e))}}submit(){return J(this,void 0,void 0,function*(){void 0!==this.onSubmit&&(yield this.onSubmit())})}getValues(){let e={},t=this.values;for(let i of this.fields){let{name:n}=i,s=t[n];e[n]=null!==s&&"object"===typeof s?s.id:s}if(void 0!==this.arrs)for(let i of this.arrs){let{name:t,fields:n,id:s,order:r}=i,o=e[t]=[],a=this.vArrs[t].list;for(let e of a){let t={};void 0!==s&&(t[s]=e[s]),void 0!==r&&(t[r]=e[r]);for(let i of n){let{name:n}=i,s=e[n];t[n]=null!==s&&"object"===typeof s?s.id:s}o.push(t)}}return e}get valueBoxs(){let e={},t=this.values;for(let i of this.fields){let{name:n,_tuid:s}=i,r=t[n];e[n]=void 0===s||"object"===typeof r?r:s.boxId(r)}if(void 0===this.arrs)return e;for(let i of this.arrs){let{name:t,fields:n,id:s,order:r}=i,o=e[t]=this.vArrs[t].list.slice();for(let e of o)for(let t of n){let{name:i,_tuid:n}=t,s=e[i];e[i]=void 0===n||"object"===typeof s?s:n.boxId(s)}}return e}setValues(e){if(void 0===e)return void this.reset();let t=this.values,i=this.errors;for(let n of this.fields){let s=n.name;i[s]=void 0;let r=e[s];t[s]=r}for(let n in this.vArrs){let i=e[n];if(void 0===i)continue;let s=t[n];s.clear(),s.push(...i)}}get isOk(){for(let e in this.vFields)if(!1===this.vFields[e].isOk)return!1;return!0}reset(){let e=this.values,t=this.errors;for(let i of this.fields){let n=i.name;e[n]=null,t[n]=void 0}for(let i in this.vFields){let e=this.vFields[i];void 0!==e.name&&e.setValue(null)}for(let i in this.vArrs){this.vArrs[i].reset()}}getValue(e){return this.values[e]}setValue(e,t){this.values[e]=t}setError(e,t){this.errors[e]=t}buildFieldValues(e){let t={valueFromFieldName:function(e){return this[e]}};for(let i of e){t[i.name]=null}return t}buildObservableValues(){let e=this.buildFieldValues(this.fields);if(void 0!==this.arrs)for(let t of this.arrs)e[t.name]=d.l.array([],{deep:!0});return Object(d.l)(e)}buildFormValues(){this.values=this.buildObservableValues(),this.errors=Object(d.l)(this.buildFieldValues(this.fields))}render(e="py-3"){return n.createElement(this.view,{className:e})}}G([d.e],Y.prototype,"isOk",null),i.d(t,"a",function(){return K}),i.d(t,"b",function(){return Y})},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(13),s=i(8),r=i(21),o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a{constructor(e,t,i,n){this.startWait=(()=>{void 0!==this.ui&&this.ui.startWait()}),this.endWait=((e,t)=>{void 0!==this.ui&&this.ui.endWait(),void 0!==t&&t("\u8bbf\u95eewebapi\u8d85\u65f6 "+e)}),this.showError=(e=>o(this,void 0,void 0,function*(){void 0!==this.ui&&(yield this.ui.showError(e))})),this.isCenter=e,this.hostUrl=t,this.apiToken=i,this.ui=n,this.timeout=!0===r.b?5e5:5e3}used(){this.post("",{})}get(e,t){return o(this,void 0,void 0,function*(){if(t){let i=Object.keys(t);if(i.length>0){let n="?";for(let s of i){void 0!==t[s]&&(e+=n+s+"="+t[s],n="&")}}}let i=this.buildOptions();return i.method="GET",yield this.innerFetch(e,i)})}post(e,t){return o(this,void 0,void 0,function*(){let i=this.buildOptions();return i.method="POST",i.body=JSON.stringify(t),yield this.innerFetch(e,i)})}put(e,t){return o(this,void 0,void 0,function*(){let i=this.buildOptions();return i.method="PUT",i.body=JSON.stringify(t),yield this.innerFetch(e,i)})}delete(e,t){return o(this,void 0,void 0,function*(){let i=this.buildOptions();return i.method="DELETE",i.body=JSON.stringify(t),yield this.innerFetch(e,i)})}fetch(e,t,i,n){return o(this,void 0,void 0,function*(){let r=this;this.startWait();let a=e;function l(e){return{channel:r,url:a,options:t,resolve:i,reject:n,error:e}}try{console.log("%s %s",t.method,a);let u=setTimeout(()=>r.endWait(e,n),this.timeout),d=yield fetch(encodeURI(a),t);if(!1===d.ok)throw clearTimeout(u),r.endWait(),console.log("call error %s",d.statusText),d.statusText;let h=d.headers.get("content-type");if(h&&h.indexOf("json")>=0)return d.json().then(e=>o(this,void 0,void 0,function*(){if(clearTimeout(u),r.endWait(),!0===e.ok)return i(e.res);void 0===e.error?yield r.showError(l("not valid tonva json")):(yield r.showError(l(e.error)),n(e.error))})).catch(e=>o(this,void 0,void 0,function*(){yield r.showError(l(e.message))}));{let e=yield d.text();clearTimeout(u),r.endWait(),i(e)}}catch(c){if("string"===typeof c&&!0===c.toLowerCase().startsWith("unauthorized"))return void s.c.logout();yield this.showError(l(c.message))}})}innerFetch(e,t){return o(this,void 0,void 0,function*(){let i=this.hostUrl+e;return!0===this.isCenter&&void 0===this.apiToken&&Object(n.h)()?yield Object(n.d)(i,t.method,t.body):yield new Promise((e,n)=>o(this,void 0,void 0,function*(){yield this.fetch(i,t,e,n)}))})}callFetch(e,t,i){return o(this,void 0,void 0,function*(){let n=this.buildOptions();return n.method=t,n.body=i,yield new Promise((t,i)=>o(this,void 0,void 0,function*(){yield this.fetch(e,n,t,i)}))})}buildOptions(){let{language:e,culture:t}=s.c,i=new Headers;i.append("Content-Type","application/json;charset=UTF-8");let n=e;return t&&(n+="-"+t),i.append("Accept-Language",n),this.apiToken&&i.append("Authorization",this.apiToken),{headers:i}}}},,function(e,t,i){"use strict";i.d(t,"b",function(){return r}),i.d(t,"a",function(){return o});var n=i(6),s=i.n(n);const r={lang:void 0,district:void 0};function o(e){let{lang:t,district:i}=r,n={};if(void 0===e)return n;s.a.merge(n,e._);let o=e[t];if(void 0===o)return n;s.a.merge(n,o._);let a=o[i];if(void 0===a)return n;s.a.merge(n,a);let{entity:l}=n;if(void 0!==l)for(let s in l)l[s.toLowerCase()]=l[s];return n}!function(){let e,t,i=navigator.languages&&navigator.languages[0]||navigator.language;if(i){let n=i.split("-");e=n[0],n.length>1&&(t=n[1])}else e="zh",t="CN";!function(e,t){r.lang=e,r.district=t}(e,t)}()},function(e,t,i){"use strict";var n=i(43);i.d(t,"CApp",function(){return n.a});i(76);var s=i(48);i.d(t,"CUq",function(){return s.a});i(50);var r=i(25);i.d(t,"CTuidSelect",function(){return r.e});i(47);var o=i(36);i.d(t,"QueryPageItems",function(){return o.c});var a=i(49);i.d(t,"CMap",function(){return a.a}),i.d(t,"VMapMain",function(){return a.b});i(51),i(52);var l=i(9);i.d(t,"PureJSONContent",function(){return l.b});i(26);var c=i(77);i.o(c,"CLink")&&i.d(t,"CLink",function(){return c.CLink}),i.o(c,"ControllerUq")&&i.d(t,"ControllerUq",function(){return c.ControllerUq}),i.o(c,"centerApi")&&i.d(t,"centerApi",function(){return c.centerApi}),i.o(c,"entityIcons")&&i.d(t,"entityIcons",function(){return c.entityIcons});var u=i(45);i.d(t,"ControllerUq",function(){return u.a});i(7);var d=i(17);i.d(t,"CLink",function(){return d.a});var h=i(44);i.d(t,"entityIcons",function(){return h.a})},function(e,t,i){"use strict";var n=i(0),s=i(3),r=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};class o{constructor(e){this.formView=e}render(){return n.createElement("div",{className:"col-sm-10"},this.renderControl())}get hasError(){return!1}get filled(){return!1}clear(){}clearErrors(){}readValues(e){}setError(e,t){}setInitValues(e){}isOk(){return this.validate(),!this.hasError}validate(){}}r([s.e],o.prototype,"hasError",null),r([s.e],o.prototype,"filled",null);class a extends o{constructor(e,t,i){super(e),this.field=t,this.face=i,this.init(),this.setProps()}ref(e){this.element=e}init(){this.rules=[];let e=this.field.rules;void 0!==e&&(!0===Array.isArray(e)?this.rules.push(...e):this.rules.push(e))}setProps(){return this.props={ref:this.ref.bind(this),name:this.field.name}}get hasError(){return void 0!==this.error}get filled(){return void 0!==this.value&&this.value!==this.field.defaultValue}clearValue(){this.value=void 0}clear(){this.clearErrors(),this.clearValue()}clearErrors(){this.isOK=void 0,this.error=void 0}readValues(e){e[this.field.name]=this.value}setError(e,t){}setInitValues(e){}getValueFromElement(){return this.value}validate(){try{let t=this.getValueFromElement();if(this.rules.length>0){let e;for(let i of this.rules){console.log("validate: %s",t);let n=i(t);if(console.log("validate: %s err: %s",t,n),!0===n)this.error=void 0,e=!0;else if(void 0!==n)return this.error=n,void(this.isOK=!1)}this.isOK=e}this.value=t}catch(e){this.error=e.message}}render(){let e;if(void 0!==this.face){let{notes:t}=this.face;void 0!==t&&(e=n.createElement("small",{className:"text-muted"},t))}return n.createElement("div",{className:"col-sm-10"},this.renderControl(),e)}}r([s.l],a.prototype,"isOK",void 0),r([s.l],a.prototype,"error",void 0),r([s.l],a.prototype,"value",void 0),r([s.e],a.prototype,"hasError",null),r([s.e],a.prototype,"filled",null);class l extends o{constructor(e){super(e),this.otherClick=this.otherClick.bind(this)}otherClick(){let e=this.formView.props.onOther;void 0!==e&&e(this.formView.readValues())}renderControl(){console.log("buttons.renderControl");let e=this.formView.nothing,t=this.formView.hasError,i=this.formView.props;console.log("buttons.renderControl nothing:%s hasError:%s",e,t);let s,{submitButton:r,otherButton:o,onOther:a}=i;return void 0!==o&&(s=n.createElement("button",{className:"btn btn-outline-info ml-auto",onClick:this.otherClick},o)),n.createElement("div",{className:"d-flex justify-content-start"},n.createElement("button",{className:"btn btn-primary",type:"submit",disabled:e||t},r||"\u63d0\u4ea4"),s)}}var c=i(6),u=i(5);const d="\u5fc5\u987b\u586b\u5165\u8981\u6c42\u5185\u5bb9";class h extends a{init(){super.init(),!0===this.field.required&&this.rules.push(e=>null!==e&&void 0!==e&&0!==e.trim().length||d)}getValueFromElement(){return this.parseValue(this.element.value)}setProps(){super.setProps(),c.assign(this.props,{onBlur:this.onBlur.bind(this),onFocus:this.onFocus.bind(this),onChange:this.onChange.bind(this)});let e=this.face;return void 0!==e&&c.assign(this.props,{placeholder:e.placeholder}),this.props}parseValue(e){return e}onBlur(){this.validate()}onChange(){console.log("onChange"),this.validate()}onFocus(){this.clearErrors()}className(){return u({"form-control":!0,"has-success":!0===this.isOK,"is-invalid":void 0!==this.error,"is-valid":void 0===this.error&&!0===this.isOK})}renderInput(){return n.createElement("input",Object.assign({className:this.className()},this.props))}ref(e){super.ref(e),e&&(e.value=void 0===this.value?"":this.value)}renderError(){return void 0===this.error?null:n.createElement("div",{className:"invalid-feedback"},this.error)}clearValue(){super.clearValue(),this.element.value=""}setError(e,t){this.field.name===e&&(this.error=t)}setInitValues(e){let t=e[this.field.name];void 0!==t&&(this.value=t)}renderControl(){return n.createElement(n.Fragment,null,this.renderInput(),this.renderError())}}class m extends h{setProps(){let e=super.setProps();return c.assign(e,{type:"text",maxLength:this.field.maxLength}),e}parseValue(e){if(void 0!==e&&0!==e.trim().length)return e}}const p="\u65e0\u6548\u7684\u6570\u5b57",f="\u6700\u5c0f\u503c\u4e3a",v="\u6700\u5927\u503c\u4e3a",g=45,y=46;class b extends a{renderControl(){return n.createElement("div",{className:"form-control-plaintext"},n.createElement("div",{className:"alert alert-primary",role:"alert"},"don't know how to create control",n.createElement("br",null),"field: ",JSON.stringify(this.field)," must be object ",n.createElement("br",null),"face: ",JSON.stringify(this.face)," must be object ",n.createElement("br",null)))}}class w extends o{constructor(e,t){super(e),this.element=t}renderControl(){return n.createElement("div",{className:"form-control-plaintext"},this.element)}}var E=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class x extends a{constructor(){super(...arguments),this.onClick=(()=>E(this,void 0,void 0,function*(){let{pick:e,fromPicked:t}=this.face,i=yield e(this.face,this.formView.props,this.formView.readValues());if(void 0===i)return void(this.value=void 0);if(void 0===t)return void(this.value=i.id);let{id:n,caption:s}=t(i);this.value=n,this.caption=s})),this.onPicked=(e=>{this.value=e.id})}setInitValues(e){let t=e[this.field.name];this.value=t}controlContent(){let{itemFromId:e,fromPicked:t,initCaption:i}=this.face;if(void 0===this.value)return i||"\u8bf7\u9009\u62e9Id";if(void 0!==this.caption)return this.caption;if(void 0!==e&&void 0!==t){let i=e(this.value);if(i){let e=t(i);if(void 0!==e)return e.caption}}return String(this.value)}renderControl(){let{tuid:e,input:t}=this.face;return void 0===t?n.createElement("div",{className:"form-control-plaintext px-2 border text-primary rounded cursor-pointer",onClick:this.onClick},this.controlContent()):n.createElement("div",{className:"form-control-static "},n.createElement(t.component,{id:this.value,ui:e}))}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([s.l],x.prototype,"caption",void 0);class C extends a{constructor(e,t,i){super(e,t,i),this.onIdChanged=this.onIdChanged.bind(this)}onIdChanged(e){this.value=e.id}setInitValues(e){let t=e[this.field.name];this.value=t}buildContent(){return n.createElement(this.face.input.component,Object.assign({},this.face,{id:this.value,onFormValues:()=>this.formView.readValues(),onIdChanged:this.onIdChanged}))}renderControl(){return n.createElement("div",{className:"form-control-static "},this.buildContent())}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([s.l],C.prototype,"caption",void 0);var k=i(4),P=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class N extends a{constructor(){super(...arguments),this.onClick=(()=>P(this,void 0,void 0,function*(){let{pick:e,fromPicked:t}=this.face,i=yield e(this.face,this.formView.props,this.formView.readValues());if(void 0===i)return void(this.value=void 0);let{id:n,caption:s}=t(i);this.value=n,this.caption=s})),this.view=Object(k.a)(()=>{let e,{content:t}=this.face;return e=void 0===this.value||null===this.value?"\u8bf7\u9009\u62e9":n.createElement(t,{id:this.value}),n.createElement("div",{className:"form-control-plaintext px-2 border text-primary rounded cursor-pointer bg-light",onClick:this.onClick},e)})}setInitValues(e){let t=e[this.field.name];this.value=t}renderControl(){return n.createElement(this.view,null)}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([s.l],N.prototype,"caption",void 0),i.d(t,"b",function(){return S}),i.d(t,"a",function(){return l});const S=(e,t)=>{t.label;return void 0!==t.group?function(e,t,i){return new b(e,i,void 0)}(e,0,t):void 0!==t.field?function(e,t,i){let{field:n,face:s}=i;switch(typeof n){case"string":n={name:n,type:"string"};break;case"object":break;default:return new b(e,n,s)}let r=n.type||"string";if(void 0===s){if(void 0===(s=R[r]))return new b(e,n,s)}else if(void 0===s.type){let e=R[r];s.type=void 0===e?"string":e.type}return new(A[s.type||r]||b)(e,n,s)}(e,0,t):new w(e,t.help)},A={string:m,password:class extends m{setProps(){let e=super.setProps();return c.assign(e,{type:"password",maxLength:this.field.maxLength}),e}},number:class extends h{init(){super.init(),this.extraChars=[];let{min:e,max:t}=this.field;switch(void 0!==e?(this.rules.push(t=>{if(void 0!==t)return!(t<e)||f+e}),e<0&&this.extraChars.push(g)):this.extraChars.push(g),void 0!==t&&this.rules.push(e=>{if(void 0!==e)return!(e>t)||v+t}),this.field.type){case"dec":case"number":this.extraChars.push(y)}}parseValue(e){if(void 0===e)return;if(0===e.trim().length)return;let t=Number.parseFloat(e);if(isNaN(t))throw new Error(p);return t}setProps(){super.setProps(),c.assign(this.props,{type:"number",step:this.field.step,onKeyPress:this.onKeyPress.bind(this)})}onKeyPress(e){let t=e.charCode;if(!(8===t||0===t||13===t||t>=48&&t<=57))if(void 0!==this.extraChars&&this.extraChars.indexOf(t)>=0)switch(t){case y:this.onKeyDot();break;case g:this.onKeyNeg(),e.preventDefault()}else e.preventDefault()}onKeyDot(){let e=this.element.value;e.indexOf(".")>=0&&(this.element.value=e.replace(".",""))}onKeyNeg(){let e=this.element.value,t=e.indexOf("-");e=t>=0?e.replace("-",""):"-"+e,this.element.value=e}},checkbox:class extends a{init(){super.init();let{trueValue:e,falseValue:t}=this.field;void 0===e&&(this.trueValue=1),void 0===t&&(this.falseValue=0)}setProps(){super.setProps(),c.assign(this.props,{onChange:this.onChange.bind(this)})}clearValue(){this.element.checked=this.field.defaultValue===this.trueValue,this.value=this.getValueFromElement()}setInitValues(e){let t=e[this.field.name];void 0===t&&(t=this.field.defaultValue)}getValueFromElement(){return this.element.checked?this.trueValue:this.falseValue}onChange(){this.value=this.getValueFromElement()}renderControl(){return n.createElement("div",{className:"form-control-static"},n.createElement("label",{className:"form-control"},n.createElement("label",{className:"custom-control custom-checkbox mb-0"},n.createElement("input",{type:"checkbox",name:this.field.name,ref:this.props.ref,onChange:this.props.onChange,className:"custom-control-input"}),n.createElement("span",{className:"custom-control-indicator"}),n.createElement("span",{className:"custom-control-description"},this.face.label))))}},radiobox:class extends a{renderControl(){return n.createElement("div",{className:"form-control-static"},n.createElement("div",{className:"form-control"},this.face.list.map((e,t)=>{let i,s;return"object"!==typeof e?i=s=e:(i=e.text,s=e.value),n.createElement("label",{key:t,className:"custom-control custom-radio w-25"},n.createElement("input",{type:"radio",name:this.field.name,className:"custom-control-input"}),n.createElement("span",{className:"custom-control-indicator"}),n.createElement("span",{className:"custom-control-description"},i))})))}},select:class extends a{constructor(e,t,i){super(e,t,i),this.ref=this.ref.bind(this)}getValueFromElement(){let{selectedIndex:e,selectedOptions:t}=this.element,i=t[0].value;switch(this.field.type){case"number":i=Number(i);break;case"date":i=new Date(i);break;case"bool":"string"===typeof i&&(i="true"===i.toLowerCase())}return i}renderControl(){let{list:e}=this.face,t=[];return void 0===this.face.default&&t.push(n.createElement("option",{key:-1,value:void 0},"\u8bf7\u9009\u62e9")),t.push(...e.map((e,t)=>{let i,s;return"object"!==typeof e?i=s=e:(i=e.text,s=e.value),n.createElement("option",{key:t,value:s},i)})),n.createElement("div",{className:"form-control-static"},n.createElement("select",{name:this.field.name,className:"form-control",ref:this.ref},t))}},"pick-id":x,"pick-tuid":C,textarea:class extends h{setProps(){let e=super.setProps(),{maxLength:t}=this.field,{rows:i}=this.face;return c.assign(e,{maxLength:t,rows:i}),e}renderInput(){return n.createElement("textarea",Object.assign({ref:e=>{this.el=e,void 0!==e&&(e.value="")},className:this.className()},this.props))}},pick:N},R={string:{type:"string"},number:{type:"number"},int:{type:"number"},dec:{type:"number"},bool:{type:"checkbox"}}},function(e,t,i){"use strict";var n=i(3),s=i(6),r=i.n(s),o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const a="\t",l="\n";class c{constructor(e,t,i){this.fieldMaps={},this.entities=e,this.name=t,this.typeId=i,this.sys=this.name.indexOf("$")>=0}get sName(){return this.jName||this.name}get tvApi(){return this.entities.uqApi}getApiFrom(){return this.entities.uqApi}fieldMap(e){void 0===e&&(e="$");let t=this.fieldMaps[e];if(void 0===t){let i;if("$"===e)i=this.fields;else if(void 0!==this.arrFields){let t=this.arrFields.find(t=>t.name===e);void 0!==t&&(i=t.fields)}else if(void 0!==this.returns){let t=this.returns.find(t=>t.name===e);void 0!==t&&(i=t.fields)}if(void 0===i)return{};t={};for(let e of i)t[e.name]=e;this.fieldMaps[e]=t}return t}loadSchema(){return o(this,void 0,void 0,function*(){if(void 0!==this.schema)return;let e=yield this.entities.uqApi.schema(this.name);this.setSchema(e),this.buildFieldsTuid()})}setSchema(e){if(void 0===e)return;if(void 0!==this.schema)return;this.schema=e;let{name:t}=e;t!==this.name&&(this.jName=t),this.buildFieldsTuid()}buildFieldsTuid(){let{fields:e,arrs:t,returns:i}=this.schema;this.entities.buildFieldTuid(this.fields=e),this.entities.buildArrFieldsTuid(this.arrFields=t,e),this.entities.buildArrFieldsTuid(this.returns=i,e)}schemaStringify(){return JSON.stringify(this.schema,(e,t)=>{if("_tuid"!==e)return t},4)}tuidFromField(e){let{_tuid:t,tuid:i}=e;if(void 0!==i)return void 0!==t?t:e._tuid=this.entities.getTuid(i,void 0)}tuidFromName(e,t){if(void 0===this.schema)return;let{fields:i,arrs:n}=this.schema,s=this.entities;function r(e,t){if(void 0===t)return;let i=t.find(t=>t.name===e);return void 0!==i?s.getTuid(i.tuid,void 0):void 0}let o=e.toLowerCase();if(void 0===t)return r(o,i);if(void 0===n)return;let a=t.toLowerCase(),l=n.find(e=>e.name===a);return void 0!==l?r(o,l.fields):void 0}buildParams(e){let t={},i=this.fields;void 0!==i&&this.buildFieldsParams(t,i,e);let n=this.arrFields;if(void 0!==n)for(let s of n){let{name:i,fields:n}=s;if(void 0===e[i])continue;let r=[];t[i]=r;for(let t of e){let e={};this.buildFieldsParams(e,n,t),r.push(e)}}return t}buildFieldsParams(e,t,i){for(let n of t){let t,{name:s}=n,r=i[s];switch(typeof r){default:t=r;break;case"object":let e=n._tuid;t=void 0===e?r.id:e.getIdFromObj(r)}e[s]=t}}pack(e){let t=[],i=this.fields;void 0!==i&&this.packRow(t,i,e);let n=this.arrFields;if(void 0!==n)for(let s of n)this.packArr(t,s.fields,e[s.name]);return t.join("")}escape(e,t){let i=e[t.name];switch(typeof i){default:return i;case"object":let e=t._tuid;return void 0===e?i.id:e.getIdFromObj(i);case"string":let n=i.length,s="",r=0;for(let t=0;t<n;t++){switch(i.charCodeAt(t)){case 9:s+=i.substring(r,t)+"\\t",r=t+1;break;case 10:s+=i.substring(r,t)+"\\n",r=t+1}}return s+i.substring(r);case"undefined":return""}}packRow(e,t,i){let n=t.length;if(0===n)return;let s="";s+=this.escape(i,t[0]);for(let r=1;r<n;r++){let e=t[r];s+=a+this.escape(i,e)}e.push(s+l)}packArr(e,t,i){if(void 0!==i)for(let n of i)this.packRow(e,t,n);e.push(l)}unpackSheet(e){let t={},i=this.fields,n=0;void 0!==i&&(n=this.unpackRow(t,i,e,n));let s=this.arrFields;if(void 0!==s)for(let r of s)n=this.unpackArr(t,r,e,n);return t}unpackReturns(e){let t={},i=0,n=this.returns;if(void 0!==n)for(let s of n)i=this.unpackArr(t,s,e,i);return t}unpackRow(e,t,i,n){let s=0,r=0,o=n,a=0,l=i.length,c=t.length;for(;n<l;n++)if(s=r,9===(r=i.charCodeAt(n))){let r=t[a],{name:u}=r;if(8!==s){if(n>o){let t=i.substring(o,n);e[u]=this.to(e,t,r)}}else e[u]=null;if(o=n+1,++a>=c){(n=i.indexOf("\n",o))>=0?++n:n=l;break}}else if(10===r){let r=t[a],{name:l}=r;if(8!==s){if(n>o){let t=i.substring(o,n);e[l]=this.to(e,t,r)}}else e[l]=null;++n,++a;break}return n}to(e,t,i){switch(i.type){default:return t;case"datetime":case"date":case"time":return new Date(Number(t));case"id":case"tinyint":case"smallint":case"int":case"dec":return Number(t);case"bigint":let e=Number(t),{_tuid:n}=i;return void 0===n?e:(n.useId(e,!0),n.boxId(e))}}unpackArr(e,t,i,n){let s=[],r=i.length,{name:o,fields:a}=t;for(;n<r;){if(10===i.charCodeAt(n)){++n;break}let e={};s.push(e),n=this.unpackRow(e,a,i,n)}return e[o]=s,n}}var u=i(89),d=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const h=1e3;class m extends c{constructor(e,t,i,s){super(e,i,s),this.queue=[],this.waitingIds=[],this.cache=n.l.map({},{deep:!1}),this.owner=t}get typeName(){return"tuid"}buildIdBoxer(){if(void 0!==this.BoxId)return;this.BoxId=function(){};let e=this.BoxId.prototype;Object.defineProperty(e,"_$tuid",{value:this,writable:!1,enumerable:!1}),Object.defineProperty(e,"obj",{enumerable:!1,get:function(){if(!(void 0===this.id||this.id<=0))return this._$tuid.valueFromId(this.id)}}),e.valueFromFieldName=function(e){return this._$tuid.valueFromFieldName(e,this.obj)},e.getObj=function(){if(void 0!==this._$tuid)return this._$tuid.getCacheValue(this.id)},e.toJSON=function(){return this.id}}boxId(e){if("object"===typeof e)return e;this.useId(e),this.buildIdBoxer();let t=new this.BoxId;return t.id=e,t}getTuidContent(){return this.entities.cUq.getTuidContent(this)}getIdFromObj(e){return e[this.idName]}setSchema(e){super.setSchema(e);let{id:t,unique:i}=e;this.idName=t,this.unique=i,this.schemaFrom=this.schema.from}buildFieldsTuid(){super.buildFieldsTuid();let{mainFields:e}=this.schema;if(void 0!==e)for(let t of e){let e=this.fields.find(e=>e.name===t.name);void 0!==e&&(t._tuid=e._tuid)}}moveToHead(e){let t=this.queue.findIndex(t=>t===e);this.queue.splice(t,1),this.queue.push(e)}valueFromId(e){let t;switch(typeof e){case"object":t=e.id;break;case"number":t=e;break;default:return}return this.getCacheValue(t)}getCacheValue(e){let t=this.cache.get(e);return void 0!==this.owner&&"object"===typeof t&&(t.$owner=this.owner.boxId(t.owner)),t}valueFromFieldName(e,t){if(void 0===t)return;if(void 0===this.fields)return;let i=this.fields.find(t=>t.name===e);if(void 0===i)return;let n=t[e],{_tuid:s}=i;return void 0===s?n:s.valueFromId(n)}resetCache(e){this.cache.delete(e);let t=this.queue.findIndex(t=>t===e);this.queue.splice(t,1),this.useId(e)}useId(e,t){if(void 0!==e&&0!==e&&!1!==Object(u.isNumber)(e))if(!0!==this.cache.has(e))if(this.entities.cacheTuids(!0===t?70:20),this.cache.set(e,e),this.waitingIds.findIndex(t=>t===e)>=0)this.moveToHead(e);else{if(this.queue.length>=h){let t=this.queue.shift();if(t===e)return void this.queue.push(t);if(!0===this.cache.has(t))this.cache.delete(t);else{let e=this.waitingIds.findIndex(e=>e===t);this.waitingIds.splice(e,1)}}this.waitingIds.push(e),this.queue.push(e)}else this.moveToHead(e)}proxied(e,t){return d(this,void 0,void 0,function*(){this.entities.getTuid(e,void 0).useId(t);let i=yield this.tvApi.proxied(this.name,e,t);return this.cacheValue(i),i})}cacheValue(e){if(void 0===e)return!1;let t=this.getIdFromObj(e);if(void 0===t)return!1;let i=this.waitingIds.findIndex(e=>e===t);return i>=0&&this.waitingIds.splice(i,1),this.cache.set(t,e),!0}afterCacheId(e){if(void 0!==this.fields)for(let t of this.fields){let{_tuid:i}=t;void 0!==i&&i.useId(e[t.name])}}from(){}unpackTuidIds(e){if(void 0===this.schemaFrom){let{mainFields:t}=this.schema;if(void 0===t)return e;let i=[],n=e.length,s=0;for(;s<n;){if(10===e.charCodeAt(s)){++s;break}let n={};s=this.unpackRow(n,t,e,s),i.push(n)}return i}return this.from().unpackTuidIds(e)}cacheIds(){return d(this,void 0,void 0,function*(){if(0===this.waitingIds.length)return;let e,t;void 0===this.owner?e=this.name:(e=this.owner.name,t=this.name);let i=this.getApiFrom(),n=yield i.tuidIds(e,t,this.waitingIds);n=this.unpackTuidIds(n);for(let s of n)!1!==this.cacheValue(s)&&(this.cacheTuidFieldValues(s),this.afterCacheId(s));yield this.cacheDivIds()})}cacheDivIds(){return d(this,void 0,void 0,function*(){})}load(e){return d(this,void 0,void 0,function*(){if(void 0===e||0===e)return;let t=this.getApiFrom(),i=yield t.tuidGet(this.name,e);if(void 0!==i){for(let e of this.schema.fields){let{tuid:t}=e;if(void 0===t)continue;let n=this.entities.getTuid(t);if(void 0===n)continue;let s=e.name;i[s]=n.boxId(i[s])}return this.cacheValue(i),this.cacheTuidFieldValues(i),i}})}getDiv(e){}cacheTuidFieldValues(e){let{fields:t,arrs:i}=this.schema;if(this.cacheFieldsInValue(e,t),void 0!==i)for(let n of i){let{name:t,fields:i}=n,s=e[t];if(void 0===s)continue;let r=this.getDiv(t);for(let e of s)e._$tuid=r,e.$owner=this.boxId(e.owner),r.cacheValue(e),this.cacheFieldsInValue(e,i)}}cacheFieldsInValue(e,t){for(let i of t){let{name:t,_tuid:n}=i;if(void 0===n)continue;let s=e[t];e[t]=n.boxId(s)}}save(e,t){return d(this,void 0,void 0,function*(){let i=r.a.clone(t);return i.$id=e,yield this.tvApi.tuidSave(this.name,i)})}search(e,t,i){return d(this,void 0,void 0,function*(){return yield this.searchArr(void 0,e,t,i)})}searchArr(e,t,i,n){return d(this,void 0,void 0,function*(){let s,r,{fields:o}=this.schema;void 0!==this.owner?(s=this.owner.name,r=this.name):(s=this.name,r=void 0);let a=this.getApiFrom(),l=yield a.tuidSearch(s,r,e,t,i,n);for(let e of l)this.cacheFieldsInValue(e,o),void 0!==this.owner&&(e.$owner=this.owner.boxId(e.owner));return l})}loadArr(e,t,i){return d(this,void 0,void 0,function*(){if(void 0===i||0===i)return;let n=this.getApiFrom();return yield n.tuidArrGet(this.name,e,t,i)})}saveArr(e,t,i,n){return d(this,void 0,void 0,function*(){let s=r.a.clone(n);return s.$id=i,yield this.tvApi.tuidArrSave(this.name,e,t,s)})}posArr(e,t,i,n){return d(this,void 0,void 0,function*(){return yield this.tvApi.tuidArrPos(this.name,e,t,i,n)})}showInfo(e){return d(this,void 0,void 0,function*(){yield this.entities.cUq.showTuid(this,e)})}}class p extends m{get Main(){return this}get uqApi(){return this.entities.uqApi}setSchema(e){super.setSchema(e);let{arrs:t}=e;if(void 0!==t){this.divs={};for(let e of t){let{name:t}=e,i=new f(this.entities,this,t,this.typeId);this.divs[t]=i,i.setSchema(e)}}}getDiv(e){return this.divs[e]}cacheDivIds(){return d(this,void 0,void 0,function*(){if(void 0!==this.divs)for(let e in this.divs)yield this.divs[e].cacheIds()})}cUqFrom(){if(void 0===this.schemaFrom)return this.entities.cUq;let{owner:e,uq:t}=this.schemaFrom,i=this.entities.cUq,n=i.cApp;if(void 0===n)return i;let s=n.getImportUq(e,t);return void 0===s?(console.error(`${e}/${t} \u4e0d\u5b58\u5728`),i):s}getApiFrom(){let e=this.from();return void 0!==e?e.entities.uqApi:this.entities.uqApi}from(){if(void 0===this.schemaFrom)return this;return this.cUqFrom().tuid(this.name)}cFrom(){return this.cUqFrom().cTuidMainFromName(this.name)}cEditFrom(){return this.cUqFrom().cTuidEditFromName(this.name)}cInfoFrom(){return this.cUqFrom().cTuidInfoFromName(this.name)}cSelectFrom(){let e=this.cUqFrom();if(void 0!==e)return e.cTuidSelectFromName(this.name)}}class f extends m{get Main(){return this.owner}from(){return this.owner.from().getDiv(this.name)}getApiFrom(){return this.owner.getApiFrom()}}var v=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class g extends c{get typeName(){return"action"}submit(e){return v(this,void 0,void 0,function*(){yield this.loadSchema();let t=this.pack(e);return yield this.tvApi.action(this.name,{data:t})})}}var y=i(1),b=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class w extends c{get typeName(){return"sheet"}setSchema(e){super.setSchema(e),this.states=e.states}build(e){this.states=[];for(let t of e.ops)this.states.push({name:t,actions:void 0})}createSheetState(e,t){let i={name:e,actions:[]},n=i.actions;for(let s in t){let e={name:s};n.push(e)}return i}save(e,t){return b(this,void 0,void 0,function*(){yield this.loadSchema();let{appId:i}=this.entities,n=this.pack(t);return yield this.tvApi.sheetSave(this.name,{app:i,discription:e,data:n})})}action(e,t,i,n){return b(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.tvApi.sheetAction(this.name,{id:e,flow:t,state:i,action:n})})}unpack(e){return b(this,void 0,void 0,function*(){let t=e[0][0];return{brief:t,data:this.unpackSheet(t.data),flows:e[1]}})}getSheet(e){return b(this,void 0,void 0,function*(){yield this.loadSchema();let t=yield this.tvApi.getSheet(this.name,e);return 0===t[0].length?yield this.getArchive(e):yield this.unpack(t)})}getArchive(e){return b(this,void 0,void 0,function*(){yield this.loadSchema();let t=yield this.tvApi.sheetArchive(this.name,e);return yield this.unpack(t)})}getArchives(e,t){return b(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.tvApi.sheetArchives(this.name,{pageStart:e,pageSize:t})})}getStateSheets(e,t,i){return b(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.tvApi.stateSheets(this.name,{state:e,pageStart:t,pageSize:i})})}createPageStateItems(){return new E(this)}stateSheetCount(){return b(this,void 0,void 0,function*(){yield this.loadSchema();let e=yield this.tvApi.stateSheetCount(this.name);return this.states.map(t=>{let i=t.name,n=0,s=e.find(e=>e.state===i);return void 0!==s&&(n=s.count),{state:i,count:n}})})}mySheets(e,t,i){return b(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.tvApi.mySheets(this.name,{state:e,pageStart:t,pageSize:i})})}}class E extends y.PageItems{constructor(e){super(!0),this.sheet=e,this.pageSize=10}load(e,t,i){return b(this,void 0,void 0,function*(){return yield this.sheet.getStateSheets(e,t,i)})}setPageStart(e){this.pageStart=void 0===e?0:e.id}}var x=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class C extends c{get typeName(){return"query"}setSchema(e){super.setSchema(e);let{returns:t}=e;this.returns=t,this.isPaged=void 0!==t.find(e=>"$page"===e.name)}resetPage(e,t){this.pageStart=void 0,this.pageSize=e,this.params=t,this.more=!1,this.list=void 0}get hasMore(){return this.more}loadPage(){return x(this,void 0,void 0,function*(){if(void 0===this.pageSize)throw"call resetPage(size:number, params:any) first";let e;if(void 0!==this.pageStart)switch(this.startField.type){default:e=this.pageStart;break;case"date":case"time":case"datetime":e=this.pageStart.getTime()}let t=yield this.page(this.params,e,this.pageSize+1);if(this.list=n.l.array([],{deep:!1}),void 0!==t){if(t.length>this.pageSize){this.more=!0,t.pop();let e=this.returns.find(e=>"$page"===e.name);this.startField=e.fields[0],this.pageStart=t[t.length-1][this.startField.name]}else this.more=!1;this.list.push(...t)}})}page(e,t,i){return x(this,void 0,void 0,function*(){yield this.loadSchema();let n=yield this.tvApi.page(this.name,t,i+1,this.buildParams(e));return(yield this.unpackReturns(n)).$page})}query(e){return x(this,void 0,void 0,function*(){yield this.loadSchema();let t=yield this.tvApi.query(this.name,this.buildParams(e));return yield this.unpackReturns(t)})}table(e){return x(this,void 0,void 0,function*(){let t=yield this.query(e);for(let e in t)return t[e]})}obj(e){return x(this,void 0,void 0,function*(){let t=yield this.table(e);if(t.length>0)return t[0]})}scalar(e){return x(this,void 0,void 0,function*(){let t=yield this.obj(e);for(let e in t)return t[e]})}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([n.l],C.prototype,"list",void 0);class k extends C{constructor(){super(...arguments),this.queryApiName="book"}get typeName(){return"book"}}class P extends C{constructor(){super(...arguments),this.queryApiName="history"}get typeName(){return"history"}}var N=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class S extends c{constructor(){super(...arguments),this.actions={},this.queries={}}get typeName(){return"map"}setSchema(e){super.setSchema(e),this.schemaFrom=this.schema.from;let{actions:t,queries:i,keys:n}=e;this.entities.buildFieldTuid(this.keys=n);for(let s in t){let e=t[s],{name:i}=e,n=this.entities.newAction(i,void 0);n.setSchema(e),this.actions[s]=n}for(let s in i){let e=i[s],{name:t}=e,n=this.entities.newQuery(t,void 0);n.setSchema(e),this.queries[s]=n}}add(e){return N(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.actions.add.submit(e)})}del(e){return N(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.actions.del.submit(e)})}all(){return N(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.queries.all.query({})})}page(e,t,i){return N(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.queries.page.page(e,t,i)})}query(e){return N(this,void 0,void 0,function*(){return yield this.loadSchema(),yield this.queries.query.query(e)})}table(e){return N(this,void 0,void 0,function*(){let t=yield this.query(e);for(let e in t)return t[e]})}obj(e){return N(this,void 0,void 0,function*(){let t=yield this.table(e);if(t.length>0)return t[0]})}scalar(e){return N(this,void 0,void 0,function*(){let t=yield this.obj(e);for(let e in t)return t[e]})}}class A extends C{constructor(){super(...arguments),this.queryApiName="pending"}get typeName(){return"pending"}}var R=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};function O(e){switch(e){case"tinyint":case"smallint":case"int":case"bigint":case"dec":return 0;case"char":case"text":return"";case"datetime":case"date":return"2000-1-1";case"time":return"0:00"}}class F{constructor(e,t,i){this.tuids={},this.actions={},this.sheets={},this.queries={},this.books={},this.maps={},this.histories={},this.pendings={},this.tuidArr=[],this.actionArr=[],this.sheetArr=[],this.queryArr=[],this.bookArr=[],this.mapArr=[],this.historyArr=[],this.pendingArr=[],this.loadIds=(()=>{this.clearCacheTimer();for(let e in this.tuids){this.tuids[e].cacheIds()}}),this.cUq=e,this.uqApi=t,this.appId=i}tuid(e){return this.tuids[e.toLowerCase()]}action(e){return this.actions[e.toLowerCase()]}sheet(e){return this.sheets[e.toLowerCase()]}query(e){return this.queries[e.toLowerCase()]}book(e){return this.books[e.toLowerCase()]}map(e){return this.maps[e.toLowerCase()]}history(e){return this.histories[e.toLowerCase()]}pending(e){return this.pendings[e.toLowerCase()]}sheetFromTypeId(e){for(let t in this.sheets){let i=this.sheets[t];if(i.typeId===e)return i}}init(){return R(this,void 0,void 0,function*(){yield this.uqApi.init()})}loadAccess(){return R(this,void 0,void 0,function*(){let e=yield this.uqApi.loadAccess();void 0!==e&&this.buildEntities(e)})}loadEntities(){return R(this,void 0,void 0,function*(){let e=yield this.uqApi.loadEntities();this.buildEntities(e)})}buildEntities(e){let{access:t,tuids:i}=e;this.buildTuids(i),this.buildAccess(t)}getTuid(e,t,i){let n=this.tuids[e];if(void 0!==n)return void 0===t?n:n.divs[t]}cacheTuids(e){this.clearCacheTimer(),this.cacheTimer=setTimeout(this.loadIds,e)}clearCacheTimer(){void 0!==this.cacheTimer&&(clearTimeout(this.cacheTimer),this.cacheTimer=void 0)}buildTuids(e){for(let t in e){let i=e[t],{name:n,typeId:s}=i;this.newTuid(t,s).sys=!0}for(let t in e){let i=e[t],{name:n}=i;this.getTuid(t).setSchema(i)}for(let t in this.tuids){this.tuids[t].buildFieldsTuid()}}buildAccess(e){for(let t in e){let i=e[t];switch(typeof i){case"string":this.fromType(t,i);break;case"object":this.fromObj(t,i)}}}newAction(e,t){let i=this.actions[e];return void 0!==i?i:(i=this.actions[e]=new g(this,e,t),this.actionArr.push(i),i)}newTuid(e,t){let i=this.tuids[e];return void 0!==i?i:(i=this.tuids[e]=new p(this,void 0,e,t),this.tuidArr.push(i),i)}newQuery(e,t){let i=this.queries[e];return void 0!==i?i:(i=this.queries[e]=new C(this,e,t),this.queryArr.push(i),i)}newBook(e,t){let i=this.books[e];return void 0!==i?i:(i=this.books[e]=new k(this,e,t),this.bookArr.push(i),i)}newMap(e,t){let i=this.maps[e];return void 0!==i?i:(i=this.maps[e]=new S(this,e,t),this.mapArr.push(i),i)}newHistory(e,t){let i=this.histories[e];if(void 0===i)return i=this.histories[e]=new P(this,e,t),this.historyArr.push(i),i}newPending(e,t){let i=this.pendings[e];if(void 0===i)return i=this.pendings[e]=new A(this,e,t),this.pendingArr.push(i),i}newSheet(e,t){let i=this.sheets[e];return void 0!==i?i:(i=this.sheets[e]=new w(this,e,t),this.sheetArr.push(i),i)}fromType(e,t){let i=t.split("|");t=i[0];let n=Number(i[1]);switch(t){case"uq":this.uqId=n;break;case"tuid":this.newTuid(e,n).sys=!1;break;case"action":this.newAction(e,n);break;case"query":this.newQuery(e,n);break;case"book":this.newBook(e,n);break;case"map":this.newMap(e,n);break;case"history":this.newHistory(e,n);break;case"sheet":this.newSheet(e,n);break;case"pending":this.newPending(e,n)}}fromObj(e,t){switch(t.$){case"sheet":this.buildSheet(e,t)}}buildSheet(e,t){let i=this.sheets[e];void 0===i&&(i=this.newSheet(e,t.id)),i.build(t)}buildFieldTuid(e,t){if(void 0!==e){for(let t of e){let{tuid:e,arr:i,url:n}=t;void 0!==e&&(t._tuid=this.getTuid(e,i,n))}for(let i of e){let{owner:n}=i;if(void 0===n)continue;let s=e.find(e=>e.name===n);if(void 0===s&&(void 0!==t&&(s=t.find(e=>e.name===n)),void 0===s))throw`owner field ${n} is undefined`;i._ownerField=s;let{arr:r,url:o}=i;if(i._tuid=this.getTuid(s._tuid.name,r,o),void 0===i._tuid)throw"owner field ${owner} is not tuid"}}}buildArrFieldsTuid(e,t){if(void 0!==e)for(let i of e){let{fields:e}=i;void 0!==e&&this.buildFieldTuid(e,t)}}}i.d(t,"b",function(){return O}),i.d(t,"a",function(){return F})},function(e,t,i){"use strict";i.d(t,"a",function(){return l}),i.d(t,"b",function(){return c});var n=i(0),s=i(31);class r{constructor(e,t){if(this.form=e,this.row=t,void 0===t.type){let i=t.createControl;void 0===i&&(i=e.createControl),void 0===i&&(i=s.b),this.control=i(e,t)}}isOk(){return void 0===this.control||this.control.isOk()}contains(e){let t=this.row.field;if(void 0!==t)return e===t.name;let i=this.row.group;return void 0!==i&&void 0!==i.find(t=>t.field.name===e)}get hasError(){return this.control.hasError}get filled(){return this.control.filled}clear(){void 0!==this.control&&this.control.clear()}clearErrors(){void 0!==this.control&&this.control.clearErrors()}readValues(e){void 0!==this.control&&this.control.readValues(e)}setError(e,t){void 0!==this.control&&this.control.setError(e,t)}setInitValues(e){void 0!==this.control&&this.control.setInitValues(e)}}class o extends r{render(e){return n.createElement("div",{key:e,className:"form-group"},this.row)}get hasError(){return!1}get filled(){return!1}}class a extends r{render(e){return n.createElement("div",{key:e,className:"form-group row"},n.createElement("label",{className:"col-sm-2 col-form-label"},this.row.label),this.control.render())}}function l(e,t){return new a(e,t)}function c(e,t){return new o(e,t)}},function(e,t,i){"use strict";i.d(t,"b",function(){return s}),i.d(t,"a",function(){return r});var n=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};function s(e,t,i,s,r){return n(this,void 0,void 0,function*(){yield e.fetch(t,i,s,r)})}class r{constructor(e,t){this.path=e||"",this.showWaiting=t}call(e,t,i){return n(this,void 0,void 0,function*(){let n=yield this.getHttpChannel();return yield n.callFetch(e,t,i)})}get(e,t){return n(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.get(this.path+e,t)})}post(e,t){return n(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.post(this.path+e,t)})}put(e,t){return n(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.put(this.path+e,t)})}delete(e,t){return n(this,void 0,void 0,function*(){let i=yield this.getHttpChannel();return yield i.delete(this.path+e,t)})}}},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i(0),s=i(8),r=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class o extends n.Component{constructor(e){super(e),this.logoutClick=(()=>{s.c.showLogout(this.logout)}),this.logout=(()=>r(this,void 0,void 0,function*(){let{logout:e}=this.props;"function"===typeof e&&(yield e()),yield s.c.logout(void 0)})),this.navChange=this.navChange.bind(this),this.state={hasBack:!1}}navChange(){this.setState({hasBack:s.c.level>1})}componentWillMount(){this.navChange()}componentWillUnmount(){}back(){return r(this,void 0,void 0,function*(){yield s.c.back()})}openWindow(){window.open(document.location.href)}render(){let e,t,i,r,o=this.state.hasBack||self!=top,{right:a,center:l,logout:c,className:u}=this.props;if(void 0!==c&&self===top&&("boolean"===typeof c&&!0===c||"function"===typeof c)){let{user:e}=s.c;if(void 0!==e){let{nick:t,name:s}=e;i=n.createElement("div",{className:"d-flex align-items-center"},n.createElement("small",{className:"text-light"},t||s),n.createElement("a",{className:"dropdown-toggle btn btn-secondary btn-sm ml-2",role:"button",onClick:this.logoutClick},n.createElement("i",{className:"fa fa-sign-out"})))}}if(o)switch(this.props.back){case"none":e=void 0;break;default:case"back":e=n.createElement("nav",{onClick:this.back},n.createElement("i",{className:"fa fa-arrow-left"}));break;case"close":e=n.createElement("nav",{onClick:this.back},n.createElement("i",{className:"fa fa-close"}))}return self!=top&&(console.log(document.location.href),t=n.createElement("header",{onClick:this.openWindow})),(a||i)&&(r=n.createElement("aside",null,a," ",i)),n.createElement("header",{className:u,style:s.b},t,e,n.createElement("div",null,l),r)}}},function(e,t,i){"use strict";var n=i(7),s=i(0),r=i.n(s),o=i(4),a=i(2),l=i(1),c=i(11);const u=e=>r.a.createElement("div",{className:"px-3 py-2"},Object(c.a)(e));var d=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class h extends n.b{constructor(){super(...arguments),this.onSubmit=(()=>d(this,void 0,void 0,function*(){let e=this.vForm.getValues();if(!0===this.entity.isPaged)yield this.entity.resetPage(30,e),yield this.entity.loadPage(),this.replacePage(this.pageResult);else{let t=yield this.entity.query(e);this.replacePage(this.queryResult,t)}})),this.again=(()=>{this.vForm.reset(),this.replacePage(this.view)}),this.renderRow=((e,t)=>s.createElement(this.row,Object.assign({},e))),this.view=(()=>s.createElement(l.Page,{header:this.label},this.vForm.render("mx-3 my-2"),this.renderExtra())),this.pageResult=(()=>{let{name:e,list:t}=this.entity,i=s.createElement("button",{className:"btn btn-outline-success",onClick:this.again},s.createElement(a.FA,{name:"search"})," \u518d\u67e5\u8be2");return s.createElement(l.Page,{header:this.label,right:i},s.createElement(a.List,{items:t,item:{render:this.renderRow}}))}),this.queryResult=Object(o.a)(e=>{let t=s.createElement("button",{className:"btn btn-outline-success",onClick:this.again},s.createElement(a.FA,{name:"search"})," \u518d\u67e5\u8be2");return s.createElement(l.Page,{header:this.label,right:t},s.createElement("pre",null,JSON.stringify(e,void 0,"\t")))})}open(e){return d(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e);let{row:t,queryRow:i}=this.ui;this.row=i||t||u,this.openPage(this.view)})}renderExtra(){}}var m=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class p extends n.b{constructor(){super(...arguments),this.onSearch=(e=>m(this,void 0,void 0,function*(){yield this.PageItems.first(e)})),this.renderRow=((e,t)=>s.createElement(this.row,Object.assign({},e))),this.clickRow=(e=>{this.callOnSelected(e)}),this.view=(()=>{let e=s.createElement(a.SearchBox,{className:"mx-1 w-100",initKey:"",onSearch:this.onSearch,placeholder:"\u641c\u7d22"+this.label});return s.createElement(l.Page,{header:e},s.createElement(a.List,{items:this.PageItems.items,item:{render:this.renderRow,onClick:this.clickRow},before:"\u641c\u7d22"+this.label+"\u8d44\u6599"}))})}open(e){return m(this,void 0,void 0,function*(){let{row:t,selectRow:i}=this.ui;this.row=i||t||u,this.PageItems=new f(this.entity),yield this.onSearch(e),this.openPage(this.view)})}callOnSelected(e){this.closePage(),this.returnCall(e)}}class f extends l.PageItems{constructor(e){super(),this.query=e}load(){return m(this,void 0,void 0,function*(){let e;if(yield this.query.loadSchema(),!0===this.query.isPaged)e=yield this.query.page(this.param,this.pageStart,this.pageSize);else{e=(yield this.query.query(this.param))[this.query.returns[0].name]}return e})}setPageStart(e){void 0===e&&(this.pageStart=0)}}var v=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class g extends n.a{}class y extends g{internalStart(){return v(this,void 0,void 0,function*(){yield this.openVPage(this.VQueryMain)})}get VQueryMain(){return this.ui&&this.ui.main||h}}class b extends g{internalStart(e){return v(this,void 0,void 0,function*(){yield this.openVPage(this.VQuerySelect,e)})}get VQuerySelect(){return p}}i.d(t,"a",function(){return y}),i.d(t,"b",function(){return b}),i.d(t,"c",function(){return f})},function(e,t,i){"use strict";i.d(t,"a",function(){return m});var n=i(0),s=i(4),r=i(3),o=i(40),a=i(20),l=i(8),c=i(15),u=i(23),d=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},h=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class m extends u.a{constructor(){super(...arguments),this.overSize=!1,this.upload=(()=>h(this,void 0,void 0,function*(){if(!this.resUploader)return;let e=yield this.resUploader.upload();if(null===e)return this.overSize=!0,void setTimeout(()=>this.overSize=!1,3e3);this.resId=e,this.isChanged=this.resId!=this.value})),this.page=Object(s.a)(e=>{let t,{resolve:i}=e,s=n.createElement("button",{className:"btn btn-sm btn-success",disabled:!this.isChanged,onClick:()=>i(this.resId)},"\u4fdd\u5b58");return!0===this.overSize&&(t=n.createElement("div",{className:"text-danger"},n.createElement("i",{className:"fa fa-times-circle"})," \u56fe\u7247\u6587\u4ef6\u5927\u5c0f\u8d85\u8fc72M\uff0c\u65e0\u6cd5\u4e0a\u4f20")),n.createElement(c.a,{header:"\u66f4\u6539"+this.label,right:s},n.createElement("div",{className:"my-3 px-3 py-3 bg-white"},n.createElement("div",null,n.createElement("div",null,"\u4e0a\u4f20\u56fe\u7247\uff1a"),n.createElement("div",{className:"my-3"},n.createElement(o.a,{ref:e=>this.resUploader=e,multiple:!1,maxSize:2048})),n.createElement("div",null,n.createElement("button",{className:"btn btn-primary",onClick:this.upload},"\u4e0a\u4f20"))),t,n.createElement("div",{className:"small muted my-4"},"\u652f\u6301JPG\u3001GIF\u3001PNG\u683c\u5f0f\u56fe\u7247\uff0c\u4e0d\u8d85\u8fc72M\u3002"),n.createElement("div",{className:"d-flex"},n.createElement("div",{className:"w-12c h-12c mr-4",style:{border:"1px dotted gray",padding:"8px"}},n.createElement(a.a,{className:"w-100 h-100",src:this.resId})),n.createElement("div",null,n.createElement("div",{className:"small"},"\u56fe\u7247\u9884\u89c8"),n.createElement(a.a,{className:"w-4c h-4c mt-3",src:this.resId})))))})}internalStart(){return h(this,void 0,void 0,function*(){return this.resId=this.value,new Promise((e,t)=>{l.c.push(n.createElement(this.page,{resolve:e,reject:t}),()=>t())})})}}d([r.l],m.prototype,"resId",void 0),d([r.l],m.prototype,"overSize",void 0)},,function(e,t,i){"use strict";i.d(t,"a",function(){return s});var n=i(0);function s(){return n.createElement("div",{className:"d-flex h-100 align-items-center justify-content-center"},n.createElement("i",{className:"fa fa-spinner fa-spin fa-2x fa-fw text-info"}))}},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i(0),s=i(8),r=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class o extends n.Component{constructor(){super(...arguments),this.upload=(()=>r(this,void 0,void 0,function*(){let{maxSize:e}=this.props;void 0===e||e<=0?e=1e11:e*=1024;let t=s.c.resUrl+"upload";var i=this.fileInput.files,n=new FormData;let r=i.length;for(let s=0;s<r;s++){let t=i[s];if(t.size>e)return null;n.append("files[]",t,t.name)}try{let e=new AbortController,i=yield fetch(t,{method:"POST",body:n,signal:e.signal});return":"+(yield i.json()).res.id}catch(o){console.error("%s %s",t,o)}}))}render(){let{className:e,multiple:t,onFilesChange:i}=this.props;return n.createElement("input",{className:e,ref:e=>this.fileInput=e,onChange:i,type:"file",name:"file",multiple:t})}}},function(e,t,i){"use strict";var n=i(67);i.o(n,"Badge")&&i.d(t,"Badge",function(){return n.Badge}),i.o(n,"DropdownActions")&&i.d(t,"DropdownActions",function(){return n.DropdownActions}),i.o(n,"EasyDate")&&i.d(t,"EasyDate",function(){return n.EasyDate}),i.o(n,"FA")&&i.d(t,"FA",function(){return n.FA}),i.o(n,"LMR")&&i.d(t,"LMR",function(){return n.LMR}),i.o(n,"List")&&i.d(t,"List",function(){return n.List}),i.o(n,"Media")&&i.d(t,"Media",function(){return n.Media}),i.o(n,"MultiStep")&&i.d(t,"MultiStep",function(){return n.MultiStep}),i.o(n,"Muted")&&i.d(t,"Muted",function(){return n.Muted}),i.o(n,"PropGrid")&&i.d(t,"PropGrid",function(){return n.PropGrid}),i.o(n,"SearchBox")&&i.d(t,"SearchBox",function(){return n.SearchBox}),i.o(n,"TonvaForm")&&i.d(t,"TonvaForm",function(){return n.TonvaForm});var s=i(68);i.o(s,"Badge")&&i.d(t,"Badge",function(){return s.Badge}),i.o(s,"DropdownActions")&&i.d(t,"DropdownActions",function(){return s.DropdownActions}),i.o(s,"EasyDate")&&i.d(t,"EasyDate",function(){return s.EasyDate}),i.o(s,"FA")&&i.d(t,"FA",function(){return s.FA}),i.o(s,"LMR")&&i.d(t,"LMR",function(){return s.LMR}),i.o(s,"List")&&i.d(t,"List",function(){return s.List}),i.o(s,"Media")&&i.d(t,"Media",function(){return s.Media}),i.o(s,"MultiStep")&&i.d(t,"MultiStep",function(){return s.MultiStep}),i.o(s,"Muted")&&i.d(t,"Muted",function(){return s.Muted}),i.o(s,"PropGrid")&&i.d(t,"PropGrid",function(){return s.PropGrid}),i.o(s,"SearchBox")&&i.d(t,"SearchBox",function(){return s.SearchBox}),i.o(s,"TonvaForm")&&i.d(t,"TonvaForm",function(){return s.TonvaForm});var r=i(69);i.o(r,"Badge")&&i.d(t,"Badge",function(){return r.Badge}),i.o(r,"DropdownActions")&&i.d(t,"DropdownActions",function(){return r.DropdownActions}),i.o(r,"EasyDate")&&i.d(t,"EasyDate",function(){return r.EasyDate}),i.o(r,"FA")&&i.d(t,"FA",function(){return r.FA}),i.o(r,"LMR")&&i.d(t,"LMR",function(){return r.LMR}),i.o(r,"List")&&i.d(t,"List",function(){return r.List}),i.o(r,"Media")&&i.d(t,"Media",function(){return r.Media}),i.o(r,"MultiStep")&&i.d(t,"MultiStep",function(){return r.MultiStep}),i.o(r,"Muted")&&i.d(t,"Muted",function(){return r.Muted}),i.o(r,"PropGrid")&&i.d(t,"PropGrid",function(){return r.PropGrid}),i.o(r,"SearchBox")&&i.d(t,"SearchBox",function(){return r.SearchBox}),i.o(r,"TonvaForm")&&i.d(t,"TonvaForm",function(){return r.TonvaForm});i(33),i(42);var o=i(70);i.d(t,"TonvaForm",function(){return o.a});i(31)},function(e,t,i){"use strict";i.d(t,"a",function(){return u});var n=i(0),s=i(3),r=i(19),o=i(31),a=i(33),l=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},c=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class u{constructor(e){this.rows=[],this.uid=Object(r.a)(),this.props=e,this.buildRows(e),this.createControl=e.createControl,this.onSubmit=this.onSubmit.bind(this)}get hasError(){let e=this.rows.map((e,t)=>t+": "+e.hasError+"\n");return console.log(e),this.rows.some(e=>e.hasError)}get nothing(){return this.rows.every(e=>!e.filled)}readValues(){let e={};for(let t of this.rows)t.readValues(e);return e}clear(){for(let e of this.rows)e.clear()}clearErrors(){for(let e of this.rows)e.clearErrors()}setError(e,t){for(let i of this.rows)i.setError(e,t)}setInitValues(e){if(void 0!==e)for(let t of this.rows)t.setInitValues(e)}buildRows(e){let{formRows:t,createRow:i}=e;if(void 0!==t){for(let e of t)this.rows.push(this.buildRow(e,i));!0!==this.props.readOnly&&(this.buttonsRow=this.buildRow({createControl:this.createButtons.bind(this)},void 0))}else this.rows.push(Object(a.b)(this,n.createElement("div",{className:"text-warning"},"TonvaForm need formRows defined")))}buildRow(e,t){let i;return void 0!==e.type?i=a.b:void 0===(i=e.createRow)&&void 0===(i=t)&&(i=a.a),i(this,e)}createButtons(e,t){return new o.a(e)}isOk(){let e=!0;for(let t of this.rows)t.isOk()||(e=!1);return e}render(){return n.createElement("form",{onSubmit:this.onSubmit},this.rows.map((e,t)=>e.render(this.uid+t)),this.buttons())}buttons(){if(void 0!==this.buttonsRow)return this.buttonsRow.render(this.uid+this.rows.length)}onSubmit(e){return c(this,void 0,void 0,function*(){if(e.preventDefault(),!this.isOk())return;let t=this.readValues();yield this.props.onSubmit(t)})}}l([s.e],u.prototype,"hasError",null),l([s.e],u.prototype,"nothing",null)},function(e,t,i){"use strict";i.d(t,"a",function(){return d});var n=i(0),s=i(6),r=i.n(s),o=i(1),a=i(2),l=i(48),c=i(46),u=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class d extends o.Controller{constructor(e){super(Object(o.resLang)(e&&e.res)),this.cImportUqs={},this.cUqCollection={},this.renderRow=((e,t)=>{let{id:i,nick:s,name:r}=e;return n.createElement(a.LMR,{className:"px-3 py-2",right:"id: "+i},n.createElement("div",null,s||r))}),this.onRowClick=(e=>u(this,void 0,void 0,function*(){o.appInFrame.unit=e.id,yield this.start()})),this.selectUnitPage=(()=>n.createElement(o.Page,{header:"\u9009\u62e9\u5c0f\u53f7",logout:!0},n.createElement(a.List,{items:this.appUnits,item:{render:this.renderRow,onClick:this.onRowClick}}))),o.nav.setSettings(e);let t=e.appName;if(void 0===t)throw'appName like "owner/app" must be defined in UI';let i=t.split("/");if(2!==i.length)throw"tonvaApp name must be / separated, owner/app";this.appOwner=i[0],this.appName=i[1],void 0===e.uqs&&(e.uqs={}),this.ui=e,this.caption=this.res.caption||"Tonva"}startDebug(){return u(this,void 0,void 0,function*(){let e=this.appOwner+"/"+this.appName,t=new d({appName:e,uqs:{}});yield t.start(!0)})}loadUqs(e){return u(this,void 0,void 0,function*(){let t=[],{id:i,uqs:n}=(o.appInFrame.unit,e);this.id=i;let s=[],r=[],a=yield this.buildRoleAppUI();this.ui=a;for(let e of n){let{id:t,uqOwner:i,uqName:n,access:o}=e,l=i+"/"+n,c=a&&a.uqs&&a.uqs[l],u=this.newCUq(l,t,o,c||{});this.cUqCollection[l]=u,s.push(u.loadSchema()),r.push(u.entities.uqApi.checkAccess())}let l=yield Promise.all(s);Promise.all(r).then(e=>{for(let t of e);});for(let e of l){let i=e;void 0===i||t.push(i)}if(0!==t.length)return t})}buildRoleAppUI(){return u(this,void 0,void 0,function*(){if(!this.ui)return;let{hashParam:e}=o.nav;if(!e)return this.ui;let{roles:t}=this.ui,i=t&&t[e];if(!i)return this.ui;let n={};for(let s in this.ui)"roles"!==s&&(n[s]=this.ui[s]);return"function"===typeof i&&(i=yield i()),r.a.merge(n,i),n})}getImportUq(e,t){let i=e+"/"+t,n=this.cImportUqs[i];if(void 0!==n)return n;this.ui&&this.ui.uqs&&this.ui.uqs[i];return this.cImportUqs[i]=n=this.getCUq(i),n}newCUq(e,t,i,n){let s=new(this.ui.CUq||l.a)(this,e,this.id,t,i,n);return Object.setPrototypeOf(s.x,this.x),s}get cUqArr(){let e=[];for(let t in this.cUqCollection)e.push(this.cUqCollection[t]);return e}getCUq(e){return this.cUqCollection[e]}get VAppMain(){return this.ui&&this.ui.main||h}beforeStart(){return u(this,void 0,void 0,function*(){try{let t=yield Object(o.loadAppUqs)(this.appOwner,this.appName),{predefinedUnit:i}=o.appInFrame,{id:s}=t;this.id=s;let{user:r}=o.nav;if(void 0!==r&&r.id>0)switch(this.appUnits=yield c.a.userAppUnits(this.id),this.appUnits.length){case 0:return this.showUnsupport(i),!1;case 1:let e=this.appUnits[0].id;if(void 0===e||e<0||void 0!==i&&e!=i)return this.showUnsupport(i),!1;o.appInFrame.unit=e;break;default:if(i>0&&void 0!==this.appUnits.find(e=>e.id===i)){o.appInFrame.unit=i;break}return o.nav.push(n.createElement(this.selectUnitPage,null)),!1}let a=yield this.loadUqs(t);return void 0===a||(this.openPage(n.createElement(o.Page,{header:"ERROR"},n.createElement("div",{className:"m-3"},n.createElement("div",null,"Load Uqs \u53d1\u751f\u9519\u8bef\uff1a"),a.map((e,t)=>n.createElement("div",{key:t},e))))),!1)}catch(e){return o.nav.push(n.createElement(o.Page,{header:"App start error!"},n.createElement("pre",null,"string"===typeof e?e:e.message))),!1}})}internalStart(e){return u(this,void 0,void 0,function*(){!0!==e&&this.clearPrevPages(),yield this.showMainPage()})}render(){return this.renderView(this.VAppMain)}clearPrevPages(){o.nav.clear()}showUnsupport(e){this.clearPrevPages();let{user:t}=o.nav,i=t?t.name:"[\u672a\u767b\u5f55]";this.openPage(n.createElement(o.Page,{header:"APP\u65e0\u6cd5\u8fd0\u884c",logout:!0},n.createElement("div",{className:"m-3 text-danger container"},n.createElement("div",{className:"form-group row"},n.createElement("div",{className:"col-2"},"\u767b\u5f55\u7528\u6237: "),n.createElement("div",{className:"col"},i)),n.createElement("div",{className:"form-group row"},n.createElement("div",{className:"col-2"},"App:"),n.createElement("div",{className:"col"},`${this.appOwner}/${this.appName}`)),n.createElement("div",{className:"form-group row"},n.createElement("div",{className:"col-2"},"\u9884\u8bbe\u5c0f\u53f7:"),n.createElement("div",{className:"col"},e||n.createElement("small",{className:"text-muted"},"[\u65e0\u9884\u8bbe\u5c0f\u53f7]"))),n.createElement("div",{className:"form-group row"},n.createElement("div",{className:"col-2"},n.createElement(a.FA,{name:"exclamation-triangle"})),n.createElement("div",{className:"col"},n.createElement("div",{className:"text-muted"},"\u65e0\u6cd5\u8fd0\u884c\u53ef\u80fd\u539f\u56e0\uff1a"),n.createElement("ul",{className:"p-0"},n.createElement("li",null,"\u6ca1\u6709\u5c0f\u53f7\u8fd0\u884c ",this.ui.appName),n.createElement("li",null,"\u7528\u6237 ",n.createElement("b",null,i)," \u6ca1\u6709\u52a0\u5165\u4efb\u4f55\u4e00\u4e2a\u8fd0\u884c",this.ui.appName,"\u7684\u5c0f\u53f7"),e&&n.createElement("li",null,"\u9884\u8bbe\u5c0f\u53f7 ",n.createElement("b",null,e)," \u6ca1\u6709\u8fd0\u884cApp ",this.ui.appName)))),e||n.createElement("div",{className:"form-group row"},n.createElement("div",{className:"col-2"}),n.createElement("div",{className:"col"},"\u9884\u8bbe\u5c0f\u53f7\u5b9a\u4e49\u5728 public/unit.json \u6587\u4ef6\u4e2d\u3002 \u5b9a\u4e49\u4e86\u8fd9\u4e2a\u6587\u4ef6\u7684\u7a0b\u5e8f\uff0c\u53ea\u80fd\u7531url\u76f4\u63a5\u542f\u52a8\u3002 \u7528\u6237\u7b2c\u4e00\u6b21\u8bbf\u95eeapp\u4e4b\u540e\uff0c\u4f1a\u7f13\u5b58\u5728localStorage\u91cc\u3002",n.createElement("br",null),"\u5982\u679c\u8981\u5220\u53bb\u7f13\u5b58\u7684\u9884\u5b9a\u4e49Unit\uff0clogout\u7136\u540e\u518dlogin\u3002")))))}showMainPage(){return u(this,void 0,void 0,function*(){let e=Object(o.getExHash)();if(void 0!==e){let t=e.split("-");if(t.length>3){let e=t[3];if("sheet"===e||"sheet_debug"===e){let e=Number(t[4]),i=Number(t[5]),n=Number(t[6]),s=this.getCUqFromId(e);return void 0===s?void alert("unknown uqId: "+e):(this.clearPrevPages(),void(yield s.navSheet(i,n)))}}}this.openVPage(this.VAppMain)})}getCUqFromId(e){for(let t in this.cUqCollection){let i=this.cUqCollection[t];if(i.id===e)return i}}}class h extends o.VPage{constructor(){super(...arguments),this.appPage=(()=>{let{caption:e}=this.controller;return n.createElement(o.Page,{header:e,logout:()=>u(this,void 0,void 0,function*(){o.appInFrame.unit=void 0})},this.appContent())}),this.appContent=(()=>{let e,{cUqArr:t}=this.controller;return e=0===t.length?n.createElement("div",{className:"text-danger"},n.createElement(a.FA,{name:""})," \u6b64APP\u6ca1\u6709\u7ed1\u5b9a\u4efb\u4f55\u7684UQ"):t.map((e,t)=>n.createElement("div",{key:t},e.render())),n.createElement(n.Fragment,null,e)})}open(e){return u(this,void 0,void 0,function*(){this.openPage(this.appPage)})}render(e){return this.appContent()}}},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(0),s=i.n(n),r=i(2);function o(e,t){return s.a.createElement(r.FA,{className:e,name:t,fixWidth:!0})}const a={tuid:o("text-info","list-alt"),action:o("text-info","hand-o-right"),map:o("text-muted","list-ul"),book:o("text-muted","book"),query:o("text-warning","search"),history:o("text-info","hand-o-right"),pending:o("text-info","forward"),sheet:o("text-primary","wpforms")}},function(e,t,i){"use strict";i.d(t,"a",function(){return s});var n=i(1);class s extends n.Controller{constructor(e,t){super(t),this.cUq=e}}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var n=i(1),s=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const r=new class extends n.CenterApi{userAppUnits(e){return s(this,void 0,void 0,function*(){return yield this.get("tie/user-app-units",{app:e})})}}("tv/",void 0)},function(e,t,i){"use strict";var n=i(3),s=i(1),r=i(7),o=i(0),a=i.n(o),l=i(4),c=i(2),u=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class d extends r.b{constructor(){super(...arguments),this.newClick=(()=>this.event("new")),this.schemaClick=(()=>this.event("schema")),this.archivesClick=(()=>this.event("archives")),this.sheetStateClick=(e=>this.event("state",e)),this.renderState=((e,t)=>{let{state:i,count:n}=e;if(0===n)return null;let s=o.createElement("span",{className:"badge badge-success ml-5 align-self-end"},n);return o.createElement(c.LMR,{className:"px-3 py-2",left:this.controller.getStateLabel(i),right:s})}),this.view=Object(l.a)(()=>{let e,t=this.controller.statesCount.filter(e=>e.count),i=o.createElement("button",{className:"btn btn-outline-primary",onClick:this.archivesClick},"\u5df2\u5f52\u6863");return!0===this.isDev&&(e=o.createElement("button",{className:"btn btn-primary mr-2",color:"primary",onClick:this.schemaClick},"\u6a21\u677f")),o.createElement(s.Page,{header:this.label},o.createElement(c.LMR,{className:"mx-3 my-2",right:i},o.createElement("button",{className:"btn btn-primary mr-2",color:"primary",onClick:this.newClick},"\u65b0\u5efa"),e),o.createElement(c.List,{className:"my-2",header:o.createElement(c.Muted,{className:"mx-3 my-1"},"\u5f85\u5904\u7406",this.label),none:"[ \u65e0 ]",items:t,item:{render:this.renderState,onClick:this.sheetStateClick}}))})}open(){return u(this,void 0,void 0,function*(){this.openPage(this.view)})}}var h=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class m extends r.b{constructor(){super(...arguments),this.onSubmit=(()=>h(this,void 0,void 0,function*(){let e=this.vForm.getValues(),t=this.vForm.values;yield this.controller.onSave(e,t)})),this.view=(()=>o.createElement(s.Page,{header:this.label},this.vForm.render()))}open(e){return h(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e),this.openPage(this.view)})}}var p=i(26);const f={width:"8rem"};class v extends r.b{constructor(){super(...arguments),this.flowRow=((e,t)=>{let i,{date:n,user:s,preState:r,state:a,action:l}=e;switch(void 0===l&&(l=o.createElement(o.Fragment,null,o.createElement(c.FA,{className:"text-primary",name:"pencil-square-o"})," \u5236\u5355")),a){case"$":break;case"#":i=o.createElement(o.Fragment,null,o.createElement(c.FA,{className:"text-success",name:"file-archive-o"}));break;default:i=o.createElement(o.Fragment,null,o.createElement(c.FA,{className:"text-muted",name:"arrow-right"})," \xa0 ",a)}return o.createElement(c.LMR,{left:o.createElement("div",{className:"pl-3 py-2",style:f},l),right:o.createElement("div",{className:"p-2"},o.createElement(c.Muted,null,o.createElement(c.EasyDate,{date:n})))},o.createElement("div",{className:"p-2"},i))}),this.sheetView=(()=>{let e,{brief:t,flows:i}=this.sheetData;return"-"===t.state&&(e=o.createElement("div",{className:"mx-3 my-2",style:{color:"red"}},"\u672c\u5355\u636e\u4f5c\u5e9f")),o.createElement("div",null,e,this.vForm.render(),o.createElement(c.List,{header:o.createElement(c.Muted,{className:"mx-3 my-1"},"\u6d41\u7a0b"),items:i,item:{render:this.flowRow}}))})}}var g=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class y extends v{constructor(){super(...arguments),this.onSubmit=(()=>g(this,void 0,void 0,function*(){let e=this.vForm.getValues();yield this.controller.saveSheet(e,this.vForm.values),this.closePage(),this.returnCall(this.vForm.values)})),this.view=(()=>o.createElement(s.Page,{header:this.label},this.vForm.render()))}open(e){return g(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(this.onSubmit,e.data,p.a.edit),this.openPage(this.view)})}}var b=i(5),w=i.n(b),E=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class x extends v{constructor(){super(...arguments),this.actionClick=(e=>E(this,void 0,void 0,function*(){let{id:t,flow:i,state:n}=this.sheetData.brief;yield this.controller.action(t,i,n,e.name);this.ceasePage(),this.openPage(this.acted)})),this.deleteClick=(()=>E(this,void 0,void 0,function*(){alert("\u5355\u636e\u4f5c\u5e9f\uff1a\u7a0b\u5e8f\u6b63\u5728\u8bbe\u8ba1\u4e2d")})),this.editClick=(()=>E(this,void 0,void 0,function*(){let e=yield this.controller.editSheet(this.sheetData);this.vForm.setValues(e)})),this.page=(()=>{let e,t,{brief:i}=this.sheetData,{state:n,no:r}=i,o=this.controller.getStateLabel(n),{states:l}=this.entity,c=l.find(e=>e.name===n);if(void 0===c){let t,i;switch(n){default:t="\u4e0d\u8ba4\u8bc6\u7684\u5355\u636e\u72b6\u6001'"+n+"'",i="text-info";break;case"-":t="\u5df2\u4f5c\u5e9f",i="text-danger";break;case"#":t="\u5df2\u5f52\u6863",i="text-success"}e=a.a.createElement("div",{className:w()(i)},"[",t,"]")}else e=a.a.createElement("div",{className:"flex-grow-1"},c.actions.map((e,t)=>a.a.createElement("button",{key:t,className:"btn btn-primary mr-2",onClick:()=>this.actionClick(e)},this.controller.getActionLabel(n,e.name)))),"$"===n&&(t=a.a.createElement("div",null,a.a.createElement("button",{className:"btn btn-outline-info ml-2",onClick:this.editClick},"\u4fee\u6539"),a.a.createElement("button",{className:"btn btn-outline-danger ml-2",onClick:this.deleteClick},"\u4f5c\u5e9f")));return a.a.createElement(s.Page,{header:this.label+":"+o+"-"+r},a.a.createElement("div",{className:"mb-2"},a.a.createElement("div",{className:"d-flex px-3 py-2 border-bottom bg-light"},e,t),a.a.createElement(this.sheetView,null)))}),this.acted=(()=>{let{discription:e}=this.sheetData.brief;return a.a.createElement(s.Page,{header:"\u5df2\u5904\u7406",back:"close"},a.a.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},a.a.createElement("div",{className:"p-3"},e),a.a.createElement("div",{className:"text-success"},a.a.createElement(c.FA,{name:"check-circle-o"})," \u5355\u636e\u5df2\u5904\u7406\uff01"),a.a.createElement("div",{className:"p-3"},a.a.createElement("button",{className:"btn btn-outline-info",onClick:()=>this.backPage()},"\u8fd4\u56de"))))})}open(e){return E(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(void 0,e.data),this.openPage(this.page)})}}var C=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class k extends r.b{constructor(){super(...arguments),this.view=(()=>o.createElement(s.Page,{header:this.label+"\u6a21\u677f"},o.createElement("pre",{className:"mx-3 my-2"},this.entity.schemaStringify())))}open(e){return C(this,void 0,void 0,function*(){this.openPage(this.view)})}}var P=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class N extends r.b{constructor(){super(...arguments),this.archiveClick=(e=>P(this,void 0,void 0,function*(){1!==e.processing&&this.event("archived",e)})),this.archiveRow=((e,t)=>{let{id:i,no:n,discription:s,date:r}=e,a=o.createElement(o.Fragment,null,1===e.processing?"... ":"",e.no," \xa0 ",e.discription),l=o.createElement(c.Muted,null,o.createElement(c.EasyDate,{date:r}));return o.createElement(c.LMR,{className:"px-3 py-2",left:a,right:l})}),this.view=(()=>o.createElement(s.Page,{header:"\u5df2\u5f52\u6863"+this.label},o.createElement(c.List,{items:this.list,item:{render:this.archiveRow,onClick:this.archiveClick}})))}open(){return P(this,void 0,void 0,function*(){this.list=yield this.entity.getArchives(void 0,10),this.openPage(this.view)})}}var S=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class A extends r.b{constructor(){super(...arguments),this.rowClick=(e=>S(this,void 0,void 0,function*(){1!==e.processing?this.event("action",e.id):this.event("processing",e.id)})),this.onScrollBottom=(()=>{console.log("onScrollBottom"),this.controller.pageStateItems.more()}),this.rowContent=(e=>{let{id:t,no:i,discription:n,date:s,processing:r}=e,a=o.createElement(o.Fragment,null,i," \xa0 ",o.createElement(c.Muted,null,n)," ",1===r?"...":""),l=o.createElement(c.Muted,null,o.createElement(c.EasyDate,{date:s}));return o.createElement(c.LMR,{className:"px-3 py-2",left:a,right:l})}),this.renderRow=((e,t)=>o.createElement(this.row,Object.assign({},e))),this.view=(()=>{let{pageStateItems:e}=this.controller;return o.createElement(s.Page,{header:this.label+" - "+this.stateLabel,onScrollBottom:this.onScrollBottom},o.createElement(c.List,{items:e,item:{render:this.renderRow,onClick:this.rowClick}}))})}open(e){return S(this,void 0,void 0,function*(){this.row=this.ui.listRow||this.rowContent,this.stateName=e.state,this.stateLabel=this.controller.getStateLabel(this.stateName),yield this.controller.pageStateItems.first(this.stateName),this.openPage(this.view)})}}var R=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class O extends v{constructor(){super(...arguments),this.view=(()=>{let{brief:e}=this.sheetData;return o.createElement(s.Page,{header:this.label+":-"+e.no},o.createElement(this.sheetView,null))})}open(e){return R(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(void 0,this.sheetData.data),this.openPage(this.view)})}}class F extends r.b{}var I=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class q extends F{constructor(){super(...arguments),this.restart=(()=>I(this,void 0,void 0,function*(){this.ceasePage(),yield this.event("new")})),this.actionClick=(e=>I(this,void 0,void 0,function*(){this.ceasePage();let{id:t,flow:i,state:n}=this.brief;yield this.controller.action(t,i,n,e.name);this.openPage(this.acted)})),this.buttons=o.createElement(o.Fragment,null,o.createElement("button",{className:"btn btn-outline-primary mr-3",onClick:this.restart},"\u7ee7\u7eed\u5f00\u5355"),o.createElement("button",{className:"btn btn-outline-info",onClick:()=>this.backPage()},"\u8fd4\u56de")),this.view=(()=>{let{states:e}=this.entity;let t=e.find(e=>"$"===e.name),i=o.createElement(o.Fragment,null,t.actions.map((e,t)=>o.createElement("button",{key:t,className:"btn btn-primary mr-3",onClick:()=>this.actionClick(e)},this.controller.getActionLabel("$",e.name))));return o.createElement(s.Page,{header:"\u5df2\u4fdd\u5b58",back:"close"},o.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},o.createElement("div",{className:"text-success"},o.createElement(c.FA,{name:"check-circle-o"})," \u5355\u636e\u5df2\u4fdd\u5b58\uff01\u7cfb\u7edf\u5c1a\u672a\u5904\u7406"),o.createElement("div",{className:"p-3"},i,this.buttons)))}),this.acted=(()=>o.createElement(s.Page,null,o.createElement("div",{className:"p-3 d-flex flex-column align-items-center"},o.createElement("div",{className:"text-success"},o.createElement(c.FA,{name:"check-circle-o"})," \u5355\u636e\u5df2\u5904\u7406\uff01"),o.createElement("div",{className:"p-3"},this.buttons))))}open(e){return I(this,void 0,void 0,function*(){this.brief=e,this.openPage(this.view)})}}var U=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class V extends v{constructor(){super(...arguments),this.page=(()=>{let{brief:e}=this.sheetData,{state:t,no:i}=e,n=this.controller.getStateLabel(t);return a.a.createElement(s.Page,{header:this.label+":"+n+"-"+i},a.a.createElement("div",{className:"mb-2"},a.a.createElement("div",{className:"d-flex px-3 py-2 border-bottom bg-light"},"\u6b63\u5728\u5904\u7406\u4e2d..."),a.a.createElement(this.sheetView,null)))})}open(e){return U(this,void 0,void 0,function*(){this.sheetData=e,this.vForm=this.createForm(void 0,e.data),this.openPage(this.page)})}}var j=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class T extends r.a{constructor(){super(...arguments),this.statesCount=n.l.array([],{deep:!0}),this.onSave=((e,t)=>j(this,void 0,void 0,function*(){let i=yield this.saveSheet(e,t);this.ceasePage(),yield this.showSaved(i)}))}internalStart(){return j(this,void 0,void 0,function*(){yield this.loadStateSheetCount(),this.pageStateItems=this.entity.createPageStateItems(),yield this.openVPage(this.VSheetMain)})}onMessage(e){return j(this,void 0,void 0,function*(){let{type:t,body:i,from:n,to:s,push:r}=e;"sheet"===t&&this.onSheet(n,s,i)})}onSheet(e,t,i){let n=this.user.id,{id:s,preState:r,state:o}=i;console.log({$:"onMessage sheet",from:e,to:t.join(","),id:s,preState:r,state:o,me:n,sheetData:i}),e===n&&this.sheetActPreState(s,r),void 0!==t.find(e=>e===n)&&this.sheetActState(s,o,i)}sheetActPreState(e,t){if(this.changeStateCount(t,-1),void 0===this.curState||this.curState!==t)return;let i=this.pageStateItems.items.findIndex(t=>t.id===e);i>=0&&this.pageStateItems.items.splice(i,1)}sheetActState(e,t,i){this.changeStateCount(t,1),void 0!==this.curState&&this.curState===t&&this.pageStateItems.items.findIndex(t=>t.id===e)<0&&this.pageStateItems.items.push(i)}changeStateCount(e,t){if(void 0===e)return;let i=this.statesCount.findIndex(t=>t.state===e);if(console.log({$:"changeState",state:e,delta:t,index:i}),i<0)return;let n=this.statesCount[i];n.count+=t,n.count<0&&(n.count=0)}get VSheetMain(){return this.ui&&this.ui.main||d}get VSheetNew(){return this.ui.sheetNew||m}get VSheetSaved(){return this.ui.sheetSaved||q}get VSheetEdit(){return this.ui.sheetEdit||y}get VSheetSchema(){return k}get VArchives(){return N}get VArchived(){return O}get VSheetList(){return A}get VSheetAction(){return this.ui.sheetAction||x}get VSheetProcessing(){return V}onEvent(e,t){return j(this,void 0,void 0,function*(){let i;switch(e){default:return;case"new":i=this.VSheetNew;break;case"schema":i=this.VSheetSchema;break;case"archives":i=this.VArchives;break;case"state":this.curState=t.state,i=this.VSheetList;break;case"archived":return void(yield this.showArchived(t));case"action":return void(yield this.showAction(t));case"processing":return void(yield this.showProcessing(t))}yield this.openVPage(i,t)})}startSheet(e){return j(this,void 0,void 0,function*(){!1!==(yield this.beforeStart())&&(yield this.onEvent("action",e))})}showAction(e){return j(this,void 0,void 0,function*(){let t=yield this.getSheetData(e);Object(s.postWsToTop)({body:{$type:"msg",action:"$sheet",msg:{id:e,uq:this.cUq.id,state:t.brief.state}}}),yield this.openVPage(this.VSheetAction,t)})}showProcessing(e){return j(this,void 0,void 0,function*(){let t=yield this.getSheetData(e);yield this.openVPage(this.VSheetProcessing,t)})}editSheet(e){return j(this,void 0,void 0,function*(){return yield this.vCall(this.VSheetEdit,e)})}showArchived(e){return j(this,void 0,void 0,function*(){let t=yield this.getArchived(e.id);yield this.openVPage(this.VArchived,t)})}showSaved(e){return j(this,void 0,void 0,function*(){yield this.openVPage(this.VSheetSaved,e)})}getStateUI(e){let{states:t}=this.res;if(void 0!==t)return t[e]}getStateLabel(e){let t=this.getStateUI(e),i=t&&t.label||e;switch(i){default:return i;case"$":return"\u65b0\u5355"}}getActionLabel(e,t){let i=this.getStateUI(e);if(void 0===i)return t;let n=i.actions;if(void 0===n)return t;let s=n[t];return s&&s.label||t}loadStateSheetCount(){return j(this,void 0,void 0,function*(){this.statesCount.clear();let e=yield this.entity.stateSheetCount();this.statesCount.splice(0,0,...e)})}getSheetData(e){return j(this,void 0,void 0,function*(){return yield this.entity.getSheet(e)})}getArchived(e){return j(this,void 0,void 0,function*(){return yield this.entity.getArchive(e)})}saveSheet(e,t){return j(this,void 0,void 0,function*(){let{sheetTitle:i}=this.ui,n=void 0===i?this.label:i(t,this.x);return yield this.entity.save(n,e)})}action(e,t,i,n){return j(this,void 0,void 0,function*(){return yield this.entity.action(e,t,i,n)})}}i.d(t,"a",function(){return T})},function(e,t,i){"use strict";var n=i(1),s=i(32),r=i(17),o=i(7),a=i(0),l=i.n(a),c=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class u extends o.b{constructor(){super(...arguments),this.view=(()=>a.createElement(n.Page,{header:this.label},"Book"))}open(e){return c(this,void 0,void 0,function*(){this.openPage(this.view)})}}var d=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class h extends o.a{internalStart(){return d(this,void 0,void 0,function*(){yield this.openVPage(this.VBookMain)})}get VBookMain(){return u}}var m=i(47),p=i(50),f=i(36),v=i(25),g=i(49),y=i(9),b=i(2);class w extends n.View{constructor(e){super(e),this.isSysVisible=!1,this.view=(()=>{let e,{res:t,uq:i,error:n}=this.controller,s={render:(e,t)=>e.render(),onClick:void 0},r=[{header:t.tuid||"TUID",items:this.tuidLinks},{cn:"my-2",header:t.map||"MAP",items:this.mapLinks},{cn:"my-2",header:t.sheet||"SHEET",items:this.sheetLinks},{cn:"my-2",header:t.action||"ACTION",items:this.actionLinks},{cn:"my-2",header:t.query||"QUERY",items:this.queryLinks},{cn:"mt-2 mb-4",header:t.book||"BOOK",items:this.bookLinks},{cn:"mt-2 mb-4",header:t.history||"HISTORY",items:this.historyLinks},{cn:"mt-2 mb-4",header:t.pending||"PENDING",items:this.pendingLinks}];return e=void 0!==n?l.a.createElement("div",{className:"p-3 text-danger"},"\u8fde\u63a5\u9519\u8bef: ",n):r.map(({cn:e,header:t,items:i},n)=>i.length>0&&l.a.createElement(b.List,{key:n,className:e,header:l.a.createElement("div",{className:"px-3 py-1 bg-light"},l.a.createElement(b.Muted,null,t)),items:i,item:s})),l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"px-3 py-1 small"},t.uq||i),e)});let{tuidArr:t,mapArr:i,sheetArr:n,actionArr:s,queryArr:o,bookArr:a,historyArr:c,pendingArr:u}=e.entities;this.tuidLinks=t.filter(e=>this.isVisible(e)).map(e=>new r.a(this.controller.cTuidMain(e))),this.mapLinks=i.filter(e=>this.isVisible(e)).map(e=>new r.a(this.controller.cMap(e))),this.sheetLinks=n.filter(e=>this.isVisible(e)).map(e=>new r.a(this.controller.cSheet(e))),this.actionLinks=s.filter(e=>this.isVisible(e)).map(e=>new r.a(this.controller.cAction(e))),this.queryLinks=o.filter(e=>this.isVisible(e)).map(e=>new r.a(this.controller.cQuery(e))),this.bookLinks=a.filter(e=>this.isVisible(e)).map(e=>new r.a(this.controller.cBook(e))),this.historyLinks=c.filter(e=>this.isVisible(e)).map(e=>new r.a(this.controller.cHistory(e))),this.pendingLinks=u.filter(e=>this.isVisible(e)).map(e=>new r.a(this.controller.cPending(e)))}isVisible(e){return!0!==e.sys||this.isSysVisible}render(e){return void 0===this.view?l.a.createElement("div",null,"??? viewModel \u5fc5\u987b\u5b9a\u4e49 view ???"):l.a.createElement(this.view)}}var E=i(51),x=i(52),C=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};function k(e){if(void 0!==e)for(let t in e)e[t.toLowerCase()]=e[t]}class P extends n.Controller{constructor(e,t,i,r,o,a){super(Object(n.resLang)(a.res)),this.schemaLoaded=!1,this.isSysVisible=!1,this.cApp=e,this.uq=t,this.id=r,k(a.tuid),k(a.sheet),k(a.map),k(a.query),k(a.action),k(a.book),k(a.history),k(a.pending),this.ui=a,this.CTuidMain=a.CTuidMain||v.d,this.CTuidEdit=a.CTuidEdit||v.a,this.CTuidList=a.CTuidList||v.c,this.CTuidSelect=a.CTuidSelect||v.e,this.CTuidInfo=a.CTuidInfo||v.b,this.CQuery=a.CQuery||f.a,this.CQuerySelect=a.CQuerySelect||f.b,this.CMap=a.CMap||g.a,this.CAction=a.CAction||p.a,this.CSheet=a.CSheet||m.a,this.CBook=a.CBook||h,this.CHistory=a.CHistory||E.a,this.CPending=a.CPending||x.a;let l,c,u=t.split("/");switch(u.length){case 1:l="$$$",c=u[0];break;case 2:l=u[0],c=u[1];break;default:return void console.log("uq must be uqOwner/uqName format")}let d,y,b=document.location.hash,w=void 0===b||""===b?"debug/":"tv/";d=null===o||void 0===o||"*"===o?[]:o.split(";").map(e=>e.trim()).filter(e=>e.length>0),y="$$$/$unitx"===t?new n.UnitxApi(n.appInFrame.unit):new n.UqApi(w,l,c,d,!0),this.entities=new s.a(this,y,i)}internalStart(){return C(this,void 0,void 0,function*(){})}loadEntites(){return C(this,void 0,void 0,function*(){yield this.entities.init(),yield this.entities.loadAccess()})}loadSchema(){return C(this,void 0,void 0,function*(){try{if(!0===this.schemaLoaded)return;yield this.loadEntites(),void 0===this.id&&(this.id=this.entities.uqId);for(let e in this.ui){let t=this.ui[e];if(void 0===t)continue;let{caption:i,collection:n}=t;if(void 0!==n)for(let s in n)void 0===this.entities[e](s)&&console.warn(e+":'"+s+"' is not uq entity")}return void(this.schemaLoaded=!0)}catch(e){return console.error(e),this.error=e}})}getQuerySearch(e){return C(this,void 0,void 0,function*(){let t=this.entities.query(e);if(void 0===t)alert(`QUERY ${e} \u6ca1\u6709\u5b9a\u4e49!`);else{yield t.loadSchema();let{returns:i}=t;i.length>1&&alert(`QUERY ${e} \u8fd4\u56de\u591a\u5f20\u8868, \u65e0\u6cd5\u505aQuerySearch`)}return t})}getTuidPlaceHolder(e){let t,{tuidPlaceHolder:i,entity:n}=this.res,{name:s}=e;if(void 0!==n){let e=n[s];void 0!==e&&(t=e.label)}return i||"Select"}getNone(){let{none:e}=this.res;return e||"none"}isVisible(e){return!0!==e.sys||this.isSysVisible}navSheet(e,t){return C(this,void 0,void 0,function*(){let i=this.entities.sheetFromTypeId(e);if(void 0===i)return void alert("sheetTypeId "+e+" is not exists!");let n=this.cSheet(i);yield n.startSheet(t)})}sheet(e){return this.entities.sheet(e)}action(e){return this.entities.action(e)}query(e){return this.entities.query(e)}book(e){return this.entities.book(e)}map(e){return this.entities.map(e)}history(e){return this.entities.history(e)}pending(e){return this.entities.pending(e)}tuid(e){return this.entities.tuid(e)}tuidDiv(e,t){let i=this.entities.tuid(e);if(void 0===i)return;let{divs:n}=i;return void 0!==n?n[t]:void 0}cSheetFromName(e){let t=this.entities.sheet(e);if(void 0!==t)return this.cSheet(t)}cActionFromName(e){let t=this.entities.action(e);if(void 0!==t)return this.cAction(t)}cQueryFromName(e){let t=this.entities.query(e);if(void 0!==t)return this.cQuery(t)}cBookFromName(e){let t=this.entities.book(e);if(void 0!==t)return this.cBook(t)}cMapFromName(e){let t=this.entities.map(e);if(void 0!==t)return this.cMap(t)}cHistoryFromName(e){let t=this.entities.history(e);if(void 0!==t)return this.cHistory(t)}cPendingFromName(e){let t=this.entities.pending(e);if(void 0!==t)return this.cPending(t)}cTuidMainFromName(e){let t=this.entities.tuid(e);if(void 0!==t)return this.cTuidMain(t)}cTuidEditFromName(e){let t=this.entities.tuid(e);if(void 0!==t)return this.cTuidEdit(t)}cTuidInfoFromName(e){let t=this.entities.tuid(e);if(void 0!==t)return this.cTuidInfo(t)}cTuidSelectFromName(e){let t=this.entities.tuid(e);if(void 0!==t)return this.cTuidSelect(t)}cFromName(e,t){switch(e){case"sheet":let i=this.entities.sheet(t);if(void 0===i)return;return this.cSheet(i);case"action":let n=this.entities.action(t);if(void 0===n)return;return this.cAction(n);case"tuid":let s=this.entities.tuid(t);if(void 0===s)return;return this.cTuidMain(s);case"query":let r=this.entities.query(t);if(void 0===r)return;return this.cQuery(r);case"book":let o=this.entities.book(t);if(void 0===o)return;return this.cBook(o);case"map":let a=this.entities.map(t);if(void 0===a)return;return this.cMap(a);case"history":let l=this.entities.history(t);if(void 0===l)return;return this.cHistory(l);case"pending":let c=this.entities.pending(t);if(void 0===c)return;return this.cPending(c)}}linkFromName(e,t){return this.link(this.cFromName(e,t))}getUI(e){let t,i,{name:n,typeName:s}=e;if(void 0!==this.ui){let e=this.ui[s];void 0!==e&&(t=e[n])}let{entity:r}=this.res;return void 0!==r&&(i=r[n]),{ui:t||{},res:i||{}}}link(e){return new r.a(e)}get tuidLinks(){return this.entities.tuidArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cTuidMain(e)))}cTuidMain(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidMain||this.CTuidMain)(this,e,t,i)}cTuidEdit(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidEdit||this.CTuidEdit)(this,e,t,i)}cTuidList(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidList||this.CTuidList)(this,e,t,i)}cTuidSelect(e){let{ui:t,res:i}=this.getUI(e.owner||e);return new(t&&t.CTuidSelect||this.CTuidSelect)(this,e,t,i)}cTuidInfo(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CTuidInfo||this.CTuidInfo)(this,e,t,i)}cSheet(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CSheet||this.CSheet)(this,e,t,i)}get sheetLinks(){return this.entities.sheetArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cSheet(e)))}cAction(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CAction||this.CAction)(this,e,t,i)}get actionLinks(){return this.entities.actionArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cAction(e)))}cQuery(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CQuery||this.CQuery)(this,e,t,i)}cQuerySelect(e){let t=this.entities.query(e);if(void 0===t)return;let{ui:i,res:n}=this.getUI(t);return new(i&&i.CQuerySelect||this.CQuerySelect)(this,t,i,n)}get queryLinks(){return this.entities.queryArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cQuery(e)))}cBook(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CBook||this.CBook)(this,e,t,i)}get bookLinks(){return this.entities.bookArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cBook(e)))}cHistory(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CHistory||this.CHistory)(this,e,t,i)}get historyLinks(){return this.entities.historyArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cHistory(e)))}cPending(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CPending||this.CPending)(this,e,t,i)}get pendingLinks(){return this.entities.pendingArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cPending(e)))}cMap(e){let{ui:t,res:i}=this.getUI(e);return new(t&&t.CMap||this.CMap)(this,e,t,i)}get mapLinks(){return this.entities.mapArr.filter(e=>this.isVisible(e)).map(e=>this.link(this.cMap(e)))}getTuidContent(e){let{owner:t}=e;if(void 0===t){let{ui:t}=this.getUI(e);return t&&t.content||y.b}{let{ui:i}=this.getUI(t);return i&&i.divs&&i.divs[e.name].content||y.b}}showTuid(e,t){return C(this,void 0,void 0,function*(){let{owner:i}=e,n=this.cTuidInfo(i||e);yield n.start(t)})}get VUq(){return w}render(){return new this.VUq(this).render()}}i.d(t,"a",function(){return P})},function(e,t,i){"use strict";var n=i(6),s=i.n(n),r=i(7),o=i(32),a=i(0),l=i(4),c=i(5),u=i.n(c),d=i(2),h=i(1),m=i(11),p=i(9),f=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class v extends r.b{constructor(){super(...arguments),this.itemRender=((e,t)=>a.createElement(this.ItemRow,{item:e})),this.ItemRow=Object(l.a)(({item:e})=>{let t,i,n,s,r,o,{tuid:l,box:c,children:h,isLeaf:f,keyIndex:v,values:g}=e,y=this.controller.keyUIs[v],{content:b,valuesContent:w,none:E}=y;if(!1===this.isFrom&&(t=a.createElement("button",{className:"btn btn-link btn-sm",onClick:()=>this.controller.addClick(e)},a.createElement(d.FA,{name:"plus"})),i=a.createElement("button",{className:"btn btn-link btn-sm",onClick:()=>this.controller.removeClick(e)},a.createElement(d.FA,{className:"text-info",name:"trash"}))),!1===f?n=0===v?t:a.createElement(a.Fragment,null,i," \xa0 ",t):v>0&&(n=i),!0===f)s=void 0,g&&(o=(w||p.b)(g,this.x));else{r="border-bottom";let e=E&&E(this.x);s=a.createElement(d.List,{className:"ml-4",items:h,item:{onClick:void 0,render:this.itemRender},none:e})}let x=a.createElement("div",{className:"py-1 pr-3"},Object(m.b)(c,b,this.x));return a.createElement("div",{className:"d-flex flex-column"},a.createElement(d.LMR,{className:u()("px-3","py-2",r),left:x,right:n},a.createElement("div",{className:"py-1"},o)),s)})}open(e){return f(this,void 0,void 0,function*(){this.isFrom=this.controller.isFrom,this.openPage(this.view)})}get view(){return()=>a.createElement(h.Page,{header:this.label},a.createElement(d.List,{items:this.controller.items,item:{className:"my-2",onClick:void 0,render:this.itemRender}}))}}var g=i(3),y=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class b extends r.b{constructor(){super(...arguments),this.onValuesSubmit=(()=>y(this,void 0,void 0,function*(){this.ceasePage();let e=this.vForm.getValues();this.returnCall(e)})),this.view=(()=>a.createElement(h.Page,null,this.vForm.render()))}open(e){return y(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onValuesSubmit),this.openPageElement(a.createElement(this.view,null))})}}var w=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class E{constructor(e,t,i,n){this.children=g.l.array([],{deep:!0}),this.parent=e,this.tuid=t,this.box=i,this.keyIndex=n,this.isLeaf=!1}}class x extends r.a{constructor(){super(...arguments),this.addClick=(e=>w(this,void 0,void 0,function*(){let{keyIndex:t,children:i}=e,n=this.keyFields.length,s=n-1,r=t+1;if(r>=n)return;let a=this.keyFields[r],l=a.name,c=a._tuid,u={},d={};for(let o=e;void 0!==o;o=o.parent){let{keyIndex:e,box:t}=o,i=this.keyFields[e].name;u[i]=d[i]=t.id}let h=yield this.searchOnKey(a,u);if(void 0===h||h<=0)return;c.useId(h);let m=c.boxId(h),p={},f={};if(t+1===s){if(c.useId(h),f[l]=p[l]=m,this.entity.fields.length>0){let e=yield this.vCall(b,d);for(let t in e)f[t]=p[t]=e[t]}}else{f[l]=d[l]=m;for(let t=r+1;t<s;t++)d[this.keyFields[t].name]=0;p[this.keyFields[s].name]=0;let{fields:e}=this.entity;for(let t of e){let{name:e,type:i,null:n}=t;!0!==n&&(p[t.name]=Object(o.b)(i))}}d.arr1=[p],yield this.entity.actions.add.submit(d);let v=i.findIndex(e=>e.box.id===h);if(v<0)i.push(this.createItem(e,c,m,r,f));else{let{fields:e}=this.entity;if(void 0!==e&&e.length>0){let e=i[v];i.splice(v,1),e.values=f,i.splice(v,0,e)}}this.removeCeased()})),this.removeClick=(e=>w(this,void 0,void 0,function*(){let t=this.keyFields[e.keyIndex]._tuid,i=this.cUq.cTuidMain(t.Main).getLable(t),n=this.res.confirmDelete||s.a.template("do you really want to remove ${label}?");if(!1===confirm(n({label:i})))return;let r=this.entity,o={},a={};(o.arr1=[]).push(a);for(let s=e;void 0!==s;s=s.parent){let e=s.keyIndex;a[this.keyFields[e].name]=s.box.id}let l=this.keyFields.length;for(let s=e.keyIndex+1;s<l;s++){a[this.keyFields[s].name]=-1}yield r.actions.del.submit(o);let c=e.parent.children,u=c.findIndex(t=>t===e);u>=0&&c.splice(u,1)}))}internalStart(){return w(this,void 0,void 0,function*(){let{keys:e,schemaFrom:t}=this.entity;this.isFrom=void 0!==t;let i=this.entity.queries.all,n=(yield i.query({})).ret,r=e.length;this.keyUIs=s.a.clone(this.ui.keys||[]),this.keyFields=[];let o=i.returns[0].fields;for(let s=0;s<r;s++)this.keyFields.push(o[s]),s>=this.keyUIs.length&&this.keyUIs.push({content:p.b});this.items=Object(g.l)([]);let a=void 0;for(let s of n){let e=this.addItem(a,s);void 0!==e&&(this.items.push(e),a=e)}yield this.openVPage(this.VMapMain)})}createItem(e,t,i,n,s){let r=new E(e,t,i,n);return n===this.keyFields.length-1&&(r.isLeaf=!0,r.values=s),r}addItem(e,t){let i=void 0,n=this.keyFields.length,s=e;for(let r=0;r<n;r++){let e=this.keyFields[r],{name:n}=e,o=e._tuid,a=t[n];if(void 0===a)break;let{id:l}=a;if(0===r){if(0===l)continue;void 0!==s&&s.box.id===l||(i=s=this.createItem(void 0,o,a,r,t));continue}let{children:c,box:u}=s,d=c.length;if(d>0){let e=c[d-1];if(e.box.id===l){s=e;continue}}l>0&&c.push(s=this.createItem(s,o,a,r,t))}return i}searchOnKey(e,t){return w(this,void 0,void 0,function*(){let{_tuid:i,_ownerField:n}=e,s=this.cUq.cTuidSelect(i),r=t;void 0!==n&&"object"===typeof(r=t[n.name])&&(r=r.id);let o=yield s.call(r);return i.getIdFromObj(o)})}get VMapMain(){return v}}i.d(t,"a",function(){return x}),i.d(t,"b",function(){return v})},function(e,t,i){"use strict";var n=i(7),s=i(0),r=i(1),o=i(11),a=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class l extends n.b{constructor(){super(...arguments),this.onSubmit=(()=>a(this,void 0,void 0,function*(){let e=this.vForm.getValues();this.returns=yield this.controller.submit(e),this.closePage(),this.openPage(this.resultPage)})),this.mainPage=(()=>{let{label:e}=this.controller;return s.createElement(r.Page,{header:e},this.vForm.render("mx-3 my-2"))}),this.resultPage=(()=>{let{label:e}=this.controller;return s.createElement(r.Page,{header:e,back:"close"},"\u5b8c\u6210\uff01",s.createElement("pre",null,Object(o.a)(this.returns)))})}open(e){return a(this,void 0,void 0,function*(){this.vForm=this.createForm(this.onSubmit,e),this.openPage(this.mainPage)})}}var c=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class u extends n.a{internalStart(){return c(this,void 0,void 0,function*(){yield this.openVPage(this.VActionMain)})}get VActionMain(){return l}submit(e){return c(this,void 0,void 0,function*(){return this.entity.submit(e)})}}i.d(t,"a",function(){return u})},function(e,t,i){"use strict";var n=i(7),s=i(0),r=i(1),o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a extends n.b{constructor(){super(...arguments),this.view=(()=>s.createElement(r.Page,{header:this.label},"History"))}open(e){return o(this,void 0,void 0,function*(){this.openPage(this.view)})}}var l=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class c extends n.a{internalStart(){return l(this,void 0,void 0,function*(){yield this.openVPage(this.VHistoryMain)})}get VHistoryMain(){return a}}i.d(t,"a",function(){return c})},function(e,t,i){"use strict";var n=i(7),s=i(0),r=i(1),o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a extends n.b{constructor(){super(...arguments),this.view=(()=>s.createElement(r.Page,{header:this.label},"pending"))}open(e){return o(this,void 0,void 0,function*(){this.openPage(this.view)})}}var l=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class c extends n.a{internalStart(){return l(this,void 0,void 0,function*(){yield this.openVPage(this.VPendingMain)})}get VPendingMain(){return a}}i.d(t,"a",function(){return c})},,function(e,t,i){"use strict";i.d(t,"a",function(){return r});var n=i(16),s=i(18);const r={set(e,t){Object(n.i)(e,t),s.a.setCenterToken(t)},clear(){Object(n.i)(0,void 0),s.a.setCenterToken(void 0)}}},function(e,t,i){"use strict";var n=i(10),s=i(22),r=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const o=new class extends n.a{login(e){return r(this,void 0,void 0,function*(){let t=yield this.get("login",e);switch(typeof t){default:return;case"string":return Object(s.b)(t);case"object":let e=t.token,i=Object(s.b)(e),{nick:n,icon:r}=t;return n&&(i.nick=n),r&&(i.icon=r),i}})}register(e){return r(this,void 0,void 0,function*(){return yield this.post("register",e)})}setVerify(e,t){return r(this,void 0,void 0,function*(){return yield this.post("set-verify",{account:e,type:t})})}checkVerify(e,t){return r(this,void 0,void 0,function*(){return yield this.post("check-verify",{account:e,verify:t})})}isExists(e){return r(this,void 0,void 0,function*(){return yield this.get("is-exists",{account:e})})}resetPassword(e,t,i,n){return r(this,void 0,void 0,function*(){return yield this.post("reset-password",{account:e,password:t,verify:i,type:n})})}userSetProp(e,t){return r(this,void 0,void 0,function*(){yield this.post("tie/user-set-prop",{prop:e,value:t})})}}("tv/user/",void 0);t.a=o},,function(e,t,i){"use strict";i.d(t,"a",function(){return s});const n="00000000000000";function s(e,t){if(void 0===e)return"";let i=e.toString(),s=t-i.length;return s<=0?i:n.substr(0,s)+i}},,,function(e,t,i){"use strict";i.d(t,"a",function(){return l}),i.d(t,"c",function(){return c}),i.d(t,"b",function(){return u});var n=i(0),s=i(8),r=i(15),o=i(10),a=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class l{constructor(e){this.isDev=o.j,this.onMessageReceive=(e=>a(this,void 0,void 0,function*(){yield this.onMessage(e)})),this.res=e||{},this.x=this.res.x||{}}get user(){return s.c.user}get isLogined(){let{user:e}=s.c;return void 0!==e&&e.id>0}dispose(){s.c.unregisterReceiveHandler(this.receiveHandlerId),this.onDispose()}onDispose(){}openVPage(e,t){return a(this,void 0,void 0,function*(){yield new e(this).open(t)})}renderView(e,t){return new e(this).render(t)}event(e,t){return a(this,void 0,void 0,function*(){yield this.onEvent(e,t)})}onEvent(e,t){return a(this,void 0,void 0,function*(){})}msg(e){alert(e)}errorPage(e,t){this.openPage(n.createElement(r.a,{header:"App error!"},n.createElement("pre",null,"string"===typeof t?t:t.message)))}onMessage(e){}beforeStart(){return a(this,void 0,void 0,function*(){return!0})}registerReceiveHandler(){this.receiveHandlerId=s.c.registerReceiveHandler(this.onMessageReceive)}start(e){return a(this,void 0,void 0,function*(){this.disposer=this.dispose.bind(this),this.registerReceiveHandler(),!1!==(yield this.beforeStart())&&(yield this.internalStart(e))})}get isCalling(){return void 0!==this._resolve_$}call(e){return a(this,void 0,void 0,function*(){return void 0===this._resolve_$&&(this._resolve_$=[]),new Promise((t,i)=>a(this,void 0,void 0,function*(){this._resolve_$.push(t),yield this.start(e)}))})}vCall(e,t){return a(this,void 0,void 0,function*(){return void 0===this._resolve_$&&(this._resolve_$=[]),new Promise((i,n)=>a(this,void 0,void 0,function*(){this._resolve_$.push(i),yield new e(this).open(t)}))})}returnCall(e){if(void 0===this._resolve_$)return;let t=this._resolve_$.pop();void 0!==t?t(e):alert("the Controller call already returned, or not called")}openPage(e){s.c.push(e,this.disposer),this.disposer=void 0}replacePage(e){s.c.replace(e,this.disposer),this.disposer=void 0}backPage(){s.c.back()}closePage(e){s.c.pop(e)}ceasePage(e){s.c.ceaseTop(e)}removeCeased(){s.c.removeCeased()}regConfirmClose(e){s.c.regConfirmClose(e)}}class c{constructor(e){this.controller=e,this.res=e.res,this.x=e.x}get isDev(){return o.j}renderVm(e,t){return new e(this.controller).render(t)}openVPage(e,t){return a(this,void 0,void 0,function*(){yield new e(this.controller).open(t)})}event(e,t){return a(this,void 0,void 0,function*(){yield this.controller.event(e,t)})}vCall(e,t){return a(this,void 0,void 0,function*(){return yield this.controller.vCall(e,t)})}returnCall(e){this.controller.returnCall(e)}openPage(e,t){this.controller.openPage(n.createElement(e,t))}replacePage(e,t){this.controller.replacePage(n.createElement(e,t))}openPageElement(e){this.controller.openPage(e)}replacePageElement(e){this.controller.replacePage(e)}backPage(){this.controller.backPage()}closePage(e){this.controller.closePage(e)}ceasePage(e){this.controller.ceasePage(e)}removeCeased(){this.controller.removeCeased()}regConfirmClose(e){this.controller.regConfirmClose(e)}}class u extends c{render(e){return null}}},function(e,t,i){"use strict";var n=i(62);i.o(n,"Edit")&&i.d(t,"Edit",function(){return n.Edit}),i.o(n,"Form")&&i.d(t,"Form",function(){return n.Form}),i.o(n,"Image")&&i.d(t,"Image",function(){return n.Image}),i.o(n,"emailRegex")&&i.d(t,"emailRegex",function(){return n.emailRegex}),i.o(n,"mobileRegex")&&i.d(t,"mobileRegex",function(){return n.mobileRegex}),i.o(n,"resLang")&&i.d(t,"resLang",function(){return n.resLang});var s=i(63);i.o(s,"Edit")&&i.d(t,"Edit",function(){return s.Edit}),i.o(s,"Form")&&i.d(t,"Form",function(){return s.Form}),i.o(s,"Image")&&i.d(t,"Image",function(){return s.Image}),i.o(s,"emailRegex")&&i.d(t,"emailRegex",function(){return s.emailRegex}),i.o(s,"mobileRegex")&&i.d(t,"mobileRegex",function(){return s.mobileRegex}),i.o(s,"resLang")&&i.d(t,"resLang",function(){return s.resLang})},function(e,t){},function(e,t){},function(e,t,i){"use strict";i.d(t,"b",function(){return n}),i.d(t,"a",function(){return s});const n=/^[0-9]*$/,s=/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(3),s=i(24),r=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},o=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class a{constructor(e=!1){this.isFirst=!0,this.loading=!1,this.beforeLoad=!0,this.loaded=!1,this.allLoaded=!1,this.firstSize=100,this.pageStart=void 0,this.pageSize=30,this.appendPosition="tail",this._items=n.l.array([],{deep:e})}get items(){return!0===this.beforeLoad?null:!1!==this.loaded?this._items:void 0}scrollToTop(){this.topDiv="$$"+Object(s.a)()}scrollToBottom(){this.bottomDiv="$$"+Object(s.a)()}reset(){this.isFirst=!0,this.beforeLoad=!0,this.loaded=!1,this.param=void 0,this.allLoaded=!1,this._items.clear(),this.setPageStart(void 0)}append(e){"tail"===this.appendPosition?this._items.unshift(e):this._items.push(e)}first(e){return o(this,void 0,void 0,function*(){this.reset(),this.beforeLoad=!1,this.param=e,yield this.more()})}more(){return o(this,void 0,void 0,function*(){if(!0===this.allLoaded)return;if(!0===this.loading)return;this.loading=!0;let e=this.pageSize+1;!0===this.isFirst&&this.firstSize>this.pageSize&&(e=this.firstSize+1);let t=yield this.load(this.param,this.pageStart,e);this.loading=!1,this.loaded=!0;let i=t.length;!0===this.isFirst&&i>this.firstSize||!1===this.isFirst&&i>this.pageSize?(this.allLoaded=!1,--i,t.splice(i,1)):this.allLoaded=!0,0!==i?(this.setPageStart(t[i-1]),"tail"===this.appendPosition?this._items.push(...t):this._items.unshift(...t.reverse()),this.isFirst=!1):this._items.clear()})}}r([n.l],a.prototype,"loading",void 0),r([n.l],a.prototype,"beforeLoad",void 0),r([n.l],a.prototype,"loaded",void 0),r([n.l],a.prototype,"allLoaded",void 0),r([n.e],a.prototype,"items",null),r([n.l],a.prototype,"topDiv",void 0),r([n.l],a.prototype,"bottomDiv",void 0)},function(e,t,i){"use strict";i.d(t,"a",function(){return r});var n=i(3),s=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class r{constructor(e=100){this.arr=[],this.dict=new Map,this.maxCount=e}loadIds(e){let t=[];for(let i of e){if(null===i)continue;let e=this.dict.get(i);void 0===e&&(t.push(i),e={id:i},this.dict.set(i,e))}this.loadId(t)}get(e){if(void 0===e||null===e)return null;let t=this.dict.get(e);return void 0===t&&(this.dict.set(e,{id:e}),this.loadId([e]),t=this.dict.get(e)),t}setItem(e,t){void 0===t?(this.dict.set(e,null),this.arr.push({id:e})):(this.dict.set(e,t),this.arr.push(t)),this.arr.length>this.maxCount&&(t=this.arr.shift(),this.dict.delete(t.id))}loadId(e){return s(this,void 0,void 0,function*(){let t=yield this._loadIds(e);if(void 0===t)for(let i of e){if(null===i)continue;let e=yield this._loadId(i);this.setItem(i,e)}else for(let i of e){let e=t.find(e=>e.id===i);this.setItem(i,e)}})}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([n.l],r.prototype,"dict",void 0)},function(e,t){},function(e,t){},function(e,t){},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i(0),s=i(4),r=i(42);let o=class extends n.Component{constructor(e){super(e),this.formView=new r.a(this.props)}componentWillMount(){this.formView.setInitValues(this.props.initValues)}debug(){}render(){let{className:e,children:t,initValues:i}=this.props;return n.createElement("div",{className:e},void 0===t?this.formView.render():n.createElement("form",{onSubmit:this.formView.onSubmit},t))}};o=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([s.a],o)},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i(0),s=i(5),r=i.n(s);class o extends n.Component{constructor(e){super(e),this.handleDocumentClick=(e=>{!1!==this.state.dropdownOpen&&(this.button&&this.button.contains(e.target)||this.menu&&this.toggle())}),this.toggle=(()=>{this.setState({dropdownOpen:!this.state.dropdownOpen})}),this.state={dropdownOpen:!1}}componentWillMount(){document.addEventListener("click",this.handleDocumentClick),document.addEventListener("touchstart",this.handleDocumentClick)}componentWillUnmount(){document.removeEventListener("click",this.handleDocumentClick),document.removeEventListener("touchstart",this.handleDocumentClick)}render(){let{icon:e,actions:t,isRight:i}=this.props;void 0===i&&(i=!0);let s=t.some(e=>void 0!==e.icon),{dropdownOpen:o}=this.state;return n.createElement("div",{className:"dropdown"},n.createElement("button",{ref:e=>this.button=e,className:"cursor-pointer dropdown-toggle btn btn-sm","data-toggle":"dropdown","aria-expanded":o,onClick:this.toggle},n.createElement("i",{className:r()("fa","fa-"+(e||"ellipsis-v"))})),n.createElement("div",{ref:e=>this.menu=e,className:r()({"dropdown-menu":!0,"dropdown-menu-right":i,show:o})},t.map((e,t)=>{let i,{icon:o,caption:a,action:l}=e;return void 0===o&&void 0===a?n.createElement("div",{className:"dropdown-divider"}):(!0===s&&(void 0!==o&&(o="fa-"+o),i=n.createElement(n.Fragment,null,n.createElement("i",{className:r()("fa",o,"fa-fw"),"aria-hidden":!0}),"\xa0 ")),void 0===l?n.createElement("h6",{className:"dropdown-header"},i," ",a):n.createElement("a",{className:"dropdown-item",key:t,href:"#",onClick:e=>{e.preventDefault(),l()}},i," ",a))})))}}},function(e,t,i){"use strict";i.d(t,"a",function(){return s});var n=i(0);class s extends n.Component{render(){let{date:e}=this.props;if(!e)return null;let t="string"===typeof e?new Date(Date.parse(e)):e,i=new Date,n=i.getTime()-t.getTime(),s=i.getDate(),r=t.getDate(),o=t.getHours(),a=t.getMinutes(),l=t.getMonth()+1,c=o+(a<10?":0":":")+a;return n<-864e5?t.getFullYear()+"\u5e74"+l+"\u6708"+r+"\u65e5 "+c:n<864e5?r!==s?(n<0?"\u660e\u5929 ":"\u6628\u5929 ")+c:c:n<31536e6?l+"\u6708"+r+"\u65e5 ":t.getFullYear()+"\u5e74"+l+"\u6708"+r+"\u65e5"}}},function(e,t,i){"use strict";i.d(t,"a",function(){return a});var n=i(0),s=i(5),r=i.n(s),o=i(1);class a extends n.Component{render(){let e,{icon:t,main:i,discription:s,px:a,py:l}=this.props;e="string"===typeof s?n.createElement("div",null,s):s;let c=r()("media",void 0===a?"px-0":"px-"+a,void 0===l?"py-2":"py-"+l);return n.createElement("div",{className:c},n.createElement(o.Image,{className:"mr-3 w-4c h-4c",src:t}),n.createElement("div",{className:"media-body"},n.createElement("h5",{className:"mt-0"},i),e))}}},function(e,t,i){"use strict";i.d(t,"a",function(){return l});var n=i(0),s=i(5),r=i.n(s),o=i(3),a=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class l extends n.Component{constructor(){super(...arguments),this.key=null,this.onChange=(e=>{this.key=e.target.value,void 0!==this.key&&(this.key=this.key.trim(),""===this.key&&(this.key=void 0)),!0!==this.props.allowEmptySearch&&(this.disabled=!this.key)}),this.onSubmit=(e=>a(this,void 0,void 0,function*(){if(e.preventDefault(),null===this.key&&(this.key=this.props.initKey||""),!0!==this.props.allowEmptySearch){if(!this.key)return;this.input&&(this.input.disabled=!0)}yield this.props.onSearch(this.key),this.input&&(this.input.disabled=!1)}))}clear(){this.input&&(this.input.value="")}render(){let e,t,{className:i,inputClassName:s,onFocus:o,label:a,placeholder:l,buttonText:c,maxLength:u,size:d}=this.props;switch(d){default:case"sm":e="input-group-sm";break;case"md":e="input-group-md";break;case"lg":e="input-group-lg"}return void 0!==a&&(t=n.createElement("label",{className:"input-group-addon"},a)),n.createElement("form",{className:i,onSubmit:this.onSubmit},n.createElement("div",{className:r()("input-group",e)},t,n.createElement("input",{ref:e=>this.input=e,onChange:this.onChange,type:"text",name:"key",onFocus:o,className:r()("form-control",s||"border-primary"),placeholder:l,defaultValue:this.props.initKey,maxLength:u}),n.createElement("div",{className:"input-group-append"},n.createElement("button",{className:"btn btn-primary",type:"submit",disabled:this.disabled},n.createElement("i",{className:"fa fa-search"}),n.createElement("i",{className:"fa"}),c))))}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([o.l],l.prototype,"disabled",void 0)},function(e,t,i){"use strict";i.d(t,"a",function(){return c});var n=i(0),s=i(6),r=i.n(s),o=i(5),a=i.n(o),l=i(41);class c extends n.Component{constructor(e){super(e),this.values={},this.stepViews=[],this.state={topView:void 0,stepViews:[]},this.onPrev=this.onPrev.bind(this),this.onNext=this.onNext.bind(this)}setStep(e){let t,i,s=this.props.steps[e];if(void 0===s)return;void 0!==this.topView&&this.stepViews.push(this.topView),this.stepViews.length>0&&(t=n.createElement(u,{prefix:"undo",text:"\u4e0a\u4e00\u6b65"}),i=this.onPrev);let{header:r,footer:o}=this.props,a=void 0===s.next?{prefix:"cloud-upload",text:this.props.submitButton||"\u63d0\u4ea4"}:{suffix:"arrow-right",text:"\u4e0b\u4e00\u6b65"},l={formRows:s.formRows,submitButton:n.createElement(u,Object.assign({},a)),onSubmit:this.onNext,otherButton:t,onOther:i};this.stepViews.length;this.topView={stepName:e,step:s,props:l},this.setState({topView:this.topView,stepViews:this.stepViews})}componentWillMount(){this.setStep(this.props.first)}onPrev(e){r.a.assign(this.values,e),this.topView=this.stepViews.pop(),this.setState({topView:this.topView,stepViews:this.stepViews})}onNext(e){r.a.assign(this.values,e);let t,{next:i}=this.topView.step;if(void 0===i)return this.props.onSubmit(this.values);t="string"===typeof i?i:i(this.values),this.setStep(t)}render(){let{className:e,header:t,footer:i}=this.props,{topView:s,stepViews:r}=this.state,{stepName:o,step:a}=s,c=r.length+1;return n.createElement("div",{className:e},n.createElement("div",null,t&&t(a,c),n.createElement(l.TonvaForm,Object.assign({key:o,initValues:this.values},s.props)),i&&i(a,c)))}}const u=e=>{let t,i,{prefix:s,text:r,suffix:o}=e;return void 0!==s&&(t=n.createElement("i",{className:a()("fa","fa-"+s)})),void 0!==o&&(i=n.createElement("i",{className:a()("fa","fa-"+o)})),n.createElement(n.Fragment,null,t," ",e.text," ",i)}},function(e,t,i){"use strict";i(0),i(43)},function(e,t){},function(e,t){},function(e,t,i){"use strict";var n=i(0),s=i(3),r=i(5),o=i.n(r),a=i(6),l=i.n(a);class c{}class u extends c{constructor(e){super(),this.func=e}check(e,t){let i=this.func(t);if(void 0!==i)switch(typeof i){case"undefined":return;case"string":return void e.push(i);default:return void e.push(...i)}}}class d extends c{constructor(e){super(),this.res=e}}class h extends d{check(e,t){switch(typeof t){default:case"boolean":return;case"object":if(null!==t)return;break;case"string":if(t.trim().length>0)return;break;case"number":if(NaN!==t)return;break;case"undefined":}e.push(this.res.required)}}class m extends d{constructor(e,t,i){super(e),this.minMsg=l.a.template(e.min),this.maxMsg=l.a.template(e.max),this.min=t,this.max=i}check(e,t){if(void 0===t||null===t)return;let i=Number(t);NaN===i?e.push(this.res.number):this.checkMore(e,i)}checkMore(e,t){void 0!==this.min&&Number(t)<this.min&&e.push(this.minMsg({min:this.min})),void 0!==this.max&&Number(t)>this.max&&e.push(this.maxMsg({max:this.max}))}}class p extends m{checkMore(e,t){super.checkMore(e,t),!1===Number.isInteger(t)&&e.push(this.res.integer)}}var f=i(4),v=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};class g{constructor(e,t,i,s){this.errors=[],this.contextErrors=[],this.onInputChange=(e=>{this.changeValue(e.target.value,!0)}),this.container=Object(f.a)(()=>{if(!1===this.visible)return null;let{form:e,inNode:t}=this.context;if(!0===t)return this.render();let i=this.label;return!0===this.itemSchema.required&&!1!==e.props.requiredFlag&&null!==i&&(i=n.createElement(n.Fragment,null,i,"\xa0",n.createElement("span",{className:"text-danger"},"*"))),e.FieldContainer(i,this.render())}),this.context=e;let{name:r}=t;if(this.name=r,this.itemSchema=t,this.fieldProps=i,this.children=s,this.ui=e.getUiItem(r),void 0===this.ui)this.readOnly=!1,this.disabled=!1,this.visible=!0;else{let{readOnly:e,disabled:t,visible:i}=this.ui;this.readOnly=!0===e,this.disabled=!0===t,this.visible=!(!1===i)}this.value=this.defaultValue=e.getValue(r),this.init()}get hasError(){return this.errors.length+this.contextErrors.length>0}init(){if(this.rules=[],!0===this.itemSchema.required&&this.rules.push(new h(this.context.form.res)),this.buildRules(),void 0===this.ui)return;let{rules:e}=this.ui;if(void 0!==e)if(!1!==Array.isArray(e))for(let t of e)this.rules.push(new u(t));else this.rules.push(new u(e))}buildRules(){}checkRules(){let e=[];for(let t of this.rules)t.check(e,this.value);0===e.length?this.context.removeErrorWidget(this):(this.context.addErrorWidget(this),this.errors.push(...e))}get isOk(){return 0===this.errors.length}setError(e){void 0!==e&&("string"===typeof e?this.errors.push(e):this.errors.push(...e))}setContextError(e){void 0!==e&&("string"===typeof e?this.contextErrors.push(e):this.contextErrors.push(...e))}clearError(){this.errors.splice(0)}clearContextError(){this.contextErrors.splice(0)}parse(e){return e}setElementValue(e){}setDataValue(e){!0!==this.isChanging&&(this.context.initData[this.name]=this.value=this.parse(e))}setValue(e){!0!==this.isChanging&&this.changeValue(e,!1)}getValue(){return this.context.getValue(this.name)}getReadOnly(){return this.readOnly}getDisabled(){return this.disabled}getVisible(){return this.visible}setReadOnly(e){this.readOnly=e}setDisabled(e){this.disabled=e}setVisible(e){this.visible=e}changeValue(e,t){let i,n,s=this.value;void 0!==this.ui&&(i=this.ui.onChanging,n=this.ui.onChanged);let r=!0;void 0!==i&&(this.isChanging=!0,r=i(this.context,this.value,s),this.isChanging=!1),!0===r&&(this.setDataValue(e),!0!==t&&this.setElementValue(e),void 0!==n&&(this.isChanging=!0,n(this.context,this.value,s),this.isChanging=!1))}get className(){let e;return!1===this.context.inNode&&(e="form-control"),o()(e,this.context.form.FieldClass,this.ui&&this.ui.className)}get label(){let e;if(void 0===this.ui)e=this.name;else{let t=this.ui.label;e=null===t?null:t||this.name}return e}renderTemplet(){if(void 0!==this.children)return n.createElement(n.Fragment,null,this.children);if(void 0===this.ui)return;let{Templet:e}=this.ui;return"function"===typeof e?e(this.value):e}renderErrors(){let e=[...this.errors,...this.contextErrors];if(0===e.length)return null;let{inNode:t}=this.context,i=!0===t?"span":"div";return e.map(e=>n.createElement(i,{key:e,className:"text-danger d-inline-block my-2 ml-3"},n.createElement(n.Fragment,null,n.createElement("i",{className:"fa fa-exclamation-circle"})," \xa0",e)))}}v([s.l],g.prototype,"errors",void 0),v([s.l],g.prototype,"contextErrors",void 0),v([s.e],g.prototype,"hasError",null),v([s.l],g.prototype,"visible",void 0),v([s.e],g.prototype,"isOk",null);var y=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class b extends g{constructor(){super(...arguments),this.inputType="text",this.onKeyDown=(e=>y(this,void 0,void 0,function*(){if(this.internalOnKeyDown(e),13!==e.keyCode)return;let{onEnter:t}=this.context.form.props;if(void 0===t)return;this.changeValue(e.currentTarget.value,!0),this.input.blur();let i=yield t(this.name,this.context);void 0!==i&&this.context.setError(this.name,i)}))}setElementValue(e){null!==this.input&&(this.input.value=e)}get placeholder(){return this.ui&&this.ui.placeholder||this.name}internalOnKeyDown(e){}onBlur(e){this.onInputChange(e),this.checkRules(),this.context.checkContextRules()}onFocus(e){this.clearError(),this.context.removeErrorWidget(this),this.context.clearErrors()}onChange(e){}setReadOnly(e){null!==this.input&&(this.input.readOnly=this.readOnly=e)}setDisabled(e){null!==this.input&&(this.input.disabled=this.disabled=e)}render(){let e=this.renderTemplet();if(void 0!==e)return e;let t={};return!0===this.hasError?t["is-invalid"]=!0:t["required-item"]=!0===this.itemSchema.required,n.createElement(n.Fragment,null,n.createElement("input",{ref:e=>this.input=e,className:o()(this.className,t),type:this.inputType,defaultValue:this.value,onChange:e=>this.onChange(e),placeholder:this.placeholder,readOnly:this.readOnly,disabled:this.disabled,onKeyDown:this.onKeyDown,onFocus:e=>this.onFocus(e),onBlur:e=>this.onBlur(e),maxLength:this.itemSchema.maxLength}),this.renderErrors())}}class w extends b{constructor(){super(...arguments),this.inputType="number"}buildRules(){super.buildRules();let e=this.context.form.res,{min:t,max:i}=this.itemSchema;this.rules.push("integer"===this.itemSchema.type?new m(e,t,i):new p(e,t,i))}parse(e){if(void 0!==e&&null!==e)return Number(e)}}class E extends w{constructor(){super(...arguments),this.inputType="number"}isValidKey(e){return 46===e||8===e||37===e||39===e||e>=48&&e<=57||e>=96&&e<=105||109===e||189===e}internalOnKeyDown(e){let t=e.keyCode;event.returnValue=this.isValidKey(t)}}class x extends b{constructor(){super(...arguments),this.inputType="date"}}class C extends g{constructor(){super(...arguments),this.onInputChange=(e=>{this.setDataValue(!0===e.target.checked?this.trueValue:this.falseValue)}),this.onClick=(()=>{this.context.clearErrors()})}init(){if(super.init(),void 0!==this.ui){let{trueValue:e,falseValue:t}=this.ui;this.trueValue=void 0===e||e,this.falseValue=void 0!==t&&t}else this.trueValue=!0,this.falseValue=!1}setElementValue(e){this.input.checked=e===this.trueValue}setReadOnly(e){this.input.readOnly=this.readOnly=e}setDisabled(e){this.input.disabled=this.disabled=e}render(){let e=o()(this.className,"form-check-inline p-0"),t=n.createElement("input",{ref:e=>this.input=e,className:"align-self-center",type:"checkbox",defaultChecked:this.defaultValue,onChange:this.onInputChange,onClick:this.onClick});return!0===this.context.inNode?n.createElement("label",{className:e},t," ",this.ui&&this.ui.label||this.name):n.createElement("div",{className:e},n.createElement("label",{className:"w-100 h-100 mb-0 d-flex justify-content-center"},t))}}class k extends g{constructor(){super(...arguments),this.onInputChange=(e=>{this.setDataValue(e.target.value)})}setElementValue(e){this.select.value=e}setReadOnly(e){this.select.disabled=this.readOnly=!e}setDisabled(e){this.select.disabled=this.disabled=e}render(){if(!0===this.readOnly){let e=this.ui.list.find(e=>e.value===this.value),t=void 0===e?"(???)":e.title;return n.createElement("span",{className:"form-control w-min-6c"},t)}return n.createElement("select",{ref:e=>this.select=e,className:o()(this.className,"form-control"),defaultValue:this.defaultValue,onChange:this.onInputChange},this.ui.list.map((e,t)=>{let{title:i,value:s}=e;return n.createElement("option",{className:void 0,key:t,value:s},i||s)}))}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([s.l],k.prototype,"readOnly",void 0);var P=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class N extends g{constructor(){super(...arguments),this.onClick=(()=>P(this,void 0,void 0,function*(){let e=this.ui&&this.ui.pickId;if(void 0===e)return void alert("no pickId defined!");let t=yield e(this.context,this.name,this.value);this.setDataValue(t),this.clearError(),this.clearContextError(),this.checkRules()}))}setReadOnly(e){this.readOnly=e}setDisabled(e){this.disabled=e}render(){let e,t;void 0!==this.ui&&(e=this.ui.placeholder,t=this.ui.Templet);let i,s={"form-control":!0,"required-item":!0===this.itemSchema.required,"cursor-pointer":!0,"is-invalid":this.hasError};return void 0===this.value||null===this.value?(i=e||"placeholder",s["text-muted"]=!0):i=void 0===t?n.createElement(n.Fragment,null,this.value):"function"===typeof t?t(this.value):t,n.createElement(n.Fragment,null,n.createElement("div",{className:o()(s),onClick:this.onClick},i),this.renderErrors())}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([s.l],N.prototype,"value",void 0);const S=(e,t,i)=>n.createElement("span",{className:"text-danger"},"!!data type ",e," only support ",(i||[]).join(", "),", can't use ui ",t,"!!");var A=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class R extends g{constructor(){super(...arguments),this.onClick=(()=>A(this,void 0,void 0,function*(){this.clearError(),this.clearContextError();let{name:e,type:t}=this.itemSchema;"submit"===t&&(yield this.context.submit(e))})),this.observerRender=Object(f.a)(()=>{let e,t,i,{name:s,type:r}=this.itemSchema;if(void 0!==this.ui){let{widget:n}=this.ui;if("button"!==n)return S(r,n,["button"]);e=this.ui.Templet,t=this.ui.className,i=this.ui.label}let o,{form:a,hasError:l}=this.context,c=this.context,u="submit"===r&&l;o=void 0!==this.children?this.children:"function"===typeof e?e():void 0!==e?e:i;let d=n.createElement("button",{className:t,type:"button",disabled:u,onClick:this.onClick},o||s);return!0===c.inNode?n.createElement(n.Fragment,null,d,this.renderErrors()):n.createElement("div",{className:a.ButtonClass},n.createElement("div",null,this.renderErrors()),d)})}get label(){return null}render(){return n.createElement(this.observerRender,null)}}var O=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},F=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class I{constructor(e,t,i,s,r){if(this.widgets={},this.errors=[],this.errorWidgets=[],this.renderErrors=Object(f.a)(()=>{let{errors:e}=this;return 0===e.length?null:n.createElement(n.Fragment,null,e.map(e=>n.createElement("span",{key:e,className:"text-danger inline-block my-1 ml-3"},n.createElement("i",{className:"fa fa-exclamation-circle"})," \xa0",e)))}),this.form=e,this.uiSchema=t,this.initData=i,this.inNode=s,this.isRow=r,void 0!==t){let{rules:e}=t;void 0!==e&&(this.rules=[],!1===Array.isArray(e)?this.rules.push(e):this.rules.push(...e))}}getArrRowContexts(e){void 0===this.subContexts&&(this.subContexts={});let t=this.subContexts[name];return void 0===t&&(this.subContexts[name]=t={}),t}get arrName(){}getValue(e){return this.initData[e]}setValue(e,t){this.initData[e]=t;let i=this.widgets[e];void 0!==i&&i.setValue(t)}getDisabled(e){let t=this.widgets[e];if(void 0!==t)return t.getDisabled()}setDisabled(e,t){let i=this.widgets[e];void 0!==i&&i.setDisabled(t)}getReadOnly(e){let t=this.widgets[e];void 0!==t&&t.getReadOnly()}setReadOnly(e,t){let i=this.widgets[e];void 0!==i&&i.setReadOnly(t)}getVisible(e){let t=this.widgets[e];void 0!==t&&t.getVisible()}setVisible(e,t){let i=this.widgets[e];void 0!==i&&i.setVisible(t)}submit(e){return F(this,void 0,void 0,function*(){if(this.checkRules(),!0===this.hasError)return;let{onButtonClick:t}=this.form.props;if(void 0===t)return void alert(`button ${e} clicked. you should define form onButtonClick`);let i=yield t(e,this);void 0!==i&&this.setError(e,i)})}checkFieldRules(){for(let e in this.widgets)this.widgets[e].checkRules();if(void 0!==this.subContexts)for(let e in this.subContexts){let t=this.subContexts[e];for(let e in t)t[e].checkFieldRules()}}checkContextRules(){if(this.clearErrors(),void 0!==this.rules){for(let e of this.rules){let t=e(this);if(void 0!==t)if(!0===Array.isArray(t))this.errors.push(...t);else if("string"===typeof t)this.errors.push(t);else for(let e in t)this.setError(e,t[e])}if(void 0!==this.subContexts)for(let e in this.subContexts){let t=this.subContexts[e];for(let e in t){let i=t[e];i.clearErrors(),i.checkContextRules()}}}}setError(e,t){let i=this.widgets[e];void 0!==i&&(i.setContextError(t),this.addErrorWidget(i))}clearContextErrors(){for(let e in this.widgets){let t=this.widgets[e];void 0!==t&&t.clearContextError()}}clearWidgetsErrors(){for(let e in this.widgets){let t=this.widgets[e];void 0!==t&&t.clearError()}}checkRules(){this.clearErrors(),this.clearWidgetsErrors(),this.checkFieldRules(),!0!==this.hasError&&this.checkContextRules()}addErrorWidget(e){this.errorWidgets.findIndex(t=>t===e)<0&&this.errorWidgets.push(e)}removeErrorWidget(e){let t=this.errorWidgets.findIndex(t=>t===e);t>=0&&this.errorWidgets.splice(t,1)}checkHasError(){if(!0===this.errorWidgets.length+this.errors.length>0)return!0;if(void 0===this.subContexts)return!1;for(let e in this.subContexts){let t=this.subContexts[e];for(let e in t)if(!0===t[e].hasError)return!0}return!1}get hasError(){return this.checkHasError()}clearErrors(){this.errors.splice(0),this.errorWidgets.splice(0),this.clearContextErrors()}}O([s.l],I.prototype,"errors",void 0),O([s.l],I.prototype,"errorWidgets",void 0),O([s.e],I.prototype,"hasError",null);let q=1;class U extends I{constructor(e,t,i,n){let s,{uiSchema:r}=e;if(void 0!==r){let{items:e}=r;void 0!==e&&(s=e[t.name])}super(e.form,s,i,n,!0),this.parentContext=e,this.arrSchema=t,this.rowKey=q++,this.data=i}getItemSchema(e){return this.arrSchema.itemSchemas[e]}getUiItem(e){if(void 0===this.uiSchema)return;let{items:t}=this.uiSchema;return void 0!==t?t[e]:void 0}get arrName(){return this.arrSchema.name}clearErrors(){super.clearErrors(),this.parentContext.clearErrors()}get parentData(){return this.parentContext.data}}class V extends I{constructor(e,t){super(e,e.uiSchema,e.data,t,!1)}get data(){return this.form.data}getItemSchema(e){return this.form.itemSchemas[e]}getUiItem(e){let{uiSchema:t}=this.form;if(void 0===t)return;let{items:i}=t;return void 0!==i?i[e]:void 0}}const j=n.createContext({}),T=Object(f.a)(({parentContext:e,arrSchema:t,children:i})=>{let s,r,a,l,{name:c,arr:u}=t,d=e.initData[c],{form:h}=e,m=e.getArrRowContexts(c),p=e.getUiItem(c),v=c,{ArrContainer:g,RowContainer:y,RowSeperator:b,uiSchema:w}=h;if(void 0!==w){let{selectable:e,deletable:t,restorable:i}=w;!0!==r&&(r=e),!0!==a&&(a=t),!0!==l&&(l=i)}if(void 0!==p){let{widget:e,label:i,selectable:n,deletable:o,restorable:c,ArrContainer:u,RowContainer:d,RowSeperator:h}=p;if(void 0!==n&&(r=n),void 0!==o&&(a=o),void 0!==c&&(l=c),void 0!==u&&(g=u),void 0!==d&&(y=d),void 0!==h&&(b=h),s=p.Templet,"arr"!==e)return S(t.type,e,["arr"]);v=i||v}let E=!0;return g(v,n.createElement(n.Fragment,null,d.map((c,h)=>{let p,v,g=void 0;if(!1===E?g=b:E=!1,void 0!==i)p=new U(e,t,c,!0),v=n.createElement(n.Fragment,null,i);else{let i=typeof s;"function"===i?(p=new U(e,t,c,!0),v=n.createElement(Object(f.a)(s),c)):"object"===i?(p=new U(e,t,c,!0),v=s):(p=new U(e,t,c,!1),v=n.createElement(n.Fragment,null,u.map((e,t)=>n.createElement(n.Fragment,{key:e.name},H(p,e,void 0)))))}let w,x,{rowKey:C}=p;if(m[C]=p,!0===r){let e=e=>{let{checked:t}=e.target;c.$isSelected=t;let{$source:i}=c;void 0!==i&&(i.$isSelected=t),p.clearErrors()};w=n.createElement("div",{className:"form-row-checkbox"},n.createElement("input",{type:"checkbox",onClick:e,defaultChecked:c.$isSelected}))}let k=!(void 0===c.$isDeleted||!1===c.$isDeleted);if(!0===a){let e=k?"fa-undo":"fa-trash",t=()=>{if(!0===l){c.$isDeleted=!k;let{$source:e}=c;void 0!==e&&(e.$isDeleted=!k)}else{let e=d.indexOf(c);e>=0&&d.splice(e,1)}p.clearErrors()};x=n.createElement("div",{className:"form-row-edit text-info",onClick:t},n.createElement("i",{className:o()("fa",e,"fa-fw")}))}let P=!0===r||!0===a?e=>n.createElement("fieldset",{disabled:k},n.createElement("div",{className:o()("d-flex",{deleted:k,"row-selected":c.$isSelected})},w,n.createElement("div",{className:!0===r&&!0===a?"form-row-content":"form-row-content-1"},e),x)):e=>e;return n.createElement(j.Provider,{key:C,value:p},g,y(P(n.createElement(n.Fragment,null,n.createElement(p.renderErrors,null),v))))})))});var L=i(20),M=i(37),D=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class _ extends g{constructor(){super(...arguments),this.onClick=(()=>D(this,void 0,void 0,function*(){let e=new M.a(this.itemSchema,this.ui,this.ui.label,this.value),t=yield e.start();null!==t&&(this.setValue(t),this.imageSrc=t),yield e.end()})),this.observerRender=Object(f.a)(()=>{let e,t=["bg-white p-1 d-flex justify-content-center"];return this.readOnly||this.disabled||(t.push("cursor-pointer"),e=this.onClick),n.createElement("div",{className:o()(t),onClick:e},n.createElement(L.a,{src:this.imageSrc,className:"w-4c h-4c"}))})}init(){super.init(),this.imageSrc=this.value}render(){return n.createElement(this.observerRender,null)}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([s.l],_.prototype,"imageSrc",void 0);const B={id:{dataTypes:["id"],widget:N},text:{dataTypes:["integer","number","string"],widget:b},textarea:{dataTypes:["string"],widget:class extends g{constructor(){super(...arguments),this.onInputChange=(e=>{this.setValue(e.currentTarget.value)})}setElementValue(e){this.input.value=e}setReadOnly(e){this.input.readOnly=this.readOnly=e}setDisabled(e){this.input.disabled=this.disabled=e}render(){let e=this.renderTemplet();if(void 0!==e)return e;let t={};return!0===this.hasError?t["is-invalid"]=!0:t["required-item"]=!0===this.itemSchema.required,n.createElement("textarea",{ref:e=>this.input=e,className:o()(this.className,t),rows:this.ui&&this.ui.rows,maxLength:this.itemSchema.maxLength,defaultValue:this.defaultValue,onChange:this.onInputChange})}}},password:{dataTypes:["string"],widget:class extends b{constructor(){super(...arguments),this.inputType="password"}}},date:{dataTypes:["date"],widget:x},datetime:{dataTypes:["date"],widget:class extends b{constructor(){super(...arguments),this.inputType="datetime"}}},time:{dataTypes:["date"],widget:class extends b{constructor(){super(...arguments),this.inputType="time"}}},month:{dataTypes:["date"],widget:class extends b{constructor(){super(...arguments),this.inputType="month"}}},select:{dataTypes:["integer","number","string","date","boolean"],widget:k},url:{dataTypes:["string"],widget:class extends b{constructor(){super(...arguments),this.inputType="url"}}},email:{dataTypes:["string"],widget:class extends b{constructor(){super(...arguments),this.inputType="email"}}},number:{dataTypes:["integer","number"],widget:w},updown:{dataTypes:["integer","number"],widget:E},color:{},checkbox:{dataTypes:["boolean","integer","number"],widget:C},image:{dataTypes:["string"],widget:_},checkboxes:{},radio:{dataTypes:["integer","number","string","date","boolean"],widget:class extends g{constructor(){super(...arguments),this.inputs={}}setElementValue(e){for(let t in this.inputs){let i=this.inputs[t];i.checked=e===i.value}}setReadOnly(e){this.readOnly=e;for(let t in this.inputs)this.inputs[t].readOnly=e}setDisabled(e){this.disabled=e;for(let t in this.inputs)this.inputs[t].disabled=e}render(){let e,{defaultValue:t,list:i}=this.ui,{isRow:s,inNode:r}=this.context;!0===s&&(e=this.context.rowKey);let a=o()(this.className,"form-radio-inline");return n.createElement("span",{className:a},i.map((i,s)=>{let{value:r,title:o}=i,a=this.name;return void 0!==e&&(a+="-"+e),n.createElement("label",{key:s,className:"form-radio-inline"},n.createElement("input",{ref:e=>this.inputs[s]=e,type:"radio",name:a,value:r,defaultChecked:(this.defaultValue||t)===r}),o||r)}))}}},range:{dataTypes:["integer"],widget:class extends g{constructor(){super(...arguments),this.inputType="range"}setReadOnly(e){this.input.readOnly=this.readOnly=e}setDisabled(e){this.input.disabled=this.disabled=e}render(){let{min:e,max:t,step:i}=this.ui;return n.createElement(n.Fragment,null,n.createElement("input",{ref:e=>this.input=e,className:o()(this.className,"form-control","w-min-6c"),type:this.inputType,defaultValue:this.defaultValue,onChange:this.onInputChange,max:t,min:e,step:i}))}}},button:{dataTypes:["button","submit"],widget:R}};function H(e,t,i,s){if(void 0===e)return null;if(void 0===t)return;let r,{name:o,type:a}=t;switch(a){case"arr":let t=e.getItemSchema(o);return n.createElement(T,{parentContext:e,arrSchema:t,children:i})}let l=e.getUiItem(o);function c(e){switch(e){default:return b;case"id":return N;case"integer":return E;case"number":return w;case"string":return b;case"date":return x;case"boolean":return C;case"button":case"submit":return R}}if(void 0===l)r=c(a);else{let{widget:e}=l;switch(e){default:if(void 0!==e){r=B[e].widget}void 0===r&&(r=c(a));break;case"custom":r=l.WidgetClass;break;case"group":return n.createElement("span",null,"impletment group")}}let{isRow:u,widgets:d}=e,h=new r(e,t,s,i);return d[o]=h,n.createElement(h.container,null)}i(59);const $={_:{required:"required",number:"not valid number",integer:"not valid integer",min:"min value is ${min}",max:"max value is ${max}"},zh:{_:{required:"\u5fc5\u987b\u586b",number:"\u9700\u8981\u6570\u5b57",integer:"\u9700\u8981\u6574\u6570",min:"\u4e0d\u80fd\u5c0f\u4e8e${min}",max:"\u4e0d\u80fd\u5927\u4e8e${max}"}}};var z=i(29),W=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Q extends n.Component{constructor(e){super(e),this.watch=(()=>{let{formData:e}=this.props;void 0!==e&&this.calcSelectOrDelete()}),this.DefaultContainer=(e=>n.createElement("form",{className:o()(this.props.className),onSubmit:e=>e.preventDefault()},e)),this.DefaultFieldContainer=((e,t)=>{let{fieldLabelSize:i}=this.props;if(i>0){let s;null===e?i=0:s=n.createElement("label",{className:o()("col-sm-"+i,"col-form-label")},e);let r="col-sm-"+(12-i);return n.createElement("div",{className:"form-group row"},s,n.createElement("div",{className:r},t))}return n.createElement("div",{className:"form-group"},null===e?null:n.createElement("label",{className:"col-form-label"},e),t)}),this.DefaultFieldClass=void 0,this.DefaultButtonClass="text-center py-2",this.DefaultRes=Object(z.a)($),this.ArrContainer=((e,t)=>n.createElement("div",null,n.createElement("div",{className:o()("small text-muted text-center bg-light py-1 px-3 mt-4 mb-1")},e),t)),this.RowContainer=(e=>{let t=o()({"py-3":!0});return n.createElement("div",{className:t},e)}),this.RowSeperator=n.createElement("div",{className:"border border-gray border-top"});let{schema:t,uiSchema:i,formData:r,Container:a,FieldContainer:l,FieldClass:c,ButtonClass:u,res:d}=e;this.Container=a||this.DefaultContainer,this.FieldContainer=l||this.DefaultFieldContainer,this.FieldClass=void 0!==c&&""!==c&&null!==c?c:this.DefaultFieldClass,this.res=d||this.DefaultRes,this.ButtonClass=u||this.DefaultButtonClass,this.schema=t,this.itemSchemas={};for(let n of this.schema)this.itemSchemas[n.name]=n;this.uiSchema=i,this.disposer=Object(s.d)(this.watch),this.data={}}renderContent(){this.initData(this.props.formData);let e,{children:t}=this.props;return void 0!==t?(this.formContext=new V(this,!0),n.createElement(n.Fragment,null,t)):(void 0!==this.uiSchema&&(e=this.uiSchema.Templet),void 0!==e?(this.formContext=new V(this,!0),"function"===typeof e?e(this.data):e):(this.formContext=new V(this,!1),n.createElement(n.Fragment,null,this.schema.map((e,i)=>n.createElement(n.Fragment,{key:i},H(this.formContext,e,t))))))}initData(e){void 0===e&&(e={});for(let t of this.schema)this.initDataItem(t,this.data,e)}initDataItem(e,t,i){let{name:n,type:r}=e;if("button"===r)return;if("arr"!==r)return void(t[n]=i[n]);let o=e,{arr:a}=o;if(void 0===a)return;let l=o.itemSchemas={};for(let s of a)l[s.name]=s;let c=i[n];void 0===c?c=[]:!1===Array.isArray(c)&&(c=[c]);let u=[];for(let s of c){let{$isSelected:e,$isDeleted:t}=s,i={$source:s,$isSelected:e,$isDeleted:t};for(let n of a)this.initDataItem(n,i,s);u.push(i)}t[n]=Object(s.l)(u)}calcSelectOrDelete(){for(let e of this.schema)this.arrItemOperated(e)}arrItemOperated(e){let{name:t,type:i}=e;if("arr"!==i)return;if(void 0===this.data)return;let n=this.data[t];if(void 0===n)return;let{arr:s}=e;for(let r of n){let{$source:e}=r;if(void 0===e)continue;let{$isSelected:t,$isDeleted:i}=e;r.$isSelected=t,r.$isDeleted=i;for(let n of s)this.arrItemOperated(n)}}componentDidMount(){let{beforeShow:e}=this.props;void 0!==e&&e(this.formContext)}componentWillUnmount(){void 0!==this.disposer&&this.disposer()}render(){let e=this.renderContent();return n.createElement(j.Provider,{value:this.formContext},n.createElement(this.formContext.renderErrors,null),this.Container(e))}buttonClick(e){return W(this,void 0,void 0,function*(){if(this.formContext.checkRules(),!0===this.formContext.hasError)return;let{onButtonClick:t}=this.formContext.form.props;if(void 0===t)return void alert("you should define form onButtonClick");let i=yield t(e,this.formContext);void 0!==i&&this.formContext.setError(e,i)})}}(class extends n.Component{render(){let{name:e,children:t}=this.props,i=this.context;if(void 0===i)return n.createElement("span",{className:"text-danger"},"!only in Form!");let s=i.getItemSchema(e),r=H(i,s,t,this.props);return void 0===r?n.createElement("span",{className:"text-danger"},"!!",e," is not defined!!"):r}}).contextType=j,i.d(t,"a",function(){return Q})},function(e,t,i){"use strict";var n=i(0),s=i(4),r=i(5),o=i.n(r);i(108);let a=class extends n.Component{render(){let e,{className:t,badge:i,size:s,color:r,badgeAlign:a,badgeVertical:l,children:c}=this.props,u=o()(t,"va-badge",s&&"va-badge-"+s,"va-badge-"+(r||"secondary"),a&&"va-badg-"+a,l&&"va-badg-"+l);return i&&(e=n.createElement("b",null,i)),n.createElement("div",{className:u},c,e)}};a=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([s.a],a);i(110);let l=class extends n.Component{render(){let e,t,i,{className:s,left:o,children:a,right:l,onClick:c}=this.props;return void 0!==o&&(e=n.createElement("header",null,o)),void 0!==l&&(t=n.createElement("footer",null,l)),void 0!==c&&(i="cursor-pointer"),n.createElement("div",{className:r("va-lmr",s,i),onClick:c},e,n.createElement("div",null,a),t)}};l=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([s.a],l);class c extends n.Component{render(){let{name:e,className:t,size:i,spin:s,fixWidth:o,border:a,pull:l,pulse:c,rotate:u,flip:d,inverse:h}=this.props,m=r(t,"fa",e&&"fa-"+e,i&&"fa-"+i,o&&"fa-fw",a&&"fa-border",l&&"fa-pull-"+l,s&&"fa-spin",c&&"fa-pulse",u&&"fa-rotate-"+u,d&&"fa-flip-"+d,h&&"fa-inverse");return n.createElement("i",{className:m})}}const u=e=>n.createElement("small",{className:r("text-muted",e.className),style:e.style},e.children);i.d(t,"a",function(){return a}),i.d(t,"c",function(){return l}),i.d(t,"b",function(){return c}),i.d(t,"d",function(){return u})},function(e,t,i){"use strict";var n=i(0),s=i(5),r=i.n(s),o=i(4),a=i(3);class l{constructor(e){this.list=e}get isPaged(){let e=this.list.props.items;return null!==e&&void 0!==e&&!1===Array.isArray(e)}get items(){let e=this.list.props.items;return null===e?null:void 0!==e?!0===Array.isArray(e)?e:e.items:void 0}get loading(){let e=this.list.props.items;if(null===e)return!1;if(void 0===e)return!0;let t=e;return void 0!==t.items&&t.loading}get selectedItems(){}updateProps(e){}renderContent(e,t){let{render:i}=this.list.props.item;return void 0===i?n.createElement("div",{className:"px-3 py-2"},JSON.stringify(e)):i(e,t)}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([a.e],l.prototype,"loading",null);class c extends l{render(e,t){let{className:i,key:r,onClick:o}=this.list.props.item;return n.createElement("li",{key:void 0===r?t:r(e),className:s("va-row-clickable",i),onClick:()=>o&&o(e)},this.renderContent(e,t))}}var u=i(19);class d extends l{render(e,t){let{className:i,key:r,render:o}=this.list.props.item;if("string"===typeof e){let t=s("va-list-gap","px-3","pt-1");return n.createElement("li",{key:Object(u.a)(),className:t},e)}return n.createElement("li",{key:void 0===r?t:r(e),className:s(i)},this.renderContent(e,t))}}class h extends l{buildItems(){console.log("buildItems in selectable.tsx");let e,{items:t,selectedItems:i,compare:n}=this.list.props;return void 0===t?this._items=void 0:null===t?this._items=null:(e=!0===Array.isArray(t)?t:t.items,this._selectedItems=i,this._items=void 0===i?e.map(e=>({selected:!1,item:e,labelId:Object(u.a)()})):void 0===n?e.map(e=>({selected:void 0!==i.find(t=>t===e),item:e,labelId:Object(u.a)()})):e.map(e=>({selected:void 0!==i.find(t=>n(e,t)),item:e,labelId:Object(u.a)()})))}get items(){return this.buildItems(),this._items}updateProps(e){e.selectedItems!==this._selectedItems&&this.buildItems()}onSelect(e,t){e.selected=t;let i=this._items.some(e=>e.selected);this.list.props.item.onSelect(e.item,t,i)}get selectedItems(){return this._items.filter(e=>!0===e.selected).map(e=>e.item)}render(e,t){let{className:i,key:r,render:o,onSelect:a}=this.list.props.item,{labelId:l,selected:c}=e;return n.createElement("li",{key:void 0===r?t:r(e),className:s(i)},n.createElement("div",{className:"d-flex align-items-center px-3"},n.createElement("input",{ref:e=>{e&&(this.input=e,e.checked=c)},className:"",type:"checkbox",value:"",id:l,defaultChecked:c,onChange:t=>{this.onSelect(e,t.target.checked)}}),n.createElement("label",{className:"",style:{flex:1,marginBottom:0},htmlFor:l},this.renderContent(e.item,t))))}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([a.e],h.prototype,"items",null);i(106);i.d(t,"a",function(){return m});let m=class extends n.Component{constructor(e){super(e),this._$scroll=(e=>{console.log("############### items scroll to "+e)});let{item:t}=this.props,{onClick:i,onSelect:n}=t;this.listBase=void 0!==n?new h(this):void 0!==i?new c(this):new d(this)}componentWillUpdate(e,t,i){this.listBase.updateProps(e)}get selectedItems(){return this.listBase.selectedItems}render(){let{className:e,header:t,footer:i,before:s,loading:o,none:a,item:l,selectedItems:c}=this.props;void 0===s&&(s="before"),void 0===o&&(o="loading"),void 0===a&&(a="none");let u,{isPaged:d,items:h,loading:m}=this.listBase;function p(e,t){if(e)switch(typeof e){default:case"string":return n.createElement("li",{className:"va-list-"+t},e);case"function":return n.createElement("li",{className:"va-list-"+t},e());case"object":return n.createElement("li",null,e)}}return u=null===h?p(s,"before"):void 0===h?p(o,"loading"):0===h.length?p(a,"none"):h.map((e,t)=>this.listBase.render(e,t)),n.createElement("ul",{className:r()("va-list",e)},p(t,"header"),u,p(i,"footer"))}};m=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([o.a],m)},function(e,t,i){"use strict";var n=i(0),s=i(4),r=i(8),o=i(15),a=i(23),l=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class c extends a.a{constructor(){super(...arguments),this.onChange=(e=>{this.newValue=e.target.value;let t=this.value;this.isChanged=this.newValue!=t}),this.onBlur=(e=>{this.verifyValue()}),this.onFocus=(()=>{this.error=void 0}),this.page=Object(s.a)(e=>{let{resolve:t,reject:i}=e,s=n.createElement("button",{className:"btn btn-sm btn-success",disabled:!this.isChanged,onClick:()=>{this.verifyValue(),void 0===this.error&&t(this.newValue)}},"\u4fdd\u5b58");return n.createElement(o.a,{header:"\u66f4\u6539"+this.label,right:s},n.createElement("div",{className:"m-3"},n.createElement("input",{type:"text",onChange:this.onChange,onBlur:this.onBlur,onFocus:this.onFocus,className:"form-control",defaultValue:this.value}),this.uiItem&&n.createElement("div",{className:"small muted m-2"},this.uiItem.placeholder),this.error&&n.createElement("div",{className:"text-danger"},this.error)))})}internalStart(){return l(this,void 0,void 0,function*(){return new Promise((e,t)=>{let i=n.createElement(this.page,{resolve:e,reject:t});r.c.push(i,t)})})}}var u=i(37),d=i(20),h=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class m extends a.a{constructor(){super(...arguments),this.onChange=(e=>{this.newValue=e;let t=this.value;this.isChanged=this.newValue!=t}),this.page=Object(s.a)(e=>{let{resolve:t,reject:i}=e,{name:s}=this.itemSchema,{list:r,defaultValue:a}=this.uiItem,l=n.createElement("button",{className:"btn btn-sm btn-success",disabled:!this.isChanged,onClick:()=>{this.verifyValue(),void 0===this.error&&t(this.newValue)}},"\u4fdd\u5b58"),c=r?r.map((e,t)=>{let{title:i,value:r}=e;return n.createElement("label",{key:t,className:"px-3 py-2 cursor-pointer"},n.createElement("input",{name:s,type:"radio",value:r,onClick:()=>this.onChange(r),defaultChecked:r===a})," ",i||r," \xa0")}):n.createElement(n.Fragment,null,"no list defined");return n.createElement(o.a,{header:"\u66f4\u6539"+this.label,right:l},n.createElement("div",{className:"m-3"},c))})}internalStart(){return h(this,void 0,void 0,function*(){return new Promise((e,t)=>{let i=n.createElement(this.page,{resolve:e,reject:t});r.c.push(i,t)})})}}var p=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class f extends a.a{constructor(){super(...arguments),this.onChange=(e=>{this.newValue=e;let t=this.value;this.isChanged=this.newValue!=t}),this.page=Object(s.a)(e=>{let{resolve:t,reject:i}=e,{list:s}=this.uiItem,r=s?s.map((e,i)=>{let{title:s,value:r}=e;return n.createElement("div",{key:i,className:"px-3 py-2 cursor-pointer bg-white mb-1",onClick:()=>{this.onChange(r),t(this.newValue)}},s||r)}):n.createElement(n.Fragment,null,"no list defined");return n.createElement(o.a,{header:"\u66f4\u6539"+this.label},n.createElement("div",{className:"my-3"},r))})}internalStart(){return p(this,void 0,void 0,function*(){return new Promise((e,t)=>{let i=n.createElement(this.page,{resolve:e,reject:t});r.c.push(i,t)})})}}var v=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let g=class extends n.Component{constructor(e){super(e),this.defaultSepClassName="border-top edit-sep-light-gray",this.defaultRowContainerClassName="d-flex px-3 py-2 bg-white align-items-center",this.renderRow=((e,t)=>{let i,{name:s,type:r,required:o}=e,a=this.uiSchema[s],l=a&&a.label||s;if(void 0!==a&&t)switch(a.widget){case"radio":case"select":let{list:e}=a;i=n.createElement("b",null,e.find(e=>e.value===t).title)}if(void 0===i)switch(r){default:i=t?n.createElement("b",null,t):n.createElement("small",{className:"text-muted"},"(\u65e0)");break;case"image":i=n.createElement(d.a,{className:"w-4c h-4c",src:t})}let c=!0===o&&n.createElement("span",{className:"text-danger"},"*");return n.createElement("div",{className:this.rowContainerClassName,onClick:()=>v(this,void 0,void 0,function*(){return yield this.rowClick(e,a,l,t)})},n.createElement("div",{className:"w-6c"},l," ",c),n.createElement("div",{className:"flex-fill d-flex justify-content-end"},i),!0!==this.props.stopEdit&&n.createElement("div",{className:"w-2c text-right"},n.createElement("i",{className:"fa fa-chevron-right"})))}),this.rowClick=((e,t,i,n)=>v(this,void 0,void 0,function*(){let s,{onItemChanged:r,onItemClick:o,stopEdit:a}=this.props;if(!0===a)return;if(void 0!==o)return void(yield o(e,t,n));let l=function(e,t,i,n){let s;if(void 0!==t)switch(t.widget){default:break;case"text":s=c;break;case"image":s=u.a;break;case"radio":s=m;break;case"select":s=f}if(void 0===s)switch(e.type){case"string":s=c;break;case"image":s=u.a}if(void 0===s)return;return new s(e,t,i,n)}(e,t,i,n);if(void 0!==l)try{(s=yield l.start())!=n&&(void 0===r?(alert(`${e.name} value changed, new: ${s}, pre: ${n}`),this.props.data[e.name]=s):yield r(e,s,n)),yield l.end()}catch(d){console.log("no value changed")}else alert("undefined: let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);")}));let{topBorderClassName:t,bottomBorderClassName:i,sepClassName:s,rowContainerClassName:r,uiSchema:o,stopEdit:a}=e;this.topBorder=n.createElement("div",{className:t||this.defaultSepClassName}),this.bottomBorder=n.createElement("div",{className:i||this.defaultSepClassName}),this.rowContainerClassName=r||this.defaultRowContainerClassName,!0!==a&&(this.rowContainerClassName+=" cursor-pointer"),this.sep=n.createElement("div",{className:s||this.defaultSepClassName}),this.uiSchema=o&&o.items||{}}render(){let e=[],{schema:t}=this.props,i=t.length;e.push(this.topBorder);for(let n=0;n<i;n++){let i=t[n];n>0&&e.push(this.sep);let s=this.props.data[i.name];e.push(this.renderRow(i,s))}return e.push(this.bottomBorder),n.createElement("div",null,e.map((e,t)=>n.createElement(n.Fragment,{key:t},e)))}};g=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([s.a],g),i.d(t,"a",function(){return g})},function(e,t,i){"use strict";var n=i(0),s=i(5),r=i.n(s);class o{setValues(e){}}class a extends o{render(e){return n.createElement("div",{key:"_b_"+e,className:""},n.createElement("div",{className:"w-100"},n.createElement("div",{style:{borderTop:"1px solid #f0f0f0"}})))}}class l extends o{constructor(e){super(),this.param=e}render(e){let t;switch(this.param){default:t="py-2";break;case"=":t="py-1";break;case"-":t="pb-1"}let i=r()(t);return n.createElement("div",{key:"_g_"+e,className:i,style:{backgroundColor:"#f0f0f0"}})}}const c="justify-content-start",u="justify-content-center",d="justify-content-end";class h extends o{constructor(e,t){super(),this.gridProps=e,this.prop=t,this.col=!0===e.labelFixLeft?"col":"col-sm"}render(e){let{onClick:t,bk:i}=this.prop,s=r()({"cursor-pointer":void 0!==t,"bg-white":void 0===i,row:!0});return n.createElement("div",{key:e,className:s,onClick:t},this.renderLabel(),this.renderProp())}renderLabel(){let{label:e}=this.prop;return void 0===e?null:n.createElement("label",{className:this.col+"-3 col-form-label"},e)}renderProp(){let e,t,{label:i}=this.prop;switch(this.gridProps.alignValue){case"left":e=c;break;case"center":e=u;break;case"right":e=d}switch(this.prop.vAlign){case"top":t="align-items-start";break;default:case"center":t="align-items-center";break;case"bottom":t="align-items-end";break;case"stretch":t="align-items-stretch"}let s=this.col+(void 0===i?"-12":"-9"),o=r()(e,t,s,"d-flex");return n.createElement("div",{className:o},this.renderPropBody())}renderPropBody(){return n.createElement("div",{className:"form-control-plaintext"},this.renderPropContent())}renderPropContent(){return this.content}}class m extends h{setValues(e){this.content=void 0===e?void 0:e[this.prop.name]}}class p extends h{setValues(e){this.content=void 0===e?void 0:e[this.prop.name]}}class f extends h{setValues(e){if(void 0===e)this.content=void 0;else{let t=this.prop.list;this.content="string"===typeof t?e[t]:void 0}}renderPropBody(){let{list:e,row:t}=this.prop,i="string"===typeof e?this.content:e;return void 0===i?n.createElement("div",null):n.createElement("div",{className:"w-100"},i.map((e,i)=>n.createElement(n.Fragment,{key:i},0===i?null:n.createElement("div",{style:{width:"100%",borderBottom:"1px solid #f0f0f0"}}),n.createElement(t,e))))}}class v extends h{renderPropBody(){let{component:e}=this.prop;return e}renderProp(){let e,t,i,{label:s,full:o}=this.prop;switch(this.gridProps.alignValue){case"left":e=c;break;case"center":e=u;break;case"right":e=d}switch(this.prop.vAlign){case"top":t="align-items-start";break;default:case"center":t="align-items-center";break;case"bottom":t="align-items-end";break;case"stretch":t="align-items-stretch"}i=!0!==o?this.col+(void 0===s?"-12":"-9"):"w-100";let a=r()(e,t,i,"d-flex");return n.createElement("div",{className:a},this.renderPropBody())}}class g{constructor(e,t){this.gridProps=e,this.props=t,this.buildRows()}buildRows(){this.rows=[];let e=!0;for(let t of this.props)if("string"===typeof t)this.rows.push(new l(t)),e=!0;else{let i;switch(e||this.rows.push(new a),t.type){default:continue;case"string":i=new m(this.gridProps,t);break;case"number":i=new p(this.gridProps,t);break;case"list":i=new f(this.gridProps,t);break;case"component":i=new v(this.gridProps,t)}this.rows.push(i),e=!1}}setValues(e){for(let t of this.rows)t.setValues(e)}render(){return this.rows.map((e,t)=>e.render(String(t)))}}var y=i(4);let b=class extends n.Component{render(){let{className:e,rows:t,values:i}=this.props,s=new g(this.props,t);s.setValues(i);let o=r()("container-fluid",e);return n.createElement("div",{className:o},s.render())}};b=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([y.a],b),i.d(t,"a",function(){return b})},function(e,t,i){"use strict";var n=i(0),s=i(5),r=i(4);i(112);let o=class extends n.Component{constructor(e){super(e),this.state={pressed:!1}}render(){let e,t,i,r,o,a,{date:l,main:c,vice:u,middle:d,midSize:h,icon:m,unread:p,right:f,onClick:v}=this.props;if(void 0!==p){let e;(e="number"===typeof p?p:p.get())>0?i=n.createElement("b",null,e):e<0&&(i=n.createElement("b",{className:"dot"}))}switch(typeof m){case"object":e=n.createElement("header",null,m,i),t=!1;break;case"string":e=n.createElement("header",{className:"icon"},n.createElement("img",{src:m}),i),t=!0}if(void 0!==d)switch(typeof d){case"string":r=n.createElement("div",{style:{flex:h}},d);break;default:r=d}void 0!==f&&(o="string"===typeof f?n.createElement("footer",null,n.createElement("small",{className:"text-muted"},f)):n.createElement("footer",null,f)),void 0!==u&&(a=n.createElement("span",null,u));let g=s("va-row",{icon:t,pressed:this.state.pressed},{"va-action":void 0!==v});return n.createElement("li",{className:g,onClick:v},e,n.createElement("div",null,n.createElement("div",null,c),a),r,o)}};o=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([r.a],o);let a=class extends n.Component{render(){let e,t,{header:i,items:r,beforeLoad:a,none:l,renderRow:c,className:u,footer:d,itemClick:h,converter:m}=this.props,p=s(u,"va-list");return e=void 0===r?null===a?null:n.createElement("li",{className:"empty"},a||"..."):0===r.length?n.createElement("li",{className:"empty"},l||"[none]"):void 0!==c?r.map((e,t)=>c(e,t,this.props.ex)):r.map((e,t)=>{let i,s=e.onClick;if(void 0===s&&void 0!==h&&(s=(()=>h(e))),void 0!==m){if(void 0===(i=m(e)))return null}else i=Object.assign({},e);return void 0===i.key&&(i.key=i.main),n.createElement(o,Object.assign({onClick:s},i))}),void 0!==i&&(t="string"===typeof i?n.createElement("div",{className:"va-list-header"},i):i),n.createElement("div",{className:p},t,n.createElement("ul",null,e),d)}};a=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([r.a],a)},function(e,t,i){"use strict";var n=i(0),s=i(3),r=i(4),o=i(5),a=i.n(o),l=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};class c{get content(){return!0!==this.selected?this._content:void 0!==this._content?this._content:this._content=this.contentBuilder()}}l([s.l],c.prototype,"selected",void 0);let u=class extends n.Component{constructor(e){super(e),this.tabs=[],this.tabClick=(e=>{this.selectedTab.selected=!1,e.selected=!0,this.selectedTab=e});let{size:t,tabs:i,tabBack:n,contentBack:s,sep:r,selected:o}=this.props;switch(t){default:case"md":this.size="3.2rem";break;case"sm":this.size="4rem";break;case"lg":this.size="2.5rem"}this.tabs.push(...i.map(e=>{let t=new c;return t.name=e.name,t.selected=!1,t.caption=e.caption,t.contentBuilder=e.content,t.notify=e.notify,t})),this.tabBack=n||"bg-light",this.contentBack=s,this.sep=r||"border-top border-gray",void 0!==o&&(this.selectedTab=this.tabs.find(e=>e.name===o)),void 0===this.selectedTab&&(this.selectedTab=this.tabs[0]),this.selectedTab.selected=!0}showTab(e){let t=this.tabs.find(t=>t.name===e);void 0!==t&&(void 0!==this.selectedTab&&(this.selectedTab.selected=!1),t.selected=!0,this.selectedTab=t)}render(){return n.createElement("div",{className:"tab"},n.createElement("div",{className:this.contentBack,style:{height:"calc(100% - "+this.size+")"}},this.tabs.map((e,t)=>{let i={display:!0===e.selected?void 0:"none"};return n.createElement("div",{key:t,style:i},e.content)})),n.createElement("div",{className:a()(this.tabBack,this.sep),style:{height:this.size}},this.tabs.map((e,t)=>{let i,{selected:s,caption:r,notify:o}=e;if(void 0!==o){let e=o.get();void 0!==e&&(e>0?i=n.createElement("u",null,e>99?"99+":e):e<0&&(i=n.createElement("u",{className:"dot"})))}return n.createElement("div",{key:t,className:"",onClick:()=>this.tabClick(e)},n.createElement("div",{className:"align-self-center"},i,r(s)))})))}};l([s.l],u.prototype,"selectedTab",void 0),l([s.l],u.prototype,"tabs",void 0),u=l([r.a],u)},function(e,t,i){"use strict";var n=i(0),s=i(3),r=i(14),o=i(55),a=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([s.l],class extends n.Component{constructor(e){super(e),this.schema=[{name:"nick",type:"string"},{name:"icon",type:"image"}],this.uiSchema={items:{nick:{widget:"text",label:"\u522b\u540d",placeholder:"\u597d\u7684\u522b\u540d\u66f4\u65b9\u4fbf\u8bb0\u5fc6"},icon:{widget:"image",label:"\u5934\u50cf"}}},this.onItemChanged=((e,t,i)=>a(this,void 0,void 0,function*(){let{name:i}=e;yield o.a.userSetProp(i,t),this.data[i]=t,r.nav.user[i]=t,r.nav.saveLocalUser()}));let{nick:t,icon:i}=r.nav.user;this.data={nick:t,icon:i}}render(){return n.createElement(r.Page,{header:"\u4e2a\u4eba\u4fe1\u606f"},n.createElement(r.Edit,{schema:this.schema,uiSchema:this.uiSchema,data:this.data,onItemChanged:this.onItemChanged}))}}.prototype,"data",void 0)},function(e,t,i){"use strict";i.d(t,"a",function(){return o});var n=i(0),s=i(10),r=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class o extends n.Component{constructor(){super(...arguments),this.reApi=(()=>r(this,void 0,void 0,function*(){this.props.clearError();const{channel:e,url:t,options:i,resolve:n,reject:r}=this.props;yield Object(s.n)(e,t,i,n,r)})),this.close=(()=>r(this,void 0,void 0,function*(){this.props.clearError()}))}render(){let e,{error:t,url:i}=this.props;if("object"===typeof t){let i=[];for(let e in t)i.push(n.createElement("li",{key:e},n.createElement("label",null,e),n.createElement("div",null,t[e])));e=n.createElement("ul",null,i)}else e=n.createElement("div",null,t);return n.createElement("li",null,n.createElement("article",{className:"page-container"},n.createElement("section",null,n.createElement("div",{className:"va-error"},n.createElement("div",null,"\u7f51\u7edc\u51fa\u73b0\u95ee\u9898"),n.createElement("div",null,"\u70b9\u51fb\u91cd\u65b0\u8bbf\u95ee"),n.createElement("div",null,"url: ",i),e,n.createElement("div",{className:"p-3"},n.createElement("button",{type:"button",onClick:this.reApi},"\u91cd\u65b0API"),n.createElement("button",{type:"button",onClick:this.close},"\u5173\u95ed"))))))}}},function(e,t,i){"use strict";i.d(t,"a",function(){return s});class n{constructor(e){this.name=e}get(){if(void 0!==this.value)return this.value;let e=localStorage.getItem(this.name);return this.value=null===e?void 0:JSON.parse(e)}set(e){e?(this.value=e,localStorage.setItem(this.name,JSON.stringify(e))):this.clear()}clear(){this.value=void 0,localStorage.removeItem(this.name)}}class s{constructor(){this.user=new n("user"),this.guest=new n("guest"),this.unit=new n("unit"),this.homeTabCur=new n("homeTabCur")}logoutClear(){[this.user,this.unit,this.homeTabCur].map(e=>e.clear())}}},,function(e,t,i){},function(e,t,i){e.exports=i.p+"static/media/logo.ee7cd8ed.svg"},function(e,t,i){e.exports=i(122)},,,,,,,,,,function(e,t,i){},,function(e,t,i){},,function(e,t,i){},,function(e,t,i){},,function(e,t,i){},,function(e,t,i){},,,,function(e,t,i){},,,,function(e,t,i){},,function(e,t,i){"use strict";i.r(t);var n=i(0),s=i.n(n),r=i(28),o=i(1),a=i(4),l=i(2),c=i(3),u=i(6),d=i.n(u),h=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const m=new class extends o.CenterApi{stickies(){return h(this,void 0,void 0,function*(){return yield this.get("sticky/list",{start:0,pageSize:30})})}ties(){return h(this,void 0,void 0,function*(){return yield this.get("tie/list",{start:0,pageSize:30})})}apps(e){return h(this,void 0,void 0,function*(){return yield this.get("tie/apps",{unit:e})})}appApi(e,t,i){return h(this,void 0,void 0,function*(){return yield this.get("tie/app-api",{unit:e,app:t,apiName:i})})}userId(e){return h(this,void 0,void 0,function*(){return yield this.get("tie/user-id",{name:e})})}userAdminUnits(){return h(this,void 0,void 0,function*(){return yield this.get("tie/user-admin-units",{})})}sendMessage(e,t,i){return h(this,void 0,void 0,function*(){let{unit:n}=o.appInFrame;return yield this.post("tie/send-message",{type:t,fromUnit:n,fromApp:0,toUser:e,content:i})})}unit(e){return h(this,void 0,void 0,function*(){return yield this.get("unit/",{unit:e})})}unitMemberCount(e){return h(this,void 0,void 0,function*(){return yield this.get("unit/member-count",{unit:e})})}unitAdmins(e){return h(this,void 0,void 0,function*(){return yield this.get("unit/admins",{unit:e})})}unitSetAdmin(e,t,i,n){return h(this,void 0,void 0,function*(){return yield this.post("unit/set-admin",{fellow:e,unit:t,isOwner:i,isAdmin:n})})}unitAddAdmin(e,t,i,n){return h(this,void 0,void 0,function*(){return yield this.post("unit/add-admin",{user:e,unit:t,isOwner:i,isAdmin:n})})}unitApps(e){return h(this,void 0,void 0,function*(){return yield this.get("unit/apps",{unit:e})})}unitAddApp(e,t){return h(this,void 0,void 0,function*(){return yield this.post("unit/add-app",{unit:e,app:t})})}unitDeleteApp(e,t,i){return h(this,void 0,void 0,function*(){yield this.post("unit/delete-app",{unit:e,app:t,deleted:i})})}unitChangeProp(e,t,i){return h(this,void 0,void 0,function*(){yield this.post("unit/change-prop",{unit:e,prop:t,value:i})})}searchApp(e,t,i,n){return h(this,void 0,void 0,function*(){return yield this.get("unit/search-app",{unit:e,key:t,pageStart:i,pageSize:n})})}unitRoles(e){return h(this,void 0,void 0,function*(){return yield this.get("unit/roles",{unit:e})})}unitAddRole(e,t,i){return h(this,void 0,void 0,function*(){return yield this.post("unit/add-role",{unit:e,name:t,discription:i})})}unitRoleChangeProp(e,t,i,n){return h(this,void 0,void 0,function*(){yield this.post("unit/change-role-prop",{unit:e,role:t,prop:i,value:n})})}unitRoleApps(e,t){return h(this,void 0,void 0,function*(){return yield this.get("unit/role-apps",{unit:e,role:t})})}unitRoleSetApps(e,t,i){return h(this,void 0,void 0,function*(){yield this.post("unit/role-set-apps",{unit:e,role:t,apps:i})})}unitMembers(e,t,i,n,s){return h(this,void 0,void 0,function*(){return yield this.get("unit/members",{unit:e,role:t,key:i,pageStart:n,pageSize:s})})}unitAssignMember(e,t,i){return h(this,void 0,void 0,function*(){yield this.post("unit/assign-member",{unit:e,member:t,assigned:i})})}unitMemberRoles(e,t){return h(this,void 0,void 0,function*(){return yield this.get("unit/member-roles",{unit:e,member:t})})}unitSetMemberRoles(e,t,i){return h(this,void 0,void 0,function*(){yield this.post("unit/member-set-roles",{unit:e,member:t,roles:i})})}unitUsers(e,t,i,n){return h(this,void 0,void 0,function*(){return yield this.get("unit/users",{unit:e,key:t,pageStart:i,pageSize:n})})}unitAppUsers(e,t,i,n){return h(this,void 0,void 0,function*(){return yield this.get("unit/app-users",{unit:e,key:t,pageStart:i,pageSize:n})})}unitOneAppUsers(e,t,i,n){return h(this,void 0,void 0,function*(){return yield this.get("unit/one-app-users",{unit:e,app:t,pageStart:i,pageSize:n})})}unitOneUserApps(e,t,i,n){return h(this,void 0,void 0,function*(){return yield this.get("unit/one-user-apps",{unit:e,user:t,pageStart:i,pageSize:n})})}unitAppEditUsers(e,t,i,n,s){return h(this,void 0,void 0,function*(){return yield this.get("unit/app-edit-users",{unit:e,app:t,key:i,pageStart:n,pageSize:s})})}unitUserEditApps(e,t,i,n,s){return h(this,void 0,void 0,function*(){return yield this.get("unit/user-edit-apps",{unit:e,user:t,key:i,pageStart:n,pageSize:s})})}bindAppUser(e,t,i,n){return h(this,void 0,void 0,function*(){yield this.post("unit/bind-app-user",{unit:e,app:t,user:i,bind:n})})}userFromKey(e){return h(this,void 0,void 0,function*(){return yield this.get("tie/user-from-key",{key:e})})}unitAddUser(e,t){return h(this,void 0,void 0,function*(){yield this.post("unit/add-user",{unit:e,user:t})})}}("tv/",void 0);var p=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const f=new class extends o.CenterApi{uqBuilderUrl(){return p(this,void 0,void 0,function*(){return yield this.get("uq-builder-url",void 0)})}counts(e){return p(this,void 0,void 0,function*(){return yield this.get("counts",{unit:e})})}app(e){return p(this,void 0,void 0,function*(){return yield this.get("app",{id:e})})}uq(e){return p(this,void 0,void 0,function*(){return yield this.get("uq",{id:e})})}server(e){return p(this,void 0,void 0,function*(){return yield this.get("server",{id:e})})}uqdb(e){return p(this,void 0,void 0,function*(){return yield this.get("uqdb",{id:e})})}apps(e,t=30){return p(this,void 0,void 0,function*(){return yield this.get("apps",{unit:e,pageSize:t})})}uqs(e,t=30){return p(this,void 0,void 0,function*(){return yield this.get("uqs",{unit:e,pageSize:t})})}buses(e,t=30){return p(this,void 0,void 0,function*(){return yield this.get("buses",{unit:e,pageSize:t})})}servers(e,t=30){return p(this,void 0,void 0,function*(){return yield this.get("servers",{unit:e,pageSize:t})})}uqdbs(e,t=30){return p(this,void 0,void 0,function*(){return yield this.get("uqdbs",{unit:e,pageSize:t})})}services(e,t=30){return p(this,void 0,void 0,function*(){return yield this.get("services",{unit:e,pageSize:t})})}saveApp(e){return p(this,void 0,void 0,function*(){return yield this.post("app-save",e)})}saveUq(e){return p(this,void 0,void 0,function*(){return yield this.post("uq-save",e)})}saveBus(e){return p(this,void 0,void 0,function*(){return yield this.post("bus-save",e)})}saveServer(e){return p(this,void 0,void 0,function*(){return yield this.post("server-save",e)})}saveUqdb(e){return p(this,void 0,void 0,function*(){return yield this.post("uqdb-save",e)})}saveService(e){return p(this,void 0,void 0,function*(){return yield this.post("service-save",e)})}delApp(e,t){return p(this,void 0,void 0,function*(){return yield this.post("app-del",{unit:e,id:t})})}delUq(e,t){return p(this,void 0,void 0,function*(){return yield this.post("uq-del",{unit:e,id:t})})}delBus(e,t){return p(this,void 0,void 0,function*(){return yield this.post("bus-del",{unit:e,id:t})})}delServer(e,t){return p(this,void 0,void 0,function*(){return yield this.post("server-del",{unit:e,id:t})})}delUqdb(e,t){return p(this,void 0,void 0,function*(){return yield this.post("uqdb-del",{unit:e,id:t})})}delService(e,t){return p(this,void 0,void 0,function*(){return yield this.post("service-del",{unit:e,id:t})})}loadAppUqs(e){return p(this,void 0,void 0,function*(){return yield this.get("app-uqs",{app:e})})}appBindUq(e,t,i){return p(this,void 0,void 0,function*(){let n;void 0!==i&&(n=i.map(e=>String(e.id)+"|"+e.access.join(",")).join(";")),yield this.post("app-bind-uq",{unit:e,app:t,uqs:n})})}searchUq(e,t,i,n){return p(this,void 0,void 0,function*(){return yield this.get("uq-search",{unit:e,key:t,pageStart:i,pageSize:n})})}getMyUqs(e){return p(this,void 0,void 0,function*(){return yield this.get("my-uqs",{unit:e})})}searchApp(e,t,i,n){return p(this,void 0,void 0,function*(){return yield this.get("app-search",{unit:e,key:t,pageStart:i,pageSize:n})})}searchServer(e,t,i,n){return p(this,void 0,void 0,function*(){return yield this.get("server-search",{unit:e,key:t,pageStart:i,pageSize:n})})}searchUqdb(e,t,i,n){return p(this,void 0,void 0,function*(){return yield this.get("uqdb-search",{unit:e,key:t,pageStart:i,pageSize:n})})}loadUqServices(e,t){return p(this,void 0,void 0,function*(){return yield this.get("uq-services",{unit:e,uq:t})})}changeServiceProp(e,t,i,n){return p(this,void 0,void 0,function*(){return yield this.post("service-change-prop",{unit:e,service:t,prop:i,value:n})})}uqGetEntities(e,t){return p(this,void 0,void 0,function*(){return yield this.get("uq-get-entities",{unit:e,uq:t})})}}("tv/dev/",void 0);var v=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},g=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class y{constructor(e){this.cur=void 0,this.owners=void 0,this.admins=void 0,this.fellows=void 0,this.store=e}load(){return g(this,void 0,void 0,function*(){let e=this.store.unit;if(void 0===e)return;if(void 0===e.id)return;if(void 0!==this.admins)return;let t=yield m.unitAdmins(e.id),i=[],n=[],s=[];t.forEach(e=>{let{isOwner:t,isAdmin:r}=e;0===t&&0===r?s.push(e):(1===t&&i.push(e),1===r&&n.push(e))}),this.owners=i,this.admins=n,this.fellows=s})}removeCur(e){let t=e.findIndex(e=>e.id===this.cur.id);t>=0&&e.splice(t,1)}unitSetAdmin(e,t){return g(this,void 0,void 0,function*(){let i=this.cur;i.isOwner=e,i.isAdmin=t;let n=i.id,s=this.store.unit.id;yield m.unitSetAdmin(n,s,e,t),this.removeCur(this.owners),this.removeCur(this.admins),this.removeCur(this.fellows),0===e&&0===t?this.fellows.unshift(i):(1===e&&this.owners.unshift(i),1===t&&this.admins.unshift(i))})}addNew(e,t,i){return g(this,void 0,void 0,function*(){let n=yield m.unitAddAdmin(e,this.store.unit.id,t,i);if(void 0!==n){let e=this.cur=n;this.removeCur(this.owners),this.removeCur(this.admins),this.removeCur(this.fellows),0===t&&0===i?this.fellows.unshift(e):(1===t&&this.owners.unshift(e),1===i&&this.admins.unshift(e))}return n})}}v([c.l],y.prototype,"cur",void 0),v([c.l],y.prototype,"owners",void 0),v([c.l],y.prototype,"admins",void 0),v([c.l],y.prototype,"fellows",void 0);var b=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},w=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class E{constructor(e,t){this.items=void 0,this.cur=void 0,this.store=e,this.dev=t}load(){return w(this,void 0,void 0,function*(){let e=yield this._load();this.items=e})}saveCur(e){return w(this,void 0,void 0,function*(){let t={};void 0!==this.cur?d.a.assign(t,this.cur,e):d.a.assign(t,e),t.unit=e.unit=this.store.unit.id;let i=yield this._save(t);if(void 0===this.cur){if(0===i)return!1;t.id=i,void 0!==this.items&&this.items.unshift(t),this._inc(),this.cur=Object(c.l)(t)}else d.a.assign(this.cur,t);return!0})}save(e){return w(this,void 0,void 0,function*(){let t={};d.a.assign(t,e),t.unit=e.unit=this.store.unit.id;let i=yield this._save(t);if(0!==i)return t.id=i,t})}del(){return w(this,void 0,void 0,function*(){let e=this.cur;if(void 0===e)return;let t=e.id;if(yield this._del(e),void 0===this.items)return;let i=this.items.findIndex(e=>e.id===t);i>=0&&(this.items.splice(i,1),this._dec())})}}b([c.l],E.prototype,"items",void 0),b([c.l],E.prototype,"cur",void 0);class x extends E{constructor(){super(...arguments),this.uqs=void 0,this.searchedUqs=void 0}_load(){return w(this,void 0,void 0,function*(){return yield f.apps(this.store.unit.id)})}_save(e){return w(this,void 0,void 0,function*(){return yield f.saveApp(e)})}_del(e){return w(this,void 0,void 0,function*(){yield f.delApp(this.store.unit.id,e.id)})}_inc(){this.dev.counts.app++}_dec(){this.dev.counts.app--}loadCurUqs(){return w(this,void 0,void 0,function*(){let e=yield f.loadAppUqs(this.cur.id);this.uqs=e})}searchUq(e){return w(this,void 0,void 0,function*(){this.searchedUqs=yield f.searchUq(this.store.unit.id,e,0,S)})}appBindUq(e,t){return w(this,void 0,void 0,function*(){let i=this.uqs.map(e=>{let{id:t,access:i}=e;return{id:t,access:[i]}});for(let n of e){let e=i.findIndex(e=>e.id===n.id);!0===t?e<0&&i.unshift(n):i.splice(e,1)}yield f.appBindUq(this.store.unit.id,this.cur.id,i);for(let n of e){let e=this.uqs.findIndex(e=>e.id===n.id);if(e>=0&&this.uqs.splice(e,1),!0===t&&void 0!==this.searchedUqs){let e=this.searchedUqs.find(e=>e.id===n.id);void 0!==e&&this.uqs.unshift(e)}}})}}b([c.l],x.prototype,"uqs",void 0),b([c.l],x.prototype,"searchedUqs",void 0);class C extends E{_load(){return w(this,void 0,void 0,function*(){return yield f.uqs(this.store.unit.id)})}_save(e){return w(this,void 0,void 0,function*(){return yield f.saveUq(e)})}_del(e){return w(this,void 0,void 0,function*(){yield f.delUq(this.store.unit.id,e.id)})}_inc(){this.dev.counts.uq++}_dec(){this.dev.counts.uq--}}class k extends E{_load(){return w(this,void 0,void 0,function*(){return yield f.buses(this.store.unit.id)})}_save(e){return w(this,void 0,void 0,function*(){return yield f.saveBus(e)})}_del(e){return w(this,void 0,void 0,function*(){yield f.delBus(this.store.unit.id,e.id)})}_inc(){this.dev.counts.bus++}_dec(){this.dev.counts.bus--}}class P extends E{_load(){return w(this,void 0,void 0,function*(){return yield f.servers(this.store.unit.id)})}_save(e){return w(this,void 0,void 0,function*(){return yield f.saveServer(e)})}_del(e){return w(this,void 0,void 0,function*(){yield f.delServer(this.store.unit.id,e.id)})}_inc(){this.dev.counts.server++}_dec(){this.dev.counts.server--}}class N extends E{_load(){return w(this,void 0,void 0,function*(){return yield f.services(this.store.unit.id)})}_save(e){return w(this,void 0,void 0,function*(){return yield f.saveService(e)})}_del(e){return w(this,void 0,void 0,function*(){yield f.delService(this.store.unit.id,e.id)})}_inc(){this.dev.counts.service++}_dec(){this.dev.counts.service--}changeProp(e,t){return w(this,void 0,void 0,function*(){let i=yield f.changeServiceProp(this.store.unit.id,this.cur.id,e,t);switch(e){case"url":this.cur.url=t;break;case"server":this.cur.server=t;break;case"db":this.cur.db=t;break;case"db_type":this.cur.db_type=t;break;case"connection":this.cur.connection=t}return i})}loadUqServices(e){return w(this,void 0,void 0,function*(){let t=yield f.loadUqServices(this.store.unit.id,e);this.items=t[0]})}}const S=50;class A{constructor(e,t,i){this.items=void 0,this.allLoaded=!1,this.pageStart=0,this.store=e,this.dev=t,this.search=i}first(e){return w(this,void 0,void 0,function*(){this.key=e,this.items=void 0,this.allLoaded=!1,this.pageStart=0,yield this.more()})}more(){return w(this,void 0,void 0,function*(){if(!0===this.allLoaded)return;let e=yield this.search(this.store.unit.id,this.key,this.pageStart,S),t=e.length;t>S?(this.allLoaded=!1,--t,e.splice(t,1)):this.allLoaded=!0,t>0?(this.pageStart=e[t-1].id,void 0===this.items?this.items=e:this.items.push(...e)):this.items=[]})}}b([c.l],A.prototype,"items",void 0);class R{constructor(e){this.counts=void 0,this.apps=void 0,this.uqs=void 0,this.buses=void 0,this.servers=void 0,this.services=void 0,this.searchApp=void 0,this.searchUq=void 0,this.searchServer=void 0,this.searchUqdb=void 0,this.store=e,this.apps=new x(e,this),this.uqs=new C(e,this),this.buses=new k(e,this),this.servers=new P(e,this),this.services=new N(e,this),this.searchApp=new A(e,this,f.searchApp.bind(f)),this.searchUq=new A(e,this,f.searchUq.bind(f)),this.searchServer=new A(e,this,f.searchServer.bind(f))}loadCounts(){return w(this,void 0,void 0,function*(){let{unit:e}=this.store;this.counts=yield f.counts(e.id)})}}b([c.l],R.prototype,"counts",void 0);var O=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class F extends o.CacheIds{_loadIds(e){return O(this,void 0,void 0,function*(){})}_loadId(e){return O(this,void 0,void 0,function*(){return yield m.unit(e)})}}class I extends o.CacheIds{_loadIds(e){return O(this,void 0,void 0,function*(){})}_loadId(e){return O(this,void 0,void 0,function*(){return yield f.uq(e)})}}class q extends o.CacheIds{_loadIds(e){return O(this,void 0,void 0,function*(){})}_loadId(e){return O(this,void 0,void 0,function*(){return yield f.app(e)})}}class U extends o.CacheIds{_loadIds(e){return O(this,void 0,void 0,function*(){})}_loadId(e){return O(this,void 0,void 0,function*(){return yield f.server(e)})}}var V=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},j=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class T{get unitId(){return o.appInFrame.unit}init(){this.unit=void 0,this.admins=new y(this),this.dev=new R(this),this.cacheUnits=new F,this.cacheUqs=new I,this.cacheApps=new q,this.cacheServers=new U}logout(){o.appInFrame.hash=void 0,o.appInFrame.unit=void 0,this.init(),this.memberCount=void 0,this.apps=void 0,this.role=void 0,this.roles=void 0,this.roleApps=void 0,this.roleMember=void 0,this.roleMembers=void 0,this.memberRoles=void 0}setRole(e){this.role!==e&&(this.role=e,this.roleApps=void 0,this.roleMember=void 0,this.roleMembers=void 0,this.memberRoles=void 0)}setRoleUser(e){this.roleMember!==e&&(this.roleMember=e,this.memberRoles=void 0)}unitChangeProp(e,t){return j(this,void 0,void 0,function*(){yield m.unitChangeProp(this.unit.id,e,t),this.unit[e]=t})}loadApps(){return j(this,void 0,void 0,function*(){void 0===this.apps&&(this.apps=yield m.unitApps(this.unitId))})}loadUnit(){return j(this,void 0,void 0,function*(){if(void 0===this.unitId)return;let e=yield m.unit(this.unitId);this.unit=e,console.log("loadUnit unit=%s",e),this.memberCount=yield m.unitMemberCount(this.unitId);let t=yield f.uqBuilderUrl(),{url:i,urlDebug:n}=t;this.uqServer=o.host.getUrlOrDebug(i,n),console.log("uq-build: %s",JSON.stringify(this.uqServer))})}stopUnitApp(e){return j(this,void 0,void 0,function*(){yield m.unitDeleteApp(this.unit.id,e,1),this.apps.find(t=>t.id===e).inUnit=0})}restoreUnitApp(e){return j(this,void 0,void 0,function*(){let t=yield m.unitAddApp(this.unit.id,e);return t<=0?t:(this.apps.find(t=>t.id===e).inUnit=1,1)})}addUnitApp(e){return j(this,void 0,void 0,function*(){let t=yield m.unitAddApp(this.unit.id,e.id);return t<=0?t:(this.apps.push(e),1)})}loadRoles(){return j(this,void 0,void 0,function*(){if(void 0!==this.roles)return;let e=yield m.unitRoles(this.unit.id);e.forEach(e=>{switch(e.id){case 1:e.name="\u8bbf\u5ba2",e.discription="\u53ef\u4ee5\u83b7\u53d6\u5f00\u653e\u4fe1\u606f";break;case 2:e.name="\u666e\u901a",e.discription="\u80fd\u8bbf\u95ee\u6700\u57fa\u672c\u7684\u529f\u80fd"}}),this.roles=e})}unitAddRole(e,t){return j(this,void 0,void 0,function*(){let i=yield m.unitAddRole(this.unit.id,e,t);return i>0&&this.roles.push({id:i,name:e,discription:t,count:void 0}),i})}roleChangeProp(e,t){return j(this,void 0,void 0,function*(){yield m.unitRoleChangeProp(this.unit.id,this.role.id,e,t),this.role[e]=t})}loadRoleApps(){return j(this,void 0,void 0,function*(){let e=yield m.unitRoleApps(this.unit.id,this.role.id);this.roleApps=e.map(e=>this.apps.find(t=>t.id===e.id))})}setRoleApps(e){return j(this,void 0,void 0,function*(){yield m.unitRoleSetApps(this.unit.id,this.role.id,e.map(e=>e.id)),this.roleApps=e})}loadMembers(){return j(this,void 0,void 0,function*(){let e=yield m.unitMembers(this.unit.id,void 0===this.role?0:this.role.id,void 0,0,100);this.roleMembers=e})}unitAssignMember(e){return j(this,void 0,void 0,function*(){yield m.unitAssignMember(this.unit.id,this.roleMember.id,e),this.roleMember.assigned=e})}loadMemberRoles(){return j(this,void 0,void 0,function*(){let e=(yield m.unitMemberRoles(this.unit.id,this.roleMember.id)).map(e=>{let t=e.id,i=this.roles.find(e=>e.id===t);return d.a.clone(i)});this.memberRoles=e})}setMemberRoles(e){return j(this,void 0,void 0,function*(){yield m.unitSetMemberRoles(this.unit.id,this.roleMember.id,e.map(e=>e.id)),this.roles.forEach(t=>{let i=t.id,n=this.memberRoles.find(e=>e.id===i),s=e.find(e=>e.id===i);if(void 0===n)void 0!==s&&t.count++;else{if(void 0!==s)return;t.count--}}),this.memberRoles=e})}}V([c.l],T.prototype,"unit",void 0),V([c.l],T.prototype,"memberCount",void 0),V([c.l],T.prototype,"apps",void 0),V([c.l],T.prototype,"role",void 0),V([c.l],T.prototype,"roles",void 0),V([c.l],T.prototype,"roleApps",void 0),V([c.l],T.prototype,"roleMember",void 0),V([c.l],T.prototype,"roleMembers",void 0),V([c.l],T.prototype,"memberRoles",void 0);const L=new T;var M=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let D=class extends n.Component{constructor(){super(...arguments),this.schema=[{name:"user",type:"string",required:!0},{name:"submit",type:"submit"}],this.uiSchema={items:{user:{widget:"text",maxLength:100,placeholder:"\u7528\u6237\u540d",label:"\u7ba1\u7406\u5458"},submit:{widget:"button",label:"\u6dfb\u52a0",className:"btn btn-primary"}}},this.onSendInvitation=((e,t)=>M(this,void 0,void 0,function*(){let{isOwner:e,isAdmin:i}=this.props,n=t.form.data.user;if(void 0===(yield L.admins.addNew(n,e?1:0,i?1:0)))return n+"\u6ca1\u6709\u5173\u6ce8\u5c0f\u53f7";o.nav.pop()}))}render(){let{isOwner:e,isAdmin:t}=this.props,i=e?"\u9ad8\u7ba1":"\u7ba1\u7406\u5458";return n.createElement(o.Page,{header:"\u65b0\u589e"+i},n.createElement("div",{className:"container"},n.createElement("div",{className:"my-4 text-info"},"\u53ea\u6709\u5173\u6ce8\u672c\u5c0f\u53f7\u7684\u7528\u6237\uff0c\u624d\u80fd\u6210\u4e3a",i),n.createElement(o.Form,{schema:this.schema,uiSchema:this.uiSchema,onButtonClick:this.onSendInvitation})))}};var _=D=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([a.a],D),B=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let H=class extends n.Component{constructor(){super(...arguments),this.onSubmit=((e,t)=>B(this,void 0,void 0,function*(){let{isOwner:e,isAdmin:i}=t.form.data;yield L.admins.unitSetAdmin(e,i),o.nav.pop()}))}render(){let e,{unit:t}=L,{isRoot:i,isOwner:s,isAdmin:r}=t,a=L.admins.cur,l={name:"isAdmin",type:"boolean"},c={name:"submit",type:"submit"};1===i?e=[{name:"isOwner",type:"boolean"},l,c]:1===s&&(e=[l,c]);let u={isOwner:a.isOwner,isAdmin:a.isAdmin};return n.createElement(o.Page,{header:"\u6743\u9650"},n.createElement("div",{className:"px-3"},n.createElement(z,Object.assign({},L.admins.cur)),n.createElement(o.Form,{schema:e,uiSchema:{items:{isOwner:{widget:"checkbox",label:"\u9ad8\u7ba1",trueValue:1,falseValue:0},isAdmin:{widget:"checkbox",label:"\u7ba1\u7406\u5458",trueValue:1,falseValue:0},submit:{widget:"button",label:"\u63d0\u4ea4",className:"btn btn-primary"}}},formData:u,onButtonClick:this.onSubmit})))}};var $=H=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([a.a],H);const z=e=>{let{name:t,nick:i,icon:s}=e;return n.createElement("div",null,n.createElement("div",{className:"d-flex my-4"},n.createElement(o.Image,{className:"w-3c h-3c mr-3",src:s}),n.createElement("div",{className:""},n.createElement("h4",{className:"text-dark"},t),i&&n.createElement("h6",null,n.createElement("small",{className:"text-secondary"},i)))),n.createElement("hr",{className:"mb-4"}))};var W=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let Q=class extends n.Component{constructor(){super(...arguments),this.row=(({icon:e,name:t,nick:i})=>{let s=i?n.createElement(n.Fragment,null,n.createElement("b",null,i)," \xa0 ",n.createElement("small",{className:"text-muted"},t)):n.createElement("b",null,t),r=n.createElement(o.Image,{className:"w-2-5c h-2-5c",src:e});return n.createElement(l.LMR,{className:"py-2 px-3 align-items-stretch",left:r},n.createElement("div",{className:"px-3"},s))}),this.onNewOwner=(e=>{this.newAdmin(e,!0,!1)}),this.onNewAdmin=(e=>{this.newAdmin(e,!1,!0)})}componentDidMount(){return W(this,void 0,void 0,function*(){yield L.admins.load()})}onNewFellow(){}onItemClick(e){L.admins.cur=e,o.nav.push(n.createElement($,null))}newAdmin(e,t,i){e.preventDefault(),o.nav.push(n.createElement(_,{isOwner:t,isAdmin:i}))}render(){let{unit:e}=L;if(void 0===e)return;let t,i,{owners:s,admins:r,fellows:a}=L.admins,c=n.createElement("button",{className:"btn btn-success btn-sm",onClick:this.onNewFellow},"\u65b0\u589e\u6210\u5458"),u=!1,d=!1;if(1===e.isRoot&&(u=!0,d=!0),1===e.isOwner&&(d=!0),!0===u){let e=n.createElement(l.LMR,{className:"px-3 py-1 small",left:"\u9ad8\u7ba1",right:n.createElement("a",{className:"small",href:"#",onClick:this.onNewOwner},"\u65b0\u589e")});t=n.createElement(l.List,{className:"my-4",header:e,items:s,none:"[\u65e0]",item:{onClick:this.onItemClick,render:this.row}})}if(!0===d){let e=n.createElement(l.LMR,{className:"px-3 py-1 small",left:"\u7ba1\u7406\u5458",right:n.createElement("a",{className:"small",href:"#",onClick:this.onNewAdmin},"\u65b0\u589e")});i=n.createElement(l.List,{className:"my-4",header:e,items:r,none:"[\u65e0]",item:{onClick:this.onItemClick,render:this.row}})}return n.createElement(o.Page,{header:"\u7ba1\u7406\u5458",right:c},t,i,n.createElement("div",{className:"my-4 p-3"},n.createElement("div",{className:"ml-2 mb-2"},"\u8bf4\u660e"),n.createElement("div",{className:""},n.createElement("ul",{className:"pl-2"},n.createElement("li",{className:"card-text"},"\u7ba1\u7406\u7ec4\u5305\u62ec\u4e3b\u4eba\u3001\u9ad8\u7ba1\u3001\u7ba1\u7406\u5458"),n.createElement("li",{className:"card-text"},"\u5c0f\u53f7\u4e3b\u4eba\u53ef\u4ee5\u589e\u51cf\u9ad8\u7ba1"),n.createElement("li",{className:"card-text"},"\u9ad8\u7ba1\u53ef\u4ee5\u589e\u51cf\u7ba1\u7406\u5458"),n.createElement("li",{className:"card-text"},"\u7ba1\u7406\u5458\u53ef\u4ee5\u7ba1\u7406\u5c0f\u53f7\uff0c\u7a0b\u5e8f\u7684\u5f00\u53d1\uff0c\u4ee5\u53ca\u7528\u6237"),n.createElement("li",{className:"card-text"},"\u5f00\u53d1\u53f7\u9ad8\u7ba1\u53ef\u4ee5\u589e\u51cf\u7f16\u8f91APP\uff0cUQ\uff0cServer\uff0cService"),n.createElement("li",{className:"card-text"},"\u5f00\u53d1\u53f7\u7ba1\u7406\u5458\u53ef\u4ee5\u7f16\u8bd1\u6307\u5b9aUQ\uff0cBUS")))))}};var K=Q=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([a.a],Q),G=i(5),J=i.n(G);class Y extends n.Component{render(){let{date_init:e,date_update:t}=this.props;return n.createElement("small",{className:"text-muted"},"\u4e0a\u6b21\u4fee\u6539: ",n.createElement(l.EasyDate,{date:t}),n.createElement("i",{className:"fa fa-fw"}),"\u521b\u5efa: ",n.createElement(l.EasyDate,{date:e}))}}function X(e,t,i,s){let r,o;return!0===e?(r="a",o={className:G(t,"cursor-pointer"),onClick:i,href:"#"}):(r="span",o={className:t}),n.createElement(r,o,s)}var Z=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let ee=class extends n.Component{constructor(){super(...arguments),this.onClick=(e=>(e.preventDefault(),o.nav.push(n.createElement(ie,{id:this.props.id})),!1))}render(){let{id:e,isLink:t,className:i}=this.props;if(void 0===e)return null;let s,r=L.cacheUnits.get(e),{name:o,nick:a,discription:l}=r,c=l&&"- "+l;return s=a?n.createElement(n.Fragment,null,a," \xa0 ",n.createElement("small",{className:"text-muted"},o," ",c)):o?n.createElement(n.Fragment,null,o," \xa0 ",n.createElement("small",{className:"text-muted"},c)):e,X(t,i,this.onClick,s)}};ee=Z([a.a],ee);let te=class extends n.Component{render(){let{id:e,isLink:t,className:i}=this.props;if(void 0===e)return null;let s=L.cacheUnits.get(e),{name:r}=s;return n.createElement(n.Fragment,null,r)}};te=Z([a.a],te);class ie extends n.Component{constructor(e){super(e)}render(){let e=L.cacheUnits.get(this.props.id),{name:t,nick:i,icon:s,discription:r}=e;return this.rows=["",{type:"component",component:n.createElement(l.Media,{icon:s,main:t,discription:r})},""],n.createElement(o.Page,{header:"\u5c0f\u53f7 - \u8be6\u7ec6\u8d44\u6599"},n.createElement(l.PropGrid,{rows:this.rows,values:this.props}))}}const ne="http://101.200.46.56/imgs/Bear-icon.png",se="http://101.200.46.56/imgs/Bear-icon.png";var re=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let oe=class extends n.Component{constructor(){super(...arguments),this.onClick=(e=>(e.preventDefault(),o.nav.push(n.createElement(ae,{id:this.props.id})),!1))}render(){let e,{id:t,className:i,isLink:s}=this.props,r=L.cacheUqs.get(t);if(null===r)e=t;else{let{name:i,discription:s}=r,o=s&&"- "+s;e=void 0!==i?n.createElement(n.Fragment,null,i," \xa0 ",n.createElement("small",{className:"text-muted"},o)):t}return X(s,i,this.onClick,e)}};oe=re([a.a],oe);let ae=class extends n.Component{constructor(e){super(e)}render(){let e=L.cacheUqs.get(this.props.id),{name:t,discription:i,unit:s,date_init:r,date_update:a}=e,c=n.createElement("div",null,n.createElement("div",null,i),n.createElement(Y,{date_update:a,date_init:r}));return this.rows=["",{type:"component",component:n.createElement(l.Media,{icon:ne,main:t,discription:c})},"",{type:"component",label:"\u6240\u6709\u8005",component:n.createElement("div",{className:"py-2"},n.createElement(ee,{id:s,isLink:!0}))}],n.createElement(o.Page,{header:"UQ - \u8be6\u7ec6\u8d44\u6599"},n.createElement(l.PropGrid,{rows:this.rows,values:this.props}))}};ae=re([a.a],ae);var le=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},ce=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let ue=class extends n.Component{constructor(){super(...arguments),this.onClick=(e=>(e.preventDefault(),o.nav.push(n.createElement(de,{id:this.props.id})),!1))}render(){let e,{id:t,isLink:i,className:s}=this.props,r=L.cacheApps.get(t);if(null===r)e=t;else{let{name:i,icon:s,discription:o}=r,a=(r.public,o&&"- "+o);e=void 0!==i?n.createElement(n.Fragment,null,i," \xa0 ",n.createElement("small",{className:"text-muted"},a)):t}return X(i,s,this.onClick,e)}};ue=le([a.a],ue);let de=class extends n.Component{constructor(e){super(e),this.apis={label:"\u5173\u8054API",type:"list",list:void 0,row:he}}componentDidMount(){return ce(this,void 0,void 0,function*(){this.apis.list=yield f.loadAppUqs(this.props.id)})}render(){let e=L.cacheApps.get(this.props.id),{unit:t,name:i,discription:s,icon:r,date_init:a,date_update:c}=e,u=n.createElement("div",null,n.createElement("div",null,s),n.createElement(Y,{date_update:c,date_init:a}));return this.rows=["",{type:"component",component:n.createElement(l.Media,{icon:r,main:i,discription:u})},"",{type:"component",label:"\u6240\u6709\u8005",component:n.createElement("div",{className:"py-2"},n.createElement(ee,{id:t,isLink:!0}))},this.apis],n.createElement(o.Page,{header:"APP - \u8be6\u7ec6\u8d44\u6599"},n.createElement(l.PropGrid,{rows:this.rows,values:this.props}))}};le([c.l],de.prototype,"apis",void 0),de=le([a.a],de);class he extends n.Component{render(){let e,{name:t,discription:i}=this.props;return i&&(e=n.createElement("div",{className:"small text-muted"},i)),n.createElement("div",{className:"form-control-plaintext"},n.createElement("div",null,t),e)}}let me=class extends n.Component{constructor(){super(...arguments),this.onClick=(e=>(e.preventDefault(),o.nav.push(n.createElement(pe,{id:this.props.id})),!1))}render(){let e,{id:t,isLink:i,className:s}=this.props,r=L.cacheServers.get(t);if(null===r)e=t;else{let{cloud:i,ip:s,discription:o}=r;e=void 0!==o?n.createElement(n.Fragment,null,o," \xa0 ",n.createElement("small",{className:"text-muted"},s)):t}return X(i,s,this.onClick,e)}};me=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([a.a],me);class pe extends n.Component{constructor(e){super(e)}render(){let e=L.cacheServers.get(this.props.id),{discription:t,cloud:i,ip:s,unit:r,date_init:a,date_update:c}=e;n.createElement("div",null,n.createElement("div",null,t),n.createElement(Y,{date_update:c,date_init:a}));return this.rows=["",{type:"component",component:n.createElement(l.Media,{icon:ne,main:t,discription:s})},"",{type:"component",label:"\u6240\u6709\u8005",component:n.createElement("div",{className:"py-2"},n.createElement(ee,{id:r,isLink:!0}))},{type:"string",label:"\u4e91\u670d\u52a1",name:"cloud"}],n.createElement(o.Page,{header:"\u670d\u52a1\u5668 - \u8be6\u7ec6\u8d44\u6599"},n.createElement(l.PropGrid,{rows:this.rows,values:this.props}))}}var fe=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class ve extends n.Component{constructor(e){super(e),this.onChange=(e=>{let t=this.props.value,i=t&&t.trim();this.value=e.currentTarget.value.trim(),this.setState({disabled:i===this.value})}),this.onSubmit=(()=>fe(this,void 0,void 0,function*(){let e=this.props.value,t=e&&e.trim(),i=this.value,n=this.props.onChanged;if(void 0!==n){let e=yield n(i,t);if("string"===typeof e)return void this.setState({error:e});o.nav.pop()}})),this.state={disabled:!0}}renderControl(){return n.createElement("input",{className:"form-control w-100",type:"text",defaultValue:this.props.value,onChange:this.onChange})}render(){let e,{title:t,onChanged:i,buttonText:s,info:r,value:a}=this.props,{disabled:l,error:c}=this.state,u=n.createElement("button",{className:"btn btn-success btn-sm",disabled:l,onClick:this.onSubmit},s||"\u4fdd\u5b58");return void 0!==c&&(e=n.createElement("div",{className:"text-danger"},c)),n.createElement(o.Page,{header:t,right:u},n.createElement("div",{className:"my-4 mx-3"},this.renderControl(),e,n.createElement("small",{className:"d-block mt-2 text-muted"},r)))}}class ge extends ve{constructor(){super(...arguments),this.onTextAreaChange=(e=>{let t=this.props.value,i=t&&t.trim();this.value=e.currentTarget.value.trim(),this.setState({disabled:i===this.value})})}renderControl(){return n.createElement("textarea",{className:"form-control w-100",rows:8,defaultValue:this.props.value,onChange:this.onTextAreaChange})}}var ye=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},be=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let we=class extends n.Component{constructor(){super(...arguments),this.itemClick=(e=>{let{resolve:t,idFromItem:i}=this.props;t(i(e)),o.nav.pop()}),this.onSearch=(e=>be(this,void 0,void 0,function*(){let{candidateItems:t,params:i}=this.props;if("function"===typeof t){let n=yield t(i,e);this.items=n}}))}componentDidMount(){return be(this,void 0,void 0,function*(){let{candidateItems:e,params:t}=this.props;this.items=Array.isArray(e)?e:yield e(t,"")})}render(){let{caption:e,row:t,searchPlaceHolder:i}=this.props;return n.createElement(o.Page,{header:e,back:"close"},n.createElement("div",{className:"container"},n.createElement(l.SearchBox,{className:"my-2",onSearch:this.onSearch,placeholder:i,maxLength:100})),n.createElement(l.List,{items:this.items,item:{onClick:this.itemClick,render:t}}))}};ye([c.l],we.prototype,"items",void 0),we=ye([a.a],we);var Ee=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},xe=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let Ce=class extends n.Component{constructor(){super(...arguments),this.renderUqRow=((e,t)=>{let{name:i,owner:s,unit:r,discription:o}=e;return n.createElement(l.LMR,{className:"py-2",right:n.createElement("small",{className:"text-muted"},o)},s," / ",i)}),this.act=(()=>xe(this,void 0,void 0,function*(){let{app:e,appActed:t}=this.props,{id:i,unit:n,inUnit:s}=e,r=1;if(0===s){(yield L.restoreUnitApp(i))<=0&&alert("app \u6216\u8005 uq \u6ca1\u6709\u5b9a\u4e49 service")}else if(1===s)yield L.stopUnitApp(i),r=0;else{let t=d.a.clone(e);t.id=i,t.inUnit=1,(yield L.addUnitApp(t))<=0&&alert("app \u6216\u8005 uq \u6ca1\u6709\u5b9a\u4e49 service")}void 0!==t&&t(i,r),o.nav.pop()}))}componentWillMount(){return xe(this,void 0,void 0,function*(){this.uqAccesses=yield f.loadAppUqs(this.props.app.id)})}render(){let e,t,i,{unit:s,name:r,discription:o,icon:a,inUnit:c,date_init:u,date_update:d}=this.props.app,h=n.createElement("div",null,n.createElement("div",null,o),n.createElement(Y,{date_update:d,date_init:u}));1===c?(e="ban",t="\u505c\u7528APP",i="btn-danger"):0===c?(e="refresh",t="\u6062\u590dAPP",i="btn-success"):(e="plus",t="\u542f\u7528APP",i="btn-primary");let m=["",{type:"component",component:n.createElement(l.Media,{icon:a,main:r,discription:h})},"",{type:"component",label:"\u5f00\u53d1\u53f7",component:n.createElement("div",{className:"py-2"},n.createElement(ee,{id:s,isLink:!0}))},{type:"component",label:"\u5173\u8054UQ",component:n.createElement(l.List,{className:"w-100",items:this.uqAccesses,item:{render:this.renderUqRow}})},"","",{type:"component",bk:"",component:n.createElement("button",{className:J()("btn","w-100",i),onClick:this.act},n.createElement(l.FA,{name:e,size:"lg"})," ",t)}];return n.createElement("div",null,n.createElement(l.PropGrid,{rows:m,values:this.props}))}};Ee([c.l],Ce.prototype,"uqAccesses",void 0),Ce=Ee([a.a],Ce);var ke=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Pe extends o.PageItems{constructor(e){super(),this.unitId=e}load(){return ke(this,void 0,void 0,function*(){return yield m.searchApp(this.unitId,this.param,this.pageStart,this.pageSize)})}setPageStart(e){this.pageStart=void 0===e?0:e.id}}let Ne=class extends n.Component{constructor(e){super(e),this.onSearch=(e=>ke(this,void 0,void 0,function*(){yield this.apps.first(e)})),this.appClick=(e=>{o.nav.push(n.createElement(o.Page,{header:"App\u8be6\u7ec6\u4fe1\u606f"},n.createElement(Ce,{app:e,appActed:this.appActed})))}),this.appActed=((e,t)=>{let i=this.apps.items,n=i.find(t=>t.id===e);n.inUnit=t,i.replace([n])}),this.apps=new Pe(L.unit.id)}renderApp(e){let t,{name:i,discription:s,icon:r,inUnit:a}=e;return 1===a?t=n.createElement("small",null,"\u5df2\u542f\u7528"):0===a&&(t=n.createElement("small",null,"\u5df2\u505c\u7528")),n.createElement(l.LMR,{className:"px-3 py-2",left:n.createElement(l.Badge,null,n.createElement(o.Image,{src:r})),right:t},n.createElement("div",{className:"px-3"},n.createElement("div",null,i),n.createElement("small",{className:"text-muted"},s)))}render(){let e=this.apps.items,t=n.createElement(l.SearchBox,{onSearch:this.onSearch,className:"w-100 mx-1",placeholder:"\u641c\u7d22App",maxLength:100});return n.createElement(o.Page,{header:t},n.createElement(l.List,{items:e,item:{onClick:this.appClick,render:this.renderApp},before:"\u641c\u7d22App\u540d\u5b57"}))}};Ne=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([a.a],Ne);var Se=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let Ae=class extends n.Component{componentDidMount(){return Se(this,void 0,void 0,function*(){yield L.loadApps()})}itemRender(e,t){let i,{name:s,discription:r,icon:a,inUnit:c}=e;return 0===c&&(i=n.createElement(l.FA,{className:"text-danger",name:"ban"})),n.createElement(l.LMR,{className:"px-3 py-1",left:n.createElement(l.Badge,null,n.createElement(o.Image,{src:a})),right:i},n.createElement("div",{className:"px-3"},n.createElement("div",null,s),n.createElement("small",{className:"text-muted"},r)))}appClick(e){o.nav.push(n.createElement(o.Page,{header:"App\u8be6\u7ec6\u4fe1\u606f"},n.createElement(Ce,{app:e})))}newItem(){o.nav.push(n.createElement(Ne,Object.assign({},this.props)))}render(){let e=n.createElement("button",{className:"btn btn-secondary btn-sm",onClick:()=>this.newItem()},n.createElement(l.FA,{name:"plus"}));return n.createElement(o.Page,{header:"\u542f\u505cApp",right:e},n.createElement(l.List,{items:L.apps,item:{render:this.itemRender,onClick:this.appClick}}))}};var Re=Ae=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([a.a],Ae),Oe=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Fe extends n.Component{constructor(){super(...arguments),this.schema=[{name:"name",type:"string",maxLength:5,required:!0},{name:"discription",type:"string",maxLength:250},{name:"submit",type:"button"}],this.uiSchema={items:{name:{widget:"text",label:"\u540d\u79f0"},discription:{widget:"textarea",label:"\u63cf\u8ff0"},submit:{widget:"button",label:"\u63d0\u4ea4"}}},this.onSubmit=((e,t)=>Oe(this,void 0,void 0,function*(){let{name:e,discription:t}=this.context.formData;(yield L.unitAddRole(e,t))<=0?this.context.setError("name","\u89d2\u8272\u540d "+e+" \u5df2\u7ecf\u5b58\u5728"):o.nav.pop()}))}render(){return n.createElement(o.Page,{header:"\u65b0\u5efa\u89d2\u8272"},n.createElement(o.Form,{className:"m-3",schema:this.schema,uiSchema:this.uiSchema,formData:{},onButtonClick:this.onSubmit}))}}var Ie=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class qe extends n.Component{constructor(e){super(e),this.state={apps:void 0}}componentDidMount(){return Ie(this,void 0,void 0,function*(){let e=yield m.unitRoleApps(L.unit.id,this.props.role.id);this.setState({apps:e})})}renderRoleApp(e,t){return n.createElement(l.LMR,{className:"py-2 px-3 align-items-center",left:e.name,right:n.createElement("small",{className:"text-muted"},e.discription)})}render(){let{role:e}=this.props;return n.createElement(o.Page,{header:e.name+" - \u53ef\u7528APP"},n.createElement(l.List,{items:this.state.apps,item:{render:this.renderRoleApp},none:"\u6ca1\u6709APP"}))}}var Ue=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},Ve=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let je=class extends n.Component{constructor(){super(...arguments),this.renderMemberRole=(e=>{let{name:t,discription:i}=e;return n.createElement(l.LMR,{className:"py-2 px-3 align-items-center",left:t,right:n.createElement(l.Muted,null,i)})}),this.setRole=(()=>{o.nav.push(n.createElement(Te,null))})}componentDidMount(){return Ve(this,void 0,void 0,function*(){yield L.loadRoles(),yield L.loadMemberRoles()})}onAssigned(e,t){return Ve(this,void 0,void 0,function*(){yield L.unitAssignMember(e)})}roleClick(e){o.nav.push(n.createElement(qe,{role:e}))}render(){let e=L.roleMember,{nick:t,name:i,assigned:s,icon:r}=e,a=n.createElement("div",null,n.createElement("div",null,n.createElement(l.Muted,null,"\u552f\u4e00\u540d: ")," \xa0 ",i),n.createElement("div",null,n.createElement(l.Muted,null,"\u6635\u79f0: ")," \xa0 ",t||n.createElement(l.Muted,null,"[\u65e0]"))),c=["",{type:"component",component:n.createElement(l.Media,{icon:r||ne,main:e.assigned||t||i,discription:a})},"",{label:"\u5907\u6ce8\u540d",type:"string",name:"assigned",onClick:()=>o.nav.push(n.createElement(ve,{title:"\u4fee\u6539\u5907\u6ce8\u540d",value:e.assigned,onChanged:this.onAssigned,info:"\u52a0\u4e00\u4e2a\u5907\u6ce8\uff0c\u4fbf\u4e8e\u7504\u522b\u7528\u6237"}))},""],u=n.createElement("button",{className:"btn btn-success btn-sm",onClick:this.setRole},"\u4fee\u6539\u89d2\u8272");return n.createElement(o.Page,{header:"\u7528\u6237\u8be6\u60c5",right:u},n.createElement(l.PropGrid,{rows:c,values:e}),n.createElement("div",{className:"px-3 py-1"},n.createElement("small",null,n.createElement(l.FA,{name:"angle-double-right"})," \u6240\u5c5e\u89d2\u8272")),n.createElement(l.List,{items:L.memberRoles,item:{render:this.renderMemberRole,onClick:this.roleClick}}))}};je=Ue([a.a],je);let Te=class extends n.Component{constructor(e){super(e),this.submit=this.submit.bind(this)}componentDidMount(){return Ve(this,void 0,void 0,function*(){yield L.loadRoles(),yield L.loadMemberRoles()})}renderRole(e,t){return n.createElement(l.LMR,{className:"py-2 px-3 align-items-center",left:e.name,right:n.createElement("small",{className:"text-muted"},e.discription)})}roleSelect(e,t,i){}submit(){return Ve(this,void 0,void 0,function*(){yield L.setMemberRoles(this.list.selectedItems),o.nav.pop()})}render(){let e=n.createElement("button",{className:"btn btn-success btn-sm",onClick:this.submit},"\u4fdd\u5b58"),t=L.roles,i=L.memberRoles;return n.createElement(o.Page,{header:"\u4fee\u6539\u89d2\u8272",right:e},n.createElement(l.List,{ref:e=>this.list=e,items:t,selectedItems:i,compare:(e,t)=>e.id===t.id,item:{render:this.renderRole,onSelect:this.roleSelect}}))}};Te=Ue([a.a],Te);var Le=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let Me=class extends n.Component{componentDidMount(){return Le(this,void 0,void 0,function*(){yield L.loadMembers()})}renderMember(e,t){return n.createElement(De,Object.assign({},e))}userClick(e){L.setRoleUser(e),o.nav.push(n.createElement(je,null))}onSearch(){let e=L.role,t=void 0===e?0:e.id;o.nav.push(n.createElement(_e,{roleId:t}))}render(){let e=n.createElement("button",{className:"btn btn-sm",onClick:this.onSearch},n.createElement(l.FA,{name:"search"}));return n.createElement(o.Page,{header:"\u7528\u6237",right:e},n.createElement(l.List,{items:L.roleMembers,item:{render:this.renderMember,onClick:this.userClick}}))}};Me=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o}([a.a],Me);const De=e=>{let t,{nick:i,name:s,assigned:r,icon:a}=e;return t=r?n.createElement(n.Fragment,null,n.createElement("div",null,n.createElement("b",null,r)," ",n.createElement(l.Muted,null,i)),n.createElement(l.Muted,null,s)):i?n.createElement(n.Fragment,null,n.createElement("div",null,n.createElement("b",null,i)),n.createElement(l.Muted,null,s)):n.createElement("div",null,n.createElement("b",null,s)),n.createElement(l.LMR,{className:"py-2 px-3 align-items-stretch",left:n.createElement(l.Badge,{size:"sm"},n.createElement(o.Image,{src:a}))},n.createElement("div",{className:"px-3"},t))};class _e extends n.Component{constructor(e){super(e),this.onSearch=this.onSearch.bind(this),this.state={members:null}}onSearch(e){return Le(this,void 0,void 0,function*(){let t=yield m.unitMembers(L.unit.id,this.props.roleId,e,0,100);this.setState({members:t})})}renderMember(e,t){return n.createElement(De,Object.assign({},e))}userClick(e){L.setRoleUser(e),o.nav.push(n.createElement(je,null))}render(){let e=n.createElement(l.SearchBox,{className:"w-100 mx-1",onSearch:this.onSearch,maxLength:100,placeholder:"\u641c\u7d22\u7528\u6237"});return n.createElement(o.Page,{header:e},n.createElement(l.List,{items:this.state.members,item:{render:this.renderMember,onClick:this.userClick}}))}}var Be=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},He=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let $e=class extends n.Component{constructor(){super(...arguments),this.renderRoleApp=((e,t)=>n.createElement(l.LMR,{className:"py-2 px-3 align-items-center",left:e.name,right:n.createElement("small",{className:"text-muted"},e.discription)})),this.roleAppClick=(e=>{o.nav.push(n.createElement(We,null))})}componentDidMount(){return He(this,void 0,void 0,function*(){yield L.loadApps(),yield L.loadRoleApps()})}editRole(){o.nav.push(n.createElement(ze,null))}addRoleApp(){o.nav.push(n.createElement(We,null))}members(){o.nav.push(n.createElement(Me,null))}render(){let e,t,i,{name:s,discription:r,count:a}=L.role;void 0===a||null===a||0===a?t=n.createElement("small",{className:"text-muted"},"\u65e0\u7528\u6237"):(t=`\u5171\u6709 ${a} \u7528\u6237`,i=n.createElement("div",null,n.createElement(l.FA,{name:"chevron-right"})),e=this.members);let c=["",{type:"component",component:n.createElement(l.Media,{icon:void 0,main:s,discription:r}),onClick:this.editRole},"",{type:"component",component:n.createElement(l.LMR,{className:"py-2",left:t,right:i}),onClick:e},"="],u=n.createElement("button",{className:"btn btn-success btn-sm",onClick:()=>this.addRoleApp()},n.createElement(l.FA,{name:"plus"})," APP");return n.createElement(o.Page,{header:"\u89d2\u8272",right:u},n.createElement(l.PropGrid,{rows:c,values:{}}),n.createElement("div",{className:"px-3 py-1"},n.createElement("small",null,n.createElement(l.FA,{name:"angle-double-right"})," \u53ef\u7528APP\u5217\u8868")),n.createElement(l.List,{items:L.roleApps,item:{render:this.renderRoleApp,onClick:this.roleAppClick},none:n.createElement("small",{className:"text-muted px-3 py-1"},"\u6ca1\u6709APP, \u70b9\u51fb\u53f3\u4e0a\u89d2\u6309\u94ae\u9009\u62e9APP")}))}};$e=Be([a.a],$e);let ze=class extends n.Component{onNameChanged(e,t){return He(this,void 0,void 0,function*(){yield L.roleChangeProp("name",e)})}onDiscriptionChanged(e,t){return He(this,void 0,void 0,function*(){yield L.roleChangeProp("discription",e)})}render(){let e=L.role,{id:t}=e,i=1===t||2===t,s=["",{label:"\u540d\u79f0",type:"string",name:"name",onClick:i?void 0:()=>o.nav.push(n.createElement(ve,{title:"\u4fee\u6539\u540d\u79f0",value:e.name,onChanged:this.onNameChanged,info:"\u597d\u7684\u540d\u5b57\u4fbf\u4e8e\u7406\u89e3"}))},{label:"\u63cf\u8ff0",type:"string",name:"discription",onClick:i?void 0:()=>o.nav.push(n.createElement(ve,{title:"\u4fee\u6539\u63cf\u8ff0",value:e.discription,onChanged:this.onDiscriptionChanged,info:"\u5bf9\u89d2\u8272\u505a\u4e00\u4e2a\u8bf4\u660e"}))}];return n.createElement(o.Page,{header:"\u4fee\u6539\u89d2\u8272\u4fe1\u606f"},n.createElement(l.PropGrid,{rows:s,values:e,alignValue:"right"}))}};ze=Be([a.a],ze);let We=class extends n.Component{constructor(e){super(e),this.submit=this.submit.bind(this)}componentDidMount(){return He(this,void 0,void 0,function*(){yield L.loadApps(),yield L.loadRoleApps()})}renderApp(e,t){return n.createElement(l.LMR,{className:"py-1 px-2 align-items-center",left:e.name,right:n.createElement("small",{className:"text-muted"},e.discription)})}appSelect(e,t,i){}submit(){return He(this,void 0,void 0,function*(){yield L.setRoleApps(this.list.selectedItems),o.nav.pop()})}render(){let e=n.createElement("button",{className:"btn btn-success btn-sm",onClick:this.submit},"\u4fdd\u5b58"),t=L.apps,i=L.roleApps;return n.createElement(o.Page,{header:"\u9009\u62e9APP",right:e},n.createElement(l.List,{ref:e=>this.list=e,items:t,selectedItems:i,item:{render:this.renderApp,onSelect:this.appSelect}}))}};We=Be([a.a],We);var Qe=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},Ke=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const Ge=J()("d-flex","h-100","align-items-center","px-5","small","text-muted");let Je=class extends n.Component{constructor(){super(...arguments),this.renderRole=((e,t)=>{let{name:i,discription:s,count:r}=e;return n.createElement(l.LMR,{className:"px-3 py-2",left:i,right:String(r||"")},n.createElement("div",{className:Ge},s))}),this.roleClick=(e=>{L.setRole(e),o.nav.push(n.createElement($e,null))}),this.newRole=(e=>{e.preventDefault(),o.nav.push(n.createElement(Fe,null))}),this.allUsersClick=(()=>{L.setRole(void 0),o.nav.push(n.createElement(Me,null))})}componentDidMount(){return Ke(this,void 0,void 0,function*(){yield L.loadRoles()})}render(){let e=n.createElement("a",{className:"small",href:"#",onClick:this.newRole},"\u65b0\u589e"),t=n.createElement(l.LMR,{className:"px-3 small bg-light",left:"\u89d2\u8272",right:e});return n.createElement(o.Page,{header:"\u7528\u6237\u89d2\u8272"},n.createElement(l.LMR,{className:"my-3 px-3 py-2 bg-white",left:"\u7528\u6237",right:String(L.memberCount),onClick:this.allUsersClick},n.createElement("div",{className:Ge},"\u8bbe\u7f6e\u7528\u6237\u89d2\u8272")),n.createElement(l.List,{header:t,items:L.roles,none:"[\u65e0]",item:{render:this.renderRole,onClick:this.roleClick}}))}};Je=Qe([a.a],Je);var Ye=i(12),Xe=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};var Ze=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};var et={map:{teamPerson:{CMap:class extends Ye.CMap{searchOnKey(e,t){const i=e=>super[e];return Xe(this,void 0,void 0,function*(){switch(e.name){default:return yield i("searchOnKey").call(this,e,t);case"post":return yield this.searchOnPost(t)}})}searchOnPost(e){return Xe(this,void 0,void 0,function*(){let t=this.cQuerySelect("teamPosts");return(yield t.call(e)).post.id})}},keys:[{content:({name:e,id:t},i)=>n.createElement(n.Fragment,null,n.createElement(l.Muted,null,i.team," \xa0 ")," ",e),none:e=>e.noStaff},{content:({name:e,id:t},i)=>n.createElement(n.Fragment,null,n.createElement(l.Muted,null,i.staff," \xa0 ")," ",e," \xa0 ",n.createElement(l.Muted,null,i.no," ",Object(o.left0)(t,4))),none:e=>e.noPost},{content:({title:e,id:t},i)=>n.createElement(n.Fragment,null,n.createElement(l.Muted,null,i.post," \xa0 ")," ",e),none:void 0}]}},tuid:{user:{CTuidSelect:class extends Ye.CTuidSelect{buildPageItems(){let e=this.cUq.cFromName("query","SearchUser");return new Ye.QueryPageItems(e.entity)}idFromItem(e){return e.id}searchMain(e){return Ze(this,void 0,void 0,function*(){void 0===this.PageItems&&(this.PageItems=this.buildPageItems()),void 0!==e&&(yield this.PageItems.first({key:e}))})}},content:e=>n.createElement(n.Fragment,null,e.name)},organization:{divs:{post:{content:e=>{let{title:t}=e;return n.createElement(n.Fragment,null,t)},rowContent:e=>{let{title:t}=e;return n.createElement(n.Fragment,null,t)}}}}},query:{teamPosts:{row:Object(a.a)(e=>{let{post:t}=e;return n.createElement("div",{className:"px-3 py-2"},t.content())})}},res:{zh:{CN:{x:{no:"\u7f16\u53f7",team:"\u90e8\u95e8",staff:"\u5458\u5de5",noStaff:"\u65e0\u5458\u5de5",post:"\u804c\u4f4d",noPost:"\u65e0\u804c\u4f4d",a:"aaa",b:{s:"sss",d:()=>s.a.createElement("span",{className:"text-success"},"ddd")},c:()=>s.a.createElement("span",{className:"text-danger"},"ccc")},uq:"$UNITX",tuid:"\u57fa\u7840\u6863\u6848",map:"\u5bf9\u7167\u8868",sheet:"\u5355\u636e",pending:"\u5f85\u5904\u7406",book:"\u5e10",action:"\u64cd\u4f5c",tuidNullCaption:"\u9009\u62e9",submit:"\u63d0\u4ea4",arrNew:"\u65b0\u589e",arrEdit:"\u4fdd\u5b58",entity:{message:{label:"\u6d88\u606f-message",arrNew:"\u65b0\u589e\u6d88\u606f",arrEdit:"\u4fdd\u5b58\u6d88\u606f",fields:{fromUser:"\u53d1\u9001\u4eba",fromUnit:"\u53d1\u9001\u90e8\u95e8",type:"\u7c7b\u578b",date:"\u65e5\u671f",subject:"\u4e3b\u9898",discription:"\u63cf\u8ff0",content:"\u5185\u5bb9"}},getMessage:{label:"\u83b7\u53d6Message",submit:"\u83b7\u53d6\u6d88\u606f",fields:{msg:"\u6d88\u606f"}},newMessage:{label:"\u65b0\u5efa\u6d88\u606f",fields:{type:"\u7c7b\u578b",subject:"\u4e3b\u9898"},arrs:{to:{label:"\u53d1\u9001",newSubmit:"\u65b0\u589eto",editSumbit:"\u4fdd\u5b58to"},cc:{label:"\u6284\u9001",newSubmit:"\u65b0\u589ecc",editSumbit:"\u4fdd\u5b58cc"}}},sectionTeam:{label:"\u5927\u90e8-\u56e2\u961f\u5bf9\u7167\u8868"},teamPerson:{label:"\u5458\u5de5-\u5c97\u4f4d\u5bf9\u7167\u8868",fields:{},confirmDelete:d.a.template("\u771f\u7684\u8981\u5220\u9664${label}\u5417")},teamOrganization:{label:"\u56e2\u961f-\u673a\u6784\u5bf9\u7167\u8868"},teamPosts:{label:"\u56e2\u961f-\u5c97\u4f4d\u5bf9\u7167\u8868"},person:{label:"\u5458\u5de5",fields:{name:"\u59d3\u540d",nick:"\u522b\u540d",given:"\u540d\u5b57",sur:"\u59d3",gender:"\u6027\u522b",user:"\u7528\u6237"}},organization:{label:"\u673a\u6784",arrs:{post:{label:"\u5c97\u4f4d"}}},user:{label:"\u7528\u6237"},team:{label:"\u56e2\u961f"},section:{label:"\u5927\u90e8"}}}}}},tt=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class it extends o.VPage{constructor(){super(...arguments),this.sheetOpsChanged=!1,this.stateTosView=Object(a.a)(({tosText:e})=>{let t=e.get();return s.a.createElement("div",{className:"bg-light py-1 px-2"},void 0===t||0===t.length?s.a.createElement(l.Muted,null,"[\u65e0\u5c97\u4f4d]"):t.map((e,t)=>s.a.createElement("span",{key:e,className:"d-inline-block border bg-white rounded mr-2 my-1 py-1 px-2"},e)))}),this.organizationRow=((e,t)=>{let{id:i,name:n}=e;return s.a.createElement("div",null,"id:",i," name:",n)}),this.teamRow=((e,t)=>s.a.createElement(this.observableTeamRow,Object.assign({},e))),this.sectionRow=((e,t)=>s.a.createElement(this.observableSectionRow,Object.assign({},e))),this.postRow=((e,t)=>s.a.createElement(this.observablePostRow,Object.assign({},e))),this.stateView=(e=>{let{caption:t}=e,i=s.a.createElement("button",{className:"btn btn-sm btn-success",onClick:()=>tt(this,void 0,void 0,function*(){return yield this.saveOps(e)})},"\u4fdd\u5b58");return s.a.createElement(o.Page,{header:`${this.sheet.name} - ${t}`,back:"close",right:i},s.a.createElement("div",{className:"mx-3 my-2"},s.a.createElement(l.Muted,null,"\u8bbe\u7f6e\u5355\u636e\u72b6\u6001\u8ddf\u5c97\u4f4d\u7684\u5bf9\u5e94\u5173\u7cfb")),s.a.createElement(l.List,{className:"my-2",items:this.selectablePosts,item:{render:this.postRow}}))}),this.observablePostRow=Object(a.a)(e=>{let t,{post:i,selected:n,teams:r}=e,{title:o}=i,a=n.get();return!0===a&&(t=s.a.createElement(l.List,{className:"ml-4 va-list-top-border",items:r,item:{render:this.teamRow}})),s.a.createElement("div",{className:"flex-column"},s.a.createElement("label",{className:"px-3 py-2 w-100 mb-0"},s.a.createElement("input",{className:"mr-3 align-middle",type:"checkbox",defaultChecked:a,onChange:t=>this.onPostSelectChanged(e,t.target.checked)}),s.a.createElement(l.Muted,null,"\u5c97\u4f4d")," \xa0 ",o),t)}),this.observableTeamRow=Object(a.a)(e=>{let t,{team:i,selected:n,sections:r}=e,{name:o}=i,a=n.get();return!0===a&&r.length>0&&(t=s.a.createElement(l.List,{className:"ml-4 va-list-top-border",items:r,item:{render:this.sectionRow}})),s.a.createElement("div",{className:"flex-column"},s.a.createElement("label",{className:"px-3 py-2 w-100 mb-0"},s.a.createElement("input",{className:"mr-3 align-middle",type:"checkbox",defaultChecked:a,onChange:t=>this.onTeamSelectChanged(e,t.target.checked)}),s.a.createElement(l.Muted,null,"\u90e8\u95e8")," \xa0 ",o),t)}),this.observableSectionRow=Object(a.a)(e=>{let{section:t,selected:i}=e,{name:n}=t,r=i.get();return s.a.createElement("div",{className:"flex-column"},s.a.createElement("label",{className:"px-3 py-2 w-100 mb-0"},s.a.createElement("input",{className:"mr-3 align-middle",type:"checkbox",defaultChecked:r,onChange:t=>this.onSectionSelectChanged(e,t.target.checked)}),s.a.createElement(l.Muted,null,"\u5927\u90e8")," \xa0 ",n))})}stateClick(e){let{organizations:t,teams:i,sections:n,posts:s}=this.controller,r={},{tos:o}=e;if(void 0!==o)for(let a of o){let{post:e}=a,t=e.id,i=r[t];void 0===i&&(r[t]=i=[]),i.push(a)}this.selectablePosts=s.map(e=>this.buildSelectablePost(e,r)),this.sheetOpsChanged=!1,this.openPage(this.stateView,e),this.regConfirmClose(()=>tt(this,void 0,void 0,function*(){return!1===this.sheetOpsChanged||confirm("\u672a\u4fdd\u5b58\n\u771f\u7684\u4e0d\u4fdd\u5b58\u5417\uff1f")}))}buildSelectablePost(e,t){let i,n,s=t[e.id];return void 0===s?(i=!1,n=[]):(i=!0,n=this.buildSelectableTeams(e,s)),{post:e,selected:c.l.box(i),teams:n}}buildSelectableTeams(e,t){let i={},n=!1;for(let c of t){let e,{team:t}=c;void 0===t?(e=0,n=!0):e=t.id;let s=i[e];void 0===s&&(i[e]=s=[]),s.push(c)}let s=[],{organization:r}=e;if(void 0!==r&&void 0!==r.teams)for(let c of e.organization.teams)void 0!==c.sections&&s.push(...c.sections);let o=[],a=i[0],l=this.buildSelectableSections(s,a);if(o.push({team:{id:0,name:"* \u6240\u6709\u90e8\u95e8",no:void 0,sections:s,organizations:void 0},selected:c.l.box(void 0!==a),sections:l}),void 0!==r&&void 0!==r.teams&&e.organization.teams.forEach(e=>{let t=i[e.id];o.push({team:e,selected:c.l.box(void 0!==t),sections:this.buildSelectableSections(s,t)})}),!0===n&&1===t.length){let e=o[0],t=!1;for(let i of e.sections)if(!0===i.selected.get()){t=!0;break}!1===t&&(e.selected.set(!1),e.sections=[])}return o}buildSelectableSections(e,t){let i=[];for(let n of e)i.push({section:n,selected:c.l.box(t&&void 0!==t.find(e=>e.section&&n.id===e.section.id))});return i}renderState(e){let t,{name:i,caption:n,tos:r,tosText:o,configable:a}=e;if(!0===a){let i=s.a.createElement(l.FA,{className:"text-muted align-self-center",name:"chevron-right"}),r=()=>this.stateClick(e),a=s.a.createElement(this.stateTosView,{tosText:o});t=s.a.createElement(s.a.Fragment,null,s.a.createElement(l.LMR,{className:"bg-white py-1 px-2 cursor-pointer",right:i,onClick:r},n),a)}else t=s.a.createElement("div",{className:"bg-white py-1 px-2"},n);return s.a.createElement("div",{key:i,className:"border border-light rounded mx-1 my-3"},t)}tosTexts(e){return e&&e.map((e,t)=>{let{post:i,team:n,section:s}=e,r=i.title;return void 0!==n&&n.id>0&&(r+=" @ "+n.name),void 0!==s&&(void 0!==n&&0!==n.id||(r+=" @ * "),r+=" / "+s.name),r})}open({entity:e,opTos:t}){return tt(this,void 0,void 0,function*(){this.sheet=e;let{name:i,states:n}=e;if(void 0===n){let e=t.$;return this.states=[{name:"$",caption:"\u5141\u8bb8\u5c97\u4f4d",configable:!0,tos:e,tosText:c.l.box(this.tosTexts(e))}],void this.openPageElement(s.a.createElement(o.Page,{header:i+" - \u5c97\u4f4d"},this.states.map(e=>this.renderState(e))))}this.states=n.map(e=>{let i,n,r;switch(e.substr(0,1)){case"<":i=s.a.createElement(s.a.Fragment,null,e.substr(1)," \xa0 ",s.a.createElement(l.Muted,null,"\u56de\u590d")),n=!1;break;case"#":i=s.a.createElement(s.a.Fragment,null,e.substr(1)," \xa0 ",s.a.createElement(l.Muted,null,"\u8fd4\u521d")),n=!1;break;case"$":i="[\u65b0\u5f00\u5355]",n=!0,r=t[e];break;default:i=e,n=!0,r=t[e]}return{name:e,caption:i,configable:n,tos:r,tosText:c.l.box(this.tosTexts(r))}}),this.openPageElement(s.a.createElement(o.Page,{header:"\u5355\u636e\u72b6\u6001\u5bf9\u5e94\u5c97\u4f4d - "+i},this.states.map(e=>this.renderState(e))))})}saveOps(e){return tt(this,void 0,void 0,function*(){let t=e.name,i=[],n=[];for(let e of this.selectablePosts){if(!1===e.selected.get())continue;let t=e.post.id,s=0;for(let r of e.teams){if(!1===r.selected.get())continue;let o=r.team.id;++s;let a=0;for(let s of r.sections){if(!1===s.selected.get())continue;let l=s.section.id;++a,n.push({post:t,team:o,section:l}),i.push({post:e.post,team:r.team,section:s.section})}0===a&&(n.push({post:t,team:o,section:0}),i.push({post:e.post,team:r.team,section:void 0}))}0===s&&(n.push({post:t,team:0,section:0}),i.push({post:e.post,team:void 0,section:void 0}))}yield this.controller.saveSheetStatePosts(this.sheet,t,n);let s=this.states.find(e=>e.name===t);s.tos=i;let r=this.tosTexts(i);s.tosText.set(r),this.closePage()})}onPostSelectChanged(e,t){this.sheetOpsChanged=!0;let{post:i,selected:n}=e;if(!0===t){let t=[],{organization:n}=i;if(void 0!==n&&void 0!==n.teams)for(let e of i.organization.teams)void 0!==e.sections&&t.push(...e.sections);e.teams.push({team:{id:0,name:"* \u6240\u6709\u90e8\u95e8",no:void 0,sections:t,organizations:void 0},selected:c.l.box(!1),sections:[]}),void 0!==n&&void 0!==n.teams&&i.organization.teams.forEach(t=>{e.teams.push({team:t,selected:c.l.box(!1),sections:[]})})}else e.teams.splice(0);n.set(t)}onTeamSelectChanged(e,t){this.sheetOpsChanged=!0;let{team:i,selected:n}=e;!0===t?i.sections.forEach(t=>{e.sections.push({section:t,selected:c.l.box(!1)})}):e.sections.splice(0),n.set(t)}onSectionSelectChanged(e,t){this.sheetOpsChanged=!0;let{section:i,selected:n}=e;n.set(t)}}var nt=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class st extends o.VPage{constructor(){super(...arguments),this.checked={},this.isChanged=!1,this.onCheckChanged=((e,t)=>{this.checked[e.name].checked=t;let i=!1;for(let n in this.checked){let{def:e,checked:t}=this.checked[n];if(e!==t){i=!0;break}}this.isChanged=i}),this.saveChange=(()=>nt(this,void 0,void 0,function*(){let e=[];for(let i in this.checked)!0===this.checked[i].checked&&e.push({entity:i});let t=this.controller.cUq.cFromName("action","saveEntityOpForAll");yield t.entity.submit({uq:this.uq.id,entities:e});this.ceasePage(),this.openPageElement(n.createElement(o.Page,{header:"\u6240\u6709\u5c97\u4f4d\u53ef\u64cd\u4f5c",back:"close"},n.createElement("div",{className:"p-3"},n.createElement(l.FA,{name:"check-circle",className:"text-success"})," \xa0 \u5df2\u4fdd\u5b58")))})),this.pageRender=Object(a.a)(()=>{let e=!0===this.isChanged?n.createElement("button",{className:"btn btn-sm btn-success",onClick:this.saveChange},"\u4fdd\u5b58"):null;return n.createElement(o.Page,{header:"\u6240\u6709\u5c97\u4f4d\u53ef\u64cd\u4f5c",right:e},n.createElement("div",{className:"text-muted p-3 small"},n.createElement("div",{style:{lineHeight:"1.8",fontWeight:"bold"}},"\u8bf4\u660e"),n.createElement("ol",{className:"pl-3",style:{listStyleType:"1",lineHeight:"1.8"}},n.createElement("li",null,"\u6709\u4e9b\u64cd\u4f5c\uff0c\u9ed8\u8ba4\u5141\u8bb8\u6240\u6709\u7528\u6237\u53ef\u64cd\u4f5c\uff0c\u53ef\u4ee5\u5728\u8fd9\u91cc\u8bbe\u7f6e\u3002"),n.createElement("li",null,"\u6bd4\u5982\uff0c\u7528\u6237\u4e0b\u8ba2\u5355\u3002\u4efb\u4f55\u5ba2\u6237\uff0c\u767b\u5f55\u8fdb\u7cfb\u7edf\uff0c\u90fd\u53ef\u4ee5\u4e0b\u5355\u3002"),n.createElement("li",null,"\u5982\u679c\u6bcf\u4e2a\u7528\u6237\u90fd\u9700\u8981\u8bbe\u7f6e\uff0c\u7528\u6237\u4f1a\u4e22\u5931\uff0c\u7ba1\u7406\u4eba\u5458\u4f1a\u7e41\u7410\u3002"))),this.blocks.map(e=>{let{items:t,type:i}=e,s=Ye.entityIcons[i];return t&&t.length>0&&n.createElement(l.List,{key:i,className:"mt-3",header:n.createElement(l.Muted,{className:"px-3 pt-1 bg-light w-100"},this.res[i]||i),items:t,item:{render:(e,t)=>this.entityRender(e,s),onClick:void 0}})}))})}open(e){return nt(this,void 0,void 0,function*(){this.uq=e;let{name:t,tuids:i,actions:n,maps:s,books:r,queries:o,histories:a,pendings:l,sheets:c}=this.uq;this.blocks=[{items:i,type:"tuid"},{items:c,type:"sheet"},{items:n,type:"action"},{items:s,type:"map"},{items:r,type:"book"},{items:o,type:"query"},{items:a,type:"history"},{items:l,type:"pending"}];let u=this.controller.cUq.cFromName("query","getEntityOpForAll"),d=yield u.entity.query({uq:this.uq.id}),h={};for(let e of d.ret)h[e.entity]=!0;for(let e of this.blocks){let{items:t}=e;if(void 0!==t)for(let e of t){let{name:t}=e,i=!0===h[t];this.checked[t]={def:i,checked:i}}}this.openPage(this.pageRender),this.regConfirmClose(()=>nt(this,void 0,void 0,function*(){return!1===this.isChanged||confirm("\u672a\u4fdd\u5b58\n\u771f\u7684\u4e0d\u4fdd\u5b58\u5417\uff1f")}))})}entityRender(e,t){let{name:i}=e,s=n.createElement("input",{className:"mr-3 align-middle",type:"checkbox",defaultChecked:this.checked[i].def,onChange:t=>this.onCheckChanged(e,t.target.checked)});return n.createElement(l.LMR,{className:"px-3 py-2 align-items-center",right:s},t," \xa0 ",i)}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([c.l],st.prototype,"isChanged",void 0);var rt=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class ot extends o.VPage{constructor(){super(...arguments),this.users=[],this.onStopFully=(e=>rt(this,void 0,void 0,function*(){this.openPageElement(n.createElement(o.Page,{header:"\u505c\u6b62\u5168\u529f\u80fd"},n.createElement("div",{className:"p-3"},n.createElement("div",null,n.createElement("b",{className:"text-danger h4"},e.user.content())," \u505c\u6b62\u5168\u529f\u80fd\u7528\u6237\u3002",n.createElement("br",null),"\u8bf7\u786e\u8ba4\u3002"),n.createElement("div",{className:"p-3"},n.createElement("button",{className:"btn btn-success",onClick:()=>this.onSumitStopFully(e)},"\u505c\u6b62\u5168\u529f\u80fd"),n.createElement("button",{className:"ml-3 btn btn-outline-danger",onClick:this.onCancelStop},"\u4e0d\u505c")))))})),this.onSumitStopFully=(e=>rt(this,void 0,void 0,function*(){let t={_uq:this.uq.id,arr1:[{_user:e.user.id}]};yield this.entityOpUserFully.entity.actions.del.submit(t);let i=this.users.findIndex(t=>t===e);i>=0&&this.users.splice(i,1),this.closePage()})),this.onCancelStop=(()=>this.closePage()),this.addClick=(()=>rt(this,void 0,void 0,function*(){let e=yield this.controller.callSearchUser(this.uq);this.onUserSelected(e)})),this.renderUser=((e,t)=>n.createElement("div",{className:"px-3 py-2"},e.user.content())),this.onSearch=(e=>rt(this,void 0,void 0,function*(){yield this.pageUsers.first({key:e})})),this.onSetFully=(e=>rt(this,void 0,void 0,function*(){yield this.entityOpUserFully.entity.actions.add.submit({_uq:this.uq.id,arr1:[{_user:e.id}]}),this.tuidUser.entity.useId(e.id);let t={uq:this.uq.id,user:this.tuidUser.entity.boxId(e.id)};this.users.push(t),this.closePage(2)})),this.onCancelFully=(()=>{this.backPage()}),this.onUserSelected=(e=>{this.openPageElement(n.createElement(o.Page,{header:"\u786e\u8ba4"},n.createElement("div",{className:"p-3"},n.createElement("div",null,n.createElement("b",{className:"text-danger h4"},e.name)," \u5c06\u8bbe\u7f6e\u4e3a\u5168\u529f\u80fd\u7528\u6237\u3002\u53ea\u6709\u7cfb\u7edf\u7ba1\u7406\u5458\u6216\u8005\u6d4b\u8bd5\u4eba\u5458\u624d\u9700\u8981\u5168\u529f\u80fd\uff0c\u53ef\u4ee5\u64cd\u4f5c\u6240\u6709\u6570\u636e\u3002",n.createElement("br",null),"\u8bf7\u786e\u8ba4\u3002"),n.createElement("div",{className:"p-3"},n.createElement("button",{className:"btn btn-success",onClick:()=>this.onSetFully(e)},"\u8bbe\u7f6e\u4e3a\u5168\u529f\u80fd\u7528\u6237"),n.createElement("button",{className:"ml-3 btn btn-outline-danger",onClick:this.onCancelFully},"\u53d6\u6d88")))))}),this.renderSelectUser=((e,t)=>n.createElement("div",{className:"px-3 py-2"},JSON.stringify(e))),this.usersView=(()=>{let e=n.createElement(l.SearchBox,{className:"w-100",onSearch:this.onSearch,placeholder:"\u9009\u62e9\u7528\u6237"});return n.createElement(o.Page,{header:e},n.createElement(l.List,{before:"\u641c\u7d22\u7528\u6237\u540d",items:this.pageUsers,item:{render:this.renderSelectUser,onClick:this.onUserSelected}}))})}open(e){return rt(this,void 0,void 0,function*(){this.uq=e,this.entityOpUserFully=this.controller.cUq.cFromName("map","entityOpUserFully"),this.tuidUser=this.controller.cUq.cFromName("tuid","user"),yield this.entityOpUserFully.entity.loadSchema();let t=yield this.entityOpUserFully.entity.queries.all.query({_uq:this.uq.id}),i=n.createElement("button",{className:"btn btn-sm btn-success",onClick:this.addClick},n.createElement(l.FA,{name:"plus"}));this.users.push(...t.ret),this.openPageElement(n.createElement(o.Page,{header:"\u5168\u529f\u80fd\u7528\u6237",right:i},n.createElement(l.List,{items:this.users,item:{render:this.renderUser,onClick:this.onStopFully}})))})}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([c.l],ot.prototype,"users",void 0);var at=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class lt extends o.VPage{constructor(){super(...arguments),this.pageUsers=new ct,this.onUserClick=(e=>{this.closePage(),this.returnCall(e)}),this.onSearch=(e=>at(this,void 0,void 0,function*(){yield this.pageUsers.first({key:e,unit:this.unit,role:void 0})})),this.renderSelectUser=((e,t)=>n.createElement("div",{className:"px-3 py-2"},JSON.stringify(e)))}open(e){return at(this,void 0,void 0,function*(){this.unit=e;let t=n.createElement(l.SearchBox,{className:"w-100",onSearch:this.onSearch,placeholder:"\u9009\u62e9\u7528\u6237"});this.openPageElement(n.createElement(o.Page,{header:t},n.createElement(l.List,{before:"\u641c\u7d22\u7528\u6237\u540d",items:this.pageUsers,item:{render:this.renderSelectUser,onClick:this.onUserClick}})))})}}class ct extends o.PageItems{load(e,t,i){return at(this,void 0,void 0,function*(){let{unit:n,role:s,key:r}=e;return yield Ye.centerApi.get("unit/members",{key:r,unit:n,role:s,pageStart:t,pageSize:i})})}setPageStart(e){this.pageStart=void 0===e?0:e.id}}var ut=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class dt extends Ye.ControllerUq{constructor(){super(...arguments),this.icon=s.a.createElement(l.FA,{name:"map-o",className:"text-success",fixWidth:!0}),this.label="\u5c97\u4f4d\u6743\u9650 - UQ\u5bf9\u8c61",this.appRender=((e,t)=>{let{name:i,discription:n}=e;return s.a.createElement(l.LMR,{className:"px-3 py-2",right:n&&s.a.createElement(l.Muted,null,n)},i)}),this.appClick=(e=>{this.openPage(s.a.createElement(this.appView,Object.assign({},e)))}),this.appsView=(()=>s.a.createElement(o.Page,{header:this.label},s.a.createElement("div",{className:"text-muted p-3 small"},s.a.createElement("div",{style:{lineHeight:"1.8",fontWeight:"bold"}},"\u8bf4\u660e"),s.a.createElement("ol",{className:"pl-3",style:{listStyleType:"1",lineHeight:"1.8"}},s.a.createElement("li",null,"\u4e0b\u9762\u662f\u5168\u90e8\u542f\u7528\u7684APP\u3002\u8bf7\u9009\u62e9"),s.a.createElement("li",null,"\u6bcf\u4e2aAPP\u4f1a\u4f7f\u7528\u4e00\u4e2a\u4ee5\u4e0a\u7684UQ\u3002UQ\u91cc\u9762\u5b9a\u4e49\u4e86Tuid\uff0cAction\uff0cMap\u548cSheet\u7b49\u5bf9\u8c61\u3002"),s.a.createElement("li",null,"\u8bbe\u7f6e\u5bf9\u8c61\u8ddf\u5c97\u4f4d\u7684\u5173\u8054"))),s.a.createElement(l.List,{items:this.apps,item:{render:this.appRender,onClick:this.appClick}}))),this.entityClick=((e,t)=>ut(this,void 0,void 0,function*(){let e=this.cUq.cFromName("query","getEntityPost"),i=yield e.entity.query({uq:t.uq.id,entityName:t.name}),n={};for(let t of i.ret){let{op:e,post:i,team:s,section:r}=t,o=n[e];void 0===o&&(n[e]=o=[]),o.push({post:this.postDict[i],team:this.teamDict[s],section:this.sectionDict[r]})}this.openVPage(it,{entity:t,opTos:n})})),this.sheetClick=((e,t)=>ut(this,void 0,void 0,function*(){this.sheetClickOld(t)})),this.sheetClickOld=(e=>ut(this,void 0,void 0,function*(){let t=this.cUq.cFromName("query","getEntityPost"),i=yield t.entity.query({uq:e.uq.id,entityName:e.name}),n={};for(let e of i.ret){let{op:t,post:i,team:s,section:r}=e,o=n[t];void 0===o&&(n[t]=o=[]),o.push({post:this.postDict[i],team:this.teamDict[s],section:this.sectionDict[r]})}this.openVPage(it,{entity:e,opTos:n})})),this.renderSetting=((e,t)=>{let{icon:i,color:n,text:r}=e;return s.a.createElement("div",{className:"px-3 py-2 align-items-center"},s.a.createElement(l.FA,{name:i,fixWidth:!0,className:n})," \xa0 ",r)}),this.settingClick=((e,t)=>{let i,{name:n}=e;switch(n){default:return;case"entity-by-all-post":i=st;break;case"user-all-entities":i=ot}this.openVPage(i,t)}),this.uqRender=((e,t)=>{let{name:i,tuids:n,actions:r,maps:o,books:a,queries:c,histories:u,pendings:d,sheets:h}=e,m=this.entityRender,p=[{items:n,type:"tuid",itemClick:this.entityClick},{items:h,type:"sheet",itemClick:this.sheetClick,itemRender:this.sheetRender},{items:r,type:"action",itemClick:this.entityClick},{items:o,type:"map",itemClick:this.entityClick},{items:a,type:"book",itemClick:this.entityClick},{items:c,type:"query",itemClick:this.entityClick},{items:u,type:"history",itemClick:this.entityClick},{items:d,type:"pending",itemClick:this.entityClick}];return s.a.createElement("div",{key:i,className:"my-2"},s.a.createElement("div",{className:"px-3 font-weight-bold"},i),s.a.createElement(l.List,{className:"mt-3",items:[{name:"entity-by-all-post",icon:"cog",color:"text-success",text:"\u6240\u6709\u5c97\u4f4d\u53ef\u64cd\u4f5c"},{name:"user-all-entities",icon:"cog",color:"text-success",text:"\u5168\u529f\u80fd\u7528\u6237"}],item:{key:e=>e.name,render:this.renderSetting,onClick:t=>this.settingClick(t,e)}}),p.map(e=>{let{items:t,type:i,itemClick:n,itemRender:r}=e,o=Ye.entityIcons[i];return t&&t.length>0&&s.a.createElement(l.List,{key:i,className:"mt-3",header:s.a.createElement(l.Muted,{className:"px-3 pt-1 bg-light w-100"},this.res[i]||i),items:t,item:{key:e=>e.name,render:(e,t)=>(r||m)(e,o),onClick:t=>n(e,t)}})}))}),this.appView=(e=>s.a.createElement(o.Page,{header:e.name+"\u64cd\u4f5c\u6743\u9650"},e.uqs.map((e,t)=>this.uqRender(e,t))))}internalStart(){return ut(this,void 0,void 0,function*(){yield this.buildPosts(),yield this.buildAppsUqs(),this.openPage(s.a.createElement(this.appsView,null))})}buildAppsUqs(){return ut(this,void 0,void 0,function*(){let e=o.appInFrame.unit,t=yield Ye.centerApi.get("/unit/apps-uqs",{unit:e});this.apps=t[0];let i=t[1];for(let n of this.apps)n.uqs=[];for(let n of i){let e=this.apps.find(e=>e.id===n.app);void 0!==e&&(e.uqs.push(n),this.setUqEntities(n))}})}buildPosts(){return ut(this,void 0,void 0,function*(){let e=this.cUq.cFromName("query","allteams"),t=yield e.entity.query(void 0);this.teams=t.teams,this.organizations=t.organization,this.posts=t.organizationpost,this.sections=t.sections,this.postDict={},this.teamDict={},this.organizationDict={},this.sectionDict={};for(let i of this.organizations)i.posts=[],i.teams=[],this.organizationDict[i.id]=i;for(let i of this.teams)i.organizations=[],i.sections=[],this.teamDict[i.id]=i;for(let i of this.sections)i.teams=[],this.sectionDict[i.id]=i;for(let i of this.posts){this.postDict[i.id]=i;let e=this.organizationDict[i.owner];void 0!==e&&(i.organization=e,e.posts.push(i))}for(let i of t.teamorganization){let{team:e,organization:t}=i,n=this.teamDict[e],s=this.organizationDict[t];n.organizations.push(s),s.teams.push(n)}for(let i of t.sectionteam){let{section:e,team:t}=i,n=this.sectionDict[e],s=this.teamDict[t];n.teams.push(s),s.sections.push(n)}})}setUqEntities(e){let t=e.entities;if(null===t)return;let i,n=t.split("\n"),s=n.length;for(let r=0;r<s;){switch(n[r]){case"tuid":i=this.setEntities(e.tuids=[],n,r,e);break;case"map":i=this.setEntities(e.maps=[],n,r,e);break;case"book":i=this.setEntities(e.books=[],n,r,e);break;case"history":i=this.setEntities(e.histories=[],n,r,e);break;case"pending":i=this.setEntities(e.pendings=[],n,r,e);break;case"query":i=this.setEntities(e.queries=[],n,r,e);break;case"action":i=this.setEntities(e.actions=[],n,r,e);break;case"sheet":i=this.setSheets(e.sheets=[],n,r,e);break;default:return void alert("unknown entity type: "+n[r])}r=i}}setEntities(e,t,i,n){let s=t.length,r=i+1;for(;r<s;r++){let i=t[r];if(!(i.length>0))return r+1;{let t=i;e.push({uq:n,name:t,states:void 0})}}return r}setSheets(e,t,i,n){let s=t.length,r=i+1;for(;r<s;r++){let i=t[r];if(!(i.length>0))return r+1;{let t=i.split("\t"),s=t[0];t[0]="$";let r={uq:n,name:s,states:t};e.push(r)}}return r}saveSheetStatePosts(e,t,i){return ut(this,void 0,void 0,function*(){let n=this.cUq.cFromName("action","saveentityoppost"),{uq:s,name:r}=e;yield n.submit({uq:s.id,entityName:r,opName:t,posts:i})})}callSearchUser(e){return ut(this,void 0,void 0,function*(){return yield this.vCall(lt,o.appInFrame.unit)})}entityRender(e,t){let{name:i}=e;return s.a.createElement("div",{className:"px-3 py-2 align-items-center"},t," \xa0 ",i)}sheetRender(e,t){let{name:i,states:n}=e;return s.a.createElement("div",{className:"px-3 py-2 align-items-center"},t," \xa0 ",i," ",s.a.createElement(l.Muted,null," \xa0 ",e.states.join(", ")))}}var ht=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class mt extends Ye.CUq{constructor(){super(void 0,"$$$/$unitx",0,0,void 0,et),this.label="\u5c97\u4f4d\u6743\u9650",this.icon="sitemap"}clearPrevPages(){}loadEntites(){return ht(this,void 0,void 0,function*(){yield this.entities.loadEntities()})}internalStart(){return ht(this,void 0,void 0,function*(){yield this.loadSchema(),this.links=["",new Ye.CLink(new dt(this,this.res)),"",this.linkFromName("map","teamPerson"),this.linkFromName("map","sectionTeam"),this.linkFromName("map","teamOrganization"),"",this.linkFromName("tuid","person"),this.linkFromName("tuid","team"),this.linkFromName("tuid","section"),this.linkFromName("tuid","organization")],this.openVPage(pt)})}}class pt extends o.VPage{constructor(){super(...arguments),this.renderRow=((e,t)=>e.render("bg-white")),this.appPage=(()=>{let{links:e,label:t}=this.controller;return n.createElement(o.Page,{header:t,logout:()=>ht(this,void 0,void 0,function*(){})},n.createElement(l.List,{items:e,item:{render:this.renderRow}}))})}open(){return ht(this,void 0,void 0,function*(){this.openPage(this.appPage)})}}var ft=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const vt=e=>{let{discription:t,cloud:i,ip:s}=e;return n.createElement(n.Fragment,null,t," ",i," ",s)},gt=[{name:"name",type:"string",maxLength:100,required:!0},{name:"caption",type:"string",maxLength:100},{name:"discription",type:"string",maxLength:250},{name:"url",type:"string",maxLength:200},{name:"public",type:"boolean"},{name:"server",type:"id"},{name:"icon",type:"image"},{name:"submit",type:"submit"}];class yt extends o.VPage{constructor(){super(...arguments),this.candidateItems=((e,t)=>ft(this,void 0,void 0,function*(){return yield L.dev.searchServer.first(t),L.dev.searchServer.items})),this.moreCandidates=(()=>ft(this,void 0,void 0,function*(){yield L.dev.searchServer.more()})),this.renderRow=((e,t)=>n.createElement("div",{className:"px-3 py-2"},n.createElement(vt,Object.assign({},e)))),this.pickServerId=((e,t,i)=>new Promise((e,t)=>{o.nav.push(n.createElement(we,{caption:"\u9009\u62e9\u670d\u52a1\u5668",searchPlaceHolder:"\u641c\u7d22\u670d\u52a1\u5668",candidateItems:this.candidateItems,moreCandidates:this.moreCandidates,row:this.renderRow,idFromItem:e=>e.id,resolve:e,params:void 0}),()=>{t()})})),this.renderServerInput=(e=>n.createElement(me,{id:e})),this.uiSchema={items:{name:{widget:"text",label:"\u540d\u79f0"},caption:{widget:"text",label:"\u6807\u9898"},discription:{widget:"textarea",label:"\u63cf\u8ff0",rows:5},url:{widget:"text",label:"URL",placeholder:"http(s)://APP\u5730\u5740"},public:{widget:"checkbox",label:"\u516c\u5f00"},server:{widget:"id",label:"\u670d\u52a1\u5668",pickId:this.pickServerId,Templet:this.renderServerInput},icon:{widget:"image",label:"\u6807\u5fd7\u56fe"},submit:{widget:"button",label:"\u63d0\u4ea4",className:"btn btn-primary"}}},this.onButtonClick=((e,t)=>ft(this,void 0,void 0,function*(){let{data:e}=t,i=d.a.clone(this.controller.app)||{};d.a.merge(i,e),yield this.controller.saveApp(i),o.nav.pop()})),this.form=Object(a.a)(()=>n.createElement(o.Form,{fieldLabelSize:2,className:"m-3",schema:gt,uiSchema:this.uiSchema,formData:this.initValues,onButtonClick:this.onButtonClick}))}open(){return ft(this,void 0,void 0,function*(){this.openPage(this.page)})}}class bt extends yt{constructor(){super(...arguments),this.page=(()=>{let{app:e}=this.controller,{name:t}=e;return n.createElement(o.Page,{header:"\u4fee\u6539APP - "+t,back:"close"},n.createElement(this.form,null))})}get initValues(){return this.controller.app}}class wt extends yt{constructor(){super(...arguments),this.page=(()=>n.createElement(o.Page,{header:"\u65b0\u5efaAPP",back:"close"},n.createElement(this.form,null)))}get initValues(){return{}}}var Et=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class xt extends o.VPage{constructor(){super(...arguments),this.newItem=(()=>{this.openVPage(wt)}),this.page=(()=>{let{appList:e,listRowClick:t}=this.controller,i=n.createElement("button",{className:"btn btn-secondary btn-sm",onClick:()=>this.newItem()},n.createElement(l.FA,{name:"plus"}));return n.createElement(o.Page,{header:"App",right:i},n.createElement(l.List,{items:e,item:{render:this.appRow,onClick:t}}))}),this.appRow=(e=>{let{name:t,caption:i,discription:s,icon:r,url:a,urlDebug:c}=e,u=n.createElement(l.Badge,{size:"sm"},n.createElement(o.Image,{src:r})),d=n.createElement("div",{className:"text-muted small text-right"},a||"-",n.createElement("br",null),c),h=i?n.createElement(n.Fragment,null,t,": ",n.createElement("b",null,i)):n.createElement("b",null,t);return n.createElement(l.LMR,{className:"py-2 px-3 align-items-stretch",left:u,right:d},n.createElement("div",{className:"px-3"},n.createElement("div",null,h),n.createElement("div",null,n.createElement(l.Muted,null,s))))})}open(e){return Et(this,void 0,void 0,function*(){this.openPage(this.page)})}}var Ct=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},kt=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Pt extends o.VPage{constructor(){super(...arguments),this.onSearch=(e=>kt(this,void 0,void 0,function*(){this.uqs=yield this.controller.searchUq(e,0,100)})),this.page=Object(a.a)(()=>{let e=n.createElement(l.SearchBox,{className:"w-100 mx-1",onSearch:this.onSearch,placeholder:"\u641c\u7d22UQ\u540d\u5b57",maxLength:100});return n.createElement(o.Page,{back:"close",header:e},n.createElement(l.List,{items:this.uqs,item:{render:this.row,onClick:this.controller.onUq}}))}),this.row=(e=>{let{owner:t,name:i,discription:s}=e;return n.createElement(l.LMR,{className:"py-2 px-3",right:s},n.createElement("div",null,t," / ",i))})}open(){return kt(this,void 0,void 0,function*(){this.uqs=yield this.controller.getMyUqs(),this.openPage(this.page)})}}Ct([c.l],Pt.prototype,"uqs",void 0);let Nt=class extends n.Component{constructor(){super(...arguments),this.anySelected=!1,this.onSelect=((e,t,i)=>{this.anySelected=i}),this.row=(e=>{let{name:t,unit:i,discription:s}=e;return n.createElement(l.LMR,{className:"p-2",right:n.createElement("small",{className:"text-muted"},s)},n.createElement(ee,{id:i}),"/",t)}),this.removeBind=(()=>{if(null===this.list)return;let{selectedItems:e}=this.list;void 0!==e&&0!==e.length&&L.dev.apps.appBindUq(e.map(e=>({id:e.id,access:["*"]})),!1)})}render(){let e=this.anySelected?{color:"danger",onClick:this.removeBind,icon:"trash",text:"\u53d6\u6d88"}:{color:"primary",onClick:()=>o.nav.push(n.createElement(St,null)),icon:"plus",text:"\u65b0\u589e"},t=n.createElement("div",{className:"va-row py-1 justify-content-center"},(e=>n.createElement("button",{className:J()("btn","btn-outline-"+e.color,"btn-sm"),onClick:e.onClick},n.createElement("i",{className:"fa fa-"+e.icon})," ",e.text,"\u5173\u8054"))(e));return n.createElement(o.Page,{header:"\u5173\u8054UQ"},n.createElement(l.List,{ref:e=>this.list=e,header:t,items:L.dev.apps.uqs,item:{render:this.row,onSelect:this.onSelect}}))}};Ct([c.l],Nt.prototype,"anySelected",void 0),Nt=Ct([a.a],Nt);let St=class extends n.Component{constructor(){super(...arguments),this.onSearch=(e=>kt(this,void 0,void 0,function*(){yield L.dev.apps.searchUq(e)})),this.row=(e=>{let t,i,s=["btn","btn-sm"];return void 0!==L.dev.apps.uqs.find(t=>t.id===e.id)?(s.push("btn-success"),i=(()=>this.onBind(e,!1)),t="\u5df2\u5173\u8054"):(s.push("btn-primary"),i=(()=>this.onBind(e,!0)),t=n.createElement("span",null,n.createElement("i",{className:"fa fa-check"})," \u5173\u8054")),n.createElement("div",{className:"d-flex justify-content-start py-1 px-3"},n.createElement("div",{className:"align-self-center"},e.name+" - "+e.discription),n.createElement("footer",{className:"ml-auto"},n.createElement("button",{className:J()(s),onClick:i},t)))})}onBind(e,t){L.dev.apps.appBindUq([{id:e.id,access:["*"]}],t)}render(){let e=n.createElement(l.SearchBox,{className:"w-100 mx-1",onSearch:this.onSearch,placeholder:"\u641c\u7d22UQ\u540d\u5b57",maxLength:100});return n.createElement(o.Page,{back:"close",header:e},n.createElement(l.List,{items:L.dev.apps.searchedUqs,item:{render:this.row},loading:null}))}};St=Ct([a.a],St);var At=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Rt extends o.VPage{constructor(){super(...arguments),this.editItem=(()=>At(this,void 0,void 0,function*(){yield this.openVPage(bt)})),this.deleteItem=(()=>At(this,void 0,void 0,function*(){!0===confirm("\u771f\u7684\u8981\u5220\u9664\u5417\uff1f\u7cfb\u7edf\u5220\u9664\u65f6\u5e76\u4e0d\u4f1a\u68c0\u67e5\u76f8\u5173\u5f15\u7528\uff0c\u8bf7\u8c28\u614e")&&(yield this.controller.deleteApp(),o.nav.pop())})),this.page=Object(a.a)(()=>{let{app:e}=this.controller,{unit:t,name:i,caption:s,discription:r,icon:a,server:c,date_init:u,date_update:d}=e,h=n.createElement("div",null,n.createElement("div",null,r),n.createElement(Y,{date_update:d,date_init:u})),m=[{caption:"\u4fee\u6539App",action:this.editItem,icon:"edit"},{caption:"\u5220\u9664",action:this.deleteItem,icon:"trash-o"}],p=n.createElement(l.DropdownActions,{actions:m}),f=s?n.createElement(n.Fragment,null,i,": ",n.createElement("b",null,s)):n.createElement("b",null,i),v=["",{type:"component",component:n.createElement(l.Media,{icon:a,main:f,discription:h})},"",{type:"component",label:"\u5f00\u53d1\u53f7",component:n.createElement("div",{className:"py-2"},n.createElement(ee,{id:t,isLink:!0}))},{label:"URL",name:"url",type:"string"},{type:"component",label:"\u670d\u52a1\u5668",component:n.createElement(me,{id:c})},""],g=n.createElement("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>this.openVPage(Pt)},"\u589e\u52a0\u5173\u8054");return n.createElement(o.Page,{header:"App - "+i,right:p},n.createElement(l.PropGrid,{rows:v,values:e}),n.createElement(l.LMR,{className:"mx-3 mt-3 mb-1",right:g},"\u5173\u8054UQ"),n.createElement(l.List,{items:this.controller.uqAccesses,item:{render:this.renderUqRow,onClick:this.uqClick}}))}),this.uqClick=(e=>{this.controller.onUq(e.uq)}),this.renderUqRow=((e,t)=>{let i,s,{uq:r,bind_access:o}=e,{name:a,discription:c,unit:u}=r;return o&&o.length>0&&(s=n.createElement(n.Fragment,null," + ",o.join(", ")," ")),c&&(i=n.createElement("div",{className:"small text-muted"}," \xa0 ",c)),n.createElement(l.LMR,{className:"px-3 py-2 align-items-center",right:i},n.createElement(te,{id:u})," / ",a," ",s)})}open(){return At(this,void 0,void 0,function*(){this.openPage(this.page)})}}var Ot=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Ft extends o.VPage{constructor(){super(...arguments),this.onCheckChanged=(e=>{let{target:t}=e;this.accessChecked[t.name]=t.checked}),this.saveUqBind=(()=>Ot(this,void 0,void 0,function*(){let e=[];if(this.accesses)for(let t in this.accessChecked)!0===this.accessChecked[t]&&e.push(t);yield this.controller.saveUqBind(this.uqAccess.uq,e),o.nav.pop()})),this.removeUqBind=(()=>Ot(this,void 0,void 0,function*(){yield this.controller.removeUqBind(this.uqAccess.uq),o.nav.pop()})),this.page=(()=>{let e,t,{uq:i,bind_access:s}=this.uqAccess,{owner:r,name:a,discription:c,access:u}=i;return null!==s&&void 0!==s&&(e=n.createElement("button",{className:"btn btn-outline-danger btn-sm",onClick:this.removeUqBind},"\u53d6\u6d88\u5173\u8054")),this.accesses&&(t=n.createElement("div",{className:"mt-3"},this.accesses.map(e=>{let t=this.accessChecked[e];return n.createElement("label",{key:e,className:"d-inline-block mr-4"},n.createElement("input",{onChange:this.onCheckChanged,style:{width:"1.1rem",height:"1.1rem"},name:e,type:"checkbox",defaultChecked:t}),"\xa0",e)}))),n.createElement(o.Page,{header:"\u5173\u8054UQ"},n.createElement("div",{className:"m-3 py-3 px-3 bg-white border"},n.createElement("div",null,r," / ",a),n.createElement("div",{className:"text-muted"},c),t,n.createElement(l.LMR,{className:"pt-3",right:e},n.createElement("button",{className:"btn btn-primary btn-sm",onClick:this.saveUqBind},"\u4fdd\u5b58\u5173\u8054"))))})}open(e){return Ot(this,void 0,void 0,function*(){this.uqAccess=e;let{uq:t,bind_access:i}=this.uqAccess,{access:n}=t;if(n){this.accessChecked={},this.accesses=n.split(",");for(let e of this.accesses)this.accessChecked[e]=void 0!==(i&&i.find(t=>t===e))}this.openPage(this.page)})}}var It=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},qt=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Ut extends o.Controller{constructor(){super(...arguments),this.listRowClick=(e=>qt(this,void 0,void 0,function*(){this.app=e;let t=yield f.loadAppUqs(e.id);this.uqAccesses=t.map(e=>{let{owner:t,access:i,id:n,name:s,discription:r,unit:o,date_init:a,date_update:l,bind_access:c}=e;return{uq:{id:n,name:s,discription:r,unit:o,access:i,owner:t,date_init:a,date_update:l,service_count:void 0},uqOwner:t,bind_access:c&&c.split(",")}}),this.openVPage(Rt)})),this.saveApp=(e=>qt(this,void 0,void 0,function*(){let t,i=new Date;void 0===this.app?(t=d.a.clone(e)).date_init=i:(t=d.a.clone(this.app),d.a.merge(t,e)),t.unit=this.unitId,t.date_update=i;let n=yield f.saveApp(t);t.id=n;let s=this.appList.find(e=>e.id===n);void 0!==s?d.a.merge(s,t):this.appList.push(t)})),this.deleteApp=(()=>qt(this,void 0,void 0,function*(){yield f.delApp(this.unitId,this.app.id);let e=this.appList.findIndex(e=>e.id===this.app.id);e>=0&&this.appList.splice(e,1)})),this.searchUq=((e,t,i)=>qt(this,void 0,void 0,function*(){return yield f.searchUq(this.unitId,e,t,i)})),this.getMyUqs=(()=>qt(this,void 0,void 0,function*(){return yield f.getMyUqs(this.unitId)})),this.onUq=(e=>{let t=this.uqAccesses.find(t=>t.uq.id===e.id);if(void 0===t)t={uq:e,bind_access:void 0};else{let e=t.bind_access;null!==e&&void 0!==e||(t.bind_access=[])}this.openVPage(Ft,t)}),this.saveUqBind=((e,t)=>qt(this,void 0,void 0,function*(){let i=this.buildBindUqs(e,t);if(yield f.appBindUq(this.unitId,this.app.id,i),i.length>this.uqAccesses.length)this.uqAccesses.unshift({uq:e,bind_access:t});else{this.uqAccesses.find(t=>t.uq.id===e.id).bind_access=t}})),this.removeUqBind=(e=>qt(this,void 0,void 0,function*(){let t=this.buildBindUqs(e);yield f.appBindUq(this.unitId,this.app.id,t);let i=this.uqAccesses.findIndex(t=>t.uq.id===e.id);i>=0&&this.uqAccesses.splice(i,1)}))}internalStart(e){return qt(this,void 0,void 0,function*(){this.unitId=e,this.appList=yield f.apps(this.unitId),this.openVPage(xt)})}buildBindUqs(e,t){let i=[],n=!0;for(let s of this.uqAccesses){let{uq:r,bind_access:o}=s;if(r.id===e.id){if(void 0===t)continue;o=t,n=!1}i.push({id:r.id,access:o||[]})}return void 0!==t&&!0===n&&i.push({id:e.id,access:t}),i}}It([c.l],Ut.prototype,"appList",void 0),It([c.l],Ut.prototype,"uqAccesses",void 0);var Vt=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class jt extends n.Component{constructor(e){super(e),this.onFilesChange=(e=>{let t=[],{files:i}=e.target,n=i.length;for(let s=0;s<n;s++)t.push(i[s]);this.setState({files:t})}),this.fileClick=(e=>{let t=new FileReader;t.onload=function(t){o.nav.push(n.createElement(Tt,{name:e.name,content:this.result}))},t.readAsText(e,"utf8")}),this.onSubmit=(e=>{e.preventDefault()}),this.onUpdate=(()=>Vt(this,void 0,void 0,function*(){yield this.update(!1)})),this.onUpdateThoroughly=(()=>Vt(this,void 0,void 0,function*(){yield this.update(!0)})),this.state={files:void 0}}fileRender(e,t){let{name:i,size:s,lastModifiedDate:r}=e;return n.createElement(l.LMR,{className:"px-2 py-1",right:n.createElement(l.Muted,null,function(){let e,t;return s<1024?(e=s,t="b"):s<1048576?(e=Math.trunc(s/1024*100)/100,t="k"):(e=Math.trunc(s/1024/1024*100)/100,t="m"),e+" "+t}())},n.createElement("div",null,i),n.createElement("div",null,n.createElement(l.Muted,null,"\u4fee\u6539\u65e5\u671f: ",n.createElement(l.EasyDate,{date:r}))))}update(e){return Vt(this,void 0,void 0,function*(){var t=this.fileInput.files,i=new FormData;let s=t.length;for(let e=0;e<s;e++){let n=t[e];i.append("files[]",n,n.name)}let r=L.uqServer+"uq-compile/"+this.props.uq.id+"/update";!0===e&&(r+="-thoroughly");try{let e=new AbortController,t=yield fetch(r,{method:"POST",body:i,signal:e.signal});o.nav.push(n.createElement(Lt,Object.assign({},this.props,{res:t,abortController:e})))}catch(a){console.error("%s %s",r,a)}})}render(){let e,t,{files:i}=this.state;return void 0!==i&&(e=n.createElement(l.List,{className:"my-3",items:i,item:{render:this.fileRender,onClick:this.fileClick}})),void 0!==i&&i.length>0&&(t=n.createElement("div",{className:"my-2 d-flex"},n.createElement("button",{className:"btn btn-success",type:"submit",onClick:this.onUpdate},"\u4f18\u5316\u7f16\u8bd1"),n.createElement("div",{className:"py-2 flex-grow-1"}),n.createElement("button",{className:"btn btn-outline-warning",type:"submit",onClick:this.onUpdateThoroughly},"\u5b8c\u5168\u7f16\u8bd1"))),n.createElement(o.Page,{header:"\u7f16\u8bd1 - "+this.props.uq.name},n.createElement("div",{className:"py-2 px-3"},n.createElement("div",null,"\u8bf7\u9009\u62e9UQ\u6e90\u4ee3\u7801\u6587\u4ef6"),n.createElement("form",{className:"my-1",encType:"multipart/form-data",onSubmit:this.onSubmit},n.createElement("div",{className:"my-1"},n.createElement("input",{ref:e=>this.fileInput=e,type:"file",id:"photo",className:"w-100 form-control-file",name:"files",multiple:!0,onChange:this.onFilesChange})),e,t),n.createElement("pre",null,this.state.compiled),n.createElement("div",null,this.state.text)))}}class Tt extends n.Component{render(){return n.createElement(o.Page,{header:this.props.name},n.createElement("pre",{className:"px-3 py-2"},this.props.content))}}class Lt extends n.Component{constructor(e){super(e),this.doubleClick=(()=>{var e=document.getElementById("scrollDiv");let t=this.getParent(e);t&&(t.scrollTop>=t.scrollHeight/2?this.topIntoView():this.bottomIntoView())}),this.texts=[],this.state={texts:this.texts,seconds:-1}}componentWillMount(){o.nav.regConfirmClose(()=>Vt(this,void 0,void 0,function*(){return this.state.seconds>=0||new Promise((e,t)=>{try{if(!0===confirm("\u6b63\u5728\u7f16\u8bd1\u4e2d\uff0c\u771f\u7684\u8981\u4e2d\u6b62\u5417\uff1f")){try{this.props.abortController.abort()}catch(i){console.error(i)}e(!0)}else e(!1)}catch(i){t(i)}})}))}clearTimeHandler(){void 0!==this.timeHandler&&(clearTimeout(this.timeHandler),this.timeHandler=void 0)}getParent(e){if(e)return"MAIN"===e.tagName?e:this.getParent(e.parentElement)}scrollToBottom(e=100){this.clearTimeHandler();let t=this;this.timeHandler=setTimeout(()=>{var e=document.getElementById("bottomDiv");e&&e.scrollIntoView(),t.clearTimeHandler()},e)}topIntoView(){var e=document.getElementById("topDiv");e&&e.scrollIntoView()}bottomIntoView(){var e=document.getElementById("bottomDiv");e&&e.scrollIntoView()}componentDidMount(){return Vt(this,void 0,void 0,function*(){let e=this,t=new Date;try{yield(i=this.props.res.body.getReader(),new Promise((n,s)=>{!function r(){i.read().then(({done:i,value:s})=>{if(i)return e.scrollToBottom(),e.setState({seconds:(new Date).getTime()-t.getTime()}),void n();let o=function(e){var t=String.fromCharCode.apply(null,e);return decodeURIComponent(escape(t))}(s);e.texts.push(o),e.setState({texts:e.texts}),s.byteLength,e.scrollToBottom(),r()}).catch(s)}()}))}catch(n){console.error(n)}var i})}render(){let{seconds:e,texts:t}=this.state;return n.createElement(o.Page,{header:e>=0?"\u7f16\u8bd1\u5b8c\u6210":"\u7f16\u8bd1\u4e2d...",back:"close"},n.createElement("div",{id:"topDiv"}),n.createElement("div",{id:"scrollDiv",onDoubleClick:this.doubleClick,className:"py-2 px-3",style:{wordWrap:"break-word",whiteSpace:"normal"}},t.map((e,t)=>n.createElement("pre",{style:{whiteSpace:"pre-wrap"},key:t},e))),e>=0?n.createElement("div",{className:"px-3 pb-3",style:{color:"red",fontWeight:"bold"}},"\u7f16\u8bd1\u5b8c\u6210\u3002\u5171\u8ba1\u7528\u65f6",Math.floor(e/1e3),"\u79d2"):void 0,n.createElement("div",{id:"bottomDiv"}))}}var Mt=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};function Dt(e){return function(t,i){return new Promise((s,r)=>{o.nav.push(n.createElement(_t,Object.assign({resolve:s,face:t,params:i},e)))})}}class _t extends n.Component{constructor(e){super(e),this.state={items:null},this.itemClick=this.itemClick.bind(this),this.onSearch=this.onSearch.bind(this)}componentDidMount(){return Mt(this,void 0,void 0,function*(){let{face:e,candidateItems:t,params:i}=this.props;this.setState({items:Array.isArray(t)?t:yield t(i,"")})})}itemClick(e){let{resolve:t}=this.props;t(e),o.nav.pop()}onSearch(e){return Mt(this,void 0,void 0,function*(){let{candidateItems:t,params:i}=this.props;if("function"===typeof t){let n=yield t(i,e);this.setState({items:n})}})}render(){let{caption:e,row:t,searchPlaceHolder:i}=this.props;return n.createElement(o.Page,{header:e,back:"close"},n.createElement("div",{className:"container"},n.createElement(l.SearchBox,{className:"my-2",onSearch:this.onSearch,placeholder:i,maxLength:100})),n.createElement(l.List,{items:this.state.items,item:{onClick:this.itemClick,render:t}}))}}var Bt=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const Ht=e=>{let{discription:t,cloud:i,ip:s}=e;return n.createElement(n.Fragment,null,t," ",i," ",s)},$t={label:"URL",field:{name:"url",type:"string",required:!0,maxLength:200}},zt={label:"\u670d\u52a1\u5668",field:{name:"server",type:"id"},face:{type:"pick-id",initCaption:"\u8bf7\u9009\u62e9\u670d\u52a1\u5668",pick:Dt({caption:"\u9009\u62e9\u670d\u52a1\u5668",searchPlaceHolder:"\u641c\u7d22\u670d\u52a1\u5668",candidateItems:(e,t)=>Bt(void 0,void 0,void 0,function*(){return yield L.dev.searchServer.first(t),L.dev.searchServer.items}),moreCandidates:()=>Bt(void 0,void 0,void 0,function*(){yield L.dev.searchServer.more()}),row:(e,t)=>n.createElement("div",{className:"px-3 py-2"},n.createElement(Ht,Object.assign({},e)))}),fromPicked:e=>({id:e.id,caption:n.createElement(Ht,Object.assign({},e))}),itemFromId:e=>L.cacheServers.get(e)}},Wt={label:"\u6570\u636e\u5e93\u7c7b\u578b",field:{name:"db_type",type:"string",maxLength:20,defaultValue:"mysql"},face:{type:"string",readonly:!0}},Qt={label:"\u6570\u636e\u5e93\u540d\u5b57",field:{name:"db",type:"string",maxLength:50,required:!0}},Kt={label:"\u8fde\u63a5\u5b57\u7b26\u4e32",field:{name:"connection",type:"string",maxLength:250},face:{type:"textarea",maxLength:250,rows:8}};class Gt extends o.VPage{constructor(){super(...arguments),this.formRows=[$t,zt,Wt,Qt,Kt],this.onSubmit=(e=>Bt(this,void 0,void 0,function*(){if(e.url.indexOf("/uq/")<0)return void this.tonvaForm.formView.setError("url","service url \u5fc5\u987b\u5305\u542b/uq/");e.type=2,e.bindId=this.controller.uq.id,0!==(yield this.controller.saveService(e))?o.nav.pop():void 0!==this.tonvaForm&&this.tonvaForm.formView.setError("url","\u5df2\u7ecf\u6709Service\u4f7f\u7528\u8fd9\u4e2aurl")})),this.page=(()=>n.createElement(o.Page,{header:"\u65b0\u5efaService"},n.createElement(l.TonvaForm,{ref:e=>this.tonvaForm=e,className:"m-3",formRows:this.formRows,onSubmit:this.onSubmit})))}open(){return Bt(this,void 0,void 0,function*(){this.openPage(this.page)})}}var Jt=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Yt extends o.VPage{constructor(){super(...arguments),this.onUrlChanged=((e,t)=>Jt(this,void 0,void 0,function*(){if(e.indexOf("/uq/")<0)return"URL\u5fc5\u987b\u5305\u542b/uq/";if(0===(yield this.changeProp("url",e)))return"URL\u5df2\u7ecf\u88ab\u4f7f\u7528\u4e86";this.service.url=e})),this.onDbChanged=((e,t)=>Jt(this,void 0,void 0,function*(){if(0===(yield this.changeProp("db",e)))return"Db\u5df2\u7ecf\u88ab\u4f7f\u7528\u4e86";this.service.db=e})),this.onDbTypeChanged=((e,t)=>Jt(this,void 0,void 0,function*(){if(void 0===e||null===e)return;if("mysql"!==e.toLowerCase().trim())return"\u76ee\u524d\u53ea\u652f\u6301mysql";yield this.changeProp("db_type",e);this.service.db_type=e})),this.onConnectionChanged=((e,t)=>Jt(this,void 0,void 0,function*(){yield this.changeProp("connection",e),this.service.connection=e})),this.onDeleteClick=(()=>Jt(this,void 0,void 0,function*(){!0===confirm("\u771f\u7684\u8981\u5220\u9664Service\u5417\uff1f\u5220\u9664\u4e86\u4e0d\u53ef\u6062\u590d\uff0c\u9700\u8981\u91cd\u65b0\u5f55\u5165\u3002")&&(yield this.controller.delService(this.service),o.nav.pop())})),this.page=(()=>{let{uq:e}=this.controller,t=["",{type:"string",name:"url",label:"URL",onClick:()=>o.nav.push(n.createElement(ve,{title:"\u4fee\u6539URL",value:this.service.url,onChanged:this.onUrlChanged}))},{type:"component",label:"\u670d\u52a1\u5668",component:n.createElement(me,{id:this.service.server})},{type:"string",name:"db_type",label:"\u6570\u636e\u5e93\u7c7b\u578b",onClick:()=>o.nav.push(n.createElement(ve,{title:"\u6570\u636e\u5e93\u7c7b\u578b",value:this.service.db_type,onChanged:this.onDbTypeChanged}))},{type:"string",name:"db",label:"\u6570\u636e\u5e93\u540d",onClick:()=>o.nav.push(n.createElement(ve,{title:"\u6570\u636e\u5e93\u540d\u5b57",value:this.service.db,onChanged:this.onDbChanged}))},{type:"string",name:"connection",label:"\u8fde\u63a5\u5b57\u7b26\u4e32",onClick:()=>o.nav.push(n.createElement(ge,{title:"\u8fde\u63a5\u5b57\u7b26\u4e32",value:this.service.connection,onChanged:this.onConnectionChanged}))}],i=n.createElement("button",{onClick:this.onDeleteClick,className:"btn btn-success"},"\u5220\u9664");return n.createElement(o.Page,{header:"UQ - "+e.name,right:i},n.createElement(l.PropGrid,{rows:t,values:this.service}))})}open(e){return Jt(this,void 0,void 0,function*(){this.service=e,this.openPage(this.page)})}changeProp(e,t){return Jt(this,void 0,void 0,function*(){return yield this.controller.changeServiceProp(this.service,e,t)})}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([c.l],Yt.prototype,"service",void 0);var Xt=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const Zt=[{label:"\u540d\u79f0",field:{name:"name",type:"string",maxLength:100,required:!0}},{label:"\u63cf\u8ff0",field:{name:"discription",type:"string",maxLength:250},face:{type:"textarea"}}];class ei extends o.VPage{constructor(){super(...arguments),this.onSubmit=(e=>Xt(this,void 0,void 0,function*(){yield this.controller.saveUq(e),o.nav.pop()}))}open(){return Xt(this,void 0,void 0,function*(){this.openPage(this.page)})}form(e){return n.createElement(l.TonvaForm,{className:"m-3",formRows:Zt,onSubmit:this.onSubmit,initValues:e})}}class ti extends ei{constructor(){super(...arguments),this.page=(()=>{let{uq:e}=this.controller,{name:t}=e;return n.createElement(o.Page,{header:"\u4fee\u6539UQ - "+t,back:"close"},this.form(e))})}}class ii extends ei{constructor(){super(...arguments),this.page=(()=>n.createElement(o.Page,{header:"\u65b0\u5efaUQ",back:"close"},this.form({})))}}var ni=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class si extends o.VPage{constructor(){super(...arguments),this.editItem=(()=>ni(this,void 0,void 0,function*(){yield this.openVPage(ti)})),this.deleteItem=(()=>ni(this,void 0,void 0,function*(){!0===confirm("\u771f\u7684\u8981\u5220\u9664UQ\u5417\uff1f")&&(yield this.controller.deleteUq(),o.nav.pop())})),this.page=(()=>{let e,{onUqUpload:t,serviceClick:i,uq:s,services:r}=this.controller,{isOwner:a}=L.unit,{id:c,name:u,discription:d,access:h,unit:m,date_init:p,date_update:f}=s,v=n.createElement("div",null,n.createElement("div",null,d),n.createElement(Y,{date_update:f,date_init:p})),g=[{caption:"\u4fee\u6539UQ",action:this.editItem,icon:"edit"},{caption:"\u5220\u9664",action:this.deleteItem,icon:"trash-o"}],y=a>0&&n.createElement(l.DropdownActions,{actions:g}),b=["",{type:"component",component:n.createElement(l.LMR,{className:"py-2",left:n.createElement(l.FA,{name:"database",className:"text-primary fa-2x mr-3"})},n.createElement("div",null,n.createElement("b",null,u)),v)},{type:"component",label:"\u5f00\u53d1\u53f7",component:n.createElement("div",{className:"py-2"},n.createElement(ee,{id:m,isLink:!0}))},"",{type:"component",label:"\u7f16\u8bd1\u4ee3\u7801",component:n.createElement(l.LMR,{onClick:()=>t(),className:"w-100 py-2 cursor-pointer",left:"\u4e0a\u4f20\u7f16\u8bd1uq\u4ee3\u7801",right:n.createElement(l.FA,{className:"align-self-center",name:"chevron-right"})})}],w=a>0&&n.createElement("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>this.controller.showNewServicePage()},"\u589e\u52a0");return a>0&&(e=i),n.createElement(o.Page,{header:"UQ - "+u,right:y},n.createElement(l.PropGrid,{rows:b,values:s}),n.createElement("div",{className:"d-flex mx-3 mt-3 mb-1 align-items-end"},n.createElement(l.Muted,{style:{display:"block",flex:1}},"Service"),w),n.createElement(l.List,{items:r,item:{render:this.renderService,onClick:e}}))})}open(){return ni(this,void 0,void 0,function*(){this.openPage(this.page)})}renderService(e,t){let{url:i,server:s,db:r,db_type:o,compile_time:a}=e,c=a?n.createElement(n.Fragment,null,n.createElement(l.Muted,null,"\u7f16\u8bd1: "),n.createElement(l.EasyDate,{date:a})):n.createElement(l.Muted,null,"\u672a\u7f16\u8bd1");return n.createElement(l.LMR,{className:"d-flex w-100 align-items-center cursor-pointer py-2 px-3",right:n.createElement("small",null,c)},n.createElement("div",null,n.createElement("div",null,i),n.createElement("div",null,o," ",r),n.createElement(l.Muted,null,n.createElement(me,{id:s}))))}}var ri=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class oi extends o.VPage{constructor(){super(...arguments),this.newItem=(()=>{this.controller.uq=void 0,this.openVPage(ii)}),this.page=(()=>{let{uqList:e,listRowClick:t}=this.controller,{isOwner:i}=L.unit,s=i>0&&n.createElement("button",{className:"btn btn-secondary btn-sm",onClick:()=>this.newItem()},n.createElement(l.FA,{name:"plus"}));return n.createElement(o.Page,{header:"UQ",right:s},n.createElement(l.List,{items:e,item:{render:this.listRow,onClick:t}}))}),this.listRow=(e=>{let{name:t,discription:i,service_count:s}=e;return n.createElement(l.LMR,{className:"py-1 px-3 align-items-center",left:n.createElement(l.FA,{name:"database",className:"text-primary fa-lg"}),right:n.createElement(n.Fragment,null,s)},n.createElement("div",{className:"py-2 px-3"},n.createElement("div",null,n.createElement("b",null,t)),n.createElement("div",null,n.createElement(l.Muted,null,i))))})}open(e){return ri(this,void 0,void 0,function*(){this.openPage(this.page)})}}var ai=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},li=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class ci extends o.Controller{constructor(){super(...arguments),this.listRowClick=(e=>li(this,void 0,void 0,function*(){this.uq=e,yield this.loadUqEntities(e.id),this.openVPage(si)})),this.serviceClick=(e=>{this.openVPage(Yt,e)}),this.onUqUpload=(()=>li(this,void 0,void 0,function*(){o.nav.push(n.createElement(jt,{uq:this.uq,services:this.services}),()=>{})})),this.saveUq=(e=>li(this,void 0,void 0,function*(){let t;void 0===this.uq?t=d.a.clone(e):(t=d.a.clone(this.uq),d.a.merge(t,e)),t.unit=this.unitId;let i=yield f.saveUq(t);t.id=i,this.uqList.push(t)})),this.deleteUq=(()=>li(this,void 0,void 0,function*(){yield f.delUq(this.unitId,this.uq.id);let e=this.uqList.findIndex(e=>e.id===this.uq.id);e>=0&&this.uqList.splice(e)})),this.showNewServicePage=(()=>li(this,void 0,void 0,function*(){yield this.openVPage(Gt)}))}internalStart(e){return li(this,void 0,void 0,function*(){this.unitId=e,this.uqList=yield f.uqs(this.unitId),this.openVPage(oi)})}loadUqEntities(e){return li(this,void 0,void 0,function*(){let t=yield f.uqGetEntities(this.unitId,e),i=t[0][0];this.access=i.access,this.entities=i.entities,this.services=t[1]})}changeServiceProp(e,t,i){return li(this,void 0,void 0,function*(){return yield f.changeServiceProp(this.unitId,e.id,t,i)})}saveService(e){return li(this,void 0,void 0,function*(){let t=d.a.clone(e);t.unit=this.unitId;let i=yield f.saveService(t);return t.id=i,this.services.push(t),i})}delService(e){return li(this,void 0,void 0,function*(){yield f.delService(this.unitId,e.id);let t=this.services.findIndex(t=>t.id==e.id);t>=0&&this.services.splice(t)})}}ai([c.l],ci.prototype,"uqList",void 0),ai([c.l],ci.prototype,"services",void 0);class ui extends n.Component{render(){let{icon:e,main:t,vice:i}=this.props;return n.createElement(l.LMR,{className:"py-1 px-3 align-items-stretch",left:n.createElement(l.Badge,{size:"sm",className:"pt-1"},n.createElement("img",{src:e}))},n.createElement("div",{className:"px-3"},n.createElement("div",null,n.createElement("b",null,t)),n.createElement("div",null,n.createElement(l.Muted,null,i))))}}var di=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},hi=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let mi=class extends n.Component{componentDidMount(){return hi(this,void 0,void 0,function*(){})}render(){let{unit:e,name:t,discription:i,schema:s,date_init:r,date_update:o}=this.props,a=n.createElement("div",null,n.createElement("div",null,i),n.createElement(Y,{date_update:o,date_init:r})),c=["",{type:"component",component:n.createElement(l.Media,{icon:ne,main:t,discription:a})},"",{type:"component",label:"\u6240\u6709\u8005",component:n.createElement("div",{className:"py-2"},n.createElement(ee,{id:e,isLink:!0}))},"",{type:"component",label:"Schema",vAlign:"stretch",component:n.createElement(pi,null)}];return n.createElement("div",null,n.createElement(l.PropGrid,{rows:c,values:this.props}))}};mi=di([a.a],mi);let pi=class extends n.Component{render(){let e=L.dev.buses.cur;if(null===e)return"...";let t=e.schema;return n.createElement("div",{className:"d-flex py-2 w-100 align-items-center",style:{flex:1}},n.createElement("pre",null,t))}};pi=di([a.a],pi);var fi={title:"BUS",formRows:[{label:"\u540d\u79f0",field:{name:"name",type:"string",maxLength:100,required:!0}},{label:"\u63cf\u8ff0",field:{name:"discription",type:"string",maxLength:250},face:{type:"textarea"}},{label:"Schema",field:{name:"schema",type:"string",maxLength:2500},face:{type:"textarea",rows:8}}],row:e=>{let{owner:t,name:i,discription:s}=e;return n.createElement(ui,{icon:se,main:t+" / "+i,vice:s})},items:()=>L.dev.buses,repeated:{name:"name",err:"\u8ddf\u5df2\u6709\u7684\u540d\u79f0\u91cd\u590d"},info:mi};var vi={title:"Server",info:class extends n.Component{render(){let{discription:e,cloud:t,ip:i,unit:s,date_init:r,date_update:o}=this.props,a=n.createElement("div",null,n.createElement("div",null,e),n.createElement(Y,{date_update:o,date_init:r})),c=["",{type:"component",component:n.createElement(l.LMR,{className:"py-2",left:n.createElement(l.FA,{name:"server",className:"text-primary fa-2x mr-3"})},n.createElement("div",null,n.createElement("b",null,i)),a)},"",{type:"component",label:"\u5f00\u53d1\u53f7",component:n.createElement("div",{className:"py-2"},n.createElement(ee,{id:s,isLink:!0}))},{type:"string",label:"\u4e91\u670d\u52a1",name:"cloud"}];return n.createElement("div",null,n.createElement(l.PropGrid,{rows:c,values:this.props}))}},formRows:[{label:"\u63cf\u8ff0",field:{name:"discription",type:"string",maxLength:50,required:!0}},{label:"\u4e91\u670d\u52a1\u5546",field:{name:"cloud",type:"string",maxLength:20,required:!0}},{label:"IP\u5730\u5740",field:{name:"ip",type:"string",maxLength:20}}],row:e=>{let{discription:t,cloud:i}=e;return n.createElement(l.LMR,{className:"py-2 px-3 align-items-center",left:n.createElement(l.FA,{name:"server",className:"text-primary fa-lg"})},n.createElement("div",{className:"px-3"},n.createElement("div",null,n.createElement("b",null,t)),n.createElement("div",null,n.createElement(l.Muted,null,i))))},items:()=>L.dev.servers,repeated:{name:"discription",err:"\u91cd\u590d\u7684\u63cf\u8ff0"}},gi=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};const yi={caption:"\u9009\u62e9APP",searchPlaceHolder:"\u641c\u7d22APP",candidateItems:(e,t)=>gi(void 0,void 0,void 0,function*(){return yield L.dev.searchApp.first(t),L.dev.searchApp.items}),moreCandidates:()=>gi(void 0,void 0,void 0,function*(){yield L.dev.searchApp.more()}),row:(e,t)=>n.createElement("div",null,e.name+" "+e.discription)},bi={caption:"\u9009\u62e9UQ",searchPlaceHolder:"\u641c\u7d22UQ",candidateItems:(e,t)=>gi(void 0,void 0,void 0,function*(){return yield L.dev.searchUq.first(t),L.dev.searchUq.items}),moreCandidates:()=>gi(void 0,void 0,void 0,function*(){yield L.dev.searchUq.more()}),row:(e,t)=>n.createElement("div",null,e.name+" "+e.discription)},wi=["\u4e2d\u5fc3","\u4ea4\u6362","APP","UQ"],Ei={name:"bindId",type:"number"},xi={label:"URL",field:{name:"url",type:"string",required:!0,maxLength:200}},Ci={label:"\u63cf\u8ff0",field:{name:"discription",type:"string",maxLength:100}},ki={label:"\u670d\u52a1\u5668",field:{name:"server",type:"id"},face:{type:"pick-id",initCaption:"\u8bf7\u9009\u62e9\u670d\u52a1\u5668",pick:Dt({caption:"\u9009\u62e9\u670d\u52a1\u5668",searchPlaceHolder:"\u641c\u7d22\u670d\u52a1\u5668",candidateItems:(e,t)=>gi(void 0,void 0,void 0,function*(){return yield L.dev.searchServer.first(t),L.dev.searchServer.items}),moreCandidates:()=>gi(void 0,void 0,void 0,function*(){yield L.dev.searchServer.more()}),row:(e,t)=>n.createElement("div",{className:"px-3 py-2"},e.discription+" "+e.cloud+" "+e.ip)}),fromPicked:e=>({id:e.id,caption:e.discription+" "+e.ip}),itemFromId:e=>L.cacheServers.get(e)}};Dt(yi),Dt(bi);var Pi=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},Ni=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};let Si=class extends n.Component{constructor(){super(...arguments),this.itemClick=(e=>{this.props.items().cur=Object(c.l)(e),o.nav.push(n.createElement(Ri,Object.assign({},this.props)))})}componentDidMount(){return Ni(this,void 0,void 0,function*(){yield this.props.items().load()})}newItem(){this.props.items().cur=void 0,o.nav.push(n.createElement(Ai,Object.assign({},this.props)))}render(){let{title:e,items:t}=this.props,{isOwner:i}=L.unit,s=i>0&&n.createElement("button",{className:"btn btn-secondary btn-sm",onClick:()=>this.newItem()},n.createElement(l.FA,{name:"plus"}));return n.createElement(o.Page,{header:e,right:s},n.createElement(l.List,{items:t().items,item:{render:this.props.row,onClick:this.itemClick}}))}};Si=Pi([a.a],Si);class Ai extends n.Component{constructor(e){super(e),this.onSubmit=this.onSubmit.bind(this)}onSubmit(e){return Ni(this,void 0,void 0,function*(){if(!0===(yield this.props.items().saveCur(e)))o.nav.pop();else{this.props.repeated}})}render(){let e,{title:t,steps:i,stepHeader:s}=this.props,{formRows:r,items:a}=this.props;return e=void 0!==i?n.createElement(l.MultiStep,{className:"mt-4",header:s,steps:i,first:"step1",onSubmit:this.onSubmit}):void 0!==r?n.createElement(l.TonvaForm,{className:"m-3",formRows:r,onSubmit:this.onSubmit,initValues:a().cur}):"ObjViewProps: no steps and no formRows",n.createElement(o.Page,{header:"\u65b0\u589e"+t},e)}}let Ri=class extends n.Component{constructor(){super(...arguments),this.menuItems=[{caption:"\u4fee\u6539"+this.props.title,action:this.editItem.bind(this),icon:"edit"},{caption:"\u5220\u9664",action:this.deleteItem.bind(this),icon:"trash-o"}]}deleteItem(){return Ni(this,void 0,void 0,function*(){!0===confirm("\u771f\u7684\u8981\u5220\u9664\u5417\uff1f\u7cfb\u7edf\u5220\u9664\u65f6\u5e76\u4e0d\u4f1a\u68c0\u67e5\u76f8\u5173\u5f15\u7528\uff0c\u8bf7\u8c28\u614e")&&(yield this.props.items().del(),o.nav.pop())})}editItem(){o.nav.push(n.createElement(Oi,Object.assign({},this.props)))}render(){let e=[],t=this.props.extraMenuActions;void 0!==t&&e.push(...t),e.push(...this.menuItems);let i=n.createElement(l.DropdownActions,{actions:e}),s=this.props.items().cur;return n.createElement(o.Page,{header:this.props.title+" - \u8be6\u7ec6\u8d44\u6599",right:i},n.createElement(this.props.info,Object.assign({},s)))}};Ri=Pi([a.a],Ri);class Oi extends n.Component{constructor(e){super(e),this.actions=[{caption:"\u5220\u9664",action:this.deleteItem.bind(this),icon:"trash-o"}],this.onSubmit=this.onSubmit.bind(this)}componentWillMount(){}onSubmit(e){return Ni(this,void 0,void 0,function*(){yield this.props.items().saveCur(e),o.nav.pop()})}deleteItem(){return Ni(this,void 0,void 0,function*(){!0===confirm("\u771f\u7684\u8981\u5220\u9664\u5417\uff1f\u7cfb\u7edf\u5220\u9664\u65f6\u5e76\u4e0d\u4f1a\u68c0\u67e5\u76f8\u5173\u5f15\u7528\uff0c\u8bf7\u8c28\u614e")&&(yield this.props.items().del(),o.nav.pop())})}render(){let e=n.createElement(l.DropdownActions,{actions:this.actions});return n.createElement(o.Page,{header:"\u4fee\u6539 "+this.props.title,right:e,back:"close"},n.createElement(l.TonvaForm,{className:"m-3",formRows:this.props.formRows,onSubmit:this.onSubmit,initValues:this.props.items().cur}))}}i(78);var Fi=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Ii extends o.VPage{constructor(){super(...arguments),this.renderRow=((e,t)=>{let{app:i,users:s}=e,{id:r,name:o,discription:a}=i,c=n.createElement("small",{className:"text-muted"},a);return n.createElement("div",{className:"d-block px-3 py-2"},n.createElement(l.LMR,{className:"mb-2",right:c},n.createElement(l.FA,{name:"address-card-o",className:"text-primary mr-3"}),n.createElement("b",null,o)),n.createElement("div",null,n.createElement("small",{className:"text-muted"},"\u7528\u6237: "),0===s.length?"[\u65e0]":s.map(e=>e.assigned||e.nick||e.name).join(", ")))}),this.page=Object(a.a)(()=>{let{appUsersList:e,searchApp:t,onAppsClick:i}=this.controller,s=n.createElement(l.SearchBox,{className:"w-100 pr-1",onSearch:t,placeholder:"\u641c\u7d22App",allowEmptySearch:!0});return n.createElement(o.Page,{header:s},n.createElement(l.List,{items:e,item:{render:this.renderRow,onClick:i,key:e=>e.app.id}}))})}open(){return Fi(this,void 0,void 0,function*(){this.openPage(this.page)})}}var qi=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Ui extends o.VPage{constructor(){super(...arguments),this.renderRow=((e,t)=>{let{user:i,apps:s}=e,{id:r,name:o,nick:a,icon:c,assigned:u}=i;return n.createElement("div",{className:"d-block px-3 py-2"},n.createElement("div",{className:"mb-2"},n.createElement(l.FA,{name:"user-o",className:"text-primary mr-3"}),n.createElement("b",null,u||a||o)),n.createElement("div",null,n.createElement("small",{className:"text-muted"},"App: "),0===s.length?"[\u65e0]":s.map(e=>e.name).join(", ")))}),this.page=Object(a.a)(()=>{let{userAppsList:e,searchUser:t,onUsersClick:i}=this.controller,s=n.createElement(l.SearchBox,{className:"w-100 pr-1",onSearch:t,placeholder:"\u641c\u7d22\u7528\u6237",allowEmptySearch:!0});return n.createElement(o.Page,{header:s},n.createElement(l.List,{items:e,item:{render:this.renderRow,onClick:i,key:e=>e.user.id}}))})}open(){return qi(this,void 0,void 0,function*(){this.openPage(this.page)})}}var Vi=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class ji extends o.VPage{constructor(){super(...arguments),this.page=Object(a.a)(()=>{let{curApp:e,curAppUsers:t,onAppEditUsers:i}=this.controller,s=n.createElement("button",{className:"btn btn-sm btn-success",onClick:()=>i()},"\u589e\u51cf\u7528\u6237");return n.createElement(o.Page,{header:"App - "+e.name,right:s},n.createElement(l.List,{items:t,item:{render:this.renderApp}}))}),this.renderApp=((e,t)=>{let i,{name:s,nick:r,assigned:o}=e;return i=o?n.createElement("span",null,o," \xa0 ",n.createElement("small",{className:"text-muted"},s)):r?n.createElement("span",null,r," \xa0 ",n.createElement("small",{className:"text-muted"},s)):n.createElement(n.Fragment,null,s),n.createElement("div",{className:"px-3 py-2"},i)})}open(){return Vi(this,void 0,void 0,function*(){this.openPage(this.page)})}}var Ti=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Li extends o.VPage{constructor(){super(...arguments),this.page=Object(a.a)(()=>{let{curUser:e,curUserApps:t,onUserEditApps:i}=this.controller,s=n.createElement("button",{className:"btn btn-sm btn-success",onClick:()=>i()},"\u589e\u51cfApp");return n.createElement(o.Page,{header:"\u7528\u6237 - "+(e.assigned||e.nick||e.name),right:s},n.createElement(l.List,{items:t,item:{render:this.renderApp}}))}),this.renderApp=((e,t)=>{let{name:i,discription:s}=e;return n.createElement("div",{className:"px-3 py-2"},i," ",s)})}open(){return Ti(this,void 0,void 0,function*(){this.openPage(this.page)})}}var Mi=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Di extends o.VPage{constructor(){super(...arguments),this.page=Object(a.a)(()=>{let{curApp:e,appEditUsers:t,onAppEditUsers:i}=this.controller;return n.createElement(o.Page,{header:e.name+" - \u589e\u51cf\u7528\u6237"},n.createElement(l.List,{items:t,item:{render:this.renderUser}}))}),this.renderUser=((e,t)=>{let i,{name:s,nick:r,assigned:o,bind:a}=e;i=o?n.createElement(n.Fragment,null,o," ",n.createElement(l.Muted,null,s)):r?n.createElement(n.Fragment,null,r," ",n.createElement(l.Muted,null,s)):n.createElement(n.Fragment,null,s);let c=n.createElement("input",{type:"checkbox",defaultChecked:1===a,onChange:t=>this.onUserChanged(e,t.target.checked)});return n.createElement(l.LMR,{className:"px-3 py-2 align-items-center",right:c},i)}),this.onUserChanged=((e,t)=>Mi(this,void 0,void 0,function*(){yield this.controller.bindAppUser(e,t),e.bind=!0===t?1:0}))}open(){return Mi(this,void 0,void 0,function*(){this.openPage(this.page)})}}var _i=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Bi extends o.VPage{constructor(){super(...arguments),this.page=Object(a.a)(()=>{let{curUser:e,userEditApps:t,onUserEditApps:i}=this.controller;return n.createElement(o.Page,{header:"\u589e\u51cfApp - "+(e.assigned||e.nick||e.name)},n.createElement(l.List,{items:t,item:{render:this.renderApp}}))}),this.renderApp=((e,t)=>{let{name:i,discription:s,bind:r}=e,o=n.createElement("input",{type:"checkbox",defaultChecked:1===r,onChange:t=>this.onAppChanged(e,t.target.checked)});return n.createElement(l.LMR,{className:"px-3 py-2",right:o},i," ",s)}),this.onAppChanged=((e,t)=>_i(this,void 0,void 0,function*(){yield this.controller.bindUserApp(e,t),e.bind=!0===t?1:0}))}open(){return _i(this,void 0,void 0,function*(){this.openPage(this.page)})}}var Hi=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class $i extends o.VPage{constructor(){super(...arguments),this.user=null,this.page=Object(a.a)(()=>{let e,t=n.createElement(l.SearchBox,{ref:e=>this.searchBox=e,className:"w-100",onSearch:this.onSearch,onFocus:this.onSearchFocus,placeholder:"\u7528\u6237\u5168\u540d/\u624b\u673a\u53f7/\u90ae\u7bb1"});if(null===this.user);else if(void 0===this.user)e=n.createElement("div",{className:"text-info p-3"},"\u6ca1\u6709\u627e\u5230\u7528\u6237");else{let t,{name:i,nick:s,icon:r}=this.user;t=s?n.createElement(n.Fragment,null,n.createElement("div",null,n.createElement("b",null,s)),n.createElement("div",null,i)):n.createElement("div",null,n.createElement("b",null,i)),e=n.createElement("div",null,n.createElement("div",{className:"m-3 p-3 d-flex bg-white"},n.createElement(o.Image,{src:r}),n.createElement("div",{className:"ml-3"},t)),n.createElement("div",{className:"d-flex justify-content-center"},n.createElement("button",{className:"btn btn-success text-center",onClick:this.onAddUser},"\u589e\u52a0\u7528\u6237")))}return n.createElement(o.Page,{header:t},e)}),this.onSearch=(e=>Hi(this,void 0,void 0,function*(){this.user=yield m.userFromKey(e)})),this.onAddUser=(()=>Hi(this,void 0,void 0,function*(){yield this.controller.addUser(this.user.id),this.controller.curUser=this.user,this.user=null,this.searchBox.clear(),this.replacePage(this.addedPage)})),this.onSearchFocus=(()=>{this.user=null,this.searchBox&&this.searchBox.clear()}),this.onAddApps=(()=>{this.closePage(),this.controller.onUserEditApps()}),this.onContinueAddUser=(()=>{this.closePage(),this.controller.onAddUser()}),this.addedPage=(()=>n.createElement(o.Page,{header:"\u6dfb\u52a0\u6210\u529f"},n.createElement("div",{className:"p-3 text-center"},n.createElement("div",null,"\u65b0\u589e\u7528\u6237: ",this.controller.curUser.name),n.createElement("div",{className:"mt-3"},n.createElement("button",{className:"btn btn-success mr-3",onClick:this.onAddApps},"\u4e3a\u7528\u6237\u6dfb\u52a0App"),n.createElement("button",{className:"btn btn-outline-primary",onClick:this.onContinueAddUser},"\u7ee7\u7eed\u6dfb\u52a0\u65b0\u7528\u6237")))))}open(){return Hi(this,void 0,void 0,function*(){this.openPage(this.page)})}}(function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);r>3&&o&&Object.defineProperty(t,i,o)})([c.l],$i.prototype,"user",void 0);var zi=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},Wi=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Qi extends o.Controller{constructor(){super(...arguments),this.onAppUsers=(()=>Wi(this,void 0,void 0,function*(){yield this.loadAppUsers(void 0),this.openVPage(Ii)})),this.onUserApps=(()=>Wi(this,void 0,void 0,function*(){yield this.loadUserApps(void 0),this.openVPage(Ui)})),this.searchUser=(e=>Wi(this,void 0,void 0,function*(){yield this.loadUserApps(e)})),this.searchApp=(e=>Wi(this,void 0,void 0,function*(){yield this.loadAppUsers(e)})),this.onAppsClick=(e=>Wi(this,void 0,void 0,function*(){this.curApp=e.app;this.curAppUsers=yield m.unitOneAppUsers(this.unit.id,this.curApp.id,0,100),this.openVPage(ji)})),this.onUsersClick=(e=>Wi(this,void 0,void 0,function*(){this.curUser=e.user;this.curUserApps=yield m.unitOneUserApps(this.unit.id,this.curUser.id,0,100),this.openVPage(Li)})),this.onAppEditUsers=(e=>Wi(this,void 0,void 0,function*(){this.appEditUsers=yield m.unitAppEditUsers(this.unit.id,this.curApp.id,e,0,100),this.openVPage(Di)})),this.onAddUser=(()=>{this.openVPage($i)}),this.onUserEditApps=(e=>Wi(this,void 0,void 0,function*(){this.userEditApps=yield m.unitUserEditApps(this.unit.id,this.curUser.id,e,0,100),this.openVPage(Bi)})),this.bindAppUser=((e,t)=>Wi(this,void 0,void 0,function*(){yield m.bindAppUser(this.unit.id,this.curApp.id,e.id,!0===t?1:0);let i=this.appUsersList.find(e=>e.app.id===this.curApp.id);if(!0===t)this.curAppUsers.push(e),i&&i.users.push(e);else{let t=this.curAppUsers.findIndex(t=>t.id===e.id);t>=0&&this.curAppUsers.splice(t,1),i&&(t=i.users.findIndex(t=>t.id===e.id))>=0&&i.users.splice(t,1)}})),this.bindUserApp=((e,t)=>Wi(this,void 0,void 0,function*(){if(yield m.bindAppUser(this.unit.id,e.id,this.curUser.id,!0===t?1:0),void 0===this.userAppsList)return;let i=this.userAppsList.find(e=>e.user.id===this.curUser.id);if(!0===t)this.curUserApps.push(e),i&&i.apps.push(e);else{let t=this.curUserApps.findIndex(t=>t.id===e.id);t>=0&&this.curUserApps.splice(t,1),i&&(t=i.apps.findIndex(t=>t.id===e.id))>=0&&i.apps.splice(t,1)}})),this.addUser=(e=>Wi(this,void 0,void 0,function*(){yield m.unitAddUser(this.unit.id,e)}))}internalStart(e){return Wi(this,void 0,void 0,function*(){this.unit=e;let t="bg-white px-3 py-2 my-1",i=n.createElement(l.FA,{name:"columns",className:"text-primary mr-3"}),s=n.createElement(l.FA,{name:"user-plus",className:"text-primary mr-3"}),r=n.createElement("button",{className:"btn btn-sm btn-success",onClick:this.onAddUser},n.createElement(l.FA,{name:"plus"}));this.openPage(n.createElement(o.Page,{header:"\u7528\u6237\u7ba1\u7406 - "+this.unit.name,right:r},n.createElement(l.LMR,{className:t,onClick:this.onAppUsers,left:i},"App"),n.createElement(l.LMR,{className:t,onClick:this.onUserApps,left:s},"\u7528\u6237")))})}loadAppUsers(e){return Wi(this,void 0,void 0,function*(){let t=[],i=yield m.unitAppUsers(this.unit.id,e,0,100),n=i[0],s=i[1],r={};for(let e of n){let i={id:e.id,name:e.name,discription:e.discription};t.push(r[e.id]={app:i,users:[]})}for(let e of s){let t={id:e.user,name:e.name,nick:e.nick,icon:e.icon,assigned:e.assigned};r[e.app].users.push(t)}this.appUsersList=t})}loadUserApps(e){return Wi(this,void 0,void 0,function*(){let t=[],i=yield m.unitUsers(this.unit.id,e,0,100),n=i[0],s=i[1],r={};for(let e of n){let i={id:e.id,name:e.name,nick:e.nick,icon:e.icon,assigned:e.assigned};t.push(r[e.id]={user:i,apps:[]})}for(let e of s){let t={id:e.app,name:e.name,discription:e.discription};r[e.user].apps.push(t)}this.userAppsList=t})}}zi([c.l],Qi.prototype,"userAppsList",void 0),zi([c.l],Qi.prototype,"appUsersList",void 0),zi([c.l],Qi.prototype,"curUserApps",void 0),zi([c.l],Qi.prototype,"userEditApps",void 0),zi([c.l],Qi.prototype,"curAppUsers",void 0),zi([c.l],Qi.prototype,"appEditUsers",void 0);var Ki=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},Gi=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};class Ji extends o.Controller{loadAdminUnits(){return Gi(this,void 0,void 0,function*(){let e=yield m.userAdminUnits(),t=this.adminUnits=e[0];console.log("loadAdminUnits",t),1===t.length&&(o.appInFrame.unit=t[0].id,yield L.loadUnit())})}internalStart(e){return Gi(this,void 0,void 0,function*(){if(L.init(),this.isProduction=document.location.hash.startsWith("#tv"),console.log("admins isProduction %s",this.isProduction),!1===this.isProduction)return yield this.loadAdminUnits(),void this.openVPage(Yi);yield L.loadUnit(),this.openVPage(Yi)})}}class Yi extends o.VPage{constructor(){super(...arguments),this.selectUnitPage=(()=>n.createElement(o.Page,{header:"\u9009\u62e9\u5c0f\u53f7",logout:Xi},n.createElement(l.List,{items:this.controller.adminUnits,item:{render:this.renderRow,onClick:this.onRowClick}}))),this.noUnitPage=(()=>{let{nick:e,name:t}=o.nav.user;return n.createElement(o.Page,{header:"\u6ca1\u6709\u5c0f\u53f7",logout:Xi},n.createElement("div",{className:"p-3 small text-info"},e||t,": \u6ca1\u6709\u9700\u8981\u7ba1\u7406\u7684\u5c0f\u53f7"))}),this.renderRow=((e,t)=>n.createElement(l.LMR,{className:"p-2",right:"id: "+e.id},n.createElement("div",null,e.nick||e.name))),this.onRowClick=(e=>Gi(this,void 0,void 0,function*(){o.appInFrame.unit=e.id,L.init(),yield L.loadUnit(),this.closePage(),this.openPageElement(n.createElement(tn,null))}))}open(){return Gi(this,void 0,void 0,function*(){let{isProduction:e,adminUnits:t}=this.controller;if(!1===e)switch(t.length){default:return void this.openPage(this.selectUnitPage);case 0:return void this.openPage(this.noUnitPage);case 1:return void this.openPageElement(n.createElement(tn,null))}void 0!==L.unit?this.openPageElement(n.createElement(tn,null)):this.openPage(this.noUnitPage)})}get view(){}}const Xi=()=>Gi(void 0,void 0,void 0,function*(){L.logout()}),Zi=n.createElement(l.FA,{name:"chevron-right"}),en={1:"\u5f00\u53d1\u53f7",2:"\u5c0f\u53f7",3:"\u7cfb\u7edf\u53f7"};let tn=class extends n.Component{constructor(){super(...arguments),this.appsAction={main:"\u542f\u505cApp",right:Zi,icon:"play-circle-o",page:Re},this.usersAction={main:"\u7528\u6237\u89d2\u8272",right:Zi,icon:"users",page:Je},this.newUsersAction={main:"\u7528\u6237\u7ba1\u7406",right:Zi,icon:"user-o",controller:new Qi(void 0)},this.adminsAction={main:"\u7ba1\u7406\u5458",right:Zi,icon:"universal-access",page:K},this.cOrganization=new mt,this.organizeAction={main:this.cOrganization.label,right:Zi,icon:this.cOrganization.icon,controller:this.cOrganization},this.noneAction={main:"\u8bf7\u8010\u5fc3\u7b49\u5f85\u5206\u914d\u4efb\u52a1",icon:"hourglass-start"},this.row=((e,t)=>{if("string"===typeof e)return n.createElement("div",{className:"px-3 pt-3 pb-1 small text-muted",style:{backgroundColor:"#f0f0f0"}},e);let i,s,r,{title:o}=e;if(void 0!==o){let{icon:t,count:a}=e;i=n.createElement(l.FA,{className:"text-primary",name:t,fixWidth:!0,size:"lg"}),s=o,r=a>0&&n.createElement("span",null,a)}else{let{right:t,main:o,icon:a}=e;i="string"===typeof a?n.createElement(l.FA,{className:"text-primary",name:a,fixWidth:!0,size:"lg"}):e.icon,s=o,r=n.createElement("span",null,t)}return n.createElement(l.LMR,{className:"px-3 py-2 align-items-center",left:i,right:r},n.createElement("div",{className:"px-3"},n.createElement("b",null,s)))}),this.rowClick=(e=>Gi(this,void 0,void 0,function*(){let{title:t}=e;if(void 0!==t){let{objProps:t,onClick:i}=e;return void 0!==t?o.nav.push(n.createElement(Si,Object.assign({},t))):void i()}{let{page:t,controller:i}=e;void 0!==t?o.nav.push(n.createElement(t,null)):yield i.start(L.unit)}}))}componentWillMount(){return Gi(this,void 0,void 0,function*(){let{unit:e,dev:t}=L,{isAdmin:i,isOwner:n,type:s}=e;this.caption=en[s],0!==(1&s)&&(yield L.dev.loadCounts())})}buildItems(){let{unit:e,dev:t}=L,{isAdmin:i,isOwner:n,type:s}=e,r=[];if(1===n&&r.push(this.adminsAction),console.log("unit:",e),1===i&&(0!==(2&s)&&r.push("\u5c0f\u53f7\u7ba1\u7406",this.appsAction,this.newUsersAction),0!==(1&s))){let{counts:i}=t,s={title:"APP",count:i&&i.app,icon:"tablet",onClick:()=>new Ut(void 0).start(e.id)},o={title:"UQ",count:i&&i.uq,icon:"database",onClick:()=>new ci(void 0).start(e.id)},a={title:"BUS",count:i&&i.bus,icon:"cogs",objProps:fi},l={title:"Server",count:i&&i.server,icon:"server",objProps:vi};r.push("\u5f00\u53d1\u53f7\u7ba1\u7406"),n>0&&r.push(s),r.push(o,a),n>0&&r.push(l)}return r}render(){let e=L.unit;if(void 0===e)return console.log("admin render without unit"),null;console.log("admin render with unit");let t,i,s=this.buildItems();if(void 0===s)return n.createElement(o.Page,{header:""});if(void 0!==e){let s,r,{name:a,nick:c,icon:u,discription:d}=e;c?(s=c,r=n.createElement("h6",null,n.createElement("small",{className:"text-secondary"},a))):s=a,void 0!==this.caption&&(t=this.caption+" - "+s),i=n.createElement(l.LMR,{className:"px-3 my-4 bg-white py-2 cursor-pointer",onClick:()=>o.nav.push(n.createElement(nn,null)),left:n.createElement("div",null,n.createElement(o.Image,{className:"w-3c h-3c",src:u}))},n.createElement("div",{className:"px-3"},n.createElement(l.LMR,{right:r},n.createElement("h6",{className:"text-dark font-weight-bold"},s)),n.createElement("div",{className:"small text-info"},d)))}else t="\u7cfb\u7edf\u7ba1\u7406";return n.createElement(o.Page,{header:t,logout:Xi},i,n.createElement(l.List,{items:s,item:{render:this.row,onClick:this.rowClick}}))}};tn=Ki([a.a],tn);class nn extends n.Component{constructor(){super(...arguments),this.schema=[{name:"icon",type:"image"},{name:"nick",type:"string"},{name:"discription",type:"string"}],this.uiSchema={items:{nick:{widget:"text",label:"\u522b\u540d",placeholder:"\u597d\u7684\u522b\u540d\u66f4\u65b9\u4fbf\u8bb0\u5fc6"},icon:{widget:"image",label:"\u6807\u5fd7\u56fe"},discription:{widget:"text",label:"\u63cf\u8ff0",placeholder:"\u7b80\u77ed\u6e05\u6670\u7684\u63cf\u8ff0"}}},this.onItemChanged=((e,t,i)=>Gi(this,void 0,void 0,function*(){let{name:i}=e;yield L.unitChangeProp(i,t)}))}render(){let e=L.unit,{isRoot:t,isOwner:i}=e;return n.createElement(o.Page,{header:"\u5c0f\u53f7\u4fe1\u606f"},n.createElement(o.Edit,{schema:this.schema,uiSchema:this.uiSchema,data:L.unit,onItemChanged:this.onItemChanged,stopEdit:!(t>0&&i>0)}))}}i(116);var sn=function(e,t,i,n){return new(i||(i=Promise))(function(s,r){function o(e){try{l(n.next(e))}catch(t){r(t)}}function a(e){try{l(n.throw(e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(o,a)}l((n=n.apply(e,t||[])).next())})};var rn=class extends n.Component{onLogined(){return sn(this,void 0,void 0,function*(){document.location,o.nav.clear();let e=new Ji({});yield e.start()})}render(){return n.createElement(o.NavView,{onLogined:this.onLogined})}};const on=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function an(e){navigator.serviceWorker.register(e).then(e=>{e.onupdatefound=(()=>{const t=e.installing;t&&(t.onstatechange=(()=>{"installed"===t.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}))})}).catch(e=>{console.error("Error during service worker registration:",e)})}i(118),i(120);r.render(n.createElement(rn,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL(".",window.location.toString()).origin!==window.location.origin)return;window.addEventListener("load",()=>{const e="./service-worker.js";on?function(e){fetch(e).then(t=>{404===t.status||-1===t.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(e=>{e.unregister().then(()=>{window.location.reload()})}):an(e)}).catch(()=>{console.log("No internet connection found. App is running in offline mode.")})}(e):an(e)})}}()}],[[92,4,3]]]);
//# sourceMappingURL=main.0695c184.chunk.js.map